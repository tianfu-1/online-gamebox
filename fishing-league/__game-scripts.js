var Physics=pc.createScript("physics");pc.Physics={},Physics.attributes.add("threshold",{type:"number",default:1.1}),Physics.attributes.add("frequency",{type:"number",default:1}),Physics.attributes.add("width",{type:"number",default:100}),Physics.attributes.add("height",{type:"number",default:100}),Physics.prototype.initialize=function(){this.kinematicCollisions=[],this.recentlyCollided=[],this.leavePool=[],this.raycastMinBounds=new pc.Vec3,this.raycastMaxBounds=new pc.Vec3,this.raycastDirection=new pc.Vec3,this.raycastTMin=new pc.Vec3,this.raycastTMax=new pc.Vec3,this.hitPoint=new pc.Vec3,pc.Physics.raycastFirst=this.raycastFirst.bind(this),pc.Physics.raycastLast=this.raycastLast.bind(this),this.on("destroy",this.onDestroy,this)},Physics.prototype.onDestroy=function(){},Physics.prototype.raycastFirst=function(t,i){var s=!1,a=1/0;for(var e in pc.app.systems.collision.store){var n=pc.app.systems.collision.store[e];if(n&&n.entity&&n.entity.enabled&&n.entity.collision.enabled&&"box"===n.data.type){var o=n.entity.getPosition(),r=n.data.halfExtents;this.raycastMinBounds.x=o.x-r.x,this.raycastMinBounds.y=o.y-r.y,this.raycastMinBounds.z=o.z-r.z,this.raycastMaxBounds.x=o.x+r.x,this.raycastMaxBounds.y=o.y+r.y,this.raycastMaxBounds.z=o.z+r.z,this.raycastDirection.sub2(i,t).normalize(),this.raycastTMin.x=(this.raycastMinBounds.x-t.x)/(this.raycastDirection.x||1e-5),this.raycastTMin.y=(this.raycastMinBounds.y-t.y)/(this.raycastDirection.y||1e-5),this.raycastTMin.z=(this.raycastMinBounds.z-t.z)/(this.raycastDirection.z||1e-5),this.raycastTMax.x=(this.raycastMaxBounds.x-t.x)/(this.raycastDirection.x||1e-5),this.raycastTMax.y=(this.raycastMaxBounds.y-t.y)/(this.raycastDirection.y||1e-5),this.raycastTMax.z=(this.raycastMaxBounds.z-t.z)/(this.raycastDirection.z||1e-5);var h=Math.min(this.raycastTMin.x,this.raycastTMax.x),c=Math.max(this.raycastTMin.x,this.raycastTMax.x),y=Math.min(this.raycastTMin.y,this.raycastTMax.y),l=Math.max(this.raycastTMin.y,this.raycastTMax.y),x=Math.min(this.raycastTMin.z,this.raycastTMax.z),d=Math.max(this.raycastTMin.z,this.raycastTMax.z),M=Math.max(Math.max(h,y),x),u=Math.min(Math.min(c,l),d);M<=u&&u>=0&&M<a&&(a=M,s=n.entity,this.hitPoint.copy(this.raycastDirection).scale(M).add(t))}}return{entity:s,point:this.hitPoint,distance:a!==1/0&&a}},Physics.prototype.raycastLast=function(t,i){var s=!1,a=-1/0;for(var e in pc.app.systems.collision.store){var n=pc.app.systems.collision.store[e];if(n&&n.entity&&n.entity.enabled&&n.entity.collision.enabled&&"box"===n.data.type){var o=n.entity.getPosition(),r=n.data.halfExtents;this.raycastMinBounds.x=o.x-r.x,this.raycastMinBounds.y=o.y-r.y,this.raycastMinBounds.z=o.z-r.z,this.raycastMaxBounds.x=o.x+r.x,this.raycastMaxBounds.y=o.y+r.y,this.raycastMaxBounds.z=o.z+r.z,this.raycastDirection.sub2(i,t).normalize(),this.raycastTMin.x=(this.raycastMinBounds.x-t.x)/(this.raycastDirection.x||1e-5),this.raycastTMin.y=(this.raycastMinBounds.y-t.y)/(this.raycastDirection.y||1e-5),this.raycastTMin.z=(this.raycastMinBounds.z-t.z)/(this.raycastDirection.z||1e-5),this.raycastTMax.x=(this.raycastMaxBounds.x-t.x)/(this.raycastDirection.x||1e-5),this.raycastTMax.y=(this.raycastMaxBounds.y-t.y)/(this.raycastDirection.y||1e-5),this.raycastTMax.z=(this.raycastMaxBounds.z-t.z)/(this.raycastDirection.z||1e-5);var h=Math.min(this.raycastTMin.x,this.raycastTMax.x),c=Math.max(this.raycastTMin.x,this.raycastTMax.x),y=Math.min(this.raycastTMin.y,this.raycastTMax.y),l=Math.max(this.raycastTMin.y,this.raycastTMax.y),x=Math.min(this.raycastTMin.z,this.raycastTMax.z),d=Math.max(this.raycastTMin.z,this.raycastTMax.z),M=Math.max(Math.max(h,y),x),u=Math.min(Math.min(c,l),d);M<=u&&u>=0&&M>a&&(a=M,s=n.entity,this.hitPoint.copy(this.raycastDirection).scale(M).add(t))}}return{entity:s,point:this.hitPoint,distance:a!==-1/0&&a}},Physics.prototype.updateKinematic=function(){if(Date.now()-this.lastKinematicUpdate<1e3*this.frequency)return!1;this.kinematicCollisions=[];var t=this;for(var i in pc.app.systems.collision.store){var s=pc.app.systems.collision.store[i];s.entity&&s.entity.tags.list().indexOf("Dynamic")>-1&&(-1===s.entity.tags.list().indexOf("Ghost")?s.entity._translate||(s.entity.revertTranslate=function(i){if(i==this)return!1;var s=this.getPosition();if(!s)return!1;var a=i.getPosition(),e=t.lookAt(a.x,a.z,s.x,s.z),n=s.clone().sub(this.previousPosition).length()*t.threshold,o=e-Math.PI,r=Math.cos(o)*n,h=Math.sin(o)*n;this._translate(-h,0,-r)},s.entity._translate=s.entity.translate,s.entity.previousPosition=s.entity.getPosition().clone(),s.entity.translate=function(i,s,a){if(!this.collision.enabled)return this._translate(i,s,a),!1;this.getPosition().clone();this.previousPosition=this.getPosition().clone(),this._translate(i,s,a);var e=this.getPosition();if(e.x<-t.width/2||e.x>t.width/2||e.z<-t.height/2||e.z>t.height/2){var n=0,o=0;e.x<-t.width/2?n=-t.width/2-e.x:e.x>t.width/2&&(n=t.width/2-e.x),e.z<-t.height/2?o=-t.height/2-e.z:e.z>t.height/2&&(o=t.height/2-e.z),this._translate(n,0,o)}}.bind(s.entity)):s.entity.revertTranslate=function(){},this.kinematicCollisions.push(s.entity))}this.lastKinematicUpdate=Date.now()},Physics.prototype.checkCollisions=function(t){this.triggerPool=[];for(var i=this.kinematicCollisions.length;i--;){for(var s=this.kinematicCollisions[i],a=Object.values(pc.app.systems.collision.store),e=a.length;e--;){(o=a[e])&&o.entity.parent&&o.entity.enabled&&o.entity.collision.enabled&&("sphere"==o.data.type?this.calculateSphereCollision(s,o,t):"box"==o.data.type&&this.calculateBoxCollision(s,o,t))}if(this.triggerPool.sort((function(t,i){return t.distance-i.distance})),this.triggerPool.length>0)for(var n=0;n<this.triggerPool.length;n++){var o=this.triggerPool[n];this.triggerPool[n].object.entity}}},Physics.prototype.calculateSphereCollision=function(t,i,s){if(!t)return!1;if(!t.collision)return!1;var a=t.getPosition().clone(),e=i.entity.getPosition().clone(),n=a.distance(e),o=i.data.radius,r=i.entity.tags.list().indexOf("Ghost")>-1;n<t.collision.radius+o&&(this.triggerPool.push({distance:n,object:i}),i.entity.fire("Trigger",t,s),t.fire("Collision",i.entity),this.addTriggerPool(i.entity,t),r||t.revertTranslate(i.entity))},Physics.prototype.calculateBoxCollision=function(t,i,s){if(!t||!t.collision)return!1;var a=t.getPosition(),e=i.entity.getPosition(),n=i.data.halfExtents,o=t.collision.radius,r=i.entity.tags.list().indexOf("Ghost")>-1,h=new pc.Vec3(Math.max(e.x-n.x,Math.min(a.x,e.x+n.x)),a.y,Math.max(e.z-n.z,Math.min(a.z,e.z+n.z))),c=a.distance(h);if(c<o&&(this.triggerPool.push({distance:c,object:i}),i.entity.fire("Trigger",t,s),t.fire("Collision",i.entity),this.addTriggerPool(i.entity,t),!r)){var y=new pc.Vec3;y.sub2(a,h).normalize();var l=o-c,x=y.scale(1.01*l);t._translate(x.x,0,x.z)}},Physics.prototype.addTriggerPool=function(t,i){for(var s=!1,a=this.leavePool.length;a--;){var e=this.leavePool[a];e.entity===t&&e.who===i&&(s=!0,e.time=Date.now())}s||this.leavePool.push({entity:t,who:i,time:Date.now()})},Physics.prototype.updateTriggerPool=function(t){for(var i=this.leavePool.length;i--;){var s=this.leavePool[i];Date.now()-s.time>60&&(this.leavePool[i].entity.fire("Leave",this.leavePool[i].who,t),this.leavePool.splice(i,1))}},Physics.prototype.update=function(t){this.updateKinematic(),this.checkCollisions(t),this.updateTriggerPool(t)},Physics.prototype.lookAt=function(t,i,s,a){return Math.atan2(s-t,a-i)};var Camera=pc.createScript("camera");Camera.attributes.add("pitchEntity",{type:"entity"}),Camera.attributes.add("yawEntity",{type:"entity"}),Camera.attributes.add("cameraEntity",{type:"entity"}),Camera.attributes.add("cameraRaycastEntity",{type:"entity"}),Camera.attributes.add("playerEntity",{type:"entity"}),Camera.attributes.add("centerEntity",{type:"entity"}),Camera.attributes.add("speed",{type:"number",default:1}),Camera.attributes.add("turnSpeed",{type:"number",default:.002}),Camera.attributes.add("mobileTurnSpeed",{type:"number",default:.5}),Camera.attributes.add("maxAngle",{type:"number",default:90}),Camera.attributes.add("minAngle",{type:"number",default:-35}),Camera.attributes.add("lookX",{type:"number",default:38}),Camera.attributes.add("lookY",{type:"number",default:39}),Camera.attributes.add("fov",{type:"number",default:65}),Camera.attributes.add("mobileFov",{type:"number",default:75}),Camera.attributes.add("maxCameraDistance",{type:"number",default:2.5}),Camera.attributes.add("mobileMaxCameraDistance",{type:"number",default:2.5}),Camera.attributes.add("minCameraDistanceEntity",{type:"entity"}),Camera.prototype.initialize=function(){this.nextPosition=new pc.Vec3,this.nextDirection=0,this.minCameraDistance=5,this._applyOrientationSettings(),window.addEventListener("resize",this._applyOrientationSettings.bind(this)),this.isLocked=!1,this.app.on("MobileTouch:ActionState",this.setActionState,this),this.app.on("Camera:SetLook",this.onSetLook,this),this.setController()},Camera.prototype.setActionState=function(t){this.actionState=t,this.onTouchEnd()},Camera.prototype._applyOrientationSettings=function(){var t=Utils.isMobile(),i=window.innerWidth>window.innerHeight;!t||i?(this.cameraEntity.camera.fov=this.fov,this.currentMaxCameraDistance=this.maxCameraDistance):(this.cameraEntity.camera.fov=this.mobileFov,this.currentMaxCameraDistance=this.mobileMaxCameraDistance)},Camera.prototype.setController=function(){this.isTouching=!1,this.lastTouchPosition=new pc.Vec2(0,0),this.touchID=!1,Utils.isMobile()?(this.currentMaxCameraDistance=this.mobileMaxCameraDistance,this.app.on("TouchManager:RotationStart",this.onTouchStart,this),this.app.on("TouchManager:RotationMove",this.onTouchMove,this),this.app.on("TouchManager:RotationEnd",this.onTouchEnd,this)):(this.app.on("Mouse:Lock",this.onMouseLock,this),this.app.mouse.on("mousedown",this.onMouseDown,this),this.app.mouse.on("mousemove",this.onMouseMove,this),this.app.mouse.on("mouseup",this.onMouseUp,this))},Camera.prototype.onSetLook=function(t,i){void 0!==t&&(this.lookX=t),void 0!==i&&(this.lookY=i)},Camera.prototype.onTouchStart=function(t){if(this.actionState)return!1;this.isTouching=!0,this.lastTouchPosition.x=t.x,this.lastTouchPosition.y=t.y},Camera.prototype.onTouchMove=function(t){if(this.actionState)return!1;this.lookX-=(t.x-this.lastTouchPosition.x)*this.mobileTurnSpeed*this.dt*60,this.lookY+=(t.y-this.lastTouchPosition.y)*this.mobileTurnSpeed*this.dt*60,this.lastTouchPosition.x=t.x,this.lastTouchPosition.y=t.y,this.lookY=Math.max(this.lookY,this.minAngle),this.lookY=Math.min(this.lookY,this.maxAngle)},Camera.prototype.normalize=function(t,i){var e=Math.sqrt(t*t+i*i);return 0===e?{x:0,y:0}:{x:t/e,y:i/e}},Camera.prototype.onTouchEnd=function(){this.isTouching=!1,this.touchID=!1},Camera.prototype.onMouseLock=function(){var t=this;if(pc.hasActiveInterface||pc.activePopup3D)return!1;this.app.mouse.enablePointerLock((function(){t.isLocked=!0,pc.app.fire("Overlay:MouseLocked",!0)}))},Camera.prototype.onMouseDown=function(){this.onMouseLock()},Camera.prototype.onMouseUp=function(){},Camera.prototype.onMouseMove=function(t){if(!pc.Mouse.isPointerLocked())return!1;this.lookX-=t.dx*this.turnSpeed*60,this.lookY+=t.dy*this.turnSpeed*60,this.lookY=Math.max(this.lookY,this.minAngle),this.lookY=Math.min(this.lookY,this.maxAngle)},Camera.prototype.updatePosition=function(t){this.dt=t;this.nextPosition=this.nextPosition.lerp(this.nextPosition,this.centerEntity.getPosition(),.9),this.entity.setPosition(this.nextPosition),this.yawEntity.setLocalEulerAngles(0,this.lookX,0),this.pitchEntity.setLocalEulerAngles(-this.lookY,0,0)},Camera.prototype.raycastClip=function(){var t=this.centerEntity.getPosition(),i=this.cameraRaycastEntity.getPosition(),e=pc.Physics.raycastFirst(t,i);e.entity?e.distance>this.currentMaxCameraDistance?this.cameraEntity.setLocalPosition(0,0,this.currentMaxCameraDistance):this.cameraEntity.setLocalPosition(0,0,e.distance-.2):this.cameraEntity.setLocalPosition(0,0,this.currentMaxCameraDistance)},Camera.prototype.update=function(t){this.updatePosition(t),this.raycastClip(),this.playerEntity&&(this.playerEntity.script.player.isometric=-this.lookX)};var Player=pc.createScript("player");Player.attributes.add("inPvP",{type:"boolean",default:!1}),Player.attributes.add("speed",{type:"number",default:.1}),Player.attributes.add("snapOffset",{type:"number",default:.1}),Player.attributes.add("offset",{type:"vec3"}),Player.attributes.add("jumpDuration",{type:"number",default:100}),Player.attributes.add("jumpForce",{type:"number",default:5}),Player.attributes.add("gravity",{type:"number",default:9.8}),Player.attributes.add("fallThreshold",{type:"number",default:0}),Player.attributes.add("startAngle",{type:"number",default:0}),Player.attributes.add("isometric",{type:"number",default:0}),Player.attributes.add("turnSpeed",{type:"number",default:.05}),Player.attributes.add("characterEntity",{type:"entity"}),Player.attributes.add("rodEntity",{type:"entity"}),Player.attributes.add("bodyEntity",{type:"entity"}),Player.attributes.add("originEntity",{type:"entity"}),Player.attributes.add("runningParticles",{type:"entity"}),Player.attributes.add("usernameEntity",{type:"entity"}),Player.attributes.add("mapHolder",{type:"entity"}),Player.attributes.add("fishModel",{type:"entity"}),Player.attributes.add("armEntity",{type:"entity"}),Player.attributes.add("handEntity",{type:"entity"}),Player.attributes.add("armAngle",{type:"vec3"}),Player.attributes.add("maxUsernameLength",{type:"number",default:16}),Player.attributes.add("vipIconEntity",{type:"entity"}),Player.attributes.add("auraHolder",{type:"entity"}),Player.attributes.add("shopManager",{type:"entity"}),Player.attributes.add("terrainEntity",{type:"entity"}),Player.attributes.add("emotes",{type:"json",schema:[{name:"button",type:"entity"},{name:"unlocked",type:"boolean",default:!0}],array:!0}),Player.prototype.initialize=function(){this.currentSpeed=0,this.nextSpeed=0,this.speedMultiplier=1,this.tempSpeedMultiplier=1,this.isDead=!1,this.isUnderWater=!1,this.airSpeed=0,this.isGrounded=!0,this.variables={},this.functionVariables={},this.velocity=new pc.Vec3(0,0,0),this.spawnPosition=this.entity.getPosition().clone(),this.respawnPosition=this.getSpawnPosition(),this.groundEntities=[],this.scanGroundEntities(),this.lastJump=-1,this.lastVIP=Date.now(),this.focusDirection=0,this.isFocusing=!1,this.animationSpeed=1,this.isRunningThreadmill=!1,this.isRunning=!1,this.isJumpinp=!1,this.direction=this.startAngle*pc.math.DEG_TO_RAD,this.nextDirection=this.startAngle*pc.math.DEG_TO_RAD;var t=Utils.getItem("Username");this.entity.username=t||Utils.generateUsername(),this.usernameEntity.element.text=this.entity.username,this.app.on("Player:ChangeUsername",this.changeUsername,this),this.renderEmotes(),this.app.on("Player:Emote",this.onEmote,this),this.app.on("Player:Jump",this.jump,this),this.app.on("Player:Teleport",this.teleport,this),this.app.on("Player:Focus",this.onFocus,this),this.entity.on("Player:SetAura",this.setAura,this),this.entity.on("Player:SetSpeedMultiplier",this.setSpeedMultiplier,this),this.app.on("Scan:Ground",this.scanGroundEntities,this),this.entity.on("Player:Die",this.setDeath,this),setTimeout((function(t){t.setAura(pc.IdleManager.CurrentAuraEquipped)}),500,this),setTimeout((function(t){t.currentAura&&(t.currentAura.enabled=!1,setTimeout((function(t){t.currentAura.enabled=!0}),100,t))}),2e3,this),this.lastBroadcast=Date.now(),pc.platform.ios||(this.jumpForce=1,this.jumpDuration=200,this.gravity=.8),this.jumpTimer=0},Player.prototype.getSpawnPosition=function(){var t=new pc.Vec3(0,0,0),e=this.mapHolder.findByTag("PlayerSpawnPosition");for(var i in e){var n=e[i];!0===n.enabled&&(t=n.getPosition().clone())}return t},Player.prototype.scanGroundEntities=function(){var t=this;this.groundEntities=[],this.app.root.findByTag("Ground").forEach((function(e){t.groundEntities.push({entity:e,position:e.getPosition().clone(),scale:e.getLocalScale().clone()})}))},Player.prototype.onFocus=function(t,e){this.isFocusing=t,t&&(this.focusDirection=e)},Player.prototype.setDeath=function(){if(this.isDead)return!1;this.stop(),this.isDead=!0,this.setVariableState("Walking",!1),this.setVariableState("Running",!1),setTimeout((function(t){t.characterEntity.anim.setTrigger("Death")}),150,this),setTimeout((function(t){t.characterEntity.anim.setTrigger("Respawn"),t.isDead=!1}),5e3,this)},Player.prototype.setSpeedMultiplier=function(t){this.speedMultiplier=t},Player.prototype.renderEmotes=function(){for(var t in this.emotes){var e=this.emotes[t];if(e.button){var i=e.button.findByName("Rewarded");e.unlocked?i.enabled=!1:i.enabled=!0}}},Player.prototype.onEmote=function(t){var e=this,i=!0;for(var n in this.emotes){var s=this.emotes[n];if(s.button&&s.button.name==t){s.unlocked||(i=!1,PokiPlugin.showRewardWithoutGameplay((function(){var t=s.button.findByName("Rewarded");t&&(t.enabled=!1),e.emotes[n].unlocked=!0})));break}}if(!i)return!1;this.app.fire("NetworkManager:Send","triggerFunction",{name:"Emote",value:t}),this.entity.fire("Emotes:Play",t),setTimeout((t=>{t.app.fire("PopupManager:Hide")}),100,this)},Player.prototype.onRewardedEmote=function(t){this.app.fire("NetworkManager:Send","triggerFunction",{name:"Emote",value:t}),this.entity.fire("Emotes:Play",t),setTimeout((t=>{t.app.fire("PopupManager:Hide")}),100,this)},Player.prototype.setAura=function(t,e){if(-1==(t=parseInt(t))&&e)this.setAura(pc.IdleManager.CurrentAuraEquipped);else{for(var i=this.auraHolder.children,n=0;n<this.auraHolder.children.length;n++)this.auraHolder.children[n].enabled=!1;-1==t?this.currentAura=null:(this.currentAura=i[t],this.currentAura.enabled=!0),this.currentAuraIndex=t}},Player.prototype.changeUsername=function(t){if(!t||0==t.length)return!1;if(t.length>this.maxUsernameLength)return this.app.fire("Overlay:Alert",`Username cannot exceed ${this.maxUsernameLength} characters`),!1;var e=Utils.getCussWords();if(Utils.checkSimilarity(t,e))return this.app.fire("Overlay:Alert","Username contains bad words"),!1;this.entity.username=t,this.usernameEntity.element.text=this.entity.username,this.app.fire("NetworkManager:Send","changeUsername",t),this.app.fire("PopupManager:Hide"),Utils.setItem("Username",this.entity.username)},Player.prototype.stop=function(){this.isRunningThreadmill=!1,this.isCycling=!1,this.isDeadlift=!1,this.characterEntity.anim.setBoolean("Ready",!1)},Player.prototype.ready=function(){this.isRunningThreadmill=!1,this.isCycling=!1,this.isDeadlift=!1,this.characterEntity.anim.setBoolean("Ready",!0)},Player.prototype.run=function(){this.isRunningThreadmill=!0,this.isCycling=!1,this.isDeadlift=!1,this.characterEntity.anim.setBoolean("Ready",!1)},Player.prototype.cycling=function(){this.isCycling=!0,this.isRunningThreadmill=!1,this.characterEntity.anim.setBoolean("Ready",!1)},Player.prototype.teleport=function(t){t&&this.entity.setPosition(t.x,t.y,t.z)},Player.prototype.jump=function(){if(pc.hasActiveInterface)return!1;if(this.isDead)return!1;if(this.isGrounded){if(this.jumpCooldownTimer>0)return!1;this.jumpCooldownTimer=.55,this.isJumping=!0,this.isGrounded=!1,this.airSpeed=this.currentSpeed,setTimeout((t=>{if(pc.hasActiveInterface)return!1;t.isJumping=!1}),200,this),this.lastJump=Date.now(),this.bodyEntity.fire("Motion","Jump"),this.characterEntity.anim.setTrigger("Jump"),this.rodEntity.anim.setTrigger("Jump"),this.jumpTimer=this.jumpDuration/1e3,this.app.fire("NetworkManager:Send","triggerFunction",{name:"Jump"}),this.app.fire("Player:Jumped")}},Player.prototype.setVariableState=function(t,e){this.variables[t]!==e&&(this.app.fire("NetworkManager:Send","animSetBoolean",{name:t,value:e}),this.variables[t]=e)},Player.prototype.setTriggerFunction=function(t,e){this.functionVariables[t]!==e&&(this.app.fire("NetworkManager:Send","triggerFunction",{name:t,value:e}),this.functionVariables[t]=e)},Player.prototype.updateAnimations=function(){this.setVariableState("Swimming",this.isUnderWater),this.setVariableState("Walking",this.isRunning),this.setVariableState("Running",this.isRunningThreadmill),this.setVariableState("Cycling",this.isCycling),Date.now()-this.lastVIP>1e3&&(pc.IdleManager.AdsWatchedVIP>=this.shopManager.script.shopManager.maxVIPAds?this.vipIconEntity.enabled=!0:this.vipIconEntity.enabled=!1,this.setTriggerFunction("VIP",this.vipIconEntity.enabled),this.setTriggerFunction("Aura",this.currentAuraIndex),this.lastVIP=Date.now())},Player.prototype.broadcastPosition=function(){if(Date.now()-this.lastBroadcast<160)return!1;this.updateAnimations();var t=this.entity.getPosition().clone(),e=this.direction;this.app.fire("NetworkManager:Send","p",{x:t.x,y:t.y,z:t.z,w:e}),this.lastBroadcast=Date.now()},Player.prototype.checkGroundCollision=function(){for(var t=this.entity.getPosition(),e=!1,i=0,n=!0,s=0;s<this.groundEntities.length;s++){var a=this.groundEntities[s],r=a.entity,o=a.scale.clone().scale(.5),h=a.position.x-o.x,u=a.position.x+o.x,p=(a.position.y,o.y,a.position.y+o.y),l=a.position.z-o.z,d=a.position.z+o.z;if(r.tags.has("noTP")&&!this.isJumping&&(n=!1),t.x>=h&&t.x<=u&&t.z>=l&&t.z<=d&&t.y<p){e=!0,i=p;break}}return{isOnGround:e,snapHeight:i,shouldTeleport:n}},Player.prototype.updateGravity=function(t){var e=this.entity.getPosition();if(this.entity.translate(0,this.velocity.y*t,0),this.jumpTimer>=0)return this.velocity.y+=this.jumpForce*t*60,void(this.jumpTimer-=t);var i=this.checkGroundCollision();i.isOnGround?(this.entity.setPosition(e.x,i.snapHeight-this.snapOffset,e.z),this.velocity.y=0,this.isGrounded=!0):this.velocity.y-=this.gravity*t*60,e.y<this.fallThreshold&&this.respawn()},Player.prototype.respawn=function(){this.respawnPosition=this.getSpawnPosition(),this.entity.setPosition(this.respawnPosition.x,this.respawnPosition.y,this.respawnPosition.z),this.velocity.set(0,0,0),this.isJumping=!1,this.isFalling=!1,this.characterEntity.anim.setTrigger("Respawn"),this.isDead=!1,this.app.fire("NetworkManager:Send","triggerFunction",{name:"Respawn"})},Player.prototype.update=function(t){if(pc.hasActiveInterface)return!1;if(this.isDead)return!1;this.isRunning?this.nextSpeed=this.speed*this.speedMultiplier*this.tempSpeedMultiplier:this.nextSpeed=0,this.isFocusing&&(this.currentSpeed=0,this.nextSpeed=0),this.currentSpeed=pc.math.lerp(this.currentSpeed,this.nextSpeed,10*t),this.jumpCooldownTimer>0&&(this.jumpCooldownTimer-=t);var e=this.turnSpeed,i=this.nextDirection*pc.math.DEG_TO_RAD,n=Math.cos(i)*this.currentSpeed*t,s=Math.sin(i)*this.currentSpeed*t;this.isGrounded||(n+=Math.cos(i)*this.airSpeed*.2*t,s+=Math.sin(i)*this.airSpeed*.2*t),this.updateGravity(t),this.entity.translate(n,0,s);var a=i;this.isFocusing&&(a=this.focusDirection*pc.math.DEG_TO_RAD),this.direction=Utils.rotate(this.direction,a,e),this.originEntity.setLocalEulerAngles(0,90-this.direction*pc.math.RAD_TO_DEG,0),this.characterEntity.anim.setBoolean("Walking",this.isRunning),this.rodEntity.anim.setBoolean("Walking",this.isRunning),this.characterEntity.anim.setBoolean("Running",this.isRunningThreadmill),this.characterEntity.anim.setBoolean("Swimming",this.isUnderWater),this.runningParticles.enabled=this.isRunning,this.broadcastPosition()},Player.prototype.postUpdate=function(t){this.fishModel.model.asset&&(this.armEntity.setLocalEulerAngles(this.armAngle),this.handEntity.setLocalEulerAngles(0,0,0))};var Keyboard=pc.createScript("keyboard");Keyboard.prototype.initialize=function(){this.isMouseLocked=!1,this.player=this.entity.script.player,this.app.on("PointerLock:Change",this.onPointerChange,this)},Keyboard.prototype.onPointerChange=function(s){this.isMouseLocked=s},Keyboard.prototype.update=function(s){this.player.isFocusing?this.player.isRunning=!1:(this.player.isRunning=!1,this.isMouseLocked&&((this.app.keyboard.isPressed(pc.KEY_W)||this.app.keyboard.isPressed(pc.KEY_UP))&&(this.player.nextDirection=-90+this.player.isometric,this.player.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_A)||this.app.keyboard.isPressed(pc.KEY_LEFT))&&(this.player.nextDirection=-180+this.player.isometric,this.player.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_D)||this.app.keyboard.isPressed(pc.KEY_RIGHT))&&(this.player.nextDirection=0+this.player.isometric,this.player.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_S)||this.app.keyboard.isPressed(pc.KEY_DOWN))&&(this.player.nextDirection=90+this.player.isometric,this.player.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_W)||this.app.keyboard.isPressed(pc.KEY_UP))&&(this.app.keyboard.isPressed(pc.KEY_A)||this.app.keyboard.isPressed(pc.KEY_LEFT))&&(this.player.nextDirection=-135+this.player.isometric,this.player.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_W)||this.app.keyboard.isPressed(pc.KEY_UP))&&(this.app.keyboard.isPressed(pc.KEY_D)||this.app.keyboard.isPressed(pc.KEY_RIGHT))&&(this.player.nextDirection=-45+this.player.isometric,this.player.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_S)||this.app.keyboard.isPressed(pc.KEY_DOWN))&&(this.app.keyboard.isPressed(pc.KEY_A)||this.app.keyboard.isPressed(pc.KEY_LEFT))&&(this.player.nextDirection=135+this.player.isometric,this.player.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_S)||this.app.keyboard.isPressed(pc.KEY_DOWN))&&(this.app.keyboard.isPressed(pc.KEY_D)||this.app.keyboard.isPressed(pc.KEY_RIGHT))&&(this.player.nextDirection=45+this.player.isometric,this.player.isRunning=!0),this.app.keyboard.wasPressed(pc.KEY_SPACE)&&this.player.jump(),this.app.keyboard.wasPressed(pc.KEY_Q)&&this.app.fire("PopupManager:Show","Quest"),this.app.keyboard.wasPressed(pc.KEY_V)&&this.app.fire("PopupManager:Show","InviteFriends"),this.app.keyboard.wasPressed(pc.KEY_G)&&(this.app.fire("PopupManager:Show","Emotes"),this.app.mouse.disablePointerLock()),this.app.keyboard.wasPressed(pc.KEY_P)&&(this.app.fire("PopupManager:Show","Settings"),this.app.mouse.disablePointerLock()),this.app.keyboard.wasPressed(pc.KEY_E)&&this.app.fire("RewardManager:CollectCoins"),this.app.keyboard.wasPressed(pc.KEY_H)&&this.app.fire("BossFight:PowerBoost")))};var MobileTouch=pc.createScript("mobileTouch");MobileTouch.attributes.add("cameraEntity",{type:"entity"}),MobileTouch.attributes.add("touchEntity",{type:"entity"}),MobileTouch.attributes.add("touchStartEntity",{type:"entity"}),MobileTouch.attributes.add("touchMoveEntity",{type:"entity"}),MobileTouch.attributes.add("touchDirectionEntity",{type:"entity"}),MobileTouch.prototype.initialize=function(){var t=this;this.actionState=!1,this.playerPause=!0,this.player=this.entity.script.player,this.OGtouchPosition=this.touchEntity.getPosition().clone(),this.app.on("MobileTouch:ActionState",this.setActionState,this),window.addEventListener("orientationchange",(function(){t.OGtouchPosition=t.touchEntity.getPosition().clone()})),Utils.isMobile()?this.setController():this.touchEntity.enabled=!1},MobileTouch.prototype.setActionState=function(t){this.actionState=t,this.onTouchEnd()},MobileTouch.prototype.setController=function(){this.isTouching=!1,this.touchStart=new pc.Vec2(0,0),this.currentTouch=new pc.Vec2(0,0),this.app.on("TouchManager:MovementStart",this.onTouchStart,this),this.app.on("TouchManager:MovementMove",this.onTouchMove,this),this.app.on("TouchManager:MovementEnd",this.onTouchEnd,this)},MobileTouch.prototype.onTouchStart=function(t){if(this.actionState)return!1;this.touchStart.x=t.x,this.touchStart.y=t.y,this.isTouchMoved=!1,this.totalMouseDistance=0,this.setTouchEntityPosition(),this.touchEntity.enabled=!0,this.touchMoveEntity.setLocalPosition(0,0,0),this.isTouching=!0},MobileTouch.prototype.onTouchMove=function(t){if(this.actionState)return!1;this.currentTouch.x=t.x,this.currentTouch.y=t.y,this.isTouchMoved=!0;var i=this.currentTouch.x-this.touchStart.x,o=this.currentTouch.y-this.touchStart.y,h=75;if(i>h?i=h:i<-75&&(i=-75),o>h?o=h:o<-75&&(o=-75),this.touchMoveEntity.setLocalPosition(2*i,2*-o,0),this.totalMouseDistance=Utils.distance(this.touchStart.x,this.touchStart.y,this.currentTouch.x,this.currentTouch.y),this.touchMoveEntity.enabled=!0,this.totalMouseDistance>=h){var e=this.currentTouch.x-this.touchStart.x,c=this.currentTouch.y-this.touchStart.y,n=this.normalize(e,c),s=Math.min(Math.max(this.totalMouseDistance,0),h);this.touchStart.x=this.currentTouch.x-n.x*s,this.touchStart.y=this.currentTouch.y-n.y*s,this.setTouchEntityPosition()}},MobileTouch.prototype.normalize=function(t,i){var o=Math.sqrt(t*t+i*i);return 0===o?{x:0,y:0}:{x:t/o,y:i/o}},MobileTouch.prototype.onTouchEnd=function(){this.isTouching=!1,this.setTouchEntityToOGPosition()},MobileTouch.prototype.setTouchEntityPosition=function(){var t=this.app.graphicsDevice.canvas,i=this.touchStart.x/t.clientWidth*2-1,o=1-this.touchStart.y/t.clientHeight*2;this.touchEntity.setPosition(i,o,0)},MobileTouch.prototype.setTouchEntityToOGPosition=function(){this.touchEntity.setPosition(this.OGtouchPosition.x,this.OGtouchPosition.y,0),this.touchMoveEntity.setLocalPosition(0,0,0),this.touchDirectionEntity.enabled=!1},MobileTouch.prototype.setTouch=function(){if(this.isTouching&&this.isTouchMoved){var t=Utils.lookAt(this.touchStart.x,this.touchStart.y,this.currentTouch.x,this.currentTouch.y),i=-this.cameraEntity.script.camera.lookX;this.player.nextDirection=(-t+Math.PI/2)*pc.math.RAD_TO_DEG+i;var o=this.player.nextDirection-i;this.player.isRunning=!0,this.touchDirectionEntity.setLocalEulerAngles(0,0,-o),this.touchDirectionEntity.enabled=this.totalMouseDistance>50}},MobileTouch.prototype.update=function(t){PokiPlugin.isGamePaused||this.setTouch()};var TouchManager=pc.createScript("touchManager");TouchManager.prototype.initialize=function(){this.setController()},TouchManager.prototype.setController=function(){if(!Utils.isMobile())return!1;this.movementTouchID=-1,this.rotationTouchID=-1,this.app.touch.on("touchstart",this.onTouchStart,this),this.app.touch.on("touchmove",this.onTouchMove,this),this.app.touch.on("touchend",this.onTouchEnd,this)},TouchManager.prototype.onTouchStart=function(o){var t=o.touches;if(t||(t=[o]),!PokiPlugin.isGamePaused&&t.length>0)for(i=0;i<t.length;i++){var h=t[i];h.x<this.app.graphicsDevice.canvas.width/2?-1==this.movementTouchID&&(this.movementTouchID=h.id,this.app.fire("TouchManager:MovementStart",h)):-1==this.rotationTouchID&&(this.rotationTouchID=h.id,this.app.fire("TouchManager:RotationStart",h))}},TouchManager.prototype.onTouchMove=function(o){var t=o.touches;if(t||(t=[o]),!PokiPlugin.isGamePaused&&t.length>0)for(i=0;i<t.length;i++){var h=t[i];h.id==this.movementTouchID?this.app.fire("TouchManager:MovementMove",h):h.id==this.rotationTouchID&&this.app.fire("TouchManager:RotationMove",h)}},TouchManager.prototype.onTouchEnd=function(o){var t=o.touches;if(t||(t=[o]),!PokiPlugin.isGamePaused)if(t.length>0)for(i=0;i<t.length;i++){var h=t[i];h.id==this.movementTouchID?(this.rotationTouchID=-1,this.app.fire("TouchManager:RotationEnd")):h.id==this.rotationTouchID&&(this.movementTouchID=-1,this.app.fire("TouchManager:MovementEnd"))}else this.app.fire("TouchManager:MovementEnd"),this.app.fire("TouchManager:RotationEnd"),this.movementTouchID=-1,this.rotationTouchID=-1};var Motion=pc.createScript("motion");Motion.attributes.add("motions",{type:"json",schema:[{name:"name",type:"string"},{name:"position",type:"curve",curves:["x","y","z"]},{name:"rotation",type:"curve",curves:["x","y","z"]},{name:"scale",type:"curve",curves:["x","y","z"]},{name:"speed",type:"number",default:1},{name:"autoplay",type:"boolean",default:!1},{name:"loop",type:"boolean",default:!1}],array:!0}),Motion.attributes.add("events",{type:"json",schema:[{name:"animationName",type:"string"},{name:"eventName",type:"string"},{name:"time",type:"number",default:1},{name:"type",type:"string",default:"Anytime",enum:[{Anytime:"Anytime"},{Start:"Start"},{End:"End"}]}],array:!0}),Motion.attributes.add("lerp",{type:"number",default:.5}),Motion.prototype.initialize=function(){this.timestamp=0,this.currentSpeed=0,this.currentMotion=!1,this.isReverting=!1,this.startPosition=this.entity.getLocalPosition().clone(),this.startRotation=this.entity.getLocalEulerAngles().clone(),this.startScale=this.entity.getLocalScale().clone(),this.position=new pc.Vec3(0,0,0),this.rotation=new pc.Vec3(0,0,0),this.scale=new pc.Vec3(0,0,0),this.motions.length>0&&this.motions[0].autoplay&&this.onMotionPlay(this.motions[0].name),this.app.on("Motion",this.onMotionPlay,this),this.app.on("Motion:Stop",this.onMotionStop,this),this.entity.on("Motion",this.onMotionPlay,this),this.entity.on("Motion:Stop",this.onMotionStop,this)},Motion.prototype.findMotion=function(t){var i=!1;for(var n in this.motions){var e=this.motions[n];e.name==t&&(i=e)}return i},Motion.prototype.onMotionStop=function(t){this.currentMotion&&this.currentMotion.name==t&&(this.isPlaying=!1,this.currentMotion=!1)},Motion.prototype.onMotionPlay=function(t,i){if(!i&&this.currentMotion&&this.currentMotion.name==t)return!1;var n=this.findMotion(t);if(!n)return!1;this.isPlaying=!0,this.timestamp=0,this.currentMotion=n,this.triggerStartEvent(this.currentMotion)},Motion.prototype.triggerEvents=function(t){for(var i in this.events){var n=this.events[i],e=n.time;n.animationName==this.currentMotion.name&&e>this.timestamp&&e<=this.timestamp+t&&this.app.fire(n.eventName)}},Motion.prototype.findEventByMotion=function(t,i){for(var n in this.events){var e=this.events[n];if(e.animationName==t.name&&e.type==i)return e}},Motion.prototype.triggerStartEvent=function(t){var i=this.findEventByMotion(t,"Start");i&&this.app.fire(i.eventName)},Motion.prototype.triggerEndEvent=function(t){var i=this.findEventByMotion(t,"End");i&&this.app.fire(i.eventName)},Motion.prototype.update=function(t){if(!this.isPlaying)return!1;if(!this.currentMotion)return!1;var i=this.currentMotion.position.value(this.timestamp),n=this.currentMotion.rotation.value(this.timestamp),e=this.currentMotion.scale.value(this.timestamp);this.position=this.position.lerp(this.position,new pc.Vec3(i[0],i[1],i[2]),this.lerp),this.rotation=this.rotation.lerp(this.rotation,new pc.Vec3(n[0],n[1],n[2]),this.lerp),this.scale=this.scale.lerp(this.scale,new pc.Vec3(e[0],e[1],e[2]),this.lerp),this.entity.setLocalPosition(this.position.clone().add(this.startPosition)),this.entity.setLocalEulerAngles(this.rotation.clone().add(this.startRotation)),this.entity.setLocalScale(this.scale.clone().add(this.startScale)),this.triggerEvents(t),this.timestamp>=1&&(this.isPlaying=!1,this.currentMotion.loop?this.onMotionPlay(this.currentMotion.name,!0):(this.triggerEndEvent(this.currentMotion),this.currentMotion=!1)),this.isReverting?(this.timestamp-=t*this.currentMotion.speed,this.timestamp<=0&&(this.triggerEndEvent(this.currentMotion),this.currentMotion=!1,this.isPlaying=!1,this.isReverting=!1)):this.timestamp+=t*this.currentMotion.speed,this.timestamp=Math.max(this.timestamp,0),this.timestamp=Math.min(this.timestamp,1)};var IdleManager=pc.createScript("idleManager");IdleManager.prototype.initialize=function(){pc.IdleManager={},pc.IdleManager.Fishes=Utils.getItemAsNumber("Fishes"),pc.IdleManager.Coin=Utils.getItemAsNumber("Coin"),pc.IdleManager.Diamond=Utils.getItemAsNumber("Diamond"),pc.IdleManager.Strength=Utils.getItemAsNumber("Strength"),pc.IdleManager.StrengthLevel=Utils.getItemAsNumber("StrengthLevel"),pc.IdleManager.LastSeen=Utils.getItemAsNumber("LastSeen"),pc.IdleManager.LastOnlineEarning=Utils.getItemAsNumber("LastOnlineEarning"),pc.IdleManager.LastOfflineEarning=Utils.getItemAsNumber("LastOfflineEarning"),pc.IdleManager.UniqueFishes=Utils.getItemAsNumber("UniqueFishes",0),pc.IdleManager.RodLevel=Utils.getItemAsNumber("RodLevel",1),pc.IdleManager.RodPower=Utils.getItemAsNumber("RodPower",.1),pc.IdleManager.Inventory=Utils.getItemAsArray("Inventory"),pc.IdleManager.FishStorage=Utils.getItemAsArray("FishStorage"),pc.IdleManager.FishDeck=Utils.getItemAsArray("FishDeck"),pc.IdleManager.BossDeck=Utils.getItemAsArray("BossDeck"),pc.IdleManager.Rods=Utils.getItemAsArray("Rods",["Wooden Rod"]),pc.IdleManager.Hooks=Utils.getItemAsArray("Hooks",["Rusty Hook"]),pc.IdleManager.Customizations=Utils.getItemAsArray("Customizations"),pc.IdleManager.Cosmetics=Utils.getItemAsArray("Cosmetics"),pc.IdleManager.PurchasedItems=Utils.getItemAsArray("PurchasedItems"),pc.IdleManager.PurchasedShoes=Utils.getItemAsArray("PurchasedShoes"),pc.IdleManager.Quests=Utils.getItemAsArray("Quests"),pc.IdleManager.LanguageIndex=Utils.getItemAsNumber("LanguageIndex"),pc.IdleManager.TutorialIndex=Utils.getItemAsNumber("TutorialIndex"),pc.IdleManager.Wins=Utils.getItemAsNumber("Wins"),pc.IdleManager.Loses=Utils.getItemAsNumber("Loses"),pc.IdleManager.AdsWatchedVIP=Utils.getItemAsNumber("AdsWatchedVIP"),pc.IdleManager.CurrentAura=Utils.getItemAsNumber("CurrentAura",-1),pc.IdleManager.CurrentAuraEquipped=Utils.getItemAsNumber("CurrentAuraEquipped",-1),pc.IdleManager.CurrentAuraEquippedArray=Utils.getItemAsArray("CurrentAuraEquippedArray",[]),pc.IdleManager.WorkoutMultiplier=Utils.getItemAsFloat("WorkoutMultiplier",1),pc.IdleManager.ShoesMultiplier=Utils.getItemAsFloat("WorkoutMultiplier",1),pc.IdleManager.EarningMultiplier=Utils.getItemAsFloat("EarningMultiplier",1),pc.IdleManager.AdsWatchedLevel=Utils.getItemAsFloat("AdsWatchedLevel",0),this.app.on("IdleManager:Add",this.onAdd,this),this.app.on("IdleManager:Set",this.onSet,this),this.app.on("IdleManager:Multiply",this.onMultiply,this)},IdleManager.prototype.onAdd=function(e,t){pc.IdleManager[e]>=0&&(pc.IdleManager[e]+=t,this.app.fire("NetworkManager:Add",e,t),Utils.setItem(e,pc.IdleManager[e]))},IdleManager.prototype.onSet=function(e,t){pc.IdleManager[e]=t,this.app.fire("NetworkManager:Set",e,t),Utils.setItemAsArray(e,pc.IdleManager[e])},IdleManager.prototype.onMultiply=function(e,t){var a=pc.IdleManager[e]*t;a<=0&&(a=1e3*t),pc.IdleManager[e]=a,this.app.fire("NetworkManager:Set",e,a),Utils.setItem(e,pc.IdleManager[e])};var CustomNumber=pc.createScript("customNumber");CustomNumber.attributes.add("suffix",{type:"string"}),CustomNumber.attributes.add("prefix",{type:"string"}),CustomNumber.attributes.add("address",{type:"string"}),CustomNumber.prototype.initialize=function(){this.lastText=this.entity.element.text},CustomNumber.prototype.numberScale=function(t){return Utils.numberScale(t)},CustomNumber.prototype.update=function(t){void 0!==pc.IdleManager[this.address]&&null!==pc.IdleManager[this.address]&&(this.entity.element.text=this.suffix+""+this.numberScale(pc.IdleManager[this.address])+this.prefix,this.entity.element.text!=this.lastText&&this.entity.fire("Motion","Increase"),this.lastText=this.entity.element.text)};var Overlay=pc.createScript("overlay");Overlay.attributes.add("alertMessage",{type:"entity"}),Overlay.attributes.add("announceEntity",{type:"entity"}),Overlay.attributes.add("announceText",{type:"entity"}),Overlay.attributes.add("messageEntity",{type:"entity"}),Overlay.attributes.add("transitionEntity",{type:"entity"}),Overlay.attributes.add("flashEntity",{type:"entity"}),Overlay.attributes.add("popupEntity",{type:"entity"}),Overlay.attributes.add("mouseLockElement",{type:"entity"}),Overlay.attributes.add("usernameInputEntity",{type:"entity"}),Overlay.attributes.add("emoteMenu",{type:"entity"}),Overlay.attributes.add("popupCloseButton",{type:"entity"}),Overlay.attributes.add("popupCloseWait",{type:"entity"}),Overlay.attributes.add("duelRewardEntity",{type:"entity"}),Overlay.attributes.add("playerEntity",{type:"entity"}),Overlay.attributes.add("diamondDisplay",{type:"entity"}),Overlay.attributes.add("diamoundCount",{type:"entity"}),Overlay.attributes.add("diamondIcon",{type:"entity"}),Overlay.attributes.add("diamondHolder",{type:"entity"}),Overlay.attributes.add("autoClicker",{type:"entity"}),Overlay.attributes.add("increasedValue",{type:"entity"}),Overlay.prototype.initialize=function(){this.diamondArray=[],this.isMobile=Utils.isMobile(),this.gameplayEntities=this.entity.findByTag("Gameplay"),this.onHide(),this.flashEntity.enabled=!0,this.app.on("Overlay:Message",this.onMessage,this),this.app.on("Overlay:Alert",this.onAlert,this),this.app.on("Overlay:Announce",this.setAnnounce,this),this.app.on("Overlay:Transition",this.setTransition,this),this.app.on("Overlay:OpenLink",this.onOpenLink,this),this.app.on("Overlay:DuelReward",this.setDuelReward,this),Utils.isMobile()&&this.announceEntity.setLocalPosition(0,-240,0),this.usernameInputEntity.on("updatedvalue",this.changeUsername,this),document.addEventListener("pointerlockchange",this.onPointerLockChange.bind(this))},Overlay.prototype.changeUsername=function(t){this.app.fire("Player:ChangeUsername",t)},Overlay.prototype.clearDiamondHolder=function(){this.diamondArray.forEach((function(t){t.destroy()})),this.diamondArray=[]},Overlay.prototype.onMessage=function(t){this.messageEntity.element.text=t,this.app.fire("PopupManager:Show","Message")},Overlay.prototype.setDuelReward=function(t){if(this.duelRewardEntity.enabled)return!1;this.duelRewardEntity.enabled=!0,this.diamoundCount.fire("Count:Target",t),this.app.fire("IdleManager:Add","Diamond",t),this.clearDiamondHolder();for(var e=0;e<t;e++)setTimeout((function(t){var e=t.diamondIcon.clone();e.enabled=!0,t.diamondHolder.addChild(e),t.diamondArray.push(e),pc.app.fire("World2Screen:Animate","Diamond",t.playerEntity.getPosition().clone(),t.diamondDisplay)}),100*e,this);setTimeout((function(t){t.duelRewardEntity.enabled=!1}),5e3,this)},Overlay.prototype.onPointerLockChange=function(){pc.Mouse.isPointerLocked()?(PokiPlugin.onPlay(),this.onShow()):(PokiPlugin.onPause(),this.onHide()),this.popupCloseButton.enabled=!1,this.popupCloseWait.enabled=!0,clearTimeout(this.popupTimer),this.popupTimer=setTimeout((function(t){t.popupCloseButton.enabled=!0,t.popupCloseWait.enabled=!1}),1500,this),this.app.fire("PointerLock:Change",pc.Mouse.isPointerLocked())},Overlay.prototype.onShow=function(){if(!this.isMobile)for(var t=0;t<this.gameplayEntities.length;t++)this.gameplayEntities[t].enabled=!0},Overlay.prototype.onHide=function(){if(!this.isMobile)for(var t=0;t<this.gameplayEntities.length;t++)this.gameplayEntities[t].enabled=!1},Overlay.prototype.setTransition=function(t=1e3){this.transitionEntity.enabled=!0,clearTimeout(this.transitionTimer),this.transitionTimer=setTimeout((function(t){t.transitionEntity.fire("Timeline",{isReverse:!0}),setTimeout((function(){t.transitionEntity.enabled=!1}),300)}),t,this)},Overlay.prototype.setAnnounce=function(t,e=2e3){this.announceEntity.enabled=!0,this.announceText.element.key=t,clearTimeout(this.announceTimer),this.announceTimer=setTimeout((function(t){t.announceEntity.enabled=!1}),e,this)},Overlay.prototype.onAlert=function(t){if(this.alertMessage.element.key==t)return!1;this.alertMessage.element.key=t,this.alertMessage.enabled=!0,clearTimeout(this.messageTimer),this.messageTimer=setTimeout((function(t){t.alertMessage.enabled=!1,t.alertMessage.element.text=""}),3e3,this)},Overlay.prototype.onOpenLink=function(t){window.open(t,"_blank")},Overlay.prototype.update=function(t){if(this.isMobile)return!1;this.mouseLockElement.enabled=!pc.Mouse.isPointerLocked()&&!this.popupEntity.enabled&&!pc.activePopup3D,this.autoClicker.enabled&&pc.inPvpMode&&(this.autoClicker.enabled=!1)};var DealtDamage=pc.createScript("dealtDamage");DealtDamage.attributes.add("numberEntity",{type:"entity"}),DealtDamage.attributes.add("holderEntity",{type:"entity"}),DealtDamage.prototype.postInitialize=function(){this.numbers=[],this.lastDamage=100,this.defaultOffset=new pc.Vec3(0,0,0),this.isMinus=1,this.cameraEntity=this.app.root.findByName("Lens"),this.numberEntity.enabled=!1,this.app.on("DealtDamage:Trigger",this.onDamageDealt,this)},DealtDamage.prototype.destroyEntity=function(e){this.numbers.splice(this.numbers.indexOf(e),1),e.destroy()},DealtDamage.prototype.onDamageDealt=function(e,t,a){var i=this.numberEntity.clone();e<=.99&&(e=1),i.element.text=e>0?Math.round(e)+"":e,this.offset=this.defaultOffset,i.player=new pc.Vec3(t.x,t.y,t.z),i.element.offsetX=5*Math.random()-5*Math.random(),i.element.offsetY=-1.7,i.element.opacity=1,i.iconElement=i.findByName("Icon");var n=3,s=.3;a&&(n=4,s=1,i.element.color=pc.Color.RED),this.lastDamage=e;var o=i.tween(i.getLocalScale()).to({x:n,y:n,z:n},.15,pc.BounceOut);o.on("complete",(function(){this.entity.tween(this.entity.getLocalScale()).to({x:1,y:1,z:1},.4,pc.BounceOut).start()})),o.start(),i.tween(i.element).to({offsetY:0},.3,pc.Linear).start().on("complete",(function(){i.tween(i.element).to({opacity:0,offsetY:.8},s,pc.Linear).delay(.5).start()})),setTimeout((function(e,t){e.destroyEntity(t)}),3e3,this,i),this.numbers.push(i),this.holderEntity.addChild(i)},DealtDamage.prototype.updateNumberPosition=function(e){var t=new pc.Vec3,a=this.cameraEntity.camera,i=this.app.graphicsDevice.maxPixelRatio,n=this.entity.screen.scale,s=this.app.graphicsDevice,o=!1;return o=e.player.name?e.player.getPosition().clone().add(this.offset):e.player,!!a&&(!!e&&(a.worldToScreen(o,t),t.x*=i,t.y*=i,void(t.x>0&&t.x<this.app.graphicsDevice.width&&t.y>0&&t.y<this.app.graphicsDevice.height&&t.z>0?(e.setLocalPosition(t.x/n+e.element.offsetX,(s.height-t.y)/n+this.isMinus*Math.cos(e.element.offsetY)*Math.cos(e.element.offsetY)*120+(this.isMinus<0?150:0),0),e.element.outlineThickness=e.element.opacity,e.iconElement.element.opacity=e.element.opacity,e.enabled=!0):e.enabled=!1)))},DealtDamage.prototype.update=function(e){for(var t=this.numbers.length;t--;)this.updateNumberPosition(this.numbers[t])};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var Timeline=pc.createScript("timeline");Timeline.attributes.add("autoplay",{type:"boolean"}),Timeline.attributes.add("loop",{type:"boolean",default:!1}),Timeline.attributes.add("yoyo",{type:"boolean",default:!1}),Timeline.attributes.add("position",{type:"boolean",default:!1}),Timeline.attributes.add("scale",{type:"boolean",default:!1}),Timeline.attributes.add("rotation",{type:"boolean",default:!1}),Timeline.attributes.add("opacity",{type:"boolean",default:!1}),Timeline.attributes.add("custom",{type:"boolean",default:!1}),Timeline.attributes.add("playSound",{type:"boolean",default:!1}),Timeline.attributes.add("duration",{type:"number",default:1}),Timeline.attributes.add("delay",{type:"number",default:0}),Timeline.attributes.add("repeat",{type:"number",default:0}),Timeline.attributes.add("soundDelay",{type:"number",default:0}),Timeline.attributes.add("rollback",{type:"number",default:0}),Timeline.attributes.add("ease",{type:"string",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}],default:"Linear"}),Timeline.attributes.add("startFrame",{type:"json",schema:[{name:"position",type:"vec3"},{name:"mobilePosition",type:"vec3"},{name:"rotation",type:"vec3"},{name:"scale",type:"vec3",default:[1,1,1]},{name:"opacity",type:"number",default:1},{name:"custom",type:"string",description:"For example camera.fov = 40"}]}),Timeline.attributes.add("endFrame",{type:"json",schema:[{name:"position",type:"vec3"},{name:"mobilePosition",type:"vec3"},{name:"rotation",type:"vec3"},{name:"scale",type:"vec3",default:[1,1,1]},{name:"opacity",type:"number",default:1},{name:"custom",type:"string",description:"For example camera.fov = 40"}]}),Timeline.prototype.initialize=function(){this.animation={custom:0},this.eventListener=!1,this.app.on("Timeline:"+this.entity.name,this.onPlay,this),this.app.on("Timeline:"+this.entity.name+"@Time",this.setTime,this),this.app.on("Timeline:"+this.entity.name+"@Reset",this.reset,this),this.entity.on("Timeline",this.onPlay,this),this.on("destroy",this.onDestroy,this),this.on("state",this.onStateChange,this),this.autoplay&&this.onPlay()},Timeline.prototype.setTime=function(t){this.duration=t},Timeline.prototype.onStateChange=function(t){!0===t?this.autoplay&&this.onPlay():this.reset()},Timeline.prototype.onDestroy=function(){},Timeline.prototype.getEase=function(){return pc[this.ease]},Timeline.prototype.reset=function(){this.positionFrames&&this.positionFrames.stop(),this.rotationFrames&&this.rotationFrames.stop(),this.scaleFrames&&this.scaleFrames.stop(),this.opacityFrames&&this.opacityFrames.stop(),this.customFrames&&this.customFrames.stop()},Timeline.prototype.setFirstFrame=function(options){var frame=this.startFrame;options.isReverse&&(frame=this.endFrame);var pos=Utils.isMobile()?frame.mobilePosition:frame.position;if(this.position&&this.entity.setLocalPosition(pos),this.rotation&&this.entity.setLocalEulerAngles(frame.rotation),this.scale&&this.entity.setLocalScale(frame.scale),this.opacity&&(this.entity.element.opacity=frame.opacity),this.custom){var parts=frame.custom.split(" = "),query=parts[0],value=parseFloat(parts[1]);this.animation.custom=value,eval("this.entity."+this.custom)}},Timeline.prototype.onComplete=function(){},Timeline.prototype.onPlay=function(_options){var self=this,options={isReverse:!1,delay:this.delay,playSound:this.playSound};"object"==typeof _options&&(options.isReverse=!!_options.isReverse),"object"==typeof _options&&(options.playSound=!!_options.playSound),options.playSound&&setTimeout((function(t){t.entity.sound.play("Sound")}),1e3*this.soundDelay,this);var frame=this.endFrame;options.isReverse&&(options.delay=0,frame=this.startFrame),this.reset(),this.setFirstFrame(options);var pos=Utils.isMobile()?frame.mobilePosition:frame.position;if(this.position&&(this.positionFrames=this.entity.tween(this.entity.getLocalPosition()).to({x:pos.x,y:pos.y,z:pos.z},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.positionFrames.on("complete",this.onComplete,this)),this.loop&&this.positionFrames.loop(!0),this.yoyo&&this.positionFrames.yoyo(!0),this.repeat>0&&this.positionFrames.repeat(this.repeat),this.positionFrames.start()),this.rotation&&(this.rotationFrames=this.entity.tween(this.entity.getLocalEulerAngles()).rotate({x:frame.rotation.x,y:frame.rotation.y,z:frame.rotation.z},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.rotationFrames.on("complete",this.onComplete,this)),this.loop&&this.rotationFrames.loop(!0),this.yoyo&&this.rotationFrames.yoyo(!0),this.repeat>0&&this.rotationFrames.repeat(this.repeat),this.rotationFrames.start()),this.scale&&(this.scaleFrames=this.entity.tween(this.entity.getLocalScale()).to({x:frame.scale.x,y:frame.scale.y,z:frame.scale.z},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.scaleFrames.on("complete",this.onComplete,this)),this.loop&&this.scaleFrames.loop(!0),this.yoyo&&this.scaleFrames.yoyo(!0),this.repeat>0&&this.scaleFrames.repeat(this.repeat),this.scaleFrames.start()),this.opacity&&(this.opacityFrames=this.entity.tween(this.entity.element).to({opacity:frame.opacity},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.opacityFrames.on("complete",this.onComplete,this)),this.loop&&this.opacityFrames.loop(!0),this.yoyo&&this.opacityFrames.yoyo(!0),this.repeat>0&&this.opacityFrames.repeat(this.repeat),this.opacityFrames.start()),this.custom){var parts=frame.custom.split(" = "),query=parts[0],value=parseFloat(parts[1]);this.customFrames=this.entity.tween(this.animation).to({custom:value},this.duration,this.getEase()).delay(options.delay),this.customFrames.on("update",(function(){eval("this.entity."+query+" = "+self.animation.custom)})),this.customFrames.start()}this.rollback>0&&!options.isReverse&&setTimeout((function(t){t.onPlay({isReverse:!0})}),1e3*this.rollback,this)};var LookAt=pc.createScript("lookAt");LookAt.attributes.add("camera",{type:"entity"}),LookAt.prototype.initialize=function(){this.camera?this.cameraEntity=this.camera:this.cameraEntity=this.app.root.findByName("Lens")},LookAt.prototype.update=function(t){if(this.app.scene._activeCamera){var a=this.app.scene._activeCamera.node;a&&this.entity.lookAt(a.getPosition())}};var Button=pc.createScript("button");Button.attributes.add("action",{type:"string"}),Button.attributes.add("value",{type:"string"}),Button.attributes.add("cooldown",{type:"number",default:0}),Button.attributes.add("hoverStateEvent",{type:"boolean",default:!1}),Button.attributes.add("lockAfterAction",{type:"boolean",default:!1}),Button.attributes.add("hoverAction",{type:"string"}),Button.attributes.add("leaveAction",{type:"string"}),Button.attributes.add("hoverColor",{type:"rgb"}),Button.attributes.add("clickColor",{type:"rgb"}),Button.attributes.add("sendEntity",{type:"boolean",default:!1}),Button.prototype.initialize=function(){this.cooldown>0&&(this.timerEntity=this.entity.findByName("Timer"),this.timerEntity.enabled=!1),this._startPos=null,this._isDragging=!1,this.entity.element.on("touchstart",(function(t){this._isDragging=!1,this._startPos={x:t.touches[0].x,y:t.touches[0].y}}),this),this.entity.element.on("touchmove",(function(t){var e=Math.abs(t.touches[0].x-this._startPos.x),i=Math.abs(t.touches[0].y-this._startPos.y);(e>10||i>10)&&(this._isDragging=!0)}),this),this.entity.element.on("touchend",(function(t){this._isDragging||this.onPress(t)}),this),this.entity.element.on("mousedown",(function(t){this._isDragging=!1,this._startPos={x:t.x,y:t.y}}),this),this.entity.element.on("mousemove",(function(t){if(this._startPos){var e=Math.abs(t.x-this._startPos.x),i=Math.abs(t.y-this._startPos.y);(e>3||i>3)&&(this._isDragging=!0)}}),this),this.entity.element.on("mouseup",(function(t){this._isDragging||this.onPress(t)}),this),this.entity.element.on("touchend",this.onLeave,this),this.entity.element.on("mouseenter",this.onHover,this),this.entity.element.on("mouseleave",this.onLeave,this),this.buttonUIParts=this.entity.findByTag("ButtonUI"),this.buttonUIParts.length>0&&(this.defaultColor=this.buttonUIParts[0].element.color.clone()),this.on("state",this.onStageChange,this)},Button.prototype.onStageChange=function(){this.lockAfterAction&&(this.entity.button.active=!0)},Button.prototype.onHover=function(t){document.body.style.cursor="pointer",this.hoverStateEvent&&this.app.fire(this.hoverAction,this.value),this.app.fire("Sound:Play","Button-Hover");for(var e=0;e<this.buttonUIParts.length;e++)this.buttonUIParts[e].element.color=this.hoverColor},Button.prototype.onLeave=function(t){this.hoverStateEvent&&this.app.fire(this.leaveAction,this.value),document.body.style.cursor="default";for(var e=0;e<this.buttonUIParts.length;e++)this.buttonUIParts[e].element.color=this.defaultColor},Button.prototype.onPress=function(t){if(Date.now()-pc.lastClickTime<250)return!1;var e=this;if(0===this.app.timeScale)return!1;if(this.timerEntity&&this.timerEntity.enabled)return!1;if(this.entity.button&&!this.entity.button.active)return!1;if(this.entity.element&&!this.entity.element.useInput)return!1;Utils.waitForChanges((function(){e.sendEntity?(e.app.fire(e.action,e.value,e.entity),e.entity.fire("Button:Click",e,e.action,e.value)):(e.app.fire(e.action,e.value),e.entity.fire("Button:Click",e,e.action,e.value))})),this.timerEntity&&(this.timerEntity.enabled=!0);for(var i=0;i<this.buttonUIParts.length;i++)this.buttonUIParts[i].element.color=this.clickColor;Timer.setTimeout((function(t){for(var e=0;e<t.buttonUIParts.length;e++)t.buttonUIParts[e]&&t.buttonUIParts[e].element&&(t.buttonUIParts[e].element.color=t.defaultColor)}),120,this),Timer.setTimeout((function(t){t.timerEntity&&(t.timerEntity.enabled=!1)}),1e3*this.cooldown,this),this.lockAfterAction&&(this.entity.button.active=!1,setTimeout((function(t){t.entity.button.active=!0}),1e3,this)),pc.lastClickTime=Date.now()};var Gameplay=pc.createScript("gameplay");Gameplay.prototype.initialize=function(){this.app.soundManager.volume=.5,this.app.on("Gameplay:Reset",this.onReset,this)},Gameplay.prototype.onReset=function(a){window.localStorage.clear(),window.location.reload()};var Timer={nextTimerId:0,timers:[],init:function(){pc.app.on("update",this.onUpdate,this)},setTimeout:function(t,i,e,n,o){return setTimeout(t,i,e,n,o)},clearTimeout:function(t){clearTimeout(t)},onUpdate:function(t){}};Timer.init();var Challenge=pc.createScript("challenge");Challenge.attributes.add("maxSpeed",{type:"number",default:5}),Challenge.attributes.add("speed",{type:"number",default:5}),Challenge.attributes.add("strengthMultiplier",{type:"number",default:14}),Challenge.attributes.add("timer",{type:"number",default:300}),Challenge.attributes.add("boostFactor",{type:"number",default:1}),Challenge.attributes.add("baseSpeed",{type:"number",default:.1}),Challenge.attributes.add("headstartSpeed",{type:"number",default:.4}),Challenge.attributes.add("speedDecayRate",{type:"number",default:.3}),Challenge.attributes.add("mapHolder",{type:"entity"}),Challenge.attributes.add("opponentEntity",{type:"entity"}),Challenge.attributes.add("opponentHolder",{type:"entity"}),Challenge.attributes.add("playerHolder",{type:"entity"}),Challenge.attributes.add("gameCameraEntity",{type:"entity"}),Challenge.attributes.add("raceCameraEntity",{type:"entity"}),Challenge.attributes.add("playerEntity",{type:"entity"}),Challenge.attributes.add("finishLine",{type:"entity"}),Challenge.attributes.add("challengeInterface",{type:"entity"}),Challenge.attributes.add("challengeBar",{type:"entity"}),Challenge.attributes.add("challengeProgress",{type:"entity"}),Challenge.attributes.add("boostProgress",{type:"entity"}),Challenge.attributes.add("actionMenuEntity",{type:"entity"}),Challenge.attributes.add("actionMenuMobileEntity",{type:"entity"}),Challenge.attributes.add("mobileMenuEntity",{type:"entity"}),Challenge.attributes.add("joytickEntity",{type:"entity"}),Challenge.attributes.add("headFactor",{type:"number",default:800}),Challenge.attributes.add("opponentTitle",{type:"entity"}),Challenge.attributes.add("opponentIcon",{type:"entity"}),Challenge.attributes.add("opponentRequired",{type:"entity"}),Challenge.attributes.add("opponentReward",{type:"entity"}),Challenge.attributes.add("playerHead",{type:"entity"}),Challenge.attributes.add("enemyHead",{type:"entity"}),Challenge.attributes.add("coinDisplay",{type:"entity"}),Challenge.attributes.add("timerEntity",{type:"entity"}),Challenge.attributes.add("timerTime",{type:"entity"}),Challenge.attributes.add("countDownEntity",{type:"entity"}),Challenge.attributes.add("statsEntity",{type:"entity"}),Challenge.attributes.add("unlockUpgradeEntity",{type:"entity"}),Challenge.attributes.add("unlockAutoclickerEntity",{type:"entity"}),Challenge.attributes.add("exitButton",{type:"entity"}),Challenge.attributes.add("confettiEntity",{type:"entity"}),Challenge.attributes.add("ribbonEntity",{type:"entity"}),Challenge.attributes.add("playerLabel",{type:"entity"}),Challenge.attributes.add("autoClickingEntity",{type:"entity"}),Challenge.attributes.add("clickTipHolder",{type:"entity"}),Challenge.attributes.add("duelOpponent",{type:"entity"}),Challenge.prototype.initialize=function(){this.isRunning=!1,this.isSlowingDown=!1,this.isWatchingAds=!1,this.headstartValue=0,this.rewardMultiplier=1,this.boostSpeed=this.baseSpeed,this.timestamp=0,this.isHeadstartActive=!1,this.hasClickedOnce=!1,this.challengeStarted=Date.now(),this.opponentSpeedMultiplier=1,this.multiplierVIP=1,this.autoclicker=!1,this.lastAutoclick=Date.now(),this.unlockAutoclickerEntity.enabled=!1,this.opponentHolderPosition=this.opponentHolder.getLocalPosition().clone(),this.playerHolderPosition=this.playerHolder.getLocalPosition().clone(),this.app.on("Challenge:SetOpponent",this.setOpponent,this),this.app.on("Challenge:Accept",this.acceptChallenge,this),this.app.on("Challenge:Cancel",this.cancelChallenge,this),this.app.on("Challenge:Boost",this.boostChallenge,this),this.app.on("Challenge:Duel",this.setDuelChallenge,this),this.app.on("Challenge:Boost",this.boostChallenge,this),this.app.on("PointerLock:Change",this.onPointerChange,this),this.app.on("Challenge:UnlockAutoclicker",this.onUnlockAutoclicker,this),this.app.on("Earning:UpdateVIPMultiplier",this.updateVIPMultiplier),this.app.on("PopupManager:Show",this.onPopupShow,this),this.app.mouse.on("mousedown",this.onMouseDown,this),this.entity.enabled=!1,this.challengeInterface.enabled=!1,setTimeout((t=>{t.updateVIPMultiplier()}),500,this)},Challenge.prototype.postInitialize=function(){this.duelOpponent.enabled=!1},Challenge.prototype.onUnlockAutoclicker=function(){var t=this;if(!this.unlockAutoclickerEntity.enabled)return!1;PokiPlugin.showReward((function(){t.autoclicker=!0,t.unlockAutoclickerEntity.enabled=!1,t.autoClickingEntity.enabled=!0,t.clickTipHolder.enabled=!1}))},Challenge.prototype.updateVIPMultiplier=function(){var t=pc.IdleManager.EarningMultiplier;this.multiplierVIP=t<1?1:t},Challenge.prototype.onPopupShow=function(t){"Challenge"==t&&this.opponentTitle&&this.app.fire("TutorialManager:AfterWin",this.opponentTitle.element.key)},Challenge.prototype.setOpponent=function(t){this.opponentEntity=t.entity,this.opponentTitle.element.key=t.title,this.opponentIcon.element.textureAsset=t.icon,this.opponentReward.element.text=t.winMoney,this.opponentSpeedMultiplier=t.speedMultiplier,this.finishLine.setLocalPosition(this.playerHolderPosition.x,this.playerHolderPosition.y,-1*(t.roadLenght+this.playerHolderPosition.z)),this.app.fire("Road:ChangeLength",t.roadLenght,this.playerHolderPosition.z)},Challenge.prototype.onPointerChange=function(t){!1===t&&!this.gameCameraEntity.enabled&&!this.isWatchingAds&&Date.now()-this.challengeStarted>1e3&&this.cancelChallenge()},Challenge.prototype.onMouseDown=function(){this.app.fire("Challenge:Boost")},Challenge.prototype.setDuelChallenge=function(){this.raceCameraEntity.parent.setLocalPosition(0,0,0),this.raceCameraEntity.parent.setLocalRotation((new pc.Quat).setFromEulerAngles(0,90,0)),this.duelOpponent.enabled=!0,this.setOpponent(this.duelOpponent.script.opponent),this._acceptChallenge()},Challenge.prototype.acceptChallenge=function(t){var e=this;this.raceCameraEntity.parent.setLocalPosition(0,0,0),this.raceCameraEntity.parent.setLocalRotation((new pc.Quat).setFromEulerAngles(0,90,0)),"Reward"==t?(this.isWatchingAds=!0,this.rewardMultiplier=2,PokiPlugin.showReward((function(){e._acceptChallenge(),setTimeout((function(){e.isWatchingAds=!1,pc.app.mouse.enablePointerLock()}),500)}))):(this.rewardMultiplier=1,PokiPlugin.showMidroll((function(){e._acceptChallenge()})))},Challenge.prototype._acceptChallenge=function(){return this.isRunning?(this.cancelChallenge(),!1):!!this.opponentEntity&&(this.timestamp=0,this.playerLabel.enabled=!1,this.headstartValue=this.headstartSpeed,this.playerHead.setLocalPosition(0,0,0),this.enemyHead.setLocalPosition(0,0,0),this.setChallenge(),this.updateInterface(),this.app.fire("PopupManager:Hide",!0),this.app.fire("NetworkManager:Send","triggerFunction",{name:"Disable"}),void(this.challengeStarted=Date.now()))},Challenge.prototype.setChallenge=function(t){this.opponentOriginalPosition=this.opponentEntity.getPosition().clone(),this.opponentParent=this.opponentEntity.parent,this.opponentHolder.setLocalPosition(this.opponentHolderPosition),this.playerHolder.setLocalPosition(this.playerHolderPosition),this.opponentEntity.reparent(this.opponentHolder),this.opponentEntity.setLocalPosition(0,0,0),this.opponentEntity.script.opponent.ready(),this.playerOriginalPosition=this.playerEntity.getPosition().clone(),this.playerEntity.collision.enabled=!1,this.playerEntity.reparent(this.playerHolder),this.playerEntity.setLocalPosition(0,0,0),this.playerEntity.script.player.focusDirection=180,this.playerEntity.script.player.isFocusing=!0,this.playerEntity.script.player.ready(),this.challengeInterface.enabled=!0,this.desktopTip=this.challengeInterface.findByName("DesktopTip"),this.mobileTip=this.challengeInterface.findByName("MobileTip"),Utils.isMobile()?(this.desktopTip.enabled=!1,this.mobileTip.enabled=!0):(this.desktopTip.enabled=!0,this.mobileTip.enabled=!1),this.enemyHead.element.textureAsset=this.opponentEntity.script.opponent.icon,this.gameCameraEntity.enabled=!1,this.playerEntity.script.keyboard.enabled=!1,this.entity.enabled=!0,this.challengeBar.enabled=!0,this.timerEntity.enabled=!0,this.autoclicker||(this.unlockAutoclickerEntity.enabled=!0),this.actionMenuEntity.enabled=!1,this.actionMenuMobileEntity.enabled=!1,this.joytickEntity.enabled=!1,this.app.fire("MobileTouch:ActionState",!0);var e=this.timer;t?(this.app.fire("Overlay:Announce","RUN!",4e3),this.isRunning=!0):this.timer1=setTimeout((function(t){t.setCountDown(3),t.timer2=setTimeout((function(){t.setCountDown(2),t.timer3=setTimeout((function(){t.setCountDown(1),t.timer4=setTimeout((function(){t.run()}),e)}),e)}),e)}),e,this),this.updateInterface(),this.app.fire("Arrow:Hide"),this.app.fire("BoostManager:UpdateBoostDisplay",!1)},Challenge.prototype.setCountDown=function(t){this.countDownEntity.enabled=!0,this.countDownEntity.element.text=t,this.mobileMenuEntity.enabled=!1},Challenge.prototype.run=function(){if(!this.entity.enabled)return!1;this.countDownEntity.enabled=!1,this.app.fire("Overlay:Announce","RUN!",4e3),this.opponentEntity.script.opponent.run(),this.isRunning=!0,this.hasClickedOnce=!1},Challenge.prototype.cancelChallenge=function(t){if(!this.entity.enabled)return!1;clearTimeout(this.timer1),clearTimeout(this.timer2),clearTimeout(this.timer3),clearTimeout(this.timer4),clearTimeout(this.timer5),clearTimeout(this.timer6),this.opponentEntity.script.opponent.isDuel&&this.app.fire("LevelManager:LoadLevel","Level-1"),t||(this.opponentEntity.script.opponent.isDuel||this.app.fire("PopupManager:Show","Challenge"),this.app.fire("NetworkManager:Send","triggerFunction",{name:"Enable"}),this.timerEntity.enabled=!1,this.playerLabel.enabled=!0,Utils.isMobile()?(this.joytickEntity.enabled=!0,this.actionMenuMobileEntity.enabled=!0,this.mobileMenuEntity.enabled=!0,this.app.fire("MobileTouch:ActionState",!1)):this.actionMenuEntity.enabled=!0,this.app.fire("Arrow:Show"),this.app.fire("BoostManager:UpdateBoostDisplay",!0)),this.ribbonEntity.anim.reset(),this.duelOpponent.enabled=!1,this.opponentEntity.reparent(this.opponentParent),this.opponentEntity.setLocalPosition(this.opponentOriginalPosition),this.opponentEntity.script.opponent.stop(),this.playerEntity.reparent(this.mapHolder),this.playerEntity.setLocalPosition(this.playerOriginalPosition),this.playerEntity.collision.enabled=!0,this.gameCameraEntity.enabled=!0,this.playerEntity.script.keyboard.enabled=!0,this.playerEntity.script.player.isFocusing=!1,this.playerEntity.script.player.stop(),this.challengeInterface.enabled=!1,this.countDownEntity.enabled=!1,this.entity.enabled=!1,this.challengeBar.enabled=!1,this.app.timeScale=1,this.timestamp=0,this.isSlowingDown=!1,this.isRunning=!1,this.boostSpeed=0,this.updateInterface()},Challenge.prototype.setRunning=function(t){this.isRunning&&!this.isSlowingDown&&(this.boostSpeed=Math.max(this.baseSpeed,this.boostSpeed-this.speedDecayRate*t));var e=70;if(Utils.isMobile()&&(e=110),this.raceCameraEntity.camera.fov=e+15*this.boostSpeed,this.boostProgress.fire("Progress",this.boostSpeed),!this.isRunning||this.isSlowingDown)return!1;var i=Math.max(pc.IdleManager.Strength,10),n=Math.sqrt(i);this.opponentEntity.script.opponent.isDuel&&(n=100);var a=n*this.boostSpeed*this.opponentSpeedMultiplier*t;if(a=Math.min(a,this.maxSpeed),a+=this.headstartValue,this.headstartValue>0&&(this.headstartValue-=.15*t),this.playerHolder.translate(-a,0,0),a>0&&this.playerEntity.script.player.run(),!this.opponentEntity.script.opponent.isDuel){var o=this.opponentEntity.script.opponent.speed*this.opponentSpeedMultiplier*t;this.opponentHolder.translate(-o,0,0)}},Challenge.prototype.boostChallenge=function(){if(!this.isRunning||this.isSlowingDown)return!1;this.boostSpeed+=this.boostFactor,this.boostSpeed=Math.min(this.boostSpeed,1)},Challenge.prototype.resetChallenge=function(){this.cancelChallenge(!0),this.setChallenge(),this.boostSpeed=this.baseSpeed,this.hasClickedOnce=!1},Challenge.prototype.updateGameState=function(t){if(!this.isRunning)return!1;if(this.isSlowingDown)return!1;var e=this.finishLine.getLocalPosition().z,i=this.playerHolder.getLocalPosition().z,n=this.opponentHolder.getLocalPosition().z;(e>i||e>n)&&(n>i?this.winCondition():this.loseCondition(),this.finish()),this.timestamp+=t;var a=1*i/e;this.challengeProgress.setLocalScale(a,1,1);var o=1*i/e*this.headFactor;this.playerHead.setLocalPosition(o,0,0);var s=1*n/e*this.headFactor;this.enemyHead.setLocalPosition(s,0,0)},Challenge.prototype.finish=function(){return!!this.isRunning&&(!this.isSlowingDown&&(this.isSlowingDown=!0,this.app.timeScale=.5,this.app.fire("Timeline:Flash"),this.timer6=setTimeout((function(t){t.app.fire("Overlay:Transition"),pc.app.fire("Timeline:RaceCamera",{isReverse:!0})}),2e3,this),void(this.timer5=setTimeout((function(t){pc.app.timeScale=1,t.isSlowingDown=!1,t.isRunning=!1,t.resetChallenge()}),3e3,this))))},Challenge.prototype.loseCondition=function(){this.app.fire("Overlay:Announce","LOSE!",4e3),this.app.fire("IdleManager:Add","Loses",1),clearTimeout(this.loseTimer),this.loseTimer=setTimeout((function(t){t.cancelChallenge()}),3e3,this)},Challenge.prototype.winCondition=function(){var t=this.opponentEntity.script.opponent.winMoney;if(t>500){t/10;const i=Math.min(t,50);for(var e=0;e<i;e++)setTimeout((function(t){pc.app.fire("World2Screen:Animate","Coin",t.playerEntity.getPosition(),t.coinDisplay)}),50*e,this)}else{const i=Math.min(t,50);for(e=0;e<i;e++)setTimeout((function(t){pc.app.fire("World2Screen:Animate","Coin",t.playerEntity.getPosition(),t.coinDisplay)}),50*e,this)}pc.app.fire("IdleManager:Add","Coin",t*this.multiplierVIP*this.rewardMultiplier),this.confettiEntity.particlesystem.reset(),this.confettiEntity.particlesystem.play(),this.ribbonEntity.anim.setTrigger("Hit"),this.app.fire("Timeline:RaceCamera"),this.app.fire("Overlay:Announce","WIN!",4e3),this.playerEntity.script.player.characterEntity.anim.setTrigger("Win"),this.app.fire("IdleManager:Add","Wins",1),this.app.fire("TutorialManager:Win",this.opponentTitle.element.key)},Challenge.prototype.updateInterface=function(){var t=this.challengeInterface.enabled?80:0;this.statsEntity.setLocalPosition(0,-t,0),this.unlockUpgradeEntity.setLocalPosition(0,-t,0),this.exitButton.enabled=this.challengeInterface.enabled},Challenge.prototype.update=function(t){this.setRunning(t),this.updateGameState(t),this.autoclicker&&Date.now()-this.lastAutoclick>100&&(this.app.fire("Challenge:Boost"),this.lastAutoclick=Date.now()),this.timerTime.element.text=Utils.mmssms(this.timestamp),this.app.keyboard.wasPressed(pc.KEY_SPACE)&&this.boostChallenge(),this.app.keyboard.wasPressed(pc.KEY_C)&&this.app.fire("Challenge:UnlockAutoclicker")};var WorkoutObjective=pc.createScript("workoutObjective");WorkoutObjective.attributes.add("threadmills",{type:"entity",array:!0}),WorkoutObjective.attributes.add("barEntity",{type:"entity"}),WorkoutObjective.attributes.add("textEntity",{type:"entity"}),WorkoutObjective.attributes.add("multiplier",{type:"number",default:5e4}),WorkoutObjective.prototype.initialize=function(){this.app.on("WorkoutObjective:State",this.setState,this),this.entity.enabled=!1},WorkoutObjective.prototype.setState=function(t){this.entity.enabled=t},WorkoutObjective.prototype.getNextObjective=function(){var t=!1;for(var e in this.threadmills){var i=this.threadmills[e];t||i.script.workout.canDoIt()||(t=i.script.workout.minimumStrength)}if(!t){var r=pc.IdleManager.Strength,a=0==pc.IdleManager.StrengthLevel?1:pc.IdleManager.StrengthLevel;t=a*this.multiplier,r>=a*this.multiplier&&this.app.fire("IdleManager:Add","StrengthLevel",1)}return t},WorkoutObjective.prototype.getLastObjective=function(){var t=!1;if(pc.IdleManager.StrengthLevel>0)t=((0==pc.IdleManager.StrengthLevel?1:pc.IdleManager.StrengthLevel)-1)*this.multiplier;else for(var e=this.threadmills.length-1;e>=0;e--){var i=this.threadmills[e];!t&&i.script.workout.canDoIt()&&(t=i.script.workout.minimumStrength)}return t},WorkoutObjective.prototype.update=function(t){var e=pc.IdleManager.Strength,i=this.getNextObjective(),r=this.getLastObjective();if(i){var a=1*(e-r)/(i-r);this.barEntity.setLocalScale(a,1,1),this.textEntity.element.text=e+" / "+i}};var Opponent=pc.createScript("opponent");Opponent.attributes.add("title",{type:"string",default:"Football Guy"}),Opponent.attributes.add("icon",{type:"asset"}),Opponent.attributes.add("speed",{type:"number",default:10}),Opponent.attributes.add("winStrength",{type:"number",default:10}),Opponent.attributes.add("winMoneyUI",{type:"entity"}),Opponent.attributes.add("winMoney",{type:"number",default:10}),Opponent.attributes.add("characterEntity",{type:"entity"}),Opponent.attributes.add("isDuel",{type:"boolean",default:!1}),Opponent.attributes.add("roadLenght",{type:"number",default:10}),Opponent.attributes.add("speedMultiplier",{type:"number",default:1,description:"Speed of player and speed of opponent * multiplySpeed. Make it 0.5 to make speed of both x2 times slower or 2 to make it faster"}),Opponent.prototype.initialize=function(){this.waitTimer=0,this.lastInteraction=Date.now(),this.entity.on("Trigger",this.onTrigger,this),this.entity.on("Leave",this.onLeave,this),this.app.on("PopupManager:Hide",this.onTimerReset,this),this.on("destroy",this.onDestroy,this),this.winMoneyUI.element.text=this.winMoney},Opponent.prototype.onDestroy=function(){this.app.off("PopupManager:Hide",this.onTimerReset,this)},Opponent.prototype.onTimerReset=function(){this.lastInteraction=Date.now(),this.waitTimer=0},Opponent.prototype.onTrigger=function(t,e){return!(Date.now()-this.lastInteraction<1e3)&&(this.waitTimer>1?(this.lastInteraction=Date.now(),this.app.fire("World2Screen:Hide","Progress"),this.app.fire("PopupManager:Show","Challenge"),this.app.fire("Challenge:SetOpponent",this),!1):(this.waitTimer+=2*e,this.app.fire("World2Screen:Show","Progress",this.entity),void this.app.fire("Progress:WaitFill",this.waitTimer)))},Opponent.prototype.onLeave=function(){this.app.fire("World2Screen:Hide","Progress",this.entity),this.waitTimer=0,this.lastInteraction=Date.now()-500},Opponent.prototype.stop=function(){this.characterEntity.anim.setBoolean("Running",!1),this.characterEntity.anim.setBoolean("Ready",!1)},Opponent.prototype.ready=function(){this.characterEntity.anim.setBoolean("Running",!1),this.characterEntity.anim.setBoolean("Ready",!0)},Opponent.prototype.run=function(){this.characterEntity.anim.setBoolean("Running",!0),this.characterEntity.anim.setBoolean("Ready",!0)};var MaterialShader=pc.createScript("materialShader");MaterialShader.attributes.add("inEditor",{type:"boolean",default:!0,title:"In Editor"}),MaterialShader.attributes.add("isDebug",{type:"boolean",default:!1}),MaterialShader.attributes.add("isElement",{type:"boolean",default:!1}),MaterialShader.attributes.add("isStatic",{type:"boolean",default:!1}),MaterialShader.attributes.add("isBatched",{type:"boolean",default:!1}),MaterialShader.attributes.add("color",{type:"boolean",default:!0}),MaterialShader.attributes.add("transform",{type:"boolean",default:!0}),MaterialShader.attributes.add("light",{type:"boolean",default:!0}),MaterialShader.attributes.add("material",{type:"asset",assetType:"material"}),MaterialShader.attributes.add("textures",{type:"json",schema:[{name:"name",type:"string",default:"texture_0"},{name:"texture",type:"asset",assetType:"texture"}],array:!0}),MaterialShader.attributes.add("colors",{type:"json",schema:[{name:"name",type:"string",default:"color_0"},{name:"color",type:"rgba"}],array:!0}),MaterialShader.attributes.add("vectors",{type:"json",schema:[{name:"name",type:"string",default:"vector_0"},{name:"vector",type:"vec2"}],array:!0}),MaterialShader.attributes.add("numbers",{type:"json",schema:[{name:"name",type:"string",default:"number_0"},{name:"number",type:"number",default:0}],array:!0}),MaterialShader.attributes.add("curves",{type:"json",schema:[{name:"name",type:"string",default:"curve_0"},{name:"curve",type:"curve",curves:["x","y","z"]},{name:"speed",type:"number",default:1}],array:!0}),MaterialShader.attributes.add("billboard",{type:"boolean",default:!1}),MaterialShader.attributes.add("vertexSet",{type:"boolean",default:!1}),MaterialShader.attributes.add("cloneMaterial",{type:"boolean",default:!1}),MaterialShader.attributes.add("alphaRef",{type:"number",default:.15}),MaterialShader.attributes.add("shader",{type:"string",default:"dmVjNCBnZXRDb2xvcih2ZWMyIFVWKXsKLy92ZWMzIHRleHR1cmVfY29sb3IgPSB0ZXh0dXJlMkQodGV4dHVyZV8wLCBVVikucmdiOwpjb2xvci5yZ2IgPSB2ZWMzKDAuMCwgMS4wLCAwLjApOwpjb2xvci5hID0gMS4wOwoKcmV0dXJuIGNvbG9yOwp9Cgp2ZWMzIGdldFZlcnRleCh2ZWMzIGxvY2FsUG9zaXRpb24sIHZlYzMgd29ybGRQb3NpdGlvbiwgdmVjMiBVVil7CnZlcnRleC54eXogPSB2ZWMzKDAuMCwgMC4wLCAwLjApOwoKcmV0dXJuIHZlcnRleDsKfQ=="}),MaterialShader.prototype.initialize=function(){this.parameters=[],this.isOnce=!1,this.reset(),this.isDebug?this.addCodeEditor():(this.emissive=atob(this.shader),this.updateMaterial()),this.on("attr:textures",this.onAttributeChange,this),this.on("attr:colors",this.onAttributeChange,this),this.on("attr:vectors",this.onAttributeChange,this),this.on("attr:numbers",this.onAttributeChange,this),this.on("attr:curves",this.onAttributeChange,this),this.on("attr:shader",this.onAttributeChange,this),this.entity.on("MaterialShader:Set",this.setVariable,this),this.on("state",this.onStateChange,this),this.on("destroy",this.onDestroy,this),this.entity.on("Model:Loaded",this.onModelLoaded,this),this.app.on("MaterialShader:Reset",this.onStateChange,this),this.material&&(this.totalAssets=2+this.textures.length,this.loaded=0,this.loadAllAssets()),this.isElement&&this.onAttributeChange()},MaterialShader.prototype.loadAllAssets=function(){if(this.isElement)return this.loaded=this.totalAssets,Timer.setTimeout((function(t){t.isLoaded()}),100,this),!1;var t=this,e=this.entity.model.asset,a=this.app.assets.get(e);for(var i in a?(a.ready((function(){t.loaded++,t.isLoaded()})),this.app.assets.load(a)):(this.loaded++,this.isLoaded()),this.material.ready((function(){t.loaded++,t.isLoaded()})),this.app.assets.load(this.material),this.textures){var r=this.textures[i];r.texture.ready((function(){t.loaded++,t.isLoaded()})),this.app.assets.load(r.texture)}},MaterialShader.prototype.isLoaded=function(){this.loaded>=this.totalAssets&&(this.isBatched?Timer.setTimeout((function(t){t.getMaterialByBatch(),t.updateMaterial()}),100,this):(this.cloneMaterial?(this.currentMaterial=this.material.resource.clone(),this.isElement?this.entity.element.material=this.currentMaterial:this.entity.model.meshInstances[0].material=this.currentMaterial):this.currentMaterial=this.material.resource,this.updateMaterial()))},MaterialShader.prototype.setVariable=function(t,e){for(var a in this.entity.enabled=!0,this.parameters){var i=this.parameters[a];this.currentMaterial.setParameter(i.name,i.resource),i.name==t&&(this.parameters[a].resource=e)}},MaterialShader.prototype.updateDynamicVariables=function(){for(var t in this.curves){var e=this.curves[t];for(var a in this.parameters){var i=this.parameters[a];if(i.name==e.name){var r=e.curve.value(this.timestamp*e.speed%1);i.resource=[r[0],r[1],r[2]]}}}},MaterialShader.prototype.onDestroy=function(){this.cloneMaterial&&this.currentMaterial&&this.currentMaterial.destroy()},MaterialShader.prototype.onModelLoaded=function(t){!0===t&&Timer.setTimeout((function(t){t.onAttributeChange()}),3e3,this)},MaterialShader.prototype.onStateChange=function(t){this.reset()},MaterialShader.prototype.copy=function(t){var e=btoa(t);navigator.clipboard.writeText(e).then((function(){console.log("Async: Copying to clipboard was successful!")}),(function(t){console.error("Async: Could not copy text: ",t)}))},MaterialShader.prototype.addCodeEditor=function(){var t=this,e=document.createElement("button");e.style.position="fixed",e.style.left="10px",e.style.top="340px",e.style.width="100px",e.style.height="40px",e.style.zIndex="5000",e.style.background="rgba(0, 0, 0, 0.5)",e.style.color="#fff",e.textContent="Copy",e.onclick=function(){t.copy(t.emissiveCode.value)},document.body.appendChild(e);var a=document.createElement("textarea");a.style.position="fixed",a.style.left="10px",a.style.top="10px",a.style.width="400px",a.style.height="300px",a.style.padding="10px",a.style.zIndex="5000",a.style.background="rgba(0, 0, 0, 0.5)",a.style.outline="none",a.style.color="white",a.onkeyup=this.onShaderChange.bind(this);var i=document.createElement("style");i.innerText="#application-console{max-height: 80px;}",document.body.appendChild(i),this.emissiveCode=a,this.emissiveCode.value=atob(this.shader),this.emissive=this.emissiveCode.value,this.updateMaterial(),document.body.appendChild(a)},MaterialShader.prototype.onShaderChange=function(){Timer.clearTimeout(this.timer),this.timer=Timer.setTimeout((function(t){t.emissive=t.emissiveCode.value,t.updateMaterial()}),100,this)},MaterialShader.prototype.reset=function(){this.timestamp=0},MaterialShader.prototype.line=function(t){return t+"\n"},MaterialShader.prototype.number=function(t){return parseFloat(t).toFixed(2)},MaterialShader.prototype.colorRGB=function(t){return"vec3("+this.number(t.data[0])+", "+this.number(t.data[1])+", "+this.number(t.data[2])+")"},MaterialShader.prototype.colorRGBA=function(t){return"vec4("+this.number(t.data[0])+", "+this.number(t.data[1])+", "+this.number(t.data[2])+", "+this.number(t.data[3])+")"},MaterialShader.prototype.addParameter=function(t,e){var a="";for(var i in this[t]){var r=this[t][i],s=!1;if(a+=this.line("uniform "+e+" "+r.name+";"),"textures"==t&&(s=r.texture.resource),"colors"==t&&(s=r.color.data),"vectors"==t&&(s=r.vector.data),"curves"==t){var n=r.curve.value(this.timestamp*r.speed);s=[n[0],n[1],n[2]]}"numbers"==t&&(s=r.number),this.parameters.push({name:r.name,resource:s})}return a},MaterialShader.prototype.generateShaderOutput=function(){var t="";return t+=this.addParameter("textures","sampler2D"),t+=this.addParameter("colors","vec4"),t+=this.addParameter("vectors","vec2"),t+=this.addParameter("numbers","float"),t+=this.addParameter("curves","vec3"),t+=this.line("uniform float timestamp;"),t+=this.line("uniform float alpha_ref;"),t+=this.line("vec4 color  = vec4(0.0);"),t+=this.line("vec3 vertex = vec3(0.0);"),t+=this.line(this.emissive),t+=this.line("void getEmission() {"),t+=this.line("}"),t+=this.line("void getAlbedo() {"),t+=this.line("}"),t+=this.line("void getOpacity() {"),t+=this.line("}"),t+=this.line("void alphaTest(float a) {"),t+=this.line("if (a < alpha_ref) discard;"),t+=this.line("}")},MaterialShader.prototype.onAttributeChange=function(){this.reset(),this.updateMaterial()},MaterialShader.prototype.generateTransformOutput=function(){var t="";return t+=this.addParameter("textures","sampler2D"),t+=this.addParameter("colors","vec4"),t+=this.addParameter("vectors","vec2"),t+=this.addParameter("numbers","float"),t+=this.addParameter("curves","vec3"),this.isBatched&&(t+=this.line("#define DYNAMICBATCH")),t+=this.line("uniform float timestamp;"),t+=this.line("uniform mat4 matrix_viewInverse;"),t+=this.line("mat4 getModelMatrix() {"),t+=this.line("#ifdef DYNAMICBATCH"),t+=this.line("return getBoneMatrix(vertex_boneIndices);"),t+=this.line("#elif defined(INSTANCING)"),t+=this.line("return mat4(instance_line1, instance_line2, instance_line3, instance_line4);"),t+=this.line("#else"),t+=this.line("return matrix_model;"),t+=this.line("#endif"),t+=this.line("}"),t+=this.line("vec4 color  = vec4(0.0);"),t+=this.line("vec3 vertex = vec3(0.0);"),t+=this.line(this.emissive),t+=this.line("vec4 getPosition() {"),t+=this.line("dModelMatrix = getModelMatrix();"),t+=this.line("vec3 localPos = vertex_position;"),t+=this.line("vec4 posW   = dModelMatrix * vec4(localPos, 1.0);"),t+=this.line("vec2 UV     = localPos.xy * 0.5 + vec2(0.5, 0.5);"),this.billboard&&(t+=this.line("vec3 CameraUp_worldspace = matrix_viewInverse[1].xyz;"),t+=this.line("vec3 CameraRight_worldspace = matrix_viewInverse[0].xyz;"),t+=this.line("vec3 particleCenter_wordspace = ( dModelMatrix * vec4(0.0, 0.0, 0.0, 1.0) ).xyz;"),t+=this.line("posW.xyz = particleCenter_wordspace.xyz + CameraRight_worldspace * localPos.x + CameraUp_worldspace * localPos.y;")),this.vertexSet?t+=this.line("posW.xyz = getFullVertex(localPos, posW.xyz, UV, dModelMatrix, matrix_viewInverse);"):t+=this.line("posW.xyz+= getVertex(localPos, posW.xyz, UV);"),t+=this.line("dPositionW = posW.xyz;"),t+=this.line("vec4 outputPosition = matrix_viewProjection * posW;"),t+=this.line("return outputPosition;"),t+=this.line("}"),t+=this.line("vec3 getWorldPosition() {"),t+=this.line("return dPositionW;"),t+=this.line("}")},MaterialShader.prototype.getMaterialByBatch=function(){var t=this.entity.model.batchGroupId,e=this.app.batcher.getBatches(t);for(var a in e){var i=e[a].meshInstance.material;this.currentMaterial=i}},MaterialShader.prototype.updateMaterial=function(){if(this.timestamp=0,!this.currentMaterial)return!1;this.transform&&(this.currentMaterial.chunks.transformVS=this.generateTransformOutput()),this.color&&(this.currentMaterial.chunks.diffusePS=this.generateShaderOutput(),this.currentMaterial.chunks.opacityPS=" ",this.currentMaterial.chunks.emissivePS=" ",this.currentMaterial.chunks.alphaTestPS=" ",this.currentMaterial.chunks.endPS="vec4 outputColor = getColor(vUv0);",this.currentMaterial.chunks.endPS+="dAlpha = outputColor.a;",this.currentMaterial.chunks.endPS+="if (dAlpha < "+this.alphaRef+"){ discard; }",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = outputColor.rgb;",this.currentMaterial.chunks.outputAlphaPS=" ",this.light&&(this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = mix(gl_FragColor.rgb * dDiffuseLight, dSpecularLight + dReflection.rgb * dReflection.a, dSpecularity);",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = addFog(gl_FragColor.rgb);",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = toneMap(gl_FragColor.rgb);",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = gammaCorrectOutput(gl_FragColor.rgb);"),this.currentMaterial.chunks.endPS+="gl_FragColor.a = dAlpha;"),this.currentMaterial.update()},MaterialShader.prototype.update=function(t){if(this.currentMaterial){if(this.updateDynamicVariables(),!this.isStatic||!this.isOnce){for(var e in this.parameters){var a=this.parameters[e];this.currentMaterial.setParameter(a.name,a.resource)}this.isOnce=!0}this.currentMaterial.setParameter("timestamp",this.timestamp),this.currentMaterial.update()}this.timestamp+=t};var Progress=pc.createScript("progress");Progress.attributes.add("autoplay",{type:"boolean",default:!1}),Progress.attributes.add("speed",{type:"number",default:1}),Progress.attributes.add("checkEntity",{type:"entity"}),Progress.prototype.initialize=function(){this.timestamp=0,this.checkEntity&&(this.checkEntity.enabled=!1),this.app.on("Progress:"+this.entity.name,this.onProgress,this),this.entity.parent.on("Progress",this.onProgress,this),this.on("state",this.onStateChange,this)},Progress.prototype.onStateChange=function(){this.timestamp=0},Progress.prototype.onProgress=function(t){this.entity.fire("MaterialShader:Set","progress",t),this.checkEntity&&(this.checkEntity.enabled=t>=1)},Progress.prototype.update=function(t){this.autoplay&&(this.timestamp+=t,this.entity.fire("MaterialShader:Set","progress",this.timestamp))};var World2ScreenAnimate=pc.createScript("world2ScreenAnimate");World2ScreenAnimate.attributes.add("elements",{type:"entity",array:!0}),World2ScreenAnimate.attributes.add("speed",{type:"number",default:1}),World2ScreenAnimate.attributes.add("randomModifier",{type:"number",default:0}),World2ScreenAnimate.attributes.add("scaleCurve",{type:"curve",curves:["x"]}),World2ScreenAnimate.attributes.add("cameraEntity",{type:"entity"}),World2ScreenAnimate.attributes.add("holderEntity",{type:"entity"}),World2ScreenAnimate.prototype.initialize=function(){this.movingElements=[],this.elements.forEach((function(e){e.enabled=!1})),this.app.on("World2Screen:Animate",this.onCollect,this)},World2ScreenAnimate.prototype.onCollect=function(e,t,n){var i=this.getElementByName(e);if(i){var r=this.getScreenPosition(t),a=n.getPosition().clone(),o=i.clone(),s=(Math.random()-Math.random())*this.randomModifier,m=(Math.random()-Math.random())*this.randomModifier;o.setLocalPosition(r.x+s,r.y+m,0),o.enabled=!0,this.movingElements.push({timestamp:0,element:o,screenPosition:r,destinationPosition:a}),this.holderEntity.addChild(o)}},World2ScreenAnimate.prototype.getScreenPosition=function(e){if(!this.cameraEntity)return console.warn("Camera doesnt exist!"),!1;var t=new pc.Vec3,n=this.cameraEntity.camera,i=this.app.graphicsDevice.maxPixelRatio,r=this.entity.screen.scale,a=this.app.graphicsDevice;return n?(n.worldToScreen(e,t),t.x*=i,t.y*=i,new pc.Vec2(t.x/r,(a.height-t.y)/r)):(console.warn("Camera doesnt exist!"),!1)},World2ScreenAnimate.prototype.getElementByName=function(e){for(var t=0;t<this.elements.length;t++)if(this.elements[t].name===e)return this.elements[t];return null},World2ScreenAnimate.prototype.update=function(e){for(var t=this.movingElements.length;t--;){var n=this.movingElements[t];if(n&&(n.timestamp+=e*this.speed,n.timestamp>0)){var i=n.timestamp,r=this.scaleCurve.value(i),a=n.element.getPosition();i>.25&&a.lerp(a,n.destinationPosition,.1),n.element.setPosition(a),n.element.setLocalScale(r,r,r),i>=1&&(this.movingElements.splice(t,1),n.element.destroy())}}};var World2Screen=pc.createScript("world2Screen");World2Screen.attributes.add("holderEntity",{type:"entity"}),World2Screen.attributes.add("display",{type:"entity",array:!0}),World2Screen.prototype.postInitialize=function(){this.interactions=[],this.cameraEntity=this.app.root.findByName("Lens"),this.frameDrawn=0,this.nextFrameVisible=!1,this.app.on("World2Screen:Clone",this.cloneInteraction,this),this.app.on("World2Screen:Show",this.addInteraction,this),this.app.on("World2Screen:Visible",this.visibleInteraction,this),this.app.on("World2Screen:Hide",this.removeInteraction,this),this.hideAllDisplays(),this.on("destroy",this.onDestroy,this)},World2Screen.prototype.hideAllDisplays=function(){for(var e in this.display){this.display[e].enabled=!1}},World2Screen.prototype.onDestroy=function(){this.app.off("World2Screen:Show",this.setInteraction,this)},World2Screen.prototype.getInteractionDisplay=function(e){var t=!1;for(var i in this.display){var n=this.display[i];n.name==e&&(t=n)}return t},World2Screen.prototype.removeInteraction=function(e,t){var i=this.getInteractionDisplay(e);i&&(i.enabled=!1,i.entity=!1)},World2Screen.prototype.addInteraction=function(e,t,i){var n=this.getInteractionDisplay(e);n&&(n.entity!=t&&(n.enabled=!1),n.offset=i||new pc.Vec3(0,0,0),n.entity=t,n.type=e,n.enabled=!0,n.createdAt=Date.now())},World2Screen.prototype.cloneInteraction=function(e,t,i,n,r){var o=this.getInteractionDisplay(e),a=this;o&&((o=o.clone()).name=t._guid,o.enabled=!0,o.offset=i||new pc.Vec3(0,0,0),o.entity=t,o.type=e,o.enabled=!0,o.createdAt=Date.now(),o.destroyAfter=r,n&&n(o),t.parentDisplay=o,t.on("destroy",(function(){var e=a.display.indexOf(this.parentDisplay);e>-1&&(a.display.splice(e,1),o.destroy())})),t.on("World2Screen:Hide",(function(){var e=a.display.indexOf(this.parentDisplay);e>-1&&(a.display.splice(e,1),o.destroy())})),this.holderEntity.addChild(o),this.display.push(o))},World2Screen.prototype.visibleInteraction=function(e,t,i){this.addInteraction(e,t,i),this.frameDrawn=0,this.nextFrameVisible=e},World2Screen.prototype.updateInteraction=function(e){if(!this.cameraEntity)return!1;var t=new pc.Vec3,i=this.cameraEntity.camera,n=this.app.graphicsDevice.maxPixelRatio,r=this.entity.screen.scale,o=this.app.graphicsDevice;if(!i)return!1;if(!e.entity)return!1;if(e.offset&&e.offset.name?i.worldToScreen(e.offset.getPosition().clone(),t):i.worldToScreen(e.entity.getPosition().clone().add(e.offset),t),t.x*=n,t.y*=n,t.x>0&&t.x<this.app.graphicsDevice.width&&t.y>0&&t.y<this.app.graphicsDevice.height&&t.z>0?(e.setLocalPosition(t.x/r,(o.height-t.y)/r,0),e.enabled=e.entity.enabled):e.enabled=!1,e.destroyAfter>0&&Date.now()-e.createdAt>1e3*e.destroyAfter){this.display.indexOf(e);e.destroy()}},World2Screen.prototype.update=function(e){for(var t=this.display.length;t--;){var i=this.display[t];i&&this.updateInteraction(i)}this.nextFrameVisible&&this.frameDrawn>0&&this.removeInteraction(this.nextFrameVisible),this.frameDrawn++};var NetworkManager=pc.createScript("networkManager");NetworkManager.attributes.add("isDebug",{type:"boolean",default:!1}),NetworkManager.attributes.add("URL",{type:"string",default:"localhost:2567"}),NetworkManager.attributes.add("testURL",{type:"string",default:"localhost:2567"}),NetworkManager.attributes.add("gameMode",{type:"string",default:"Parkour"}),NetworkManager.attributes.add("playerEntity",{type:"entity"}),NetworkManager.attributes.add("enemyEntity",{type:"entity"}),NetworkManager.attributes.add("playerHolder",{type:"entity"}),NetworkManager.attributes.add("levelManager",{type:"entity"}),NetworkManager.attributes.add("inviteManager",{type:"entity"}),NetworkManager.prototype.initialize=function(){this.isActive=!1,this.pvpModes=["BossFight"],this.enemyEntity.enabled=!1,this.playerArray=[],this.lastAdd=Date.now(),this.privateRoomId=PokiSDK.getURLParam("invite"),this.app.on("NetworkManager:Connect",this.connectToColyseus,this),this.app.on("NetworkManager:Send",this.send,this),this.app.on("NetworkManager:CreateRoom",this.createRoom,this),this.app.on("NetworkManager:Add",this.onIdleManagerAdd,this),this.app.on("NetworkManager:Set",this.onIdleManagerSet,this),this.app.on("PopupManager:Show",this.onPopupShow,this),this.app.on("PopupManager:Hide",this.onPopupHide,this),this.on("destroy",this.onDestroy,this)},NetworkManager.prototype.onDestroy=function(){this.app.off("NetworkManager:Send",this.send,this),this.app.off("NetworkManager:Leave",this.onLeaveButton,this),this.app.off("NetworkManager:Add",this.onIdleManagerAdd,this),this.app.off("NetworkManager:Set",this.onIdleManagerSet,this),this.app.off("PopupManager:Show",this.onPopupShow,this),this.app.off("PopupManager:Hide",this.onPopupHide,this)},NetworkManager.prototype.onPopupShow=function(e){},NetworkManager.prototype.onPopupHide=function(e){},NetworkManager.prototype.sendCircleHit=function(e){this.isActive&&this.room&&this.room.send("circleHit",{damage:e})},NetworkManager.prototype.sendBarHit=function(e,t){this.isActive&&this.room&&this.room.send("barHit",{position:e,multiplier:t})},NetworkManager.prototype.onIdleManagerAdd=function(e,t){if(Date.now()-this.lastAdd<250)return!1;this.lastAdd=Date.now(),"Fishes"==e&&this.app.fire("NetworkManager:Send","changeFishes",pc.IdleManager.Fishes)},NetworkManager.prototype.onIdleManagerSet=function(e,t){},NetworkManager.prototype.createRoom=function(){var e=Utils.generateRoomId();this.connectToColyseus(this.levelManager.script.levelManager.currentLevel,e),this.inviteManager.script.inviteManager.createButtonEntity.enabled=!1,this.inviteManager.script.inviteManager.loadingButton.enabled=!0,Utils.addEvent("Invite")},NetworkManager.prototype.connectToColyseus=function(e,t){var o=this;this.room&&(this.room.leave(),this.deletePlayers()),this.isDebug?this.client=new Colyseus.Client("ws://"+this.testURL):this.client=new Colyseus.Client("wss://"+this.URL),this.username=this.playerEntity.username;var i=0==pc.IdleManager.Customizations.length?[{shoes:"Default"}]:pc.IdleManager.Customizations,n=pc.IdleManager.Cosmetics,r=this.bundleCustomizationData(i,n);t&&(this.privateRoomId=t);var a={username:this.username,fishes:pc.IdleManager.Fishes,rebirth:pc.IdleManager.RebirthLevel,rodAura:Utils.getItemAsArray("CurrentAura",[]),rodPower:pc.IdleManager.RodPower,customizations:JSON.stringify(r),privateRoomId:this.privateRoomId,level:e};pc.levelName=e,this.pvpModes.indexOf(pc.levelName)>-1&&(pc.inPvpMode=!0),t?this.connection=this.client.create("private",a).then((function(e){pc.app.fire("InviteManager:SetLink",e.id),o.onConnected(e)})).catch((function(e){o.showErrorMessage("Connection problem!")})):this.privateRoomId&&!t?this.connection=this.client.joinById(this.privateRoomId,a).then((function(e){o.onConnected(e)})).catch((function(e){o.showErrorMessage("Connection problem!")})):this.connection=this.client.joinOrCreate(e,a).then((function(e){o.onConnected(e)})).catch((function(e){o.showErrorMessage("Connection problem!")}))},NetworkManager.prototype.deletePlayers=function(){for(var e in this.playerArray){var t=this.playerArray[e];t&&t.destroy()}this.playerArray=[]},NetworkManager.prototype.showErrorMessage=function(e){this.app.fire("Overlay:Alert",e)},NetworkManager.prototype.bundleCustomizationData=function(e,t){var o={};return e.forEach((e=>{var t=Object.keys(e)[0];o[t]=e[t]})),o.cosmetics=t,o},NetworkManager.prototype.onConnected=function(e){var t=this;this.room=e,this.isActive=!0,this.app.fire("InviteManager:Connected",this.room),this.app.on("NetworkManager:Leave",this.onLeaveButton,this),this.room.onStateChange((function(e){t.onStateChange(e)})),this.room.onMessage("playerPowers",(function(e){t.app.fire("BossFight:PlayerPowers",e)})),this.room.onMessage("t",(function(e){pc.app.fire("Server:Time",e)})),this.room.onMessage("Spawn",(function(e){t.playerEntity.enabled=!0,t.playerEntity.fire("Spawn",e)})),this.room.onMessage("animSetBoolean",(function(e){if(t.playerEntity.sessionId==e.client)return!1;var o=t.getPlayerById(e.client);o&&o.fire("Enemy:AnimSetBoolean",e)})),this.room.onMessage("triggerFunction",(function(e){if(t.playerEntity.sessionId==e.client)return!1;var o=t.getPlayerById(e.client);o&&o.fire("Enemy:TriggerFunction",e)})),this.room.onMessage("setItem",(function(e){if(t.playerEntity.sessionId==e.client)return!1;var o=t.getPlayerById(e.client);o&&o.fire("SetItem",e)})),this.room.onMessage("animSetTrigger",(function(e){if(t.playerEntity.sessionId==e.client)return!1;var o=t.getPlayerById(e.client);o&&o.fire("Enemy:AnimSetTrigger",e)})),this.room.onMessage("updateCustomizations",(function(e){if(t.playerEntity.sessionId==e.client)return!1;var o=t.getPlayerById(e.client);o&&o.fire("Enemy:UpdateCustomizations",e)})),this.room.onMessage("changeUsername",(function(e){if(t.playerEntity.sessionId==e.client)return!1;var o=t.getPlayerById(e.client);o&&(o.username=e.value,o.fire("Username",e.value))})),this.room.onMessage("changeRodPower",(function(e){if(t.playerEntity.sessionId==e.client)return!1;var o=t.getPlayerById(e.client);o&&(o.rodPower=e.value,o.fire("RodPower",e.value))})),this.room.onMessage("changeFishes",(function(e){if(t.playerEntity.sessionId==e.client)return!1;var o=t.getPlayerById(e.client);o&&(o.fishes=e.value,o.fire("Fishes",e.value))})),this.room.onMessage("changeRebirth",(function(e){if(t.playerEntity.sessionId==e.client)return!1;var o=t.getPlayerById(e.client);o&&(o.rebirth=e.value,o.fire("Rebirth",e.value))})),this.room.onMessage("changeAura",(function(e){if(t.playerEntity.sessionId==e.client)return!1;var o=t.getPlayerById(e.client);o&&o.fire("SetRodAura",e.value)})),this.room.onMessage("fishSubmitted",(function(e){t.app.fire("CompetitiveMode:FishSubmitted",e)})),this.room.onMessage("allowFishSubmission",(function(e){t.app.fire("CompetitiveMode:SubmitFish",e)})),this.room.onMessage("competitiveTimer",(function(e){t.app.fire("CompetitiveMode:Timer",e)})),this.room.onMessage("CompetitiveGameStarted",(function(e){t.app.fire("CompetitiveMode:GameStarted",e)})),this.room.onMessage("playerGame1Started",(function(e){t.app.fire("CompetitiveMode:Game1Started",e)})),this.room.onMessage("playerGame2Started",(function(e){t.app.fire("CompetitiveMode:Game2Started",e)})),this.room.onMessage("playerProgress",(function(e){t.app.fire("CompetitiveMode:PlayerProgress",e)})),this.room.onMessage("playersUpdate",(function(e){t.app.fire("CompetitiveMode:PlayersUpdate",e)})),this.room.onMessage("playerPositions",(function(e){t.app.fire("CompetitiveMode:PlayerPositions",e)})),this.room.onMessage("barData",(function(e){t.app.fire("CompetitiveMode:BarData",e)})),this.room.onMessage("gameFinished",(function(e){t.app.fire("CompetitiveMode:GameFinished",e)})),this.room.onMessage("roundComplete",(function(e){t.app.fire("CompetitiveMode:RoundComplete",e)})),this.room.onMessage("results",(function(e){t.app.fire("CompetitiveMode:Results",e)})),this.room.onMessage("leaderboard",(function(e){t.app.fire("Leaderboard:Update",e)})),this.room.onMessage("timer",(function(e){t.app.fire("Game:Timer",e),t.app.fire("BossFight:Timer",e)})),this.room.onMessage("lightState",(function(e){t.app.fire("Prison:SetLight",e)})),this.room.onMessage("prisonWin",(function(e){t.app.fire("Prison:Win",e),t.app.fire("Obstacle:Win",e)})),this.room.onMessage("createBarrel",(function(e){t.app.fire("Obstacle:CreateBarrel",e)})),this.room.onMessage("updateBarrel",(function(e){t.app.fire("Obstacle:UpdateBarrel",e)})),this.room.onMessage("removeBarrel",(function(e){t.app.fire("Obstacle:RemoveBarrel",e)})),this.room.onMessage("teleport",(function(e){t.app.fire("Player:Teleport",e)})),this.room.onMessage("die",(function(e){if(t.playerEntity.sessionId==e.client)return t.playerEntity.fire("Player:Die",e.rank),t.app.fire("Prison:Eliminated",e.rank),t.app.fire("Obstacle:Eliminated",e.rank),t.app.fire("Prison:Shoot",t.playerEntity),!1;var o=t.getPlayerById(e.client);o&&(o.fire("Player:Die",e.rank),t.app.fire("Prison:Shoot",o))})),this.room.onMessage("gameStarted",(function(e){t.app.fire("BossFight:GameStarted",e)})),this.room.onMessage("gameUpdate",(function(e){t.app.fire("BossFight:GameUpdate",e)})),this.room.onMessage("bossUpdate",(function(e){t.app.fire("BossFight:BossUpdate",e)})),this.room.onMessage("gameWin",(function(e){t.app.fire("BossFight:Win",e)})),this.room.onMessage("gameOver",(function(e){t.app.fire("BossFight:Lose",e)})),this.room.onMessage("specialActionPrompt",(function(e){t.app.fire("BossFight:SpecialActionPrompt",e)})),this.room.onMessage("cooldownUpdate",(function(e){t.app.fire("BossFight:CooldownUpdate",e)})),this.room.onMessage("onCooldown",(function(e){t.app.fire("BossFight:OnCooldown",e)})),this.room.onMessage("cooldownUpdated",(function(e){t.app.fire("BossFight:CooldownUpdated",e)})),this.room.onMessage("lobbyUpdate",(function(e){t.app.fire("BossFight:LobbyUpdate",e)})),this.room.onLeave((function(e){t.isActive=!1})),this.room.state.players.onAdd((function(e,o){if(e.sessionId===t.room.sessionId)return t.playerEntity.username=e.username,t.playerEntity.sessionId=e.sessionId,!1;t.onPlayerCreate(e)})),this.room.onMessage("holdFish",(function(e){if(t.playerEntity.sessionId==e.client)return!1;var o=t.getPlayerById(e.client);o&&o.fire("SetHeldFish",e.fishData)})),this.room.state.players.onRemove((function(e){t.onLeave(e)}))},NetworkManager.prototype.sendBossAttack=function(e){this.isActive&&this.room&&this.room.send("updatePower",{power:e})},NetworkManager.prototype.sendSpecialAction=function(e){this.isActive&&this.room&&this.room.send("specialAction",{type:e})},NetworkManager.prototype.sendSkipCooldown=function(){this.isActive&&this.room&&this.room.send("skipCooldown",{})},NetworkManager.prototype.onLeaveButton=function(){this.room.leave(),this.app.fire("Scene:Load","Menu")},NetworkManager.prototype.onStateChange=function(e){},NetworkManager.prototype.onPlayerCreate=function(e){var t=this.enemyEntity.clone();t.sessionId=e.sessionId,t.username=e.username,t.strength=e.strength,t.rebirth=e.rebirth,t.rodPower=e.rodPower,t.fishes=e.fishes,t.network=e,t.enabled=!0,e.p.onChange((function(o){t.fire("Position",{x:e.p.x,y:e.p.y,z:e.p.z,w:e.p.w})})),this.playerHolder.addChild(t),this.playerArray.push(t),t.fire("Enemy:UpdateCustomizations",e.customizations),t.fire("Strength",e.strength),t.fire("Rebirth",e.rebirth),t.fire("RodPower",e.rodPower),t.fire("Fishes",e.fishes),t.fire("Username",e.username),t.fire("SetItem",e.item),t.fire("SetRodAura",e.rodAura),this.app.fire("Overlay:Notification",t.username,"Joined",!1)},NetworkManager.prototype.getPlayerById=function(e){for(var t=this.playerArray.length;t--;)if(this.playerArray[t].sessionId===e)return this.playerArray[t];if(e==this.playerEntity.sessionId)return this.playerEntity},NetworkManager.prototype.onMessage=function(e){console.log(this.client.id,"received on",this.room.name,e)},NetworkManager.prototype.onLeave=function(e){var t=this.getPlayerById(e.sessionId);t&&(this.playerArray.splice(this.playerArray.indexOf(t),1),t.destroy())},NetworkManager.prototype.send=function(e,t){return!!this.isActive&&(!!this.room&&void this.room.send(e,t))};var PopupPrevent=pc.createScript("popupPrevent");PopupPrevent.prototype.initialize=function(){this.entity.element.on("mouseup",this.onPress,this)},PopupPrevent.prototype.onPress=function(t){t._stopPropagation=!0};var Enemy=pc.createScript("enemy");Enemy.attributes.add("originEntity",{type:"entity"}),Enemy.attributes.add("characterEntity",{type:"entity"}),Enemy.attributes.add("modelEntity",{type:"entity"}),Enemy.attributes.add("rodEntity",{type:"entity"}),Enemy.attributes.add("bodyEntity",{type:"entity"}),Enemy.attributes.add("usernameEntity",{type:"entity"}),Enemy.attributes.add("vipIconEntity",{type:"entity"}),Enemy.attributes.add("auraHolder",{type:"entity"}),Enemy.attributes.add("strengthEntity",{type:"entity"}),Enemy.attributes.add("rebirthEntity",{type:"entity"}),Enemy.attributes.add("catchSpeedEntity",{type:"entity"}),Enemy.attributes.add("turnSpeed",{type:"number",default:.35}),Enemy.attributes.add("lerpSpeed",{type:"number",default:.35}),Enemy.attributes.add("drawDistance",{type:"number",default:25}),Enemy.attributes.add("shoeEntityL",{type:"entity"}),Enemy.attributes.add("shoeEntityR",{type:"entity"}),Enemy.attributes.add("trails",{type:"entity"}),Enemy.attributes.add("rodAura",{type:"entity"}),Enemy.attributes.add("fishModelEntity",{type:"entity"}),Enemy.attributes.add("armEntity",{type:"entity"}),Enemy.attributes.add("handEntity",{type:"entity"}),Enemy.attributes.add("armAngle",{type:"vec3"}),Enemy.attributes.add("items",{type:"json",schema:[{name:"categoryName",type:"string"},{name:"itemHolders",type:"entity",array:!0}],array:!0}),Enemy.attributes.add("cosmetics",{type:"json",schema:[{name:"categoryName",type:"string"},{name:"useMaterials",type:"boolean",default:!1},{name:"entity",type:"entity"}],array:!0}),Enemy.prototype.initialize=function(){this.direction=0,this.nextDirection=0,this.isLanded=!0,this.lastDraw=-1,this.isDeath=!1,this.item="None",this.nextPosition=new pc.Vec3(0,2,0),this.originalFishScale=1,this.originalFishWeight=1,this.currentFishName=null,this.entity.on("Position",this.setPosition,this),this.entity.on("Scale",this.setScale,this),this.entity.on("Fishes",this.onFishes,this),this.entity.on("RodPower",this.onRodPower,this),this.entity.on("Username",this.onUsername,this),this.entity.on("SetItem",this.onSetItem,this),this.entity.on("SetRodAura",this.setRodAura,this),this.entity.on("Enemy:UpdateCustomizations",this.updateCustomizations,this),this.entity.on("SetHeldFish",this.onSetHeldFish,this),this.entity.on("Enemy:AnimSetBoolean",this.animSetBoolean,this),this.entity.on("Enemy:AnimSetTrigger",this.animSetTrigger,this),this.entity.on("Enemy:TriggerFunction",this.triggerFunction,this),this.entity.on("Player:Die",this.setDeath,this),pc.inPvpMode&&this.setModeSkin(),this.rebirthEntity.enabled=!1,this.on("destroy",this.onDestroy,this)},Enemy.prototype.onSetHeldFish=function(t){if(this.fishModelEntity){if(!t||!t.fishModel)return this.fishModelEntity.model.asset=null,this.fishModelEntity.setLocalScale(1,1,1),this.currentFishName=null,this.originalFishScale=1,void(this.originalFishWeight=1);var e=this.app.assets.get(t.fishModel);if(e){if(this.fishModelEntity.model.asset=e,this.currentFishName=t.fishName,t.fishName){var i=this.app.root.findByName(t.fishName);i&&i.script&&i.script.fish?this.originalFishWeight=i.script.fish.weight||1:this.originalFishWeight=1}if(this.originalFishScale=1,t.fishWeight||t.fishScore){var n=t.fishWeight||t.fishScore,s=this.scaleFishModel(n);this.fishModelEntity.setLocalScale(s,s,s)}else this.fishModelEntity.setLocalScale(this.originalFishScale,this.originalFishScale,this.originalFishScale)}else console.warn("Fish model asset not found:",t.fishModel)}else console.warn("Fish model entity not assigned for enemy")},Enemy.prototype.setDeath=function(){if(console.log("death set!"),this.isDeath)return!1;this.characterEntity.anim.setTrigger("Death"),this.isDeath=!0},Enemy.prototype.setRodAura=function(t){let e;if(t){if("number"==typeof t)e=t;else{if(!Array.isArray(t))return void(this.rodAura.enabled=!1);{const i=t.length;if(0===i)return void(this.rodAura.enabled=!1);if(1===i)switch(t[0]){case"CatchSpeed":default:e=0;break;case"FishChance":e=1;break;case"Money":e=2}else e=2===i?3:4}}this.rodAura.enabled=!0,setTimeout((function(t){t.rodAura.fire("MaterialShader:Set","activeIndex",e)}),3e3,this)}else this.rodAura.enabled=!1},Enemy.prototype.onRodPower=function(t){this.catchSpeedEntity&&(this.catchSpeedEntity.element.text=t||0)},Enemy.prototype.onSetItem=function(t){var e=t.name;return"Model"!=e&&(this.item&&"None"!=this.item&&(this.item.enabled=!1),e&&"None"!=e?(this.item=this.entity.findByName(e),void(this.item?this.item.enabled=!0:this.item="None")):(this.item&&"None"!=this.item&&(this.item.enabled=!1),this.item,!1))},Enemy.prototype.onUsername=function(t){this.usernameEntity.element.text=t},Enemy.prototype.onRebirth=function(t){var e=Utils.numberScale(t);this.rebirthEntity.element.text=e},Enemy.prototype.onFishes=function(t){if(t){var e=Utils.numberScale(t);this.strengthEntity.element.text=e}else this.strengthEntity.element.text=0},Enemy.prototype.setModeSkin=function(){"Prison"==pc.levelName&&(this.modelEntity.render.asset=this.app.assets.find("Prisoner","render"),this.modelEntity.render.materialAssets=[this.app.assets.find("Prisoner",pc.ASSET_MATERIAL)])},Enemy.prototype.updateCustomizations=function(t){if(pc.inPvpMode&&"Prison"==pc.levelName)return this.setModeSkin(),!1;"object"==typeof t?this.customizations=JSON.parse(t.data):"string"==typeof t&&(this.customizations=JSON.parse(t));for(const t in this.customizations)if(this.customizations.hasOwnProperty(t)){var e=this[t];"function"==typeof e&&(e=e.bind(this))(this.customizations[t])}this.customizations&&this.customizations.cosmetics&&this.customizations.cosmetics.forEach((t=>{this.cosmetics.forEach((e=>{var i;if(t.categoryName==e.categoryName&&((i=this.app.assets.get(t.model))&&(e.entity.render.asset=i),e.useMaterials&&(i=this.app.assets.get(parseInt(t.model))))){var n=this.app.assets.find(i.name,pc.ASSET_MATERIAL);if(n){this.app.assets.load(n);for(const t of e.entity.render.meshInstances)t.material=n.resource}}}))}))},Enemy.prototype.triggerFunction=function(t){if("Jump"==t.name)return this.bodyEntity.fire("Motion","Jump"),this.characterEntity.anim.setTrigger("Jump"),this.rodEntity.anim.setTrigger("Jump"),!1;if("Enable"==t.name)return this.originEntity.enabled=!0,!1;if("Disable"==t.name)return this.originEntity.enabled=!1,!1;if("Emote"==t.name)return this.entity.fire("Emotes:Play",t.value),!1;if("VIP"==t.name)return this.vipIconEntity.enabled=t.value,!1;if("Aura"==t.name){if(t.value==this.oldAuraIndex)return!1;for(var e=0;e<this.auraHolder.children.length;e++)this.auraHolder.children[e].enabled=!1;return-1!=t.value&&(this.auraHolder.children[t.value].enabled=!0),this.oldAuraIndex=t.value,!1}},Enemy.prototype.animSetBoolean=function(t){pc.inPvpMode&&"Walking"==t.name?(this.characterEntity.anim.setBoolean("Walking",t.value),this.rodEntity.anim.setBoolean("Walking",t.value)):(this.characterEntity.anim.setBoolean(t.name,t.value),this.rodEntity.anim.setBoolean(t.name,t.value))},Enemy.prototype.animSetTrigger=function(t){this.characterEntity.anim.setTrigger(t.name),this.rodEntity.anim.setTrigger(t.name)},Enemy.prototype.setMeshInstances=function(){var t=this.modelEntity.findComponents("render");this.meshInstances=[];for(var e=0;e<t.length;++e)for(var i=t[e].meshInstances,n=0;n<i.length;n++)this.meshInstances.push(i[n])},Enemy.prototype.setPosition=function(t){this.nextPosition.x=t.x,this.nextPosition.y=Math.max(t.y,1.2),this.nextPosition.z=t.z,this.nextDirection=t.w},Enemy.prototype.setScale=function(t){this.entity.setLocalScale(t,t,t)},Enemy.prototype.setDirection=function(t){var e=this.turnSpeed;this.direction=Utils.rotate(this.direction,this.nextDirection,e),this.originEntity.setLocalEulerAngles(0,90-this.direction*pc.math.RAD_TO_DEG,0)},Enemy.prototype.lerpPosition=function(t){var e=this.entity.getPosition(),i=new pc.Vec3(0,0,0);i.x=e.x+(this.nextPosition.x-e.x)*this.lerpSpeed,i.y=e.y+(this.nextPosition.y-e.y)*this.lerpSpeed,i.z=e.z+(this.nextPosition.z-e.z)*this.lerpSpeed,e.distance(i)>2&&(i=this.nextPosition),this.entity.setPosition(i)},Enemy.prototype.shoes=function(t){var e=t;this.setShoe(this.shoeEntityL,e),this.setShoe(this.shoeEntityR,e)},Enemy.prototype.setShoe=function(t,e){var i=this.app.assets.findByTag("Shoes").find((t=>t.name==e));if(i){t.render.asset=i;var n=this.app.assets.find(i.name,pc.ASSET_MATERIAL);t.render.materialAssets=[n];var s=t.findByTag("Trail")[0];s&&s.destroy();var a=this.trails.findByName(i.name);if(a){var o=a.clone();t.addChild(o),o.setLocalPosition(0,.012,-.01),o.enabled=!0}}},Enemy.prototype.drawChallengeEnemy=function(){return!pc.inPvpMode&&(!(Date.now()-this.lastDraw<1e3)&&(this.entity.position.length()>this.drawDistance?(this.originEntity.enabled=!1,this.auraHolder.enabled=!1):(this.originEntity.enabled=!0,this.auraHolder.enabled=!0),void(this.lastDraw=Date.now())))},Enemy.prototype.onDestroy=function(){},Enemy.prototype.update=function(t){if(this.isDeath)return!1;this.lerpPosition(t),this.setDirection(t)},Enemy.prototype.postUpdate=function(t){this.fishModelEntity.model.asset&&(this.armEntity.setLocalEulerAngles(this.armAngle),this.handEntity.setLocalEulerAngles(0,0,0))};var PopupManager=pc.createScript("popupManager");PopupManager.attributes.add("popupEntity",{type:"entity"}),PopupManager.attributes.add("emotesScrollViews",{type:"entity",array:!0}),PopupManager.attributes.add("commercialBreakPopups",{type:"string",array:!0}),PopupManager.attributes.add("hideOnPopup",{type:"entity",array:!0}),PopupManager.prototype.initialize=function(){this.popupEntity.enabled=!1,this.views=this.popupEntity.findByTag("View"),this.popupName="";for(var e=0;e<this.views.length;e++)this.views[e].enabled=!1;this.app.on("PopupManager:Show",this.onShow,this),this.app.on("PopupManager:Hide",this.onHide,this)},PopupManager.prototype.onShow=function(e){if(e==this.popupName&&this.popupEntity.enabled)return!1;for(var i in pc.app.fire("Overlay:HideMouseInstructions"),pc.app.fire("World2Screen:Hide","Progress"),pc.hasActiveInterface=!0,this.popupName=e,this.hideOnPopup.forEach((function(e){e.enabled=!1})),this.emotesScrollViews){this.emotesScrollViews[i].scrollview.scroll=pc.Vec2.ZERO}this.app.mouse.disablePointerLock(),this.popupEntity.enabled=!0,this.app.fire("Timeline:Popup");for(var p=0;p<this.views.length;p++)this.views[p].name===e?this.views[p].enabled=!0:this.views[p].enabled=!1;Utils.addEvent(e),PokiPlugin.onPause()},PopupManager.prototype.onHide=function(){pc.hasActiveInterface=!1;this.popupEntity.enabled=!1,this.hideOnPopup.forEach((function(e){e.enabled=!0})),PokiPlugin.onPlay(),Utils.isMobile()||PokiPlugin.isPaused||this.app.mouse.enablePointerLock(),this.app.fire("PopupManager:PopupHidden",this.popupName)};!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("colyseus.js",["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Colyseus={})}(this,(function(e){"use strict";function _mergeNamespaces(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return null!==e&&"object"==typeof e&&e.buffer instanceof ArrayBuffer}),"undefined"==typeof globalThis&&"undefined"!=typeof window&&(window.globalThis=window);var extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},extendStatics(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function __(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}var t,__assign=function(){return __assign=Object.assign||function __assign(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},__assign.apply(this,arguments)};function __awaiter(e,t,n,r){return new(n||(n=Promise))((function(i,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r.throw(e))}catch(e){o(e)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))}function __generator(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function verb(a){return function(c){return function step(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function __classPrivateFieldGet(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function __classPrivateFieldSet(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n}!function(e){e[e.CONSENTED=4e3]="CONSENTED",e[e.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(t||(t={}));var n=function(e){function ServerError(t,n){var r=e.call(this,n)||this;return r.name="ServerError",r.code=t,r}return __extends(ServerError,e),ServerError}(Error);function Decoder(e,t){if(this._offset=t,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}Decoder.prototype._array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this._parse();return t},Decoder.prototype._map=function(e){for(var t={},n=0;n<e;n++)t[this._parse()]=this._parse();return t},Decoder.prototype._str=function(e){var t=function utf8Read$1(e,t,n){for(var r="",i=0,o=t,s=t+n;o<s;o++){var a=e.getUint8(o);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(i=(7&a)<<18|(63&e.getUint8(++o))<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0)>=65536?(i-=65536,r+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):r+=String.fromCharCode(i)}else r+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0);else r+=String.fromCharCode((31&a)<<6|63&e.getUint8(++o));else r+=String.fromCharCode(a)}return r}(this._view,this._offset,e);return this._offset+=e,t},Decoder.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},Decoder.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),n=0,r=0,i=0,o=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(t>223)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:if(n=this._view.getUint8(this._offset),r=this._view.getInt8(this._offset+1),this._offset+=2,-1===r){var s=this._view.getUint32(this._offset);return i=this._view.getInt32(this._offset+4),o=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*i+o)+s/1e6)}return[r,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),r=this._view.getInt8(this._offset+2),this._offset+=3,[r,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),r=this._view.getInt8(this._offset+4),this._offset+=5,[r,this._bin(n)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return i=this._view.getUint32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,i+o;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return i=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,i+o;case 212:return r=this._view.getInt8(this._offset),this._offset+=1,0===r?void(this._offset+=1):[r,this._bin(1)];case 213:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(2)];case 214:return r=this._view.getInt8(this._offset),this._offset+=1,-1===r?(e=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*e)):[r,this._bin(4)];case 215:return r=this._view.getInt8(this._offset),this._offset+=1,0===r?(i=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,new Date(i+o)):-1===r?(i=this._view.getUint32(this._offset),o=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&i)+o)+(i>>>2)/1e6)):[r,this._bin(8)];case 216:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw new Error("Could not parse")};function utf8Write(e,t,n){for(var r=0,i=0,o=n.length;i<o;i++)(r=n.charCodeAt(i))<128?e.setUint8(t++,r):r<2048?(e.setUint8(t++,192|r>>6),e.setUint8(t++,128|63&r)):r<55296||r>=57344?(e.setUint8(t++,224|r>>12),e.setUint8(t++,128|r>>6&63),e.setUint8(t++,128|63&r)):(i++,r=65536+((1023&r)<<10|1023&n.charCodeAt(i)),e.setUint8(t++,240|r>>18),e.setUint8(t++,128|r>>12&63),e.setUint8(t++,128|r>>6&63),e.setUint8(t++,128|63&r))}function _encode(e,t,n){var r=typeof n,i=0,o=0,s=0,a=0,c=0,h=0;if("string"===r){if(c=function utf8Length$1(e){for(var t=0,n=0,r=0,i=e.length;r<i;r++)(t=e.charCodeAt(r))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(n),c<32)e.push(160|c),h=1;else if(c<256)e.push(217,c),h=2;else if(c<65536)e.push(218,c>>8,c),h=3;else{if(!(c<4294967296))throw new Error("String too long");e.push(219,c>>24,c>>16,c>>8,c),h=5}return t.push({_str:n,_length:c,_offset:e.length}),h+c}if("number"===r)return Math.floor(n)===n&&isFinite(n)?n>=0?n<128?(e.push(n),1):n<256?(e.push(204,n),2):n<65536?(e.push(205,n>>8,n),3):n<4294967296?(e.push(206,n>>24,n>>16,n>>8,n),5):(s=n/Math.pow(2,32)>>0,a=n>>>0,e.push(207,s>>24,s>>16,s>>8,s,a>>24,a>>16,a>>8,a),9):n>=-32?(e.push(n),1):n>=-128?(e.push(208,n),2):n>=-32768?(e.push(209,n>>8,n),3):n>=-2147483648?(e.push(210,n>>24,n>>16,n>>8,n),5):(s=Math.floor(n/Math.pow(2,32)),a=n>>>0,e.push(211,s>>24,s>>16,s>>8,s,a>>24,a>>16,a>>8,a),9):(e.push(203),t.push({_float:n,_length:8,_offset:e.length}),9);if("object"===r){if(null===n)return e.push(192),1;if(Array.isArray(n)){if((c=n.length)<16)e.push(144|c),h=1;else if(c<65536)e.push(220,c>>8,c),h=3;else{if(!(c<4294967296))throw new Error("Array too large");e.push(221,c>>24,c>>16,c>>8,c),h=5}for(i=0;i<c;i++)h+=_encode(e,t,n[i]);return h}if(n instanceof Date){var f=n.getTime(),u=Math.floor(f/1e3),l=1e6*(f-1e3*u);return u>=0&&l>=0&&u<=17179869183?0===l&&u<=4294967295?(e.push(214,255,u>>24,u>>16,u>>8,u),6):(s=u/4294967296,a=4294967295&u,e.push(215,255,l>>22,l>>14,l>>6,s,a>>24,a>>16,a>>8,a),10):(s=Math.floor(u/4294967296),a=u>>>0,e.push(199,12,255,l>>24,l>>16,l>>8,l,s>>24,s>>16,s>>8,s,a>>24,a>>16,a>>8,a),15)}if(n instanceof ArrayBuffer){if((c=n.byteLength)<256)e.push(196,c),h=2;else if(c<65536)e.push(197,c>>8,c),h=3;else{if(!(c<4294967296))throw new Error("Buffer too large");e.push(198,c>>24,c>>16,c>>8,c),h=5}return t.push({_bin:n,_length:c,_offset:e.length}),h+c}if("function"==typeof n.toJSON)return _encode(e,t,n.toJSON());var d=[],p="",y=Object.keys(n);for(i=0,o=y.length;i<o;i++)void 0!==n[p=y[i]]&&"function"!=typeof n[p]&&d.push(p);if((c=d.length)<16)e.push(128|c),h=1;else if(c<65536)e.push(222,c>>8,c),h=3;else{if(!(c<4294967296))throw new Error("Object too large");e.push(223,c>>24,c>>16,c>>8,c),h=5}for(i=0;i<c;i++)h+=_encode(e,t,p=d[i]),h+=_encode(e,t,n[p]);return h}if("boolean"===r)return e.push(n?195:194),1;if("undefined"===r)return e.push(192),1;if("function"==typeof n.toJSON)return _encode(e,t,n.toJSON());throw new Error("Could not encode")}function encode(e){var t=[],n=[],r=_encode(t,n,e),i=new ArrayBuffer(r),o=new DataView(i),s=0,a=0,c=-1;n.length>0&&(c=n[0]._offset);for(var h,f=0,u=0,l=0,d=t.length;l<d;l++)if(o.setUint8(a+l,t[l]),l+1===c){if(f=(h=n[s])._length,u=a+c,h._bin)for(var p=new Uint8Array(h._bin),y=0;y<f;y++)o.setUint8(u+y,p[y]);else h._str?utf8Write(o,u,h._str):void 0!==h._float&&o.setFloat64(u,h._float);a+=f,n[++s]&&(c=n[s]._offset)}return i}var r,i,o=globalThis.WebSocket||function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},s=function(){function WebSocketTransport(e){this.events=e}return WebSocketTransport.prototype.send=function(e){e instanceof ArrayBuffer?this.ws.send(e):Array.isArray(e)&&this.ws.send(new Uint8Array(e).buffer)},WebSocketTransport.prototype.connect=function(e){this.ws=new o(e,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},WebSocketTransport.prototype.close=function(e,t){this.ws.close(e,t)},Object.defineProperty(WebSocketTransport.prototype,"isOpen",{get:function(){return this.ws.readyState===o.OPEN},enumerable:!1,configurable:!0}),WebSocketTransport}(),a=function(){function Connection(){this.events={},this.transport=new s(this.events)}return Connection.prototype.send=function(e){this.transport.send(e)},Connection.prototype.connect=function(e){this.transport.connect(e)},Connection.prototype.close=function(e,t){this.transport.close(e,t)},Object.defineProperty(Connection.prototype,"isOpen",{get:function(){return this.transport.isOpen},enumerable:!1,configurable:!0}),Connection}();function utf8Read(e,t){for(var n=e[t++],r="",i=0,o=t,s=t+n;o<s;o++){var a=e[o];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(i=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|(63&e[++o])<<0)>=65536?(i-=65536,r+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):r+=String.fromCharCode(i)}else r+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|(63&e[++o])<<0);else r+=String.fromCharCode((31&a)<<6|63&e[++o]);else r+=String.fromCharCode(a)}return r}function utf8Length(e){void 0===e&&(e="");for(var t=0,n=0,r=0,i=e.length;r<i;r++)(t=e.charCodeAt(r))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n+1}e.Protocol=void 0,(r=e.Protocol||(e.Protocol={}))[r.HANDSHAKE=9]="HANDSHAKE",r[r.JOIN_ROOM=10]="JOIN_ROOM",r[r.ERROR=11]="ERROR",r[r.LEAVE_ROOM=12]="LEAVE_ROOM",r[r.ROOM_DATA=13]="ROOM_DATA",r[r.ROOM_STATE=14]="ROOM_STATE",r[r.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",r[r.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",r[r.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES",e.ErrorCode=void 0,(i=e.ErrorCode||(e.ErrorCode={}))[i.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",i[i.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",i[i.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",i[i.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",i[i.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",i[i.AUTH_FAILED=4215]="AUTH_FAILED",i[i.APPLICATION_ERROR=4216]="APPLICATION_ERROR";var c={};function registerSerializer(e,t){c[e]=t}function getSerializer(e){var t=c[e];if(!t)throw new Error("missing serializer: "+e);return t}var h=function(){function EventEmitter(){this.handlers=[]}return EventEmitter.prototype.register=function(e,t){return this.handlers.push(e),this},EventEmitter.prototype.invoke=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.handlers.forEach((function(n){return n.apply(e,t)}))},EventEmitter.prototype.invokeAsync=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.all(this.handlers.map((function(n){return n.apply(e,t)})))},EventEmitter.prototype.remove=function(e){var t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()},EventEmitter.prototype.clear=function(){this.handlers=[]},EventEmitter}();function createSignal(){var e=new h;function register(t){return e.register(t,null===this)}return register.once=function(t){var callback=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];t.apply(this,n),e.remove(callback)};e.register(callback)},register.remove=function(t){return e.remove(t)},register.invoke=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invoke.apply(e,t)},register.invokeAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invokeAsync.apply(e,t)},register.clear=function(){return e.clear()},register}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var f=function createCommonjsModule(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e,t){!function(e){var extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},extendStatics(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function __(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}function __decorate(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function __spreadArray(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var t,n=255,r=213;e.OPERATION=void 0,(t=e.OPERATION||(e.OPERATION={}))[t.ADD=128]="ADD",t[t.REPLACE=0]="REPLACE",t[t.DELETE=64]="DELETE",t[t.DELETE_AND_ADD=192]="DELETE_AND_ADD",t[t.TOUCH=1]="TOUCH",t[t.CLEAR=10]="CLEAR";var i=function(){function ChangeTree(e,t,n){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(t,n)}return ChangeTree.prototype.setParent=function(e,t,n){var r=this;if(this.indexes||(this.indexes=this.ref instanceof b?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=n,t)if(this.root=t,this.ref instanceof b){var i=this.ref._definition;for(var o in i.schema){var s=this.ref[o];if(s&&s.$changes){var a=i.indexes[o];s.$changes.setParent(this.ref,t,a)}}}else"object"==typeof this.ref&&this.ref.forEach((function(e,t){if(e instanceof b){var n=e.$changes,i=r.ref.$changes.indexes[t];n.setParent(r.ref,r.root,i)}}))},ChangeTree.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},ChangeTree.prototype.change=function(t,n){void 0===n&&(n=e.OPERATION.ADD);var r="number"==typeof t?t:this.indexes[t];this.assertValidIndex(r,t);var i=this.changes.get(r);i&&i.op!==e.OPERATION.DELETE&&i.op!==e.OPERATION.TOUCH||this.changes.set(r,{op:i&&i.op===e.OPERATION.DELETE?e.OPERATION.DELETE_AND_ADD:n,index:r}),this.allChanges.add(r),this.changed=!0,this.touchParents()},ChangeTree.prototype.touch=function(t){var n="number"==typeof t?t:this.indexes[t];this.assertValidIndex(n,t),this.changes.has(n)||this.changes.set(n,{op:e.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},ChangeTree.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},ChangeTree.prototype.getType=function(e){if(this.ref._definition)return(t=this.ref._definition).schema[t.fieldsByIndex[e]];var t,n=(t=this.parent._definition).schema[t.fieldsByIndex[this.parentIndex]];return Object.values(n)[0]},ChangeTree.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},ChangeTree.prototype.getValue=function(e){return this.ref.getByIndex(e)},ChangeTree.prototype.delete=function(t){var n="number"==typeof t?t:this.indexes[t];if(void 0!==n){var r=this.getValue(n);this.changes.set(n,{op:e.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],r&&r.$changes&&(r.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(t," (").concat(n,")"))},ChangeTree.prototype.discard=function(t,n){var r=this;void 0===t&&(t=!1),void 0===n&&(n=!1),this.ref instanceof b||this.changes.forEach((function(t){if(t.op===e.OPERATION.DELETE){var n=r.ref.getIndex(t.index);delete r.indexes[n]}})),this.changes.clear(),this.changed=t,n&&this.allChanges.clear(),this.currentCustomOperation=0},ChangeTree.prototype.discardAll=function(){var e=this;this.changes.forEach((function(t){var n=e.getValue(t.index);n&&n.$changes&&n.$changes.discardAll()})),this.discard()},ChangeTree.prototype.cache=function(e,t){this.caches[e]=t},ChangeTree.prototype.clone=function(){return new ChangeTree(this.ref,this.parent,this.root)},ChangeTree.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},ChangeTree.prototype.assertValidIndex=function(e,t){if(void 0===e)throw new Error('ChangeTree: missing index for field "'.concat(t,'"'))},ChangeTree}();function addCallback(e,t,n,r){return e[t]||(e[t]=[]),e[t].push(n),null==r||r.forEach((function(e,t){return n(e,t)})),function(){return spliceOne(e[t],e[t].indexOf(n))}}function removeChildRefs(t){var n=this,r="string"!=typeof this.$changes.getType();this.$items.forEach((function(i,o){t.push({refId:n.$changes.refId,op:e.OPERATION.DELETE,field:o,value:void 0,previousValue:i}),r&&n.$changes.root.removeRef(i.$changes.refId)}))}function spliceOne(e,t){if(-1===t||t>=e.length)return!1;for(var n=e.length-1,r=t;r<n;r++)e[r]=e[r+1];return e.length=n,!0}var DEFAULT_SORT=function(e,t){var n=e.toString(),r=t.toString();return n<r?-1:n>r?1:0};function getArrayProxy(e){return e.$proxy=!0,e=new Proxy(e,{get:function(e,t){return"symbol"==typeof t||isNaN(t)?e[t]:e.at(t)},set:function(e,t,n){if("symbol"==typeof t||isNaN(t))e[t]=n;else{var r=Array.from(e.$items.keys()),i=parseInt(r[t]||t);null==n?e.deleteAt(i):e.setAt(i,n)}return!0},deleteProperty:function(e,t){return"number"==typeof t?e.deleteAt(t):delete e[t],!0}})}var o=function(){function ArraySchema(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.$changes=new i(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return ArraySchema.prototype.onAdd=function(t,n){return void 0===n&&(n=!0),addCallback(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,t,n?this.$items:void 0)},ArraySchema.prototype.onRemove=function(t){return addCallback(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,t)},ArraySchema.prototype.onChange=function(t){return addCallback(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,t)},ArraySchema.is=function(e){return Array.isArray(e)||void 0!==e.array},Object.defineProperty(ArraySchema.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),ArraySchema.prototype.push=function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){e=t.$refId++,t.setAt(e,n)})),e},ArraySchema.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(void 0!==e){this.$changes.delete(e),this.$indexes.delete(e);var t=this.$items.get(e);return this.$items.delete(e),t}},ArraySchema.prototype.at=function(e){var t=Array.from(this.$items.keys())[e];return this.$items.get(t)},ArraySchema.prototype.setAt=function(t,n){var r,i;void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,t);var o=null!==(i=null===(r=this.$changes.indexes[t])||void 0===r?void 0:r.op)&&void 0!==i?i:e.OPERATION.ADD;this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,n),this.$changes.change(t,o)},ArraySchema.prototype.deleteAt=function(e){var t=Array.from(this.$items.keys())[e];return void 0!==t&&this.$deleteAt(t)},ArraySchema.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},ArraySchema.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&removeChildRefs.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},ArraySchema.prototype.concat=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new(ArraySchema.bind.apply(ArraySchema,__spreadArray([void 0],(e=Array.from(this.$items.values())).concat.apply(e,t),!1)))},ArraySchema.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},ArraySchema.prototype.reverse=function(){var e=this,t=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(n,r){e.setAt(t[r],n)})),this},ArraySchema.prototype.shift=function(){var e=Array.from(this.$items.keys()).shift();if(void 0!==e){var t=this.$items.get(e);return this.$deleteAt(e),t}},ArraySchema.prototype.slice=function(e,t){var n=new ArraySchema;return n.push.apply(n,Array.from(this.$items.values()).slice(e,t)),n},ArraySchema.prototype.sort=function(e){var t=this;void 0===e&&(e=DEFAULT_SORT);var n=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(e).forEach((function(e,r){t.setAt(n[r],e)})),this},ArraySchema.prototype.splice=function(e,t){void 0===t&&(t=this.length-e);for(var n=Array.from(this.$items.keys()),r=[],i=e;i<e+t;i++)r.push(this.$items.get(n[i])),this.$deleteAt(n[i]);return r},ArraySchema.prototype.unshift=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=this.length,i=t.length,o=Array.from(this.$items.values());return t.forEach((function(t,n){e.setAt(n,t)})),o.forEach((function(t,n){e.setAt(i+n,t)})),r+i},ArraySchema.prototype.indexOf=function(e,t){return Array.from(this.$items.values()).indexOf(e,t)},ArraySchema.prototype.lastIndexOf=function(e,t){return void 0===t&&(t=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,t)},ArraySchema.prototype.every=function(e,t){return Array.from(this.$items.values()).every(e,t)},ArraySchema.prototype.some=function(e,t){return Array.from(this.$items.values()).some(e,t)},ArraySchema.prototype.forEach=function(e,t){Array.from(this.$items.values()).forEach(e,t)},ArraySchema.prototype.map=function(e,t){return Array.from(this.$items.values()).map(e,t)},ArraySchema.prototype.filter=function(e,t){return Array.from(this.$items.values()).filter(e,t)},ArraySchema.prototype.reduce=function(e,t){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},ArraySchema.prototype.reduceRight=function(e,t){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},ArraySchema.prototype.find=function(e,t){return Array.from(this.$items.values()).find(e,t)},ArraySchema.prototype.findIndex=function(e,t){return Array.from(this.$items.values()).findIndex(e,t)},ArraySchema.prototype.fill=function(e,t,n){throw new Error("ArraySchema#fill() not implemented")},ArraySchema.prototype.copyWithin=function(e,t,n){throw new Error("ArraySchema#copyWithin() not implemented")},ArraySchema.prototype.toString=function(){return this.$items.toString()},ArraySchema.prototype.toLocaleString=function(){return this.$items.toLocaleString()},ArraySchema.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},ArraySchema.prototype.entries=function(){return this.$items.entries()},ArraySchema.prototype.keys=function(){return this.$items.keys()},ArraySchema.prototype.values=function(){return this.$items.values()},ArraySchema.prototype.includes=function(e,t){return Array.from(this.$items.values()).includes(e,t)},ArraySchema.prototype.flatMap=function(e,t){throw new Error("ArraySchema#flatMap() is not supported.")},ArraySchema.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")},ArraySchema.prototype.findLast=function(){var e=Array.from(this.$items.values());return e.findLast.apply(e,arguments)},ArraySchema.prototype.findLastIndex=function(){var e=Array.from(this.$items.values());return e.findLastIndex.apply(e,arguments)},ArraySchema.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},ArraySchema.prototype.getIndex=function(e){return this.$indexes.get(e)},ArraySchema.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},ArraySchema.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},ArraySchema.prototype.toArray=function(){return Array.from(this.$items.values())},ArraySchema.prototype.toJSON=function(){return this.toArray().map((function(e){return"function"==typeof e.toJSON?e.toJSON():e}))},ArraySchema.prototype.clone=function(e){return e?new(ArraySchema.bind.apply(ArraySchema,__spreadArray([void 0],Array.from(this.$items.values()),!1))):new(ArraySchema.bind.apply(ArraySchema,__spreadArray([void 0],this.map((function(e){return e.$changes?e.clone():e})),!1)))},ArraySchema}();function getMapProxy(e){return e.$proxy=!0,e=new Proxy(e,{get:function(e,t){return"symbol"!=typeof t&&void 0===e[t]?e.get(t):e[t]},set:function(e,t,n){return"symbol"!=typeof t&&-1===t.indexOf("$")&&"onAdd"!==t&&"onRemove"!==t&&"onChange"!==t?e.set(t,n):e[t]=n,!0},deleteProperty:function(e,t){return e.delete(t),!0}})}var s=function(){function MapSchema(e){var t=this;if(this.$changes=new i(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map||e instanceof MapSchema)e.forEach((function(e,n){return t.set(n,e)}));else for(var n in e)this.set(n,e[n])}return MapSchema.prototype.onAdd=function(t,n){return void 0===n&&(n=!0),addCallback(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,t,n?this.$items:void 0)},MapSchema.prototype.onRemove=function(t){return addCallback(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,t)},MapSchema.prototype.onChange=function(t){return addCallback(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,t)},MapSchema.is=function(e){return void 0!==e.map},MapSchema.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(MapSchema.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),MapSchema.prototype.set=function(t,n){if(null==n)throw new Error("MapSchema#set('".concat(t,"', ").concat(n,"): trying to set ").concat(n," value on '").concat(t,"'."));var r=void 0!==this.$changes.indexes[t],i=r?this.$changes.indexes[t]:this.$refId++,o=r?e.OPERATION.REPLACE:e.OPERATION.ADD,s=void 0!==n.$changes;return s&&n.$changes.setParent(this,this.$changes.root,i),r?s&&this.$items.get(t)!==n&&(o=e.OPERATION.ADD):(this.$changes.indexes[t]=i,this.$indexes.set(i,t)),this.$items.set(t,n),this.$changes.change(t,o),this},MapSchema.prototype.get=function(e){return this.$items.get(e)},MapSchema.prototype.delete=function(e){return this.$changes.delete(e),this.$items.delete(e)},MapSchema.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&removeChildRefs.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},MapSchema.prototype.has=function(e){return this.$items.has(e)},MapSchema.prototype.forEach=function(e){this.$items.forEach(e)},MapSchema.prototype.entries=function(){return this.$items.entries()},MapSchema.prototype.keys=function(){return this.$items.keys()},MapSchema.prototype.values=function(){return this.$items.values()},Object.defineProperty(MapSchema.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),MapSchema.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},MapSchema.prototype.getIndex=function(e){return this.$indexes.get(e)},MapSchema.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},MapSchema.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},MapSchema.prototype.toJSON=function(){var e={};return this.forEach((function(t,n){e[n]="function"==typeof t.toJSON?t.toJSON():t})),e},MapSchema.prototype.clone=function(e){var t;return e?t=Object.assign(new MapSchema,this):(t=new MapSchema,this.forEach((function(e,n){e.$changes?t.set(n,e.clone()):t.set(n,e)}))),t},MapSchema}(),a={};function registerType(e,t){a[e]=t}function getType(e){return a[e]}var c=function(){function SchemaDefinition(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return SchemaDefinition.create=function(e){var t=new SchemaDefinition;return t.schema=Object.assign({},e&&e.schema||{}),t.indexes=Object.assign({},e&&e.indexes||{}),t.fieldsByIndex=Object.assign({},e&&e.fieldsByIndex||{}),t.descriptors=Object.assign({},e&&e.descriptors||{}),t.deprecated=Object.assign({},e&&e.deprecated||{}),t},SchemaDefinition.prototype.addField=function(e,t){var n=this.getNextFieldIndex();this.fieldsByIndex[n]=e,this.indexes[e]=n,this.schema[e]=Array.isArray(t)?{array:t[0]}:t},SchemaDefinition.prototype.hasField=function(e){return void 0!==this.indexes[e]},SchemaDefinition.prototype.addFilter=function(e,t){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=t,this.indexesWithFilters.push(this.indexes[e]),!0},SchemaDefinition.prototype.addChildrenFilter=function(e,t){var n=this.indexes[e],r=this.schema[e];if(getType(Object.keys(r)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[n]=t,!0;console.warn("@filterChildren: field '".concat(e,"' can't have children. Ignoring filter."))},SchemaDefinition.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},SchemaDefinition.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},SchemaDefinition}();function hasFilter(e){return e._context&&e._context.useFilters}var h=function(){function Context(){this.types={},this.schemas=new Map,this.useFilters=!1}return Context.prototype.has=function(e){return this.schemas.has(e)},Context.prototype.get=function(e){return this.types[e]},Context.prototype.add=function(e,t){void 0===t&&(t=this.schemas.size),e._definition=c.create(e._definition),e._typeid=t,this.types[t]=e,this.schemas.set(e,t)},Context.create=function(e){return void 0===e&&(e={}),function(t){return e.context||(e.context=new Context),type(t,e)}},Context}(),f=new h;function type(e,t){return void 0===t&&(t={}),function(n,r){var i=t.context||f,a=n.constructor;if(a._context=i,!e)throw new Error("".concat(a.name,': @type() reference provided for "').concat(r,"\" is undefined. Make sure you don't have any circular dependencies."));i.has(a)||i.add(a);var c=a._definition;if(c.addField(r,e),c.descriptors[r]){if(c.deprecated[r])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(r,"' definition on '").concat(a.name,"'.\nCheck @type() annotation"))}catch(e){var h=e.stack.split("\n")[4].trim();throw new Error("".concat(e.message," ").concat(h))}}var u=o.is(e),l=!u&&s.is(e);if("string"!=typeof e&&!b.is(e)){var d=Object.values(e)[0];"string"==typeof d||i.has(d)||i.add(d)}if(t.manual)c.descriptors[r]={enumerable:!0,configurable:!0,writable:!0};else{var p="_".concat(r);c.descriptors[p]={enumerable:!1,configurable:!1,writable:!0},c.descriptors[r]={get:function(){return this[p]},set:function(e){e!==this[p]&&(null!=e?(!u||e instanceof o||(e=new(o.bind.apply(o,__spreadArray([void 0],e,!1)))),!l||e instanceof s||(e=new s(e)),void 0===e.$proxy&&(l?e=getMapProxy(e):u&&(e=getArrayProxy(e))),this.$changes.change(r),e.$changes&&e.$changes.setParent(this,this.$changes.root,this._definition.indexes[r])):this[p]&&this.$changes.delete(r),this[p]=e)},enumerable:!0,configurable:!0}}}}function filter(e){return function(t,n){var r=t.constructor;r._definition.addFilter(n,e)&&(r._context.useFilters=!0)}}function filterChildren(e){return function(t,n){var r=t.constructor;r._definition.addChildrenFilter(n,e)&&(r._context.useFilters=!0)}}function deprecated(e){return void 0===e&&(e=!0),function(t,n){var r=t.constructor._definition;r.deprecated[n]=!0,e&&(r.descriptors[n]={get:function(){throw new Error("".concat(n," is deprecated."))},set:function(e){},enumerable:!1,configurable:!0})}}function defineTypes(e,t,n){for(var r in void 0===n&&(n={}),n.context||(n.context=e._context||n.context||f),t)type(t[r],n)(e.prototype,r);return e}function utf8Length(e){for(var t=0,n=0,r=0,i=e.length;r<i;r++)(t=e.charCodeAt(r))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}function utf8Write(e,t,n){for(var r=0,i=0,o=n.length;i<o;i++)(r=n.charCodeAt(i))<128?e[t++]=r:r<2048?(e[t++]=192|r>>6,e[t++]=128|63&r):r<55296||r>=57344?(e[t++]=224|r>>12,e[t++]=128|r>>6&63,e[t++]=128|63&r):(i++,r=65536+((1023&r)<<10|1023&n.charCodeAt(i)),e[t++]=240|r>>18,e[t++]=128|r>>12&63,e[t++]=128|r>>6&63,e[t++]=128|63&r)}function int8$1(e,t){e.push(255&t)}function uint8$1(e,t){e.push(255&t)}function int16$1(e,t){e.push(255&t),e.push(t>>8&255)}function uint16$1(e,t){e.push(255&t),e.push(t>>8&255)}function int32$1(e,t){e.push(255&t),e.push(t>>8&255),e.push(t>>16&255),e.push(t>>24&255)}function uint32$1(e,t){var n=t>>24,r=t>>16,i=t>>8,o=t;e.push(255&o),e.push(255&i),e.push(255&r),e.push(255&n)}function int64$1(e,t){var n=Math.floor(t/Math.pow(2,32));uint32$1(e,t>>>0),uint32$1(e,n)}function uint64$1(e,t){var n=t/Math.pow(2,32)>>0;uint32$1(e,t>>>0),uint32$1(e,n)}function float32$1(e,t){writeFloat32(e,t)}function float64$1(e,t){writeFloat64(e,t)}var u=new Int32Array(2),l=new Float32Array(u.buffer),d=new Float64Array(u.buffer);function writeFloat32(e,t){l[0]=t,int32$1(e,u[0])}function writeFloat64(e,t){d[0]=t,int32$1(e,u[0]),int32$1(e,u[1])}function boolean$1(e,t){return uint8$1(e,t?1:0)}function string$1(e,t){t||(t="");var n=utf8Length(t),r=0;if(n<32)e.push(160|n),r=1;else if(n<256)e.push(217),uint8$1(e,n),r=2;else if(n<65536)e.push(218),uint16$1(e,n),r=3;else{if(!(n<4294967296))throw new Error("String too long");e.push(219),uint32$1(e,n),r=5}return utf8Write(e,e.length,t),r+n}function number$1(e,t){return isNaN(t)?number$1(e,0):isFinite(t)?t!==(0|t)?(e.push(203),writeFloat64(e,t),9):t>=0?t<128?(uint8$1(e,t),1):t<256?(e.push(204),uint8$1(e,t),2):t<65536?(e.push(205),uint16$1(e,t),3):t<4294967296?(e.push(206),uint32$1(e,t),5):(e.push(207),uint64$1(e,t),9):t>=-32?(e.push(224|t+32),1):t>=-128?(e.push(208),int8$1(e,t),2):t>=-32768?(e.push(209),int16$1(e,t),3):t>=-2147483648?(e.push(210),int32$1(e,t),5):(e.push(211),int64$1(e,t),9):number$1(e,t>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var p=Object.freeze({__proto__:null,utf8Write:utf8Write,int8:int8$1,uint8:uint8$1,int16:int16$1,uint16:uint16$1,int32:int32$1,uint32:uint32$1,int64:int64$1,uint64:uint64$1,float32:float32$1,float64:float64$1,writeFloat32:writeFloat32,writeFloat64:writeFloat64,boolean:boolean$1,string:string$1,number:number$1});function utf8Read(e,t,n){for(var r="",i=0,o=t,s=t+n;o<s;o++){var a=e[o];0!=(128&a)?192!=(224&a)?224!=(240&a)?240!=(248&a)?console.error("Invalid byte "+a.toString(16)):(i=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|(63&e[++o])<<0)>=65536?(i-=65536,r+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):r+=String.fromCharCode(i):r+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|(63&e[++o])<<0):r+=String.fromCharCode((31&a)<<6|63&e[++o]):r+=String.fromCharCode(a)}return r}function int8(e,t){return uint8(e,t)<<24>>24}function uint8(e,t){return e[t.offset++]}function int16(e,t){return uint16(e,t)<<16>>16}function uint16(e,t){return e[t.offset++]|e[t.offset++]<<8}function int32(e,t){return e[t.offset++]|e[t.offset++]<<8|e[t.offset++]<<16|e[t.offset++]<<24}function uint32(e,t){return int32(e,t)>>>0}function float32(e,t){return readFloat32(e,t)}function float64(e,t){return readFloat64(e,t)}function int64(e,t){var n=uint32(e,t);return int32(e,t)*Math.pow(2,32)+n}function uint64(e,t){var n=uint32(e,t);return uint32(e,t)*Math.pow(2,32)+n}var y=new Int32Array(2),v=new Float32Array(y.buffer),g=new Float64Array(y.buffer);function readFloat32(e,t){return y[0]=int32(e,t),v[0]}function readFloat64(e,t){return y[0]=int32(e,t),y[1]=int32(e,t),g[0]}function boolean(e,t){return uint8(e,t)>0}function string(e,t){var n,r=e[t.offset++];r<192?n=31&r:217===r?n=uint8(e,t):218===r?n=uint16(e,t):219===r&&(n=uint32(e,t));var i=utf8Read(e,t.offset,n);return t.offset+=n,i}function stringCheck(e,t){var n=e[t.offset];return n<192&&n>160||217===n||218===n||219===n}function number(e,t){var n=e[t.offset++];return n<128?n:202===n?readFloat32(e,t):203===n?readFloat64(e,t):204===n?uint8(e,t):205===n?uint16(e,t):206===n?uint32(e,t):207===n?uint64(e,t):208===n?int8(e,t):209===n?int16(e,t):210===n?int32(e,t):211===n?int64(e,t):n>223?-1*(255-n+1):void 0}function numberCheck(e,t){var n=e[t.offset];return n<128||n>=202&&n<=211}function arrayCheck(e,t){return e[t.offset]<160}function switchStructureCheck(e,t){return e[t.offset-1]===n&&(e[t.offset]<128||e[t.offset]>=202&&e[t.offset]<=211)}var m=Object.freeze({__proto__:null,int8:int8,uint8:uint8,int16:int16,uint16:uint16,int32:int32,uint32:uint32,float32:float32,float64:float64,int64:int64,uint64:uint64,readFloat32:readFloat32,readFloat64:readFloat64,boolean:boolean,string:string,stringCheck:stringCheck,number:number,numberCheck:numberCheck,arrayCheck:arrayCheck,switchStructureCheck:switchStructureCheck}),A=function(){function CollectionSchema(e){var t=this;this.$changes=new i(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach((function(e){return t.add(e)}))}return CollectionSchema.prototype.onAdd=function(t,n){return void 0===n&&(n=!0),addCallback(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,t,n?this.$items:void 0)},CollectionSchema.prototype.onRemove=function(t){return addCallback(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,t)},CollectionSchema.prototype.onChange=function(t){return addCallback(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,t)},CollectionSchema.is=function(e){return void 0!==e.collection},CollectionSchema.prototype.add=function(e){var t=this.$refId++;return void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,t),this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,e),this.$changes.change(t),t},CollectionSchema.prototype.at=function(e){var t=Array.from(this.$items.keys())[e];return this.$items.get(t)},CollectionSchema.prototype.entries=function(){return this.$items.entries()},CollectionSchema.prototype.delete=function(e){for(var t,n,r=this.$items.entries();(n=r.next())&&!n.done;)if(e===n.value[1]){t=n.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},CollectionSchema.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&removeChildRefs.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},CollectionSchema.prototype.has=function(e){return Array.from(this.$items.values()).some((function(t){return t===e}))},CollectionSchema.prototype.forEach=function(e){var t=this;this.$items.forEach((function(n,r,i){return e(n,r,t)}))},CollectionSchema.prototype.values=function(){return this.$items.values()},Object.defineProperty(CollectionSchema.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),CollectionSchema.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},CollectionSchema.prototype.getIndex=function(e){return this.$indexes.get(e)},CollectionSchema.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},CollectionSchema.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},CollectionSchema.prototype.toArray=function(){return Array.from(this.$items.values())},CollectionSchema.prototype.toJSON=function(){var e=[];return this.forEach((function(t,n){e.push("function"==typeof t.toJSON?t.toJSON():t)})),e},CollectionSchema.prototype.clone=function(e){var t;return e?t=Object.assign(new CollectionSchema,this):(t=new CollectionSchema,this.forEach((function(e){e.$changes?t.add(e.clone()):t.add(e)}))),t},CollectionSchema}(),w=function(){function SetSchema(e){var t=this;this.$changes=new i(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach((function(e){return t.add(e)}))}return SetSchema.prototype.onAdd=function(t,n){return void 0===n&&(n=!0),addCallback(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,t,n?this.$items:void 0)},SetSchema.prototype.onRemove=function(t){return addCallback(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,t)},SetSchema.prototype.onChange=function(t){return addCallback(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,t)},SetSchema.is=function(e){return void 0!==e.set},SetSchema.prototype.add=function(t){var n,r;if(this.has(t))return!1;var i=this.$refId++;void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,i);var o=null!==(r=null===(n=this.$changes.indexes[i])||void 0===n?void 0:n.op)&&void 0!==r?r:e.OPERATION.ADD;return this.$changes.indexes[i]=i,this.$indexes.set(i,i),this.$items.set(i,t),this.$changes.change(i,o),i},SetSchema.prototype.entries=function(){return this.$items.entries()},SetSchema.prototype.delete=function(e){for(var t,n,r=this.$items.entries();(n=r.next())&&!n.done;)if(e===n.value[1]){t=n.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},SetSchema.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&removeChildRefs.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},SetSchema.prototype.has=function(e){for(var t,n=this.$items.values(),r=!1;(t=n.next())&&!t.done;)if(e===t.value){r=!0;break}return r},SetSchema.prototype.forEach=function(e){var t=this;this.$items.forEach((function(n,r,i){return e(n,r,t)}))},SetSchema.prototype.values=function(){return this.$items.values()},Object.defineProperty(SetSchema.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),SetSchema.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},SetSchema.prototype.getIndex=function(e){return this.$indexes.get(e)},SetSchema.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},SetSchema.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},SetSchema.prototype.toArray=function(){return Array.from(this.$items.values())},SetSchema.prototype.toJSON=function(){var e=[];return this.forEach((function(t,n){e.push("function"==typeof t.toJSON?t.toJSON():t)})),e},SetSchema.prototype.clone=function(e){var t;return e?t=Object.assign(new SetSchema,this):(t=new SetSchema,this.forEach((function(e){e.$changes?t.add(e.clone()):t.add(e)}))),t},SetSchema}(),E=function(){function ClientState(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return ClientState.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},ClientState.get=function(e){return void 0===e.$filterState&&(e.$filterState=new ClientState),e.$filterState},ClientState}(),S=function(){function ReferenceTracker(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return ReferenceTracker.prototype.getNextUniqueId=function(){return this.nextUniqueId++},ReferenceTracker.prototype.addRef=function(e,t,n){void 0===n&&(n=!0),this.refs.set(e,t),n&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},ReferenceTracker.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1,this.deletedRefs.add(e)},ReferenceTracker.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},ReferenceTracker.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach((function(t){if(!(e.refCounts[t]>0)){var n=e.refs.get(t);if(n instanceof b)for(var r in n._definition.schema)"string"!=typeof n._definition.schema[r]&&n[r]&&n[r].$changes&&e.removeRef(n[r].$changes.refId);else{var i=n.$changes.parent._definition,o=i.schema[i.fieldsByIndex[n.$changes.parentIndex]];"function"==typeof Object.values(o)[0]&&Array.from(n.values()).forEach((function(t){return e.removeRef(t.$changes.refId)}))}e.refs.delete(t),delete e.refCounts[t]}})),this.deletedRefs.clear()},ReferenceTracker}(),$=function(e){function EncodeSchemaError(){return null!==e&&e.apply(this,arguments)||this}return __extends(EncodeSchemaError,e),EncodeSchemaError}(Error);function assertType(e,t,n,r){var i,o=!1;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":i="number",isNaN(e)&&console.log('trying to encode "NaN" in '.concat(n.constructor.name,"#").concat(r));break;case"string":i="string",o=!0;break;case"boolean":return}if(typeof e!==i&&(!o||o&&null!==e)){var s="'".concat(JSON.stringify(e),"'").concat(e&&e.constructor&&" (".concat(e.constructor.name,")")||"");throw new $("a '".concat(i,"' was expected, but ").concat(s," was provided in ").concat(n.constructor.name,"#").concat(r))}}function assertInstanceType(e,t,n,r){if(!(e instanceof t))throw new $("a '".concat(t.name,"' was expected, but '").concat(e.constructor.name,"' was provided in ").concat(n.constructor.name,"#").concat(r))}function encodePrimitiveType(e,t,n,r,i){assertType(n,e,r,i);var o=p[e];if(!o)throw new $("a '".concat(e,"' was expected, but ").concat(n," was provided in ").concat(r.constructor.name,"#").concat(i));o(t,n)}function decodePrimitiveType(e,t,n){return m[e](t,n)}var b=function(){function Schema(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Object.defineProperties(this,{$changes:{value:new i(this,void 0,new S),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var n=this._definition.descriptors;n&&Object.defineProperties(this,n),e[0]&&this.assign(e[0])}return Schema.onError=function(e){console.error(e)},Schema.is=function(e){return e._definition&&void 0!==e._definition.schema},Schema.prototype.onChange=function(t){return addCallback(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,t)},Schema.prototype.onRemove=function(t){return addCallback(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,t)},Schema.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(Schema.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),Schema.prototype.setDirty=function(e,t){this.$changes.change(e,t)},Schema.prototype.listen=function(e,t,n){var r=this;return void 0===n&&(n=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[e]||(this.$callbacks[e]=[]),this.$callbacks[e].push(t),n&&void 0!==this[e]&&t(this[e],void 0),function(){return spliceOne(r.$callbacks[e],r.$callbacks[e].indexOf(t))}},Schema.prototype.decode=function(t,r,i){var a;void 0===r&&(r={offset:0}),void 0===i&&(i=this);var c=[],h=this.$changes.root,f=t.length,u=0;for(h.refs.set(u,this);r.offset<f;){var l=t[r.offset++];if(l!=n){var d=i.$changes,p=void 0!==i._definition,y=p?l>>6<<6:l;if(y!==e.OPERATION.CLEAR){var v=p?l%(y||255):number(t,r),g=p?i._definition.fieldsByIndex[v]:"",m=d.getType(v),E=void 0,S=void 0,$=void 0;if(p?S=i["_".concat(g)]:(S=i.getByIndex(v),(y&e.OPERATION.ADD)===e.OPERATION.ADD?($=i instanceof s?string(t,r):v,i.setIndex(v,$)):$=i.getIndex(v)),(y&e.OPERATION.DELETE)===e.OPERATION.DELETE&&(y!==e.OPERATION.DELETE_AND_ADD&&i.deleteByIndex(v),S&&S.$changes&&h.removeRef(S.$changes.refId),E=null),void 0!==g){if(y===e.OPERATION.DELETE);else if(Schema.is(m)){var b=number(t,r);if(E=h.refs.get(b),y!==e.OPERATION.REPLACE){var O=this.getSchemaType(t,r,m);E||((E=this.createTypeInstance(O)).$changes.refId=b,S&&(E.$callbacks=S.$callbacks,S.$changes.refId&&b!==S.$changes.refId&&h.removeRef(S.$changes.refId))),h.addRef(b,E,E!==S)}}else if("string"==typeof m)E=decodePrimitiveType(m,t,r);else{var T=getType(Object.keys(m)[0]),C=number(t,r),I=h.refs.has(C)?S||h.refs.get(C):new T.constructor;if((E=I.clone(!0)).$changes.refId=C,S&&(E.$callbacks=S.$callbacks,S.$changes.refId&&C!==S.$changes.refId)){h.removeRef(S.$changes.refId);for(var R=S.entries(),x=void 0;(x=R.next())&&!x.done;){var P=(a=x.value)[0],k=a[1];c.push({refId:C,op:e.OPERATION.DELETE,field:P,value:void 0,previousValue:k})}}h.addRef(C,E,I!==S)}if(null!=E)if(E.$changes&&E.$changes.setParent(d.ref,d.root,v),i instanceof Schema)i[g]=E;else if(i instanceof s)P=$,i.$items.set(P,E),i.$changes.allChanges.add(v);else if(i instanceof o)i.setAt(v,E);else if(i instanceof A){var D=i.add(E);i.setIndex(v,D)}else i instanceof w&&!1!==(D=i.add(E))&&i.setIndex(v,D);S!==E&&c.push({refId:u,op:y,field:g,dynamicIndex:$,value:E,previousValue:S})}else{console.warn("@colyseus/schema: definition mismatch");for(var M={offset:r.offset};r.offset<f&&(!switchStructureCheck(t,r)||(M.offset=r.offset+1,!h.refs.has(number(t,M))));)r.offset++}}else i.clear(c)}else{u=number(t,r);var N=h.refs.get(u);if(!N)throw new Error('"refId" not found: '.concat(u));i=N}}return this._triggerChanges(c),h.garbageCollectDeletedRefs(),c},Schema.prototype.encode=function(t,r,i){void 0===t&&(t=!1),void 0===r&&(r=[]),void 0===i&&(i=!1);for(var o=this.$changes,a=new WeakSet,c=[o],h=1,f=0;f<h;f++){var u=c[f],l=u.ref,d=l instanceof Schema;u.ensureRefId(),a.add(u),u!==o&&(u.changed||t)&&(uint8$1(r,n),number$1(r,u.refId));for(var p=t?Array.from(u.allChanges):Array.from(u.changes.values()),y=0,v=p.length;y<v;y++){var g=t?{op:e.OPERATION.ADD,index:p[y]}:p[y],m=g.index,A=d?l._definition.fieldsByIndex&&l._definition.fieldsByIndex[m]:m,w=r.length;if(g.op!==e.OPERATION.TOUCH)if(d)uint8$1(r,m|g.op);else{if(uint8$1(r,g.op),g.op===e.OPERATION.CLEAR)continue;number$1(r,m)}if(d||(g.op&e.OPERATION.ADD)!=e.OPERATION.ADD||l instanceof s&&string$1(r,u.ref.$indexes.get(m)),g.op!==e.OPERATION.DELETE){var E=u.getType(m),S=u.getValue(m);if(S&&S.$changes&&!a.has(S.$changes)&&(c.push(S.$changes),S.$changes.ensureRefId(),h++),g.op!==e.OPERATION.TOUCH){if(Schema.is(E))assertInstanceType(S,E,l,A),number$1(r,S.$changes.refId),(g.op&e.OPERATION.ADD)===e.OPERATION.ADD&&this.tryEncodeTypeId(r,E,S.constructor);else if("string"==typeof E)encodePrimitiveType(E,r,S,l,A);else{var $=getType(Object.keys(E)[0]);assertInstanceType(l["_".concat(A)],$.constructor,l,A),number$1(r,S.$changes.refId)}i&&u.cache(m,r.slice(w))}}}t||i||u.discard()}return r},Schema.prototype.encodeAll=function(e){return this.encode(!0,[],e)},Schema.prototype.applyFilters=function(t,r){var i,o;void 0===r&&(r=!1);for(var a=this,c=new Set,h=E.get(t),f=[this.$changes],u=1,l=[],_loop_1=function(d){var y=f[d];if(c.has(y.refId))return"continue";var v=y.ref,g=v instanceof Schema;uint8$1(l,n),number$1(l,y.refId);var m=h.refIds.has(y),A=r||!m;h.addRefId(y);var w=h.containerIndexes.get(y),E=A?Array.from(y.allChanges):Array.from(y.changes.values());!r&&g&&v._definition.indexesWithFilters&&v._definition.indexesWithFilters.forEach((function(t){!w.has(t)&&y.allChanges.has(t)&&(A?E.push(t):E.push({op:e.OPERATION.ADD,index:t}))}));for(var S=0,$=E.length;S<$;S++){var b=A?{op:e.OPERATION.ADD,index:E[S]}:E[S];if(b.op!==e.OPERATION.CLEAR){var O=b.index;if(b.op!==e.OPERATION.DELETE){var T=y.getValue(O),C=y.getType(O);if(g){if((I=v._definition.filters&&v._definition.filters[O])&&!I.call(v,t,T,a)){T&&T.$changes&&c.add(T.$changes.refId);continue}}else{var I,R=y.parent;if((I=y.getChildrenFilter())&&!I.call(R,t,v.$indexes.get(O),T,a)){T&&T.$changes&&c.add(T.$changes.refId);continue}}if(T.$changes&&(f.push(T.$changes),u++),b.op!==e.OPERATION.TOUCH)if(b.op===e.OPERATION.ADD||g)l.push.apply(l,null!==(i=y.caches[O])&&void 0!==i?i:[]),w.add(O);else if(w.has(O))l.push.apply(l,null!==(o=y.caches[O])&&void 0!==o?o:[]);else{if(w.add(O),uint8$1(l,e.OPERATION.ADD),number$1(l,O),v instanceof s){var x=y.ref.$indexes.get(O);string$1(l,x)}T.$changes?number$1(l,T.$changes.refId):p[C](l,T)}else T.$changes&&!g&&(uint8$1(l,e.OPERATION.ADD),number$1(l,O),v instanceof s&&(x=y.ref.$indexes.get(O),string$1(l,x)),number$1(l,T.$changes.refId))}else g?uint8$1(l,b.op|O):(uint8$1(l,b.op),number$1(l,O))}else uint8$1(l,b.op)}},d=0;d<u;d++)_loop_1(d);return l},Schema.prototype.clone=function(){var e,t=new this.constructor,n=this._definition.schema;for(var r in n)"object"==typeof this[r]&&"function"==typeof(null===(e=this[r])||void 0===e?void 0:e.clone)?t[r]=this[r].clone():t[r]=this[r];return t},Schema.prototype.toJSON=function(){var e=this._definition.schema,t=this._definition.deprecated,n={};for(var r in e)t[r]||null===this[r]||void 0===this[r]||(n[r]="function"==typeof this[r].toJSON?this[r].toJSON():this["_".concat(r)]);return n},Schema.prototype.discardAllChanges=function(){this.$changes.discardAll()},Schema.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},Schema.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},Schema.prototype.tryEncodeTypeId=function(e,t,n){t._typeid!==n._typeid&&(uint8$1(e,r),number$1(e,n._typeid))},Schema.prototype.getSchemaType=function(e,t,n){var i;return e[t.offset]===r&&(t.offset++,i=this.constructor._context.get(number(e,t))),i||n},Schema.prototype.createTypeInstance=function(e){var t=new e;return t.$changes.root=this.$changes.root,t},Schema.prototype._triggerChanges=function(t){for(var n,r,i,o,s,a,c,h,f,u=new Set,l=this.$changes.root.refs,_loop_2=function(d){var p=t[d],y=p.refId,v=l.get(y),g=v.$callbacks;if((p.op&e.OPERATION.DELETE)===e.OPERATION.DELETE&&p.previousValue instanceof Schema&&(null===(r=null===(n=p.previousValue.$callbacks)||void 0===n?void 0:n[e.OPERATION.DELETE])||void 0===r||r.forEach((function(e){return e()}))),!g)return"continue";if(v instanceof Schema){if(!u.has(y))try{null===(i=null==g?void 0:g[e.OPERATION.REPLACE])||void 0===i||i.forEach((function(e){return e(t)}))}catch(e){Schema.onError(e)}try{g.hasOwnProperty(p.field)&&(null===(o=g[p.field])||void 0===o||o.forEach((function(e){return e(p.value,p.previousValue)})))}catch(e){Schema.onError(e)}}else p.op===e.OPERATION.ADD&&void 0===p.previousValue?null===(s=g[e.OPERATION.ADD])||void 0===s||s.forEach((function(e){var t;return e(p.value,null!==(t=p.dynamicIndex)&&void 0!==t?t:p.field)})):p.op===e.OPERATION.DELETE?void 0!==p.previousValue&&(null===(a=g[e.OPERATION.DELETE])||void 0===a||a.forEach((function(e){var t;return e(p.previousValue,null!==(t=p.dynamicIndex)&&void 0!==t?t:p.field)}))):p.op===e.OPERATION.DELETE_AND_ADD&&(void 0!==p.previousValue&&(null===(c=g[e.OPERATION.DELETE])||void 0===c||c.forEach((function(e){var t;return e(p.previousValue,null!==(t=p.dynamicIndex)&&void 0!==t?t:p.field)}))),null===(h=g[e.OPERATION.ADD])||void 0===h||h.forEach((function(e){var t;return e(p.value,null!==(t=p.dynamicIndex)&&void 0!==t?t:p.field)}))),p.value!==p.previousValue&&(null===(f=g[e.OPERATION.REPLACE])||void 0===f||f.forEach((function(e){var t;return e(p.value,null!==(t=p.dynamicIndex)&&void 0!==t?t:p.field)})));u.add(y)},d=0;d<t.length;d++)_loop_2(d)},Schema._definition=c.create(),Schema}();function dumpChanges(e){for(var t=[e.$changes],n=1,r={},i=r,_loop_1=function(e){var n=t[e];n.changes.forEach((function(e){var t=n.ref,r=e.index,o=t._definition?t._definition.fieldsByIndex[r]:t.$indexes.get(r);i[o]=n.getValue(r)}))},o=0;o<n;o++)_loop_1(o);return r}var O={context:new h},T=function(e){function ReflectionField(){return null!==e&&e.apply(this,arguments)||this}return __extends(ReflectionField,e),__decorate([type("string",O)],ReflectionField.prototype,"name",void 0),__decorate([type("string",O)],ReflectionField.prototype,"type",void 0),__decorate([type("number",O)],ReflectionField.prototype,"referencedType",void 0),ReflectionField}(b),C=function(e){function ReflectionType(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=new o,t}return __extends(ReflectionType,e),__decorate([type("number",O)],ReflectionType.prototype,"id",void 0),__decorate([type([T],O)],ReflectionType.prototype,"fields",void 0),ReflectionType}(b),I=function(e){function Reflection(){var t=null!==e&&e.apply(this,arguments)||this;return t.types=new o,t}return __extends(Reflection,e),Reflection.encode=function(e){var t=e.constructor,n=new Reflection;n.rootType=t._typeid;var buildType=function(e,t){for(var r in t){var i=new T;i.name=r;var o=void 0;if("string"==typeof t[r])o=t[r];else{var s=t[r],a=void 0;b.is(s)?(o="ref",a=t[r]):"string"==typeof s[o=Object.keys(s)[0]]?o+=":"+s[o]:a=s[o],i.referencedType=a?a._typeid:-1}i.type=o,e.fields.push(i)}n.types.push(e)},r=t._context.types;for(var i in r){var o=new C;o.id=Number(i),buildType(o,r[i]._definition.schema)}return n.encodeAll()},Reflection.decode=function(e,t){var n=new h,r=new Reflection;r.decode(e,t);var i=r.types.reduce((function(e,t){var r=function(e){function _(){return null!==e&&e.apply(this,arguments)||this}return __extends(_,e),_}(b),i=t.id;return e[i]=r,n.add(r,i),e}),{});r.types.forEach((function(e){var t=i[e.id];e.fields.forEach((function(e){var r;if(void 0!==e.referencedType){var o=e.type,s=i[e.referencedType];if(!s){var a=e.type.split(":");o=a[0],s=a[1]}"ref"===o?type(s,{context:n})(t.prototype,e.name):type(((r={})[o]=s,r),{context:n})(t.prototype,e.name)}else type(e.type,{context:n})(t.prototype,e.name)}))}));var o=i[r.rootType],s=new o;for(var a in o._definition.schema){var c=o._definition.schema[a];"string"!=typeof c&&(s[a]="function"==typeof c?new c:new(getType(Object.keys(c)[0]).constructor))}return s},__decorate([type([C],O)],Reflection.prototype,"types",void 0),__decorate([type("number",O)],Reflection.prototype,"rootType",void 0),Reflection}(b);registerType("map",{constructor:s}),registerType("array",{constructor:o}),registerType("set",{constructor:w}),registerType("collection",{constructor:A}),e.ArraySchema=o,e.CollectionSchema=A,e.Context=h,e.MapSchema=s,e.Reflection=I,e.ReflectionField=T,e.ReflectionType=C,e.Schema=b,e.SchemaDefinition=c,e.SetSchema=w,e.decode=m,e.defineTypes=defineTypes,e.deprecated=deprecated,e.dumpChanges=dumpChanges,e.encode=p,e.filter=filter,e.filterChildren=filterChildren,e.hasFilter=hasFilter,e.registerType=registerType,e.type=type,Object.defineProperty(e,"__esModule",{value:!0})}(t)})),u=function(){function Room(e,t){var n=this;this.onStateChange=createSignal(),this.onError=createSignal(),this.onLeave=createSignal(),this.onJoin=createSignal(),this.hasJoined=!1,this.onMessageHandlers={emit:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=this.events[e]||[],i=0,o=r.length;i<o;i++)r[i].apply(r,t)},events:{},on:function(e,t){var n,r=this;return(null===(n=this.events[e])||void 0===n?void 0:n.push(t))||(this.events[e]=[t]),function(){var n;r.events[e]=null===(n=r.events[e])||void 0===n?void 0:n.filter((function(e){return t!==e}))}}},this.roomId=null,this.name=e,t&&(this.serializer=new(getSerializer("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError((function(e,t){var n;return null===(n=console.warn)||void 0===n?void 0:n.call(console,"colyseus.js - onError => (".concat(e,") ").concat(t))})),this.onLeave((function(){return n.removeAllListeners()}))}return Object.defineProperty(Room.prototype,"id",{get:function(){return this.roomId},enumerable:!1,configurable:!0}),Room.prototype.connect=function(e,n,r){void 0===r&&(r=this);var i=new a;r.connection=i,i.events.onmessage=Room.prototype.onMessageCallback.bind(r),i.events.onclose=function(e){var i;if(!r.hasJoined)return null===(i=console.warn)||void 0===i||i.call(console,"Room connection was closed unexpectedly (".concat(e.code,"): ").concat(e.reason)),void r.onError.invoke(e.code,e.reason);e.code===t.DEVMODE_RESTART&&n?n():(r.onLeave.invoke(e.code),r.destroy())},i.events.onerror=function(e){var t;null===(t=console.warn)||void 0===t||t.call(console,"Room, onError (".concat(e.code,"): ").concat(e.reason)),r.onError.invoke(e.code,e.reason)},i.connect(e)},Room.prototype.leave=function(n){var r=this;return void 0===n&&(n=!0),new Promise((function(i){r.onLeave((function(e){return i(e)})),r.connection?n?r.connection.send([e.Protocol.LEAVE_ROOM]):r.connection.close():r.onLeave.invoke(t.CONSENTED)}))},Room.prototype.onMessage=function(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)},Room.prototype.send=function(t,n){var r,i=[e.Protocol.ROOM_DATA];if("string"==typeof t?f.encode.string(i,t):f.encode.number(i,t),void 0!==n){var o=encode(n);(r=new Uint8Array(i.length+o.byteLength)).set(new Uint8Array(i),0),r.set(new Uint8Array(o),i.length)}else r=new Uint8Array(i);this.connection.send(r.buffer)},Room.prototype.sendBytes=function(t,n){var r,i=[e.Protocol.ROOM_DATA_BYTES];"string"==typeof t?f.encode.string(i,t):f.encode.number(i,t),(r=new Uint8Array(i.length+(n.byteLength||n.length))).set(new Uint8Array(i),0),r.set(new Uint8Array(n),i.length),this.connection.send(r.buffer)},Object.defineProperty(Room.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),Room.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},Room.prototype.onMessageCallback=function(t){var n=Array.from(new Uint8Array(t.data)),r=n[0];if(r===e.Protocol.JOIN_ROOM){var i=1,o=utf8Read(n,i);if(i+=utf8Length(o),this.serializerId=utf8Read(n,i),i+=utf8Length(this.serializerId),!this.serializer){var s=getSerializer(this.serializerId);this.serializer=new s}n.length>i&&this.serializer.handshake&&this.serializer.handshake(n,{offset:i}),this.reconnectionToken="".concat(this.roomId,":").concat(o),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([e.Protocol.JOIN_ROOM])}else if(r===e.Protocol.ERROR){var a={offset:1},c=f.decode.number(n,a),h=f.decode.string(n,a);this.onError.invoke(c,h)}else if(r===e.Protocol.LEAVE_ROOM)this.leave();else if(r===e.Protocol.ROOM_DATA_SCHEMA){var u={offset:1};(h=new(d=this.serializer.getState().constructor._context.get(f.decode.number(n,u)))).decode(n,u),this.dispatchMessage(d,h)}else if(r===e.Protocol.ROOM_STATE)n.shift(),this.setState(n);else if(r===e.Protocol.ROOM_STATE_PATCH)n.shift(),this.patch(n);else if(r===e.Protocol.ROOM_DATA){var l={offset:1},d=f.decode.stringCheck(n,l)?f.decode.string(n,l):f.decode.number(n,l);h=n.length>l.offset?function decode(e,t){void 0===t&&(t=0);var n=new Decoder(e,t),r=n._parse();if(n._offset!==e.byteLength)throw new Error(e.byteLength-n._offset+" trailing bytes");return r}(t.data,l.offset):void 0;this.dispatchMessage(d,h)}else if(r===e.Protocol.ROOM_DATA_BYTES){var p={offset:1};d=f.decode.stringCheck(n,p)?f.decode.string(n,p):f.decode.number(n,p);this.dispatchMessage(d,new Uint8Array(n.slice(p.offset)))}},Room.prototype.setState=function(e){this.serializer.setState(e),this.onStateChange.invoke(this.serializer.getState())},Room.prototype.patch=function(e){this.serializer.patch(e),this.onStateChange.invoke(this.serializer.getState())},Room.prototype.dispatchMessage=function(e,t){var n,r=this.getMessageHandlerKey(e);this.onMessageHandlers.events[r]?this.onMessageHandlers.emit(r,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):null===(n=console.warn)||void 0===n||n.call(console,"colyseus.js: onMessage() not registered for type '".concat(e,"'."))},Room.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},Room.prototype.getMessageHandlerKey=function(e){switch(typeof e){case"function":return"$".concat(e._typeid);case"string":return e;case"number":return"i".concat(e);default:throw new Error("invalid message type.")}},Room}();function apply(e,t){t.statusMessage=e.statusText,t.statusCode=e.status,t.data=e.body}function send(e,t,n){var r,i,o=(n=n||{}).body;return n.method=e,n.headers=n.headers||{},o instanceof FormData||o&&"object"==typeof o&&(n.headers["content-type"]="application/json",n.body=JSON.stringify(o)),n.withCredentials&&(n.credentials="include"),n.timeout&&(i=new AbortController,n.signal=i.signal,r=setTimeout(i.abort,n.timeout)),new Promise(((e,s)=>{fetch(t,n).then(((t,i)=>{clearTimeout(r),apply(t,t),i=t.status>=400?s:e,(o=t.headers.get("content-type"))&&~o.indexOf("application/json")?t.text().then((e=>{try{t.data=JSON.parse(e,n.reviver),i(t)}catch(e){e.headers=t.headers,apply(t,e),s(e)}})):i(t)})).catch((e=>{e.timeout=i&&i.signal.aborted,s(e)}))}))}var l,d,p,y,v,g=send.bind(send,"GET"),m=send.bind(send,"POST"),A=send.bind(send,"PATCH"),w=send.bind(send,"DELETE"),E=send.bind(send,"PUT"),S={del:w,get:g,patch:A,post:m,put:E,send:send},$=_mergeNamespaces({__proto__:null,default:S,del:w,get:g,patch:A,post:m,put:E,send:send},[S]),b=function(){function HTTP(e){this.client=e}return HTTP.prototype.get=function(e,t){return void 0===t&&(t={}),this.request("get",e,t)},HTTP.prototype.post=function(e,t){return void 0===t&&(t={}),this.request("post",e,t)},HTTP.prototype.del=function(e,t){return void 0===t&&(t={}),this.request("del",e,t)},HTTP.prototype.put=function(e,t){return void 0===t&&(t={}),this.request("put",e,t)},HTTP.prototype.request=function(e,t,r){return void 0===r&&(r={}),$[e](this.client.getHttpEndpoint(t),this.getOptions(r)).catch((function(e){var t;throw new n(e.statusCode||-1,(null===(t=e.data)||void 0===t?void 0:t.error)||e.statusMessage||e.message||"offline")}))},HTTP.prototype.getOptions=function(e){return this.authToken&&(e.headers||(e.headers={}),e.headers.Authorization="Bearer ".concat(this.authToken),e.withCredentials=!0),e},HTTP}();function getStorage(){return l||(l="undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(e,t){this.cache[e]=t},getItem:function(e){this.cache[e]},removeItem:function(e){delete this.cache[e]}}),l}var O,T=function(){function Auth(e){var t=this;this.http=e,this.settings={path:"/auth",key:"colyseus-auth-token"},d.set(this,!1),p.set(this,void 0),y.set(this,void 0),v.set(this,{emit:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=this.events[e]||[],i=0,o=r.length;i<o;i++)r[i].apply(r,t)},events:{},on:function(e,t){var n,r=this;return(null===(n=this.events[e])||void 0===n?void 0:n.push(t))||(this.events[e]=[t]),function(){var n;r.events[e]=null===(n=r.events[e])||void 0===n?void 0:n.filter((function(e){return t!==e}))}}}),function getItem(e,t){var n=getStorage().getItem(e);"undefined"!=typeof Promise&&n instanceof Promise?n.then((function(e){return t(e)})):t(n)}(this.settings.key,(function(e){return t.token=e}))}return Object.defineProperty(Auth.prototype,"token",{get:function(){return this.http.authToken},set:function(e){this.http.authToken=e},enumerable:!1,configurable:!0}),Auth.prototype.onChange=function(e){var t=this,n=__classPrivateFieldGet(this,v,"f").on("change",e);return __classPrivateFieldGet(this,d,"f")||__classPrivateFieldSet(this,p,new Promise((function(e,n){t.getUserData().then((function(e){t.emitChange(__assign(__assign({},e),{token:t.token}))})).catch((function(e){t.emitChange({user:null,token:void 0})})).finally((function(){e()}))})),"f"),__classPrivateFieldSet(this,d,!0,"f"),n},Auth.prototype.getUserData=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.token?[4,this.http.get("".concat(this.settings.path,"/userdata"))]:[3,2];case 1:return[2,e.sent().data];case 2:throw new Error("missing auth.token")}}))}))},Auth.prototype.registerWithEmailAndPassword=function(e,t,n){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.http.post("".concat(this.settings.path,"/register"),{body:{email:e,password:t,options:n}})];case 1:return r=i.sent().data,this.emitChange(r),[2,r]}}))}))},Auth.prototype.signInWithEmailAndPassword=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.http.post("".concat(this.settings.path,"/login"),{body:{email:e,password:t}})];case 1:return n=r.sent().data,this.emitChange(n),[2,n]}}))}))},Auth.prototype.signInAnonymously=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return[4,this.http.post("".concat(this.settings.path,"/anonymous"),{body:{options:e}})];case 1:return t=n.sent().data,this.emitChange(t),[2,t]}}))}))},Auth.prototype.sendPasswordResetEmail=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return[4,this.http.post("".concat(this.settings.path,"/forgot-password"),{body:{email:e}})];case 1:return t=n.sent().data,this.emitChange(t),[2,t]}}))}))},Auth.prototype.signInWithProvider=function(e,t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,(function(){var n=this;return __generator(this,(function(r){return[2,new Promise((function(r,i){var o=t.width||480,s=t.height||768,a=n.token?"?token=".concat(n.token):"",c="Login with ".concat(e[0].toUpperCase()+e.substring(1)),h=n.http.client.getHttpEndpoint("".concat(t.prefix||"".concat(n.settings.path,"/provider"),"/").concat(e).concat(a)),f=screen.width/2-o/2,u=screen.height/2-s/2;__classPrivateFieldSet(n,y,window.open(h,c,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+o+", height="+s+", top="+u+", left="+f),"f");var onMessage=function(e){void 0===e.data.user&&void 0===e.data.token||(clearInterval(l),__classPrivateFieldGet(n,y,"f").close(),__classPrivateFieldSet(n,y,void 0,"f"),window.removeEventListener("message",onMessage),void 0!==e.data.error?i(e.data.error):(r(e.data),n.emitChange(e.data)))},l=setInterval((function(){__classPrivateFieldGet(n,y,"f")&&!__classPrivateFieldGet(n,y,"f").closed||(__classPrivateFieldSet(n,y,void 0,"f"),i("cancelled"),window.removeEventListener("message",onMessage))}),200);window.addEventListener("message",onMessage)}))]}))}))},Auth.prototype.signOut=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return this.emitChange({user:null,token:null}),[2]}))}))},Auth.prototype.emitChange=function(e){void 0!==e.token&&(this.token=e.token,null===e.token?function removeItem(e){getStorage().removeItem(e)}(this.settings.key):function setItem(e,t){getStorage().setItem(e,t)}(this.settings.key,e.token)),__classPrivateFieldGet(this,v,"f").emit("change",e)},Auth}();d=new WeakMap,p=new WeakMap,y=new WeakMap,v=new WeakMap;var C=function(e){function MatchMakeError(t,n){var r=e.call(this,t)||this;return r.code=n,Object.setPrototypeOf(r,MatchMakeError.prototype),r}return __extends(MatchMakeError,e),MatchMakeError}(Error),I="undefined"!=typeof window&&void 0!==(null===(O=null===window||void 0===window?void 0:window.location)||void 0===O?void 0:O.hostname)?"".concat(window.location.protocol.replace("http","ws"),"//").concat(window.location.hostname).concat(window.location.port&&":".concat(window.location.port)):"ws://127.0.0.1:2567",R=function(){function Client(e){if(void 0===e&&(e=I),"string"==typeof e){var t=new URL(e),n="https:"===t.protocol||"wss:"===t.protocol,r=Number(t.port||(n?443:80));this.settings={hostname:t.hostname,pathname:t.pathname,port:r,secure:n}}else void 0===e.port&&(e.port=e.secure?443:80),void 0===e.pathname&&(e.pathname=""),this.settings=e;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new b(this),this.auth=new T(this.http)}return Client.prototype.joinOrCreate=function(e,t,n){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",e,t,n)];case 1:return[2,r.sent()]}}))}))},Client.prototype.create=function(e,t,n){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("create",e,t,n)];case 1:return[2,r.sent()]}}))}))},Client.prototype.join=function(e,t,n){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("join",e,t,n)];case 1:return[2,r.sent()]}}))}))},Client.prototype.joinById=function(e,t,n){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,t,n)];case 1:return[2,r.sent()]}}))}))},Client.prototype.reconnect=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r,i;return __generator(this,(function(o){switch(o.label){case 0:if("string"==typeof e&&"string"==typeof t)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");return n=e.split(":"),r=n[0],i=n[1],[4,this.createMatchMakeRequest("reconnect",r,{reconnectionToken:i},t)];case 1:return[2,o.sent()]}}))}))},Client.prototype.getAvailableRooms=function(e){return void 0===e&&(e=""),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.http.get("matchmake/".concat(e),{headers:{Accept:"application/json"}})];case 1:return[2,t.sent().data]}}))}))},Client.prototype.consumeSeatReservation=function(e,t,r){return __awaiter(this,void 0,void 0,(function(){var i,o,s,a=this;return __generator(this,(function(c){return(i=this.createRoom(e.room.name,t)).roomId=e.room.roomId,i.sessionId=e.sessionId,o={sessionId:i.sessionId},e.reconnectionToken&&(o.reconnectionToken=e.reconnectionToken),s=r||i,i.connect(this.buildEndpoint(e.room,o),e.devMode&&function(){return __awaiter(a,void 0,void 0,(function(){var n,r,o=this;return __generator(this,(function(a){return console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," Re-establishing connection with room id '").concat(i.roomId,"'...")),n=0,8,r=function(){return __awaiter(o,void 0,void 0,(function(){return __generator(this,(function(o){switch(o.label){case 0:n++,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.consumeSeatReservation(e,t,s)];case 2:return o.sent(),console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(9989)," Successfully re-established connection with room '").concat(i.roomId,"'")),[3,4];case 3:return o.sent(),n<8?(console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," retrying... (").concat(n," out of ").concat(8,")")),setTimeout(r,2e3)):console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(10060)," Failed to reconnect. Is your server running? Please check server logs.")),[3,4];case 4:return[2]}}))}))},setTimeout(r,2e3),[2]}))}))},s),[2,new Promise((function(e,t){var onError=function(e,r){return t(new n(e,r))};s.onError.once(onError),s.onJoin.once((function(){s.onError.remove(onError),e(s)}))}))]}))}))},Client.prototype.createMatchMakeRequest=function(e,t,n,r,i){return void 0===n&&(n={}),__awaiter(this,void 0,void 0,(function(){var o;return __generator(this,(function(s){switch(s.label){case 0:return[4,this.http.post("matchmake/".concat(e,"/").concat(t),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})];case 1:if((o=s.sent().data).error)throw new C(o.error,o.code);return"reconnect"===e&&(o.reconnectionToken=n.reconnectionToken),[4,this.consumeSeatReservation(o,r,i)];case 2:return[2,s.sent()]}}))}))},Client.prototype.createRoom=function(e,t){return new u(e,t)},Client.prototype.buildEndpoint=function(e,t){void 0===t&&(t={});var n=[];for(var r in t)t.hasOwnProperty(r)&&n.push("".concat(r,"=").concat(t[r]));var i=this.settings.secure?"wss://":"ws://";return e.publicAddress?i+="".concat(e.publicAddress):i+="".concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname),"".concat(i,"/").concat(e.processId,"/").concat(e.roomId,"?").concat(n.join("&"))},Client.prototype.getHttpEndpoint=function(e){void 0===e&&(e="");var t=e.startsWith("/")?e:"/".concat(e);return"".concat(this.settings.secure?"https":"http","://").concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname).concat(t)},Client.prototype.getEndpointPort=function(){return 80!==this.settings.port&&443!==this.settings.port?":".concat(this.settings.port):""},Client}(),x=function(){function SchemaSerializer(){}return SchemaSerializer.prototype.setState=function(e){return this.state.decode(e)},SchemaSerializer.prototype.getState=function(){return this.state},SchemaSerializer.prototype.patch=function(e){return this.state.decode(e)},SchemaSerializer.prototype.teardown=function(){var e,t;null===(t=null===(e=this.state)||void 0===e?void 0:e.$changes)||void 0===t||t.root.clearRefs()},SchemaSerializer.prototype.handshake=function(e,t){this.state?(new f.Reflection).decode(e,t):this.state=f.Reflection.decode(e,t)},SchemaSerializer}(),P=function(){function NoneSerializer(){}return NoneSerializer.prototype.setState=function(e){},NoneSerializer.prototype.getState=function(){return null},NoneSerializer.prototype.patch=function(e){},NoneSerializer.prototype.teardown=function(){},NoneSerializer.prototype.handshake=function(e){},NoneSerializer}();registerSerializer("schema",x),registerSerializer("none",P),e.Auth=T,e.Client=R,e.Room=u,e.SchemaSerializer=x,e.registerSerializer=registerSerializer,Object.defineProperty(e,"__esModule",{value:!0})}));var SceneLoader=pc.createScript("sceneLoader");SceneLoader.attributes.add("defaultScenes",{type:"string",array:!0}),SceneLoader.prototype.initialize=function(){this.app.on("SceneLoader:Load",this.loadScene,this),this.app.on("SceneLoader:Unload",this.unloadScene,this),this.loadDefaultScenes()},SceneLoader.prototype.loadDefaultScenes=function(){for(var e=this.defaultScenes.length;e--;)this.loadScene(this.defaultScenes[e])},SceneLoader.prototype.unloadScene=function(e){var n=this.entity.findByName("Holder-"+e);n&&n.destroy()},SceneLoader.prototype.loadScene=function(e,n){var t=this.app.scenes.find(e);if(!t)return console.error("Scene is not found"),!1;var o=new pc.Entity;o.name="Holder-"+e,this.entity.addChild(o),this.app.loadSceneHierarchy(t.url,(function(e,t){e?console.error(e):(o.addChild(t),n&&n(),pc.app.fire("Scan:Ground"))}))};!function(){const e=function getIosVersion(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}return null}();document.documentElement.style.setProperty("--sat","env(safe-area-inset-top)"),document.documentElement.style.setProperty("--sab","env(safe-area-inset-bottom)"),document.documentElement.style.setProperty("--sal","env(safe-area-inset-left)"),document.documentElement.style.setProperty("--sar","env(safe-area-inset-right)");const t=pc.Application.getApplication();let n=null;function createInputDom(){n&&n.remove(),n=document.createElement("input"),n.setAttribute("type","text"),n.style.position="absolute",n.style.fontFamily="Arial, sans-serif",n.style.background="white",n.style.paddingLeft="10px",n.style.paddingRight="10px",n.style.margin="0px",n.style.visibility="hidden",n.style.zIndex=1e3,resetStyle(),n.value="",document.body.appendChild(n)}createInputDom();let o=!1,i=!1,l=null;function onInputFieldClick(e,t){t.stopPropagation(),showDom(e,t)}function showDom(e,t){if(i!==e){switch(i&&i!==e&&onBlur(),i=e,"visible"!==n.style.visibility&&(t.changedTouches?(t.event.preventDefault(),o=!1):o=!0,n.style.visibility="visible",n.onblur=onBlur,n.addEventListener("keydown",onKeyDown),n.addEventListener("keyup",onKeyUp)),n.value=e.value,n.maxLength=e.maxLength,n.placeholder=e.placeHolder,n.pattern=null,n.spellcheck=!1,e.inputType){case"text":default:n.type="text",n.spellcheck=!0;break;case"text no spellcheck":n.type="text";break;case"number":n.type="number",n.pattern="[0-9]*";break;case"decimal":n.type="number";break;case"email":n.type="email";break;case"password":n.type="password"}n.enterKeyHint=e.enterKeyHint,n.focus(),updateStyle(),i.entity.element.on("resize",updateStyle)}}function onBlur(){n.onblur=null,n.removeEventListener("keydown",onKeyDown),n.removeEventListener("keyup",onKeyUp),n.style.visibility="hidden",function onElementSwitch(){i.entity.fire("uiinput:updatevalue",n.value),i.entity.element.off("resize",updateStyle),"password"===i.inputType&&createInputDom(),i=null}()}function onKeyDown(e){e.stopPropagation(),13===e.keyCode&&n.blur()}function onKeyUp(e){e.preventDefault(),e.stopPropagation()}function resetStyle(){const e=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sal")),t=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sar"));n.style.left="20px",n.style.height="40px",n.style.width=window.innerWidth-64-e-t+"px",n.style.fontSize="100%",n.style.top="20px",n.style.marginTop="env(safe-area-inset-top)",n.style.marginLeft="env(safe-area-inset-left)",n.style.bottom=null}function updateStyle(){if(i)if(o&&i.entity.element.screenCorners){const e=i.entity.element.screenCorners,o=Math.min(t.graphicsDevice.maxPixelRatio,window.devicePixelRatio);n.style.left=e[0].x/o-2+"px",n.style.bottom=e[0].y/o-2+"px",n.style.top=null;const l=(e[2].x-e[0].x)/o-20,s=(e[2].y-e[0].y)/o;n.style.width=l+"px",n.style.height=s+"px",n.style.fontSize=Math.round(.5*s)+"px"}else resetStyle()}function onIosResizeTimeout(){t.on("uiinput:clicked",onInputFieldClick),l=null}e?l=setTimeout(onIosResizeTimeout,2100):(t.on("uiinput:clicked",onInputFieldClick),t.on("uiinput:focus",showDom)),t.graphicsDevice.on("resizecanvas",(function onResize(){e&&!l&&(t.off("uiinput:clicked",onInputFieldClick),l=setTimeout(onIosResizeTimeout,2100)),setTimeout((()=>{updateStyle()}))}))}();var UiInputField=pc.createScript("uiInputField");UiInputField.attributes.add("textEntity",{type:"entity",title:"Text Entity",description:"The Entity that has the text Element to update with the inputted text."}),UiInputField.attributes.add("inputType",{type:"string",title:"Input Type",description:"What type of input will this field accept. On some devices, the virtual keyboard layout may change as well. For example, 'Number' will bring up a numpad instead of the full keyboard.",default:"text",enum:[{Text:"text"},{"Text (no spellcheck)":"text no spellcheck"},{Email:"email"},{Number:"number"},{Decimal:"decimal"},{Password:"password"}]}),UiInputField.attributes.add("enterKeyHint",{type:"string",title:"Enter Key Hint",description:"Change what the enter key shows on the virutal keyboard. Different OSs will have different representations of the hint.",default:"enter",enum:[{Enter:"enter"},{Done:"done"},{Go:"go"},{Search:"search"},{Send:"send"}]}),UiInputField.attributes.add("maxLength",{type:"number",default:32,title:"Max Length",description:"Maximum length of the text can be."}),UiInputField.attributes.add("placeHolder",{type:"string",default:"Placeholder text...",title:"Place Holder String",description:"When the inputted text is empty, what should show as placeholder? Usually this is a prompt such as 'Enter your email here'."}),UiInputField.attributes.add("placeHolderColor",{type:"rgb",title:"Place Holder Text Color",description:"What color the text should be when the placeholder string is used."}),UiInputField.prototype.initialize=function(){this._textElement=this.textEntity.element,this._textColor=this._textElement.color.clone(),this.value="",this.setEvents("on"),this.on("destroy",(()=>{this.setEvents("off")})),this._onValueChange("")},UiInputField.prototype.setEvents=function(t){this.entity[t]("uiinput:updatevalue",this._onValueChange,this),this.entity.element[t]("click",this._onClick,this),this.entity[t]("focus",this.onFocus,this)},UiInputField.prototype.onFocus=function(){this.app.fire("uiinput:focus",this,{})},UiInputField.prototype._onValueChange=function(t){if(this.value=t,t.length>0){if("password"===this.inputType){let e="";for(let i=0;i<t.length;++i)e+="*";this._textElement.text=e}else this._textElement.text=t;this._textElement.color=this._textColor}else this._textElement.text=this.placeHolder,this._textElement.color=this.placeHolderColor;this.entity.fire("updatedvalue",t)},UiInputField.prototype._onClick=function(t){this.app.fire("uiinput:clicked",this,t)};var Slider=pc.createScript("slider");Slider.attributes.add("valueEntity",{type:"entity"}),Slider.attributes.add("sizeEntity",{type:"entity"}),Slider.prototype.initialize=function(){this.on("state",this.onUpdate,this),this.entity.scrollbar.on("set:value",this.onUpdate,this),this.onUpdate()},Slider.prototype.onUpdate=function(t){this.valueEntity.element.text=Math.round(100*this.entity.scrollbar.value)+"%",this.sizeEntity.setLocalScale(this.entity.scrollbar.value,1,1)};var Interaction=pc.createScript("interaction");Interaction.attributes.add("speed",{type:"number",default:1}),Interaction.attributes.add("eventName",{type:"string"}),Interaction.attributes.add("string",{type:"string"}),Interaction.attributes.add("player",{type:"entity"}),Interaction.prototype.postInitialize=function(){this.popupShown=!1,this.progress=-1,this.threshold=0,this.entity.on("Trigger",this.onTrigger,this),this.entity.on("Leave",this.onLeave,this)},Interaction.prototype.onTrigger=function(t,e){this.popupShown||"Player"!=t.name||(this.threshold+=e*this.speed,this.app.fire("World2Screen:Show","Progress",this.entity),this.app.fire("Progress:WaitFill",this.threshold),this.threshold>=1&&(this.app.fire("World2Screen:Hide","Progress",this.entity),this.app.fire(this.eventName,this.string),this.popupShown=!0,this.threshold=0))},Interaction.prototype.onLeave=function(t){this.popupShown&&(this.popupShown=!1),this.threshold=0,this.app.fire("Progress:WaitFill",this.threshold),this.app.fire("World2Screen:Hide","Progress",this.entity)},Interaction.prototype.update=function(t){};var Popup3d=pc.createScript("popup3d");Popup3d.prototype.initialize=function(){this.popups3D=this.app.root.findByTag("Popup3D"),this.currentPopup=null,this.app.on("Popup3D:Show",this.onShow,this),this.app.on("Popup3D:Hide",this.onHide,this)},Popup3d.prototype.onShow=function(p){for(var o=0;o<this.popups3D.length;o++){var t=this.popups3D[o];t.name===p?(t.enabled=!0,this.currentPopup=t,pc.activePopup3D=!0,this.app.mouse.disablePointerLock()):t.enabled=!1}},Popup3d.prototype.onHide=function(){this.currentPopup&&(this.currentPopup.enabled=!1,this.app.mouse.enablePointerLock(),setTimeout((()=>{pc.activePopup3D=!1}),10))},Popup3d.prototype.update=function(p){};var Rotate=pc.createScript("rotate");Rotate.attributes.add("axis",{type:"string",enum:[{x:"x"},{y:"y"},{z:"z"}]}),Rotate.attributes.add("speed",{type:"number"}),Rotate.attributes.add("waveStyle",{type:"boolean"}),Rotate.attributes.add("waveWidth",{type:"number"}),Rotate.attributes.add("children",{type:"boolean"}),Rotate.attributes.add("graphName",{type:"string"}),Rotate.prototype.initialize=function(){this.currentElement=this.entity,this.timestamp=0,this.children&&(this.currentElement=this.entity.findByName(this.graphName))},Rotate.prototype.update=function(t){var e=this.speed*(60*t);this.waveStyle&&(e=Math.cos(this.timestamp*this.speed)*this.waveWidth,this.timestamp+=60*t),this.currentElement?("x"==this.axis&&this.currentElement.rotateLocal(e,0,0),"y"==this.axis&&this.currentElement.rotateLocal(0,e,0),"z"==this.axis&&this.currentElement.rotateLocal(0,0,e)):this.children&&(this.currentElement=this.entity.findByName(this.graphName))};var ShoesShop=pc.createScript("shoesShop");ShoesShop.attributes.add("popup",{type:"entity"}),ShoesShop.attributes.add("shoes",{type:"json",schema:[{name:"shoeName",type:"string"},{name:"displayName",type:"string"},{name:"icon",type:"asset",assetType:"texture"},{name:"price",type:"number"},{name:"boost",type:"number"},{name:"title",type:"entity"},{name:"items",type:"entity",array:!0}],array:!0}),ShoesShop.prototype.initialize=function(){this.purchasedItems=pc.IdleManager.PurchasedItems;var e=Utils.getItemAsString("CurrentLevel");e&&"undefined"!=e||(e="Level-1"),this.levelNumber=e.split("-")[1]?parseInt(e.split("-")[1]):1,this.createTitles(),this.app.on("Shoes:onInteraction",this.onInteraction,this),this.app.on("LevelManager:Trigger",this.setEntityPosition,this)},ShoesShop.prototype.setEntityPosition=function(){setTimeout((e=>{var t=e.app.root.findByName("ShoeShopPosition");t&&(e.entity.setPosition(t.getPosition().clone()),e.entity.setLocalRotation(t.getLocalRotation().clone()))}),1500,this);var e=Utils.getItemAsString("CurrentLevel");e&&"undefined"!=e||(e="Level-1"),this.createTitles()},ShoesShop.prototype.postInitialize=function(){this.customizations=pc.IdleManager.Customizations,Array.isArray(this.customizations)?0==this.customizations.length&&(this.customizations=[{shoes:"Default"}]):this.customizations=[{shoes:"Default"}],this.savedShoes=this.customizations.find((e=>1==e.hasOwnProperty("shoes"))),this.savedShoes?this.savedShoes&&this.activateItemByName(this.savedShoes.shoes):(this.savedShoes={shoes:"Default"},this.activateItemByName("Default",!1)),this.setEntityPosition()},ShoesShop.prototype.createTitles=function(){for(var e=0;e<this.shoes.length;e++){var t=this.shoes[e],s=t.title;if(s){var i=s.findByName("Name");s.findByName("BoostNumber").element.text=t.boost*this.levelNumber,i.element.text=t.displayName}}},ShoesShop.prototype.onInteraction=function(e){var t=Utils.getItemAsString("CurrentLevel");t&&"undefined"!=t||(t="Level-1"),this.levelNumber=t.split("-")[1]?parseInt(t.split("-")[1]):1;var s=this.popup.findByName("BoostNumber"),i=this.popup.findByName("PriceNumber"),o=this.popup.findByName("BuyButton"),a=this.getItemByName(e);if(a){s.element.text=a.boost*this.levelNumber,i.element.text=a.price*this.levelNumber,o.script.button.value=a.shoeName;var n=this.purchasedItems.indexOf(a.shoeName+this.levelNumber);this.savedShoes.shoes==a.shoeName&&n>=0?(this.updateBuyButton(o,"Equipped"),i.element.key="Purchased",i.element.fontSize=30):(this.updateBuyButton(o,"Buy"),i.element.text=a.price*this.levelNumber,i.element.fontSize=47.83,n>=0&&(this.updateBuyButton(o,"Equip"),i.element.key="Purchased",i.element.fontSize=30)),this.app.fire("PopupManager:Show","ShoeShop")}},ShoesShop.prototype.onPurchase=function(e){var t=this.getItemByName(e);if(this.purchasedItems.indexOf(e+this.levelNumber)>=0){var s=this.popup.findByName("BuyButton");return this.activateItemByName(e,!1),this.updateBuyButton(s,"Equipped"),!1}pc.IdleManager.Coin>=t.price?(this.app.fire("IdleManager:Add","Coin",t.price*this.levelNumber*-1),this.activateItemByName(e),this.app.fire("PopupManager:Hide")):this.app.fire("PopupManager:Show","NoEnoughMoney")},ShoesShop.prototype.getItemByName=function(e){for(var t=0;t<this.shoes.length;t++){var s=this.shoes[t];if(s.shoeName==e)return s}},ShoesShop.prototype.activateItemByName=function(e,t=!0){for(var s=0;s<this.shoes.length;s++){var i=this.shoes[s];if(i.shoeName==e)for(var o=0;o<i.items.length;o++){i.items[o].enabled=!0,this.savedShoes.shoes=e,this.app.fire("IdleManager:Set","Customizations",this.customizations),this.app.fire("Workout:UpdateShoesMultiplier",i.boost*this.levelNumber-1,!1),this.purchasedItems.indexOf(e+this.levelNumber)<0&&(this.purchasedItems.push(e+this.levelNumber),this.app.fire("IdleManager:Set","PurchasedItems",this.purchasedItems));var a=`${JSON.stringify(this.bundleCustomizationData(pc.IdleManager.Customizations,pc.IdleManager.Cosmetics))}`;this.app.fire("NetworkManager:Send","updateCustomizations",a)}else for(o=0;o<i.items.length;o++){i.items[o].enabled=!1}}},ShoesShop.prototype.bundleCustomizationData=function(e,t){var s={};return e.forEach((e=>{var t=Object.keys(e)[0];s[t]=e[t]})),s.cosmetics=t,s},ShoesShop.prototype.updateBuyButton=function(e,t){var s=e.findByTag("ButtonUI"),i=e.findByName("Text");if("Buy"==t){var o=new pc.Color(0,.918,.114);i.element.key="Buy",s.forEach((e=>e.element.color=o)),e.element.useInput=!0}else if("Equip"==t){o=new pc.Color(0,.918,.114);i.element.key="Equip",s.forEach((e=>e.element.color=o)),e.element.useInput=!0}else{o=new pc.Color(.584,.584,.584);i.element.key="Equipped",s.forEach((e=>e.element.color=o)),e.element.useInput=!1}},ShoesShop.prototype.update=function(e){};var Emotes=pc.createScript("emotes");Emotes.attributes.add("stickerEntity",{type:"entity"}),Emotes.attributes.add("animationEntity",{type:"entity"}),Emotes.prototype.initialize=function(){this.stickerEntity.enabled=!1,this.entity.on("Emotes:Play",this.onEmotePlay,this),this.entity.on("Emotes:PlaySticker",this.onEmoteStickerPlay,this),this.entity.on("Emotes:PlayAnimation",this.onEmoteAnimationPlay,this)},Emotes.prototype.onEmotePlay=function(t){return!!t&&("string"==typeof t&&void(t.includes(".png")?this.entity.fire("Emotes:PlaySticker",t):this.entity.fire("Emotes:PlayAnimation",t)))},Emotes.prototype.onEmoteStickerPlay=function(t){var i=this;this.stickerEntity.enabled=!1,this.stickerEntity.enabled=!0;var e=this.app.assets.find(t);if(!e)return!1;this.stickerEntity.element.textureAsset=e,clearTimeout(this.sticketTimeout),this.sticketTimeout=setTimeout((function(){i.stickerEntity.enabled=!1}),3e3)},Emotes.prototype.onEmoteAnimationPlay=function(t){var i=this;if(!t)return console.log("Dance name is not provided"),!1;var e=this.app.assets.find(t,"animation");if(!e)return console.error("Emote asset is not found"),!1;e&&e.resource?i.updateEmoteAnimation(e):(e.once("load",(function(){i.updateEmoteAnimation(e)})),this.app.assets.load(e))},Emotes.prototype.updateEmoteAnimation=function(t){this.animationEntity.anim.assignAnimation("Emote",t.resource),this.animationEntity.anim.setTrigger("Emote")};var OfflineEarnings=pc.createScript("offlineEarnings");OfflineEarnings.attributes.add("status",{type:"entity"}),OfflineEarnings.attributes.add("minuteNumber",{type:"entity"}),OfflineEarnings.attributes.add("collectBtn",{type:"entity"}),OfflineEarnings.attributes.add("collect2Btn",{type:"entity"}),OfflineEarnings.attributes.add("notify",{type:"entity"}),OfflineEarnings.attributes.add("player",{type:"entity"}),OfflineEarnings.attributes.add("coinDisplay",{type:"entity"}),OfflineEarnings.attributes.add("multiplierCoin",{type:"number",default:2,description:"Coin per minute"}),OfflineEarnings.attributes.add("minValue",{type:"number",default:20}),OfflineEarnings.attributes.add("maxValue",{type:"number",default:2e3}),OfflineEarnings.attributes.add("checkingfreq",{type:"number",default:5}),OfflineEarnings.prototype.initialize=function(){var e=this;this.x2=1,this.lastSeen=pc.IdleManager.LastSeen?pc.IdleManager.LastSeen:Date.now(),this.level=1;var n=Math.floor((Date.now()-this.lastSeen)/1e3/60);this.earnedCoinsOffline=pc.math.clamp(Math.floor(n*this.multiplierCoin*this.level),0,this.maxValue)+pc.IdleManager.LastOfflineEarning,this.app.fire("IdleManager:Set","LastOfflineEarning",this.earnedCoinsOffline),setInterval((()=>{e.app.fire("IdleManager:Set","LastSeen",Date.now())}),1e3*this.checkingfreq),setInterval((()=>{var n=pc.IdleManager.LastOnlineEarning+1*e.multiplierCoin;e.app.fire("IdleManager:Set","LastOnlineEarning",n)}),6e4),this.app.fire("IdleManager:Set","LastSeen",Date.now()),this.app.on("OfflineEarnings:Collect",this.collect,this),this.app.on("OfflineEarnings:OpenPopup",this.openPopup,this)},OfflineEarnings.prototype.postInitialize=function(){this.updateEarnings(),this.earnedCoinsOffline+this.earnedCoinsOnline>0&&(this.notify.enabled=!0)},OfflineEarnings.prototype.updateEarnings=function(){this.level=pc.IdleManager.RebirthLevel||1,this.earnedCoinsOnline=pc.math.clamp(Math.floor(pc.IdleManager.LastOnlineEarning),0,this.maxValue)},OfflineEarnings.prototype.openPopup=function(){this.updateEarnings(),this.x2=1,this.minuteNumber.element.text=this.multiplierCoin*this.level;var e=this.status.findByName("Amount");e&&(e.element.text="+"+(this.earnedCoinsOffline+this.earnedCoinsOnline)),pc.app.fire("PopupManager:Show","PassiveEarnings"),0==this.earnedCoinsOffline&&0==this.earnedCoinsOnline?this.updateButtons(!1):this.updateButtons(!0)},OfflineEarnings.prototype.collect=function(e){var n=this;"1"==e?(this.x2=1,this.makeEarning()):"2"==e&&(this.x2=2,PokiPlugin.showReward((function(){n.makeEarning()})))},OfflineEarnings.prototype.makeEarning=function(){for(var e=(this.earnedCoinsOffline+this.earnedCoinsOnline)*this.x2,n=0;n<50;n++)setTimeout((function(e){pc.app.fire("World2Screen:Animate","Coin",e.player.getPosition(),e.coinDisplay)}),5*n,this);pc.app.fire("IdleManager:Add","Coin",e),pc.app.fire("PopupManager:Hide"),this.earnedCoinsOffline=0,this.notify.enabled=!1,this.app.fire("IdleManager:Set","LastOfflineEarning",0),this.app.fire("IdleManager:Set","LastOnlineEarning",0),this.app.fire("IdleManager:Set","LastSeen",Date.now())},OfflineEarnings.prototype.updateButtons=function(e){var n=this.collectBtn.findByTag("ButtonUI"),t=this.collect2Btn.findByTag("ButtonUI");if(e){this.collectBtn.element.useInput=!0,this.collect2Btn.element.useInput=!0;for(var i=0;i<n.length;i++)n[i].element.color=new pc.Color(.314,.945,0,1);for(i=0;i<t.length;i++)t[i].element.color=new pc.Color(.133,.549,.902,1)}else{this.collectBtn.element.useInput=!1,this.collect2Btn.element.useInput=!1;for(i=0;i<n.length;i++)n[i].element.color=pc.Color.GRAY;for(i=0;i<t.length;i++)t[i].element.color=pc.Color.GRAY}};var QuestManager=pc.createScript("questManager");QuestManager.attributes.add("questItem",{type:"entity"}),QuestManager.attributes.add("questContent",{type:"entity"}),QuestManager.attributes.add("player",{type:"entity"}),QuestManager.attributes.add("coinDisplay",{type:"entity"}),QuestManager.attributes.add("collectButton",{type:"entity"}),QuestManager.attributes.add("notify",{type:"entity"}),QuestManager.attributes.add("startingQuests",{type:"json",schema:[{name:"icon",type:"asset",assetType:"texture"},{name:"questName",type:"string"},{name:"description",type:"string"},{name:"parameter",type:"string",enum:[{Fishes:"Fishes"},{Score:"Score"},{Wins:"Wins"},{Coin:"Coin"},{UniqueFishes:"UniqueFishes"},{RodLevel:"RodLevel"}],default:"Fishes"},{name:"startCompletionThreshold",type:"number"},{name:"thresholdMultiplier",type:"number"},{name:"reward",type:"number"},{name:"rewardMultiplier",type:"number"},{name:"level",type:"number"}],array:!0}),QuestManager.prototype.initialize=function(){this.questsLevels=pc.IdleManager.Quests,this.generateQuests(),this.app.on("PopupManager:Show",this.updateQuests,this),this.app.on("IdleManager:Add",this.updateQuests,this),this.app.on("Quest:Collect",this.collect,this),this.questItem.enabled=!1,this.updateQuests()},QuestManager.prototype.generateQuests=function(){this.startingQuests.forEach((e=>{this.createQuest(e)})),this.questContent.element.height=120*this.startingQuests.length},QuestManager.prototype.createQuest=function(e){var t=this.questsLevels.find((t=>t.questName==e.questName));t&&(e.level=t.level);var s=this.questItem.clone();s.name=e.questName;var a=s.findByName("Icon"),i=s.findByName("ProgressNumber"),n=(p=s.findByName("Description")).findByName("Text1"),r=p.findByName("Number"),u=p.findByName("Text2"),o=e.icon,l=Math.ceil(e.startCompletionThreshold*(1+Math.pow(e.thresholdMultiplier,e.level))),p=`${e.description.split("_")[0]}${l}${e.description.split("_")[1]}`;n.element.key=e.description.split("_")[0],r.element.key=l,u.element.key=e.description.split("_")[1],a.element.textureAsset=o,i.element.text=`0 / ${l}`,this.questContent.addChild(s)},QuestManager.prototype.updateQuests=function(){this.updateCollectButton(!1),this.startingQuests.forEach((e=>{var t=this.questContent.findByName(e.questName);this.updateQuest(t,e)&&this.updateCollectButton(!0)}))},QuestManager.prototype.updateQuest=function(e,t){var s=Math.ceil(t.startCompletionThreshold*(1+Math.pow(t.thresholdMultiplier,t.level))),a=pc.IdleManager[t.parameter];e.findByName("ProgressNumber").element.text=`${pc.math.clamp(a,0,s)} / ${s}`,e.findByName("Progress").element.width=pc.math.clamp(a/s*300,0,300);var i=e.findByName("Description"),n=i.findByName("Text1"),r=i.findByName("Number"),u=i.findByName("Text2");n.element.key=t.description.split("_")[0].trim(),r.element.text=s,u.element.key=t.description.split("_")[1].trim();var o=e.findByName("Notify");if(e.isDone=a>=s,o.enabled=e.isDone,e.isDone)return!0},QuestManager.prototype.collect=function(){var e=0;this.startingQuests.forEach((t=>{var s=this.questContent.findByName(t.questName);s.isDone&&(s.findByName("Notify").enabled=!1,t.level++,e+=t.reward*(1+t.rewardMultiplier*t.level));var a={questName:t.questName,level:t.level},i=this.questsLevels.find((e=>e.questName==t.questName));i?i.level=a.level:this.questsLevels.push(a)})),this.app.fire("IdleManager:Set","Quests",this.questsLevels);for(var t=Math.min(e,20),s=0;s<t;s++)setTimeout((()=>{this.app.fire("World2Screen:Animate","Coin",this.player.getPosition(),this.coinDisplay)}),5*s);this.app.fire("IdleManager:Add","Coin",e),this.updateCollectButton(!1),this.updateQuests()},QuestManager.prototype.updateCollectButton=function(e){var t=this.collectButton.findByTag("ButtonUI"),s=e?new pc.Color(0,.918,.114):new pc.Color(.584,.584,.584);this.collectButton.element.useInput=e,t.forEach((function(e){e.element.color=s})),this.notify.enabled=e},QuestManager.prototype.update=function(e){};var CosmeticsManager=pc.createScript("cosmeticsManager");CosmeticsManager.attributes.add("camera",{type:"entity"}),CosmeticsManager.attributes.add("cameraHolder",{type:"entity"}),CosmeticsManager.attributes.add("scrollView",{type:"entity"}),CosmeticsManager.attributes.add("skinsEntity",{type:"entity"}),CosmeticsManager.attributes.add("skinsContainer",{type:"entity"}),CosmeticsManager.attributes.add("glassesEntity",{type:"entity"}),CosmeticsManager.attributes.add("glassesContainer",{type:"entity"}),CosmeticsManager.attributes.add("skinsBuyButton",{type:"entity"}),CosmeticsManager.attributes.add("skinsRewardButton",{type:"entity"}),CosmeticsManager.attributes.add("glassesBuyButton",{type:"entity"}),CosmeticsManager.attributes.add("glassesRewardButton",{type:"entity"}),CosmeticsManager.attributes.add("removeImage",{type:"asset",assetType:"texture"}),CosmeticsManager.attributes.add("cosmeticItems",{type:"json",schema:[{name:"category",type:"string",enum:[{None:"None"},{Skins:"Skins"},{Glasses:"Glasses"}],default:"None"},{name:"models",type:"asset",assetType:"render"},{name:"prices",type:"number"},{name:"diamond",type:"number",default:-1},{name:"ads",type:"number"},{name:"growth",type:"number"},{name:"descriptions",type:"string"}],array:!0}),CosmeticsManager.prototype.initialize=function(){this.setUpCategories(),this.purchasedItems=pc.IdleManager.PurchasedItems,this.currentlyActiveItems=pc.IdleManager.Cosmetics,this.createPopup(),this.activeIndex=0,this.selectedItem="",this.app.on("Cosmetics:onInteraction",this.onInteraction,this),this.app.on("Cosmetics:SetItem",this.setItem,this),this.app.on("Cosmetics:BuyItem",this.buyItem,this),this.app.on("Cosmetics:Reward",this.playRewardAd,this),this.app.on("Cosmetics:SelectMenu",this.selectMenu,this),this.app.on("PopupManager:Hide",this.onPopupHide,this),this.app.on("PopupManager:Show",this.onPopupShow,this),this.app.on("Cosmetics:HideCamera",this.hideCamera,this),this.app.on("Cosmetics:GetDiamond",this.getDiamond,this),this.scrollView.scrollview.vertical=!1},CosmeticsManager.prototype.getDiamond=function(){PokiPlugin.showReward((function(){pc.app.fire("IdleManager:Add","Diamond",1),pc.app.fire("PopupManager:Show","GotDiamond")}))},CosmeticsManager.prototype.postInitialize=function(){var e=pc.IdleManager.Cosmetics,t=1;e.forEach((e=>{this.setItem(`${e.categoryName},${e.model}`),t*=e.growth?e.growth:1,this.updateEquipped(e.categoryName,e.model)})),this.app.fire("Workout:UpdateCosmeticsMultiplier",t.toFixed(2))},CosmeticsManager.prototype.setUpCategories=function(){for(var e=[],t=0;t<this.cosmeticItems.length;t++){var a=this.cosmeticItems[t];if(n=e.find((e=>e.categoryName==a.category)))n.models.push(a.models),n.prices.push(a.prices),n.diamonds.push(a.diamond),n.ads.push(a.ads),n.growth.push(a.growth),n.descriptions.push(a.descriptions);else{var i={};i.categoryName=a.category,i.entity=this[a.category.toLowerCase()+"Entity"],i.container=this[a.category.toLowerCase()+"Container"],i.button=this[a.category.toLowerCase()+"BuyButton"],i.rewardButton=this[a.category.toLowerCase()+"RewardButton"],i.firstItemDefault=!0,i.useMaterials=!0,i.models=[a.models],i.prices=[a.prices],i.diamonds=[a.diamond],i.ads=[a.ads],i.growth=[a.growth],i.descriptions=[a.descriptions],e.push(i)}}for(var s=0;s<e.length;s++){for(var n,r=!1,o=(n=e[s]).models.length-1;o>=0;o--)null!=n.models[o]&&void 0!==n.models[o]||(r=!0,n.models.splice(o,1),n.prices.splice(o,1),n.diamonds.splice(o,1),n.ads.splice(o,1),n.growth.splice(o,1),n.descriptions.splice(o,1));r&&(n.firstItemDefault=!1,n.useMaterials=!1)}this.categories=e},CosmeticsManager.prototype.onInteraction=function(e){this.selectMenu(e),this.app.fire("PopupManager:Show","Cosmetics"),this.camera.enabled=!0,this.app.fire("CosmeticsCamera:PlaceCamera",this.cameraHolder),this.categories.forEach((e=>{this.updateBuyButton(e.button,!1)})),this.currentlyActiveItems=[],this.categories.forEach((e=>{var t=this.cosmeticItems.find((t=>t.models&&t.models.id==e.entity.render.asset)),a={categoryName:e.categoryName,model:e.entity.render.asset,growth:t?t.growth:1};this.currentlyActiveItems.push(a)}))},CosmeticsManager.prototype.selectMenu=function(e){this.menuTabEntities||(this.menuTabEntities=this.app.root.findByTag("CosmeticTab"));var t=this;this.menuTabEntities.forEach((function(a){a.name==e?(a.enabled=!0,t.scrollView.scrollview.contentEntity=a):a.enabled=!1})),this.selectTab(e)},CosmeticsManager.prototype.selectTab=function(e){this.tabEntities&&0!==this.tabEntities.length||(this.tabEntities=this.app.root.findByTag("CosmeticTabBtn")),this.tabEntities.forEach((t=>{t.element.opacity=t.name===e?1:0}))},CosmeticsManager.prototype.onPopupHide=function(){if(pc.inPvpMode)return!1;var e=1;this.currentlyActiveItems.forEach((t=>{this.setItem(`${t.categoryName},${t.model}`),e*=t.growth?t.growth:1})),this.app.fire("Workout:UpdateCosmeticsMultiplier",e.toFixed(2))},CosmeticsManager.prototype.hideCamera=function(){this.camera.enabled=!1,this.categories.forEach((e=>{this.updateBuyButton(e.button,!1)}))},CosmeticsManager.prototype.onPopupShow=function(e){if("Cosmetics"==e)return this.categories.forEach((e=>{this.updateBuyButton(e.button,!1)})),!1;this.camera.enabled=!1,this.categories.forEach((e=>{this.updateBuyButton(e.button,!1)}))},CosmeticsManager.prototype.setItem=function(e){var t=e.split(","),a="HAS"===t[2],i=parseInt(t[2]),s=parseInt(t[3]||0),n=parseInt(t[5]||-1);if("null"==t[1]&&(s=0,i=0,a=!0),0==i&&!a&&-1==n&&0==s){(c=(o=this.categories.find((e=>e.categoryName==t[0]))).entity).render.asset=null,this.currentlyActiveItems.forEach((e=>{e.categoryName==t[0]&&(e.model=null,e.growth=1),this.updateEquipped(e.categoryName,e.model)})),this.app.fire("IdleManager:Set","Cosmetics",this.currentlyActiveItems);var r=`${JSON.stringify(this.bundleCustomizationData(pc.IdleManager.Customizations,pc.IdleManager.Cosmetics))}`;return this.app.fire("NetworkManager:Send","updateCustomizations",r),this.selectedItem="",this.updateBuyButton(o.button,!1),this.updateButtons(t[0],-1),!1}if(a){var o;if(o=this.categories.find((e=>e.categoryName==t[0])))if((c=o.entity).render.asset=t[1],o.useMaterials)if(p=this.getNameById(o.models,t[1])){var d=this.app.assets.find(p,pc.ASSET_MATERIAL);c.render.materialAssets=[d]}var m=this.cosmeticItems.find((e=>e.models&&e.models.id==o.entity.render.asset));this.currentlyActiveItems.forEach((e=>{m&&e.categoryName==t[0]&&(e.model=t[1],e.growth=m.growth),this.updateEquipped(e.categoryName,e.model)})),this.app.fire("IdleManager:Set","Cosmetics",this.currentlyActiveItems);r=`${JSON.stringify(this.bundleCustomizationData(pc.IdleManager.Customizations,pc.IdleManager.Cosmetics))}`;return this.app.fire("NetworkManager:Send","updateCustomizations",r),this.selectedItem="",this.updateBuyButton(o.button,!1),this.updateButtons(t[0],-1,null,a),!1}if(t.length>1&&(o=this.categories.find((e=>e.categoryName==t[0])))){var c,p;if((c=o.entity).render.asset=t[1],o.useMaterials)if(p=this.getNameById(o.models,t[1])){d=this.app.assets.find(p,pc.ASSET_MATERIAL);c.render.materialAssets=[d]}this.selectedItem=e,this.updateBuyButton(o.button,!0),this.updateButtons(t[0],t[2]?t[2]:0,t[5])}},CosmeticsManager.prototype.getNameById=function(e,t){for(var a=0;a<e.length;a++)if(e[a].id==parseInt(t))return e[a].name},CosmeticsManager.prototype.buyItem=function(e){var t=""==this.selectedItem?null:this.selectedItem.split(",");"Reward"!=e?t&&t.length>1&&this.currentlyActiveItems.forEach((e=>{if(e.categoryName==t[0]){var a=parseInt(t[5]);if(a>0)if(pc.IdleManager.Diamond>=a){e.model=t[1];var i=this.cosmeticItems.find((t=>t.models&&t.models.id==e.model));e.growth=i.growth,this.app.fire("IdleManager:Add","Diamond",-1*parseInt(t[5])),this.setItem(t[0]+","+t[1]+",HAS"),this.purchasedItems.indexOf(t[1])<0&&this.purchasedItems.push(t[1]),this.makeAsPurchased(t[0],t[1]),this.app.fire("IdleManager:Set","Cosmetics",this.currentlyActiveItems),this.app.fire("IdleManager:Set","PurchasedItems",this.purchasedItems);var s=`${JSON.stringify(this.bundleCustomizationData(pc.IdleManager.Customizations,pc.IdleManager.Cosmetics))}`;this.app.fire("NetworkManager:Send","updateCustomizations",s),Utils.addEvent("skin",t[0])}else this.camera.enabled=!1,this.app.fire("PopupManager:Show","NoEnoughDiamonds");else if(pc.IdleManager.Coin>=parseInt(t[2])){e.model=t[1];i=this.cosmeticItems.find((t=>t.models&&t.models.id==e.model));e.growth=i.growth,this.app.fire("IdleManager:Add","Coin",-1*parseInt(t[2])),this.setItem(t[0]+","+t[1]+",HAS"),this.purchasedItems.indexOf(t[1])<0&&this.purchasedItems.push(t[1]),this.makeAsPurchased(t[0],t[1]),this.app.fire("IdleManager:Set","Cosmetics",this.currentlyActiveItems),this.app.fire("IdleManager:Set","PurchasedItems",this.purchasedItems);s=`${JSON.stringify(this.bundleCustomizationData(pc.IdleManager.Customizations,pc.IdleManager.Cosmetics))}`;this.app.fire("NetworkManager:Send","updateCustomizations",s),Utils.addEvent("skin",t[0])}else this.camera.enabled=!1,this.app.fire("PopupManager:Show","NoEnoughMoney")}})):this.currentlyActiveItems.forEach((e=>{if(e.categoryName==t[0]){e.model=t[1];var a=this.cosmeticItems.find((t=>t.models&&t.models.id==e.model));e.growth=a.growth,this.setItem(t[0]+","+t[1]+",HAS"),this.purchasedItems.indexOf(t[1])<0&&this.purchasedItems.push(t[1]),this.makeAsPurchased(t[0],t[1]),this.app.fire("IdleManager:Set","Cosmetics",this.currentlyActiveItems),this.app.fire("IdleManager:Set","PurchasedItems",this.purchasedItems);var i=`${JSON.stringify(this.bundleCustomizationData(pc.IdleManager.Customizations,pc.IdleManager.Cosmetics))}`;this.app.fire("NetworkManager:Send","updateCustomizations",i),Utils.addEvent("skin",t[0])}}))},CosmeticsManager.prototype.playRewardAd=function(){var e=this,t=""==this.selectedItem?null:this.selectedItem.split(",");1===parseInt(t[3])?PokiPlugin.showReward((function(){e.makeReward(t)})):PokiPlugin.showLargeRewardWithoutGameplay((function(){e.makeReward(t)}))},CosmeticsManager.prototype.makeReward=function(e){var t=e.join(",");this.selectedItem=t,this.buyItem("Reward")},CosmeticsManager.prototype.updateEquipped=function(e,t){var a=(e=this.getCategoryByName(e)).container;if(a){var i=a.findByName("Content");i&&i.children.forEach((e=>{var a=e.findByName("Equipped");a&&(e.name==t?a.enabled=!0:a.enabled=!1)}))}this.updateBuyButton(e.button,!1)},CosmeticsManager.prototype.makeAsPurchased=function(e,t){var a=this.getCategoryByName(e).container;if(a){var i=a.findByName(t);if(i){var s=i.findByName("BackgroundImage"),n=i.findByName("PriceDisplay"),r=i.findByName("DiamondDisplay");s.script.button.value=`${e},${t},HAS`,n.enabled=!1,r.enabled=!1,this.updateEquipped(e,t)}}},CosmeticsManager.prototype.createPopup=function(){this.categories.forEach((e=>{this.createCategory(e.categoryName,e.container,e,e.firstItemDefault)}))},CosmeticsManager.prototype.createCategory=function(e,t,a,i){var s=t;s.name=e,this.createItems(e,s,a,i)},CosmeticsManager.prototype.formatPrice=function(e){return 0===e?"FREE":Utils.numberScaleWithoutFloat(e)},CosmeticsManager.prototype.createItems=function(e,t,a,i){var s=t.findByName("Item"),n=t.findByName("Content"),r=a.models,o=a.prices,d=a.diamonds,m=a.descriptions,c=a.growth,p=a.ads;if(i)r.forEach(((t,a)=>{if(0==a){var i=s.findByName("Background"),r=s.findByName("BackgroundImage"),l=s.findByName("Description"),u=s.findByName("PriceDisplay"),h=s.findByName("DiamondDisplay"),y=this.app.assets.find(t.name+".png",pc.ASSET_TEXTURE);s.name=t.id+"",s.adsCount=0,i.element.textureAsset=y,r.script.button.value=`${e},${t.id},HAS,${p[a]},${c[a]},${d[a]}`,u.enabled=!1,h.enabled=!1,l.enabled=!1}else if(this.purchasedItems.indexOf(t.id+"")>=0){i=(g=s.clone()).findByName("Background"),r=g.findByName("BackgroundImage"),u=g.findByName("PriceDisplay"),h=g.findByName("DiamondDisplay"),l=g.findByName("Description"),y=this.app.assets.find(t.name+".png",pc.ASSET_TEXTURE);g.name=t.id+"",g.adsCount=0,o[a]=0,i.element.textureAsset=y,r.script.button.value=`${e},${t.id},HAS,${p[a]},${c[a]},${d[a]}`,u.enabled=!1,h.enabled=!1,l.enabled=!1,l.element.key=m[a],n.addChild(g)}else{i=(g=s.clone()).findByName("Background"),r=g.findByName("BackgroundImage");var g,f=g.findByName("Price");g.findByName("Diamond"),l=g.findByName("Description"),u=g.findByName("PriceDisplay"),h=g.findByName("DiamondDisplay");g.name=t.id+"",g.adsCount=0;y=this.app.assets.find(t.name+".png",pc.ASSET_TEXTURE);if(i.element.textureAsset=y,r.script.button.value=`${e},${t.id},${o[a]},${p[a]},${c[a]},${d[a]}`,f.element.text=this.formatPrice(o[a]),p[a]>0||d[a]>0?(h.enabled=!0,u.enabled=!1):(h.enabled=!1,u.enabled=!0),l.enabled=!1,l.element.key=m[a],"Footballer"==t.name){var I=this.app.root.findByTag("TutorialFinger")[0].clone();I.enabled=!1,I.setLocalScale(.3,.3,.3),I.setLocalPosition(-24,-10,0),I.name="SelectFootballer",g.addChild(I),this.app.fire("TutorialManager:AddFinger",I)}n.addChild(g)}}));else{r.forEach(((t,a)=>{if(this.purchasedItems.indexOf(t.id+"")>=0){var i=(g=s.clone()).findByName("Background"),r=g.findByName("BackgroundImage"),l=g.findByName("PriceDisplay"),u=g.findByName("DiamondDisplay"),h=g.findByName("Description"),y=this.app.assets.find(t.name+".png",pc.ASSET_TEXTURE);g.name=t.id+"",g.adsCount=0,o[a]=0,i.element.textureAsset=y,r.script.button.value=`${e},${t.id},HAS,${p[a]},${c[a]}`,l.enabled=!1,u.enabled=!1,h.enabled=!1,h.element.key=m[a],n.addChild(g)}else{i=(g=s.clone()).findByName("Background"),r=g.findByName("BackgroundImage"),h=g.findByName("Description");var g,f=g.findByName("Price"),I=g.findByName("Diamond");l=g.findByName("PriceDisplay"),u=g.findByName("DiamondDisplay");d[a]>0?(l.enabled=!1,u.enabled=!0):(l.enabled=!0,u.enabled=!1),g.name=t.id+"",g.adsCount=0;y=this.app.assets.find(t.name+".png",pc.ASSET_TEXTURE);i.element.textureAsset=y,r.script.button.value=`${e},${t.id},${o[a]},${p[a]},${c[a]},${d[a]}`,f.element.text=this.formatPrice(o[a]),I.element.text=this.formatPrice(d[a]),h.enabled=!1,h.element.key=m[a],n.addChild(g)}}));var l=s.findByName("Background"),u=(l=s.findByName("Background"),s.findByName("BackgroundImage")),h=s.findByName("PriceDisplay"),y=s.findByName("Description");l.setLocalPosition(pc.Vec3.ZERO),l.element.textureAsset=this.removeImage.id,l.element.width=40,l.element.height=40,u.script.button.value=`${e},null`,h.enabled=!1,y.enabled=!1,s.adsCount=0}n.element.height=90*r.length},CosmeticsManager.prototype.bundleCustomizationData=function(e,t){var a={};return e.forEach((e=>{var t=Object.keys(e)[0];a[t]=e[t]})),a.cosmetics=t,a},CosmeticsManager.prototype.updateBuyButton=function(e,t,a=!1){var i=t?new pc.Color(0,.918,.114):new pc.Color(.584,.584,.584),s=e.findByTag("ButtonUI"),n=e.findByName("PriceNumber"),r=e.findByName("DiamondNumber"),o=e.findByName("Price"),d=e.findByName("Diamond"),m=e.findByName("Text"),c=e.findByName("SelectItem");if(e.element.useInput=t,s.forEach((e=>e.element.color=i)),t&&""!==this.selectedItem){o.enabled=!0,m.enabled=!0,c.enabled=!1;var p=this.selectedItem.split(",");n.element.text=p[2],r.element.text=p[5],p[5]>-1?(o.enabled=!1,d.enabled=!0):(o.enabled=!0,d.enabled=!1)}else d.enabled=!1,o.enabled=!1,m.enabled=!1,c.enabled=!0;a&&(d.enabled=!1,o.enabled=!1,m.enabled=!1,c.enabled=!0)},CosmeticsManager.prototype.updateRewardButtons=function(e){var t=this.selectedItem.split(",");if(""==this.selectedItem)return!1;(e=this.getCategoryByName(t[0])).container.findByName(t[1]);var a=parseInt(t[3]||0),i=e.rewardButton.findByName("Ads");i.element.text=1===a?"Watch Ad":a>1?"Watch Ads":"Free"},CosmeticsManager.prototype.updateButtons=function(e,t,a,i){var s=this.getCategoryByName(e),n=parseInt(t),r=parseInt(a),o=this.selectedItem.split(","),d=parseInt(o[3]||0);i||r>0||n>0?(s.button.enabled=!0,s.rewardButton.enabled=!1):d>0?(s.button.enabled=!1,s.rewardButton.enabled=!0,this.updateRewardButtons(s)):(s.button.enabled=!1,s.rewardButton.enabled=!1)},CosmeticsManager.prototype.getCategoryByName=function(e){for(var t=0;t<this.categories.length;t++){var a=this.categories[t];if(a.categoryName==e)return a}},CosmeticsManager.prototype.update=function(e){};var CosmeticsCamera=pc.createScript("cosmeticsCamera");CosmeticsCamera.attributes.add("manager",{type:"entity"}),CosmeticsCamera.attributes.add("textureElement",{type:"entity"}),CosmeticsCamera.attributes.add("characterEntity",{type:"entity"}),CosmeticsCamera.prototype.initialize=function(){this.app.on("CosmeticsCamera:PlaceCamera",this.placeCamera,this),this.app.on("PopupManager:Hide",this.hideCamera,this)},CosmeticsCamera.prototype.updateCameraRect=function(){var e=window.innerWidth,t=window.innerHeight,a=this.textureElement.element.canvasCorners[0].x,i=this.textureElement.element.canvasCorners[0].y,n=a/e,r=i/t,s=(this.textureElement.element.canvasCorners[2].x-a)/e,o=(i-this.textureElement.element.canvasCorners[3].y)/t;this.entity.camera.rect=new pc.Vec4(n,1-r,s,o)},CosmeticsCamera.prototype.placeCamera=function(e){this.entity.reparent(e),this.entity.setLocalPosition(pc.Vec3.ZERO),this.entity.setLocalRotation(pc.Quat.IDENTITY)},CosmeticsCamera.prototype.hideCamera=function(){this.entity.reparent(this.manager),this.entity.enabled=!1},CosmeticsCamera.prototype.update=function(e){this.updateCameraRect(),this.characterEntity.anim.setBoolean("Walking",!1)};var LevelManager=pc.createScript("levelManager");LevelManager.attributes.add("firstLevelHolder",{type:"entity"}),LevelManager.attributes.add("playerEntity",{type:"entity"}),LevelManager.attributes.add("levelPopup",{type:"entity"}),LevelManager.attributes.add("fishingManager",{type:"entity"}),LevelManager.attributes.add("cooldownTime",{type:"entity"}),LevelManager.attributes.add("noSaveLevels",{type:"string",array:!0}),LevelManager.attributes.add("firstPos",{type:"entity"}),LevelManager.attributes.add("secondPos",{type:"entity"}),LevelManager.attributes.add("thirdPos",{type:"entity"}),LevelManager.prototype.initialize=function(){this.startPosition=this.playerEntity.getPosition().clone(),this.currentLevel=this.getCurrentLevel(),this.unlockedLevels=this.getUnlockedLevels(),this.loadedLevel=!1,this.isLoadingLevel=!1,this.price=0,this.app.on("LevelManager:Trigger",this.onTrigger,this),this.app.on("LevelManager:Unlock",this.onUnlock,this),this.app.on("LevelManager:WatchAd",this.onWatchAd,this),this.app.on("LevelManager:LoadLevel",this.loadLevel,this),this.app.on("LevelManager:LoadLevelNoAds",this.loadLevelNoAds,this),this.app.on("LevelManager:OkayForLoadLevel",this.okayButtonForLoad,this),this.app.on("LevelManager:CustomLevel",this.setCustomLevel,this),this.loadLevel(this.currentLevel,!0)},LevelManager.prototype.setPodium=function(e){if(e&&e>0&&e<4){if(1==e){var t=this.firstPos.getPosition().clone();this.playerEntity.setPosition(t)}else if(2==e){t=this.secondPos.getPosition().clone();this.playerEntity.setPosition(t)}else if(3==e){t=this.thirdPos.getPosition().clone();this.playerEntity.setPosition(t)}this.app.fire("Camera:SetLook",0,0),this.playerEntity.script.player.isFocusing=!0,this.playerEntity.script.player.focusDirection=90,this.playerEntity.script.player.nextDirection=90,setTimeout((()=>{this.playerEntity.script.player.isFocusing=!1}),500)}else this.app.fire("Overlay:Message","You finished in rank #"+e+"!");pc.lastPvPRank=-1},LevelManager.prototype.onUnlock=function(e,t){var i=this;if(pc.IdleManager.Coin<this.price&&!t)return this.app.fire("PopupManager:Show","NoEnoughMoney"),!1;for(var n in this.app.fire("IdleManager:Add","Coin",-1*this.price),i.app.fire("IdleManager:Set","AdsWatchedLevel",0),i.app.fire("PopupManager:Hide"),i.addUnlockedLevel(e),i.unlockedLevels){if(i.unlockedLevels[n]==e)return i.loadLevel(e,!0),!1}},LevelManager.prototype.onWatchAd=function(e){var t=this;PokiPlugin.largeShowReward((function(){t.app.fire("IdleManager:Add","AdsWatchedLevel",1),t.levelPopup.findByName("Ads").element.text=pc.IdleManager.AdsWatchedLevel.toString()+" / "+t.adsRequired.toString(),t.onUnlock(e,!0)}))},LevelManager.prototype.onTrigger=function(e,t,i,n,a){for(var s in this.unlockedLevels){if(this.unlockedLevels[s]==e)return this.loadLevel(e,!1),!1}var l=this.app.assets.find(e+"-Thumbnail.jpg");if(!l)return console.error("Level thumbnail is not found"),!1;var o=this.levelPopup.findByName("AdButton"),r=this.levelPopup.findByName("BuyButton"),d=this.levelPopup.findByName("Message");pc.IdleManager.Strength<i?(d.enabled=!0,r.enabled=!1):(d.enabled=!1,r.enabled=!0),this.levelPopup.findByName("JoinButton").enabled=!1,this.price=t,this.adsRequired=a,o.script.button.value=e,r.script.button.value=e,this.levelPopup.findByName("GymName").element.text=n,this.levelPopup.findByName("Price").element.text="$ "+t.toString(),this.levelPopup.findByName("Icon").element.textureAsset=l,this.levelPopup.findByName("Ads").element.text=pc.IdleManager.AdsWatchedLevel.toString()+" / "+a.toString(),this.levelPopup.findByName("Strength").element.text=Utils.numberScale(i),0===this.price&&(this.levelPopup.findByName("AdButton").enabled=!1,this.levelPopup.findByName("BuyButton").enabled=!1,this.levelPopup.findByName("JoinButton").enabled=!0),this.app.fire("PopupManager:Show","UnlockLevel")},LevelManager.prototype.setCustomLevel=function(e,t){if(this.currentLevel&&"Level-1"!=this.currentLevel&&this.app.fire("SceneLoader:Unload",this.currentLevel),this.loadedLevel&&this.loadedLevel==e)return this.playerEntity.setPosition(this.startPosition),!1;this.loadedLevel=e,this.app.fire("World2Screen:Hide","Progress"),this.currentLevel=e,-1===this.noSaveLevels.indexOf(e)&&Utils.setItem("CurrentLevel",e),this.playerEntity.setPosition(this.startPosition),"Level-1"==e?this.firstLevelHolder.enabled=!0:(this.app.fire("SceneLoader:Load",e,t),this.firstLevelHolder.enabled=!1)},LevelManager.prototype.okayButtonForLoad=function(e){var t=Utils.getItem("LastBossFight");Date.now()-t<12e4?this.app.fire("PopupManager:Hide"):this.loadLevelNoAds(e)},LevelManager.prototype.loadLevelNoAds=function(e){if(!this.isLoadingLevel){var t=Utils.getItem("LastBossFight");Date.now();if(this.fishingManager.script.fishingManager.maxSlots==pc.IdleManager.Inventory.length)return this.app.fire("Overlay:Message","Inventory is full!"),!1;this.app.root.findByName("InviteButton").enabled=!0,this.isLoadingLevel=!0,this._doLoad(e),PokiPlugin.onPlayWithPrevent(),this.isLoadingLevel=!1}},LevelManager.prototype.loadLevel=function(e,t){var i=this;this.isLoadingLevel||(this.isLoadingLevel=!0,this.loadedLevel&&this.loadedLevel!==e&&!t?PokiPlugin.showMidroll((function(){i._doLoad(e),i.isLoadingLevel=!1})):(this._doLoad(e),this.isLoadingLevel=!1))},LevelManager.prototype._doLoad=function(e){if(this.currentLevel&&"Level-1"!=this.currentLevel&&this.app.fire("SceneLoader:Unload",this.currentLevel),this.loadedLevel&&this.loadedLevel==e)return-1!=pc.lastPvPRank?this.setPodium(pc.lastPvPRank):this.playerEntity.setPosition(this.startPosition),!1;this.loadedLevel=e,this.app.fire("World2Screen:Hide","Progress"),this.currentLevel=e,-1===this.noSaveLevels.indexOf(e)&&Utils.setItem("CurrentLevel",e),-1!=pc.lastPvPRank&&pc.lastPvPRank<4?this.setPodium(pc.lastPvPRank):this.playerEntity.setPosition(this.startPosition),"Level-1"==e?this.firstLevelHolder.enabled=!0:(this.app.fire("SceneLoader:Load",e),this.firstLevelHolder.enabled=!1),this.app.fire("NetworkManager:Connect",e),this.app.fire("Scan:Ground")},LevelManager.prototype.getCurrentLevel=function(){var e=Utils.getItem("CurrentLevel");return"Duel"==e&&(e="Level-1"),e&&"undefined"!=e?e:e="Level-1"},LevelManager.prototype.getUnlockedLevels=function(){var e=Utils.getItemAsArray("UnlockedLevels");return e.length>0||(e=["Level-1"],Utils.setItemAsArray("UnlockedLevels",e)),e},LevelManager.prototype.addUnlockedLevel=function(e){var t=Utils.getItemAsArray("UnlockedLevels");t.length>0&&(t.push(e),this.unlockedLevels=t,Utils.setItemAsArray("UnlockedLevels",t))};var Localization=pc.createScript("localization");Localization.attributes.add("languageName",{type:"entity"}),Localization.attributes.add("languages",{type:"json",schema:[{name:"name",type:"string"},{name:"code",type:"string"}],array:!0}),Localization.attributes.add("textElementTag",{type:"string",default:"localizedText"}),Localization.attributes.add("textElements",{type:"entity",array:!0}),Localization.attributes.add("useClientLanguage",{type:"boolean",default:!1}),Localization.attributes.add("fallbackLanguageIndex",{type:"number",default:0}),Localization.prototype.originalFontSizes={},Localization.prototype.initialize=function(){this.languageIndex=void 0,this.useClientLanguage&&void 0===this.languageIndex&&(this.languageIndex=this.detectClientLanguage()),void 0!==this.languageIndex&&null!==this.languageIndex||(this.languageIndex=this.fallbackLanguageIndex),this.languageIndex=pc.math.clamp(this.languageIndex,0,this.languages.length-1),this.app.on("Localization:Switch",this.onSwitch,this),this.app.on("Scan:Ground",this.onSceneLoaded,this),this.storeOriginalFontSizes(),this.setLanguage(this.languageIndex)},Localization.prototype.detectClientLanguage=function(){var t=navigator.language||navigator.userLanguage;if(!t)return this.fallbackLanguageIndex;var e=this.languages.map((function(t){return t.code})),a=this.app.i18n.findAvailableLocale(t,e);if(a)for(var n=0;n<this.languages.length;n++)if(this.languages[n].code===a)return n;return this.fallbackLanguageIndex},Localization.prototype.storeOriginalFontSizes=function(){if(this.textElements&&this.textElements.length)for(var t=0;t<this.textElements.length;t++){var e=this.textElements[t];if(e&&e.element){var a=e.getGuid();this.originalFontSizes[a]=e.element.fontSize}}},Localization.prototype.onSwitch=function(t){"Left"==t?this.languageIndex--:"Right"==t&&this.languageIndex++,this.languageIndex=pc.math.clamp(this.languageIndex,0,this.languages.length-1),this.setLanguage(this.languageIndex)},Localization.prototype.setLanguage=function(t){var e=this.languages[t];this.app.i18n.locale=e.code,this.languageName.element.text=e.name,this.adjustFontSizes(e.code),this.app.fire("IdleManager:Set","LanguageIndex",this.languageIndex)},Localization.prototype.onSceneLoaded=function(){this.findAndStoreTextElements(),this.languages&&this.languages[this.languageIndex]&&this.adjustFontSizes(this.languages[this.languageIndex].code)},Localization.prototype.findAndStoreTextElements=function(){var t=this.app.root.findByTag(this.textElementTag);if(t&&t.length)for(var e=0;e<t.length;e++){var a=t[e];if(a&&a.element){var n=a.getGuid();this.originalFontSizes[n]||(this.originalFontSizes[n]=a.element.fontSize)}}},Localization.prototype.adjustFontSizes=function(t){var e="en"===t||"en-US"===t||"en-GB"===t,a=this.app.root.findByTag(this.textElementTag);if(a&&a.length)for(var n=0;n<a.length;n++){var i=a[n];if(i&&i.element){var o=i.getGuid(),l=this.originalFontSizes[o];!l&&i.element.fontSize&&(this.originalFontSizes[o]=i.element.fontSize,l=i.element.fontSize),l&&(i.element.fontSize=e?l:l/1.5)}}},Localization.prototype.onEnable=function(){this.app.i18n&&this.app.i18n.locale&&this.adjustFontSizes(this.app.i18n.locale)};var Door=pc.createScript("door");Door.attributes.add("sceneName",{type:"string",default:"Level-2"}),Door.attributes.add("gymName",{type:"string",default:"Gym"}),Door.attributes.add("price",{type:"number",default:10}),Door.attributes.add("strength",{type:"number",default:10}),Door.attributes.add("adsRequired",{type:"number",default:4}),Door.prototype.initialize=function(){this.waitTimer=0,this.lastInteraction=Date.now(),this.entity.on("Trigger",this.onTrigger,this),this.entity.on("Leave",this.onLeave,this),this.app.on("PopupManager:Hide",this.onTimerReset,this),this.on("destroy",this.onDestroy,this)},Door.prototype.onDestroy=function(){this.app.off("PopupManager:Hide",this.onTimerReset,this)},Door.prototype.onTimerReset=function(){this.lastInteraction=Date.now(),this.waitTimer=0},Door.prototype.onTrigger=function(t,e){return!(Date.now()-this.lastInteraction<1e3)&&(this.waitTimer>1?(this.lastInteraction=Date.now(),this.app.fire("LevelManager:Trigger",this.sceneName,this.price,this.strength,this.gymName,this.adsRequired,!1),!1):(this.waitTimer+=2*e,this.app.fire("World2Screen:Show","Progress",this.entity),void this.app.fire("Progress:WaitFill",this.waitTimer)))},Door.prototype.onLeave=function(){this.app.fire("World2Screen:Hide","Progress",this.entity),this.waitTimer=0,this.lastInteraction=Date.now()-500};var FlyCamera=pc.createScript("flyCamera");FlyCamera.attributes.add("speed",{type:"number",default:10}),FlyCamera.attributes.add("fastSpeed",{type:"number",default:20}),FlyCamera.attributes.add("mode",{type:"number",default:0,enum:[{Lock:0},{Drag:1}]}),FlyCamera.prototype.initialize=function(){var e=this.entity.getLocalEulerAngles();this.ex=e.x,this.ey=e.y,this.moved=!1,this.lmbDown=!1,this.paintMode=!1,this.app.mouse.disableContextMenu(),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.on("MapManager:PaintMode",this.setPaintMode,this)},FlyCamera.prototype.setPaintMode=function(e){this.paintMode=e},FlyCamera.prototype.update=function(e){if(this.paintMode)return!1;this.entity.setLocalEulerAngles(this.ex,this.ey,0);var t=this.app,s=this.speed;t.keyboard.isPressed(pc.KEY_SHIFT)&&(s=this.fastSpeed),t.keyboard.isPressed(pc.KEY_UP)||t.keyboard.isPressed(pc.KEY_W)?this.entity.translateLocal(0,0,-s*e):(t.keyboard.isPressed(pc.KEY_DOWN)||t.keyboard.isPressed(pc.KEY_S))&&this.entity.translateLocal(0,0,s*e),t.keyboard.isPressed(pc.KEY_LEFT)||t.keyboard.isPressed(pc.KEY_A)?this.entity.translateLocal(-s*e,0,0):(t.keyboard.isPressed(pc.KEY_RIGHT)||t.keyboard.isPressed(pc.KEY_D))&&this.entity.translateLocal(s*e,0,0),t.keyboard.isPressed(pc.KEY_E)?this.entity.translateLocal(0,s*e,0):t.keyboard.isPressed(pc.KEY_Q)&&this.entity.translateLocal(0,-s*e,0)},FlyCamera.prototype.onMouseMove=function(e){if(this.paintMode)return!1;if(this.mode){if(!this.lmbDown)return}else if(!pc.Mouse.isPointerLocked())return;this.moved?(this.ex-=e.dy/5,this.ex=pc.math.clamp(this.ex,-90,90),this.ey-=e.dx/5):this.moved=!0},FlyCamera.prototype.onMouseDown=function(e){if(this.paintMode)return!1;0===e.button&&(this.lmbDown=!0,this.mode||pc.Mouse.isPointerLocked()||this.app.mouse.enablePointerLock())},FlyCamera.prototype.onMouseUp=function(e){if(this.paintMode)return!1;0===e.button&&(this.lmbDown=!1)};var ShoesManager=pc.createScript("shoesManager");ShoesManager.attributes.add("item",{type:"entity"}),ShoesManager.attributes.add("holder",{type:"entity"}),ShoesManager.attributes.add("shoeShop",{type:"entity"}),ShoesManager.attributes.add("randomShoeEntity",{type:"entity"}),ShoesManager.attributes.add("shoeEntityL",{type:"entity"}),ShoesManager.attributes.add("shoeEntityR",{type:"entity"}),ShoesManager.attributes.add("trails",{type:"entity"}),ShoesManager.attributes.add("shoesBoxManager",{type:"entity"}),ShoesManager.attributes.add("shoes",{type:"json",schema:[{name:"name",type:"string"},{name:"strenghtMultiplier",type:"number",default:1},{name:"coinMultiplier",type:"number",default:1}],array:!0}),ShoesManager.prototype.initialize=function(){this.item.enabled=!1,this.removeAll(),this.updatePopup(),this.app.on("ShoesManager:Equipped",this.onEquipped,this),this.app.on("ShoesManager:Merge",this.onMerge,this),this.app.on("ShoesManager:UnequipShoes",this.onUnequipShoes,this),this.app.on("Shoes:Purchase",this.onPurchase,this),this.app.on("ShoesManager:RewardShoe",this.rewardShoe,this)},ShoesManager.prototype.postInitialize=function(){var e=pc.IdleManager.Customizations;Array.isArray(e)?0==e.length&&(e=[{shoes:"DefaultShoe",level:0}]):e=[{shoes:"DefaultShoe",level:0}];var t=e.find((e=>1==e.hasOwnProperty("shoes")));t?t&&this.onEquipped(`${t.shoes},${t.level}`):this.onEquipped("DefaultShoe,0")},ShoesManager.prototype.rewardShoe=function(){var e=["Azure_Rush","Verdant_Stride","Blush_Breeze"];PokiPlugin.showReward((function(){var t=Utils.getRandom(e);pc.app.fire("Shoes:Purchase",t,1,"Common")})),this.randomShoeEntity.enabled=!1},ShoesManager.prototype.onMerge=function(e,t){var a=pc.IdleManager.PurchasedShoes,r=e.name.split(","),i=parseInt(r[1]),n=e.findByName("Equipped").enabled||t.findByName("Equipped").enabled,s=t.name.split(","),o=a[parseInt(s[1])];if(o.level+=1,t.fire("Glow"),t.findByName("LevelNumber").element.text=o.level+1,a.splice(i,1),e.destroy(),this.app.fire("IdleManager:Set","PurchasedShoes",a),this.renameAll(),n){var h=`${t.shoeData.name},${t.shoeData.level+1}`;this.onEquipped(h,t)}this.holder.element.height=this.holder.children.length/3*175},ShoesManager.prototype.onUnequipShoes=function(){this.onEquipped("DefaultShoe,0")},ShoesManager.prototype.onPurchase=function(e,t,a){var r=pc.IdleManager.PurchasedShoes;r.push({name:e,level:t,rarity:a}),this.app.fire("IdleManager:Set","PurchasedShoes",r),this.updatePopup()},ShoesManager.prototype.onEquipped=function(e,t){var a=e.split(","),r=a[0],i=parseInt(a[1]),n=this.getMultipliersByName(r);this.setShoe(this.shoeEntityL,r),this.setShoe(this.shoeEntityR,r),this.app.fire("Workout:UpdateShoesMultiplier",n.strenghtMultiplier+.5*i),this.app.fire("IdleManager:Set","ShoesMultiplier",n.strenghtMultiplier+.5*i);var s=pc.IdleManager.Customizations;Array.isArray(s)?0==s.length&&(s=[{shoes:"DefaultShoe",level:0}]):s=[{shoes:"DefaultShoe",level:0}];var o=s.find((e=>1==e.hasOwnProperty("shoes")));o?o&&(o.shoes=r,o.level=i):s.push({shoes:r,level:i}),this.app.fire("IdleManager:Set","Customizations",s);s=`${JSON.stringify(this.bundleCustomizationData(pc.IdleManager.Customizations,pc.IdleManager.Cosmetics))}`;this.app.fire("NetworkManager:Send","updateCustomizations",s),this.activeItem(r,t)},ShoesManager.prototype.setShoe=function(e,t){var a=this.app.assets.findByTag("Shoes").find((e=>e.name==t));if(a){e.render.asset=a;var r=this.app.assets.find(a.name,pc.ASSET_MATERIAL);e.render.materialAssets=[r];var i=e.findByTag("Trail")[0];i&&i.destroy();var n=this.trails.findByName(a.name);if(n){var s=n.clone();e.addChild(s),s.setLocalPosition(0,.012,-.01),s.enabled=!0}}},ShoesManager.prototype.updatePopup=function(){var e=pc.IdleManager.PurchasedShoes;for(var t in this.removeAll(),e){var a=e[t],r=this.holder.findByName(a.name+t);r||((r=this.item.clone()).enabled=!0,this.holder.addChild(r)),r.name=a.name+","+t,r.shoeData=a;var i=r.findByName("LevelNumber"),n=r.findByName("Icon"),s=r.findByName("Name"),o=r.findByName("FrontBackground"),h=this.app.assets.find(a.name+"_thumb.png"),l=a.name.split("_");l=l.join(" "),r.script.mergeItem.value=`${a.name},${a.level}`,i.element.text=a.level+1,n.element.textureAsset=h,s.element.text=l,o.element.color=this.getRarityColor(a.rarity)}this.holder.element.height=this.holder.children.length/3*175},ShoesManager.prototype.activeItem=function(e,t){if(t)for(var a=this.holder.children.length-1;a>=0;a--){(s=(n=this.holder.children[a]).findByName("Equipped"))&&(n.name==t.name?s.enabled=!0:s.enabled=!1)}else if(!t&&e){var r=e,i=!1;for(a=this.holder.children.length-1;a>=0;a--){var n,s;(s=(n=this.holder.children[a]).findByName("Equipped"))&&(n.name.includes(r)&&!i?(s.enabled=!0,i=!0):s.enabled=!1)}}this.clearHolder()},ShoesManager.prototype.getRarityColor=function(e){for(var t=this.shoesBoxManager.script.shoesBoxManager.colorsForRarities,a=0;a<t.length;a++){var r=t[a];if(r.rarity==e)return r.color}return pc.Color.GRAY},ShoesManager.prototype.getMultipliersByName=function(e){for(var t in this.shoes){var a=this.shoes[t];if(a.name==e)return{strenghtMultiplier:a.strenghtMultiplier,coinMultiplier:a.coinMultiplier}}return{strenghtMultiplier:1,coinMultiplier:1}},ShoesManager.prototype.clearHolder=function(){for(var e=pc.IdleManager.PurchasedShoes,t=this.holder.children.length-1;t>=0;t--){var a=this.holder.children[t];-1==e.indexOf(a.shoeData)&&a.enabled&&"UnequipShoes"!=a.name&&a.destroy()}},ShoesManager.prototype.removeAll=function(){for(var e=this.holder.children.length-1;e>=0;e--){var t=this.holder.children[e];t.tags.has("MergeItem")&&"UnequipShoes"!=t.name&&"Item"!=t.name&&t.destroy()}},ShoesManager.prototype.renameAll=function(){var e=pc.IdleManager.PurchasedShoes,t=this.holder.findByTag("MergeItem");t.splice(0,1);for(var a=0;a<e.length;a++){var r=t[a],i=e[a];"UnequipShoes"!=r.name&&"Item"!=r.name&&(r.name=i.name+","+a)}},ShoesManager.prototype.bundleCustomizationData=function(e,t){var a={};return e.forEach((e=>{var t=Object.keys(e)[0];a[t]=e[t]})),a.cosmetics=t,a},ShoesManager.prototype.update=function(e){};var MobileUi=pc.createScript("mobileUi");MobileUi.attributes.add("position",{type:"vec3",default:[0,0,0]}),MobileUi.attributes.add("scale",{type:"vec3",default:[1,1,1]}),MobileUi.attributes.add("preset",{type:"number",enum:[{Default:0},{"Top Left Anchor":1},{"Top Left Anchor & Pivot":2},{"Top Anchor":3},{"Top Anchor & Pivot":4},{"Top Right Anchor":5},{"Top Right Anchor & Pivot":6},{"Left Anchor":7},{"Left Anchor & Pivot":8},{"Center Anchor":9},{"Center Anchor & Pivot":10},{"Right Anchor":11},{"Right Anchor & Pivot":12},{"Bottom Left Anchor":13},{"Bottom Left Anchor & Pivot":14},{"Bottom Anchor":15},{"Bottom Anchor & Pivot":16},{"Bottom Right Anchor":17},{"Bottom Right Anchor & Pivot":18}],default:0}),MobileUi.attributes.add("visible",{type:"boolean",default:!0}),MobileUi.attributes.add("desktopVisible",{type:"boolean",default:!0}),MobileUi.prototype.postInitialize=function(){if(Utils.isMobile()){this.entity.enabled=this.visible,0===this.position.x&&0===this.position.y&&0===this.position.z||this.entity.setLocalPosition(this.position),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||this.entity.setLocalScale(this.scale);var t=this.entity.element;if(t){var i=this.getPresetValues(this.preset);i&&(t.anchor=i.anchor,t.pivot=i.pivot)}}else this.entity.enabled=this.desktopVisible},MobileUi.prototype.getPresetValues=function(t){var i=[[0,1,0,1],[.5,1,.5,1],[1,1,1,1],[0,.5,0,.5],[.5,.5,.5,.5],[1,.5,1,.5],[0,0,0,0],[.5,0,.5,0],[1,0,1,0]];if(0===t)return null;if(t%2==1)return{anchor:i[(t-1)/2],pivot:[.5,.5]};var e=(t-2)/2;return{anchor:i[e],pivot:[[0,1],[.5,1],[1,1],[0,.5],[.5,.5],[1,.5],[0,0],[.5,0],[1,0]][e]}};var ShoesBox=pc.createScript("shoesBox");ShoesBox.attributes.add("shoesList",{type:"json",schema:[{name:"name",type:"string"},{name:"chance",type:"number"}],array:!0}),ShoesBox.attributes.add("boxType",{type:"string"}),ShoesBox.attributes.add("price",{type:"number"}),ShoesBox.attributes.add("icon",{type:"asset",assetType:"texture"}),ShoesBox.attributes.add("waitTime",{type:"number",default:1}),ShoesBox.attributes.add("firstFree",{type:"boolean",default:!1}),ShoesBox.attributes.add("coinsForAd",{type:"number",default:30,description:"The amount of coins player needs to open box by watching ad"}),ShoesBox.prototype.initialize=function(){this.entity.on("Trigger",this.onTrigger,this),this.entity.on("Leave",this.onLeave,this),this.waitTimer=0,this.isFired=!1},ShoesBox.prototype.onTrigger=function(e,t){if(this.waitTimer<this.waitTime)this.waitTimer+=t,this.app.fire("World2Screen:Show","Progress",this.entity),this.app.fire("Progress:WaitFill",this.waitTimer/this.waitTime);else if(!this.isFired){var i=!1;if(this.firstFree)Utils.getItem("FirstOpen_"+this.boxType)||(i=!0);this.app.fire("ShoeBoxManager:Show",{shoesList:this.shoesList,boxType:this.boxType,price:this.price,icon:this.icon,coinsForAd:this.coinsForAd,free:i}),this.isFired=!0,this.app.fire("World2Screen:Hide","Progress",this.entity)}},ShoesBox.prototype.onLeave=function(e){this.app.fire("World2Screen:Hide","Progress",this.entity),this.waitTimer=0,this.isFired=!1};var Leaderboard=pc.createScript("leaderboard");Leaderboard.attributes.add("strengthLeaderboardHolder",{type:"entity"}),Leaderboard.attributes.add("strengthDefaultItemEntity",{type:"entity"}),Leaderboard.prototype.initialize=function(){this.allItems=[],this.strengthDefaultItemEntity.enabled=!1,this.app.on("Leaderboard:Update",this.onLeaderboardUpdate,this),this.on("destroy",this.onDestroy,this)},Leaderboard.prototype.onDestroy=function(){this.app.off("Leaderboard:Update",this.onLeaderboardUpdate,this)},Leaderboard.prototype.onLeaderboardUpdate=function(e){this.clearLeaderboards(),this.renderLeaderboard(e.fishLeaderboard,this.strengthLeaderboardHolder,this.strengthDefaultItemEntity)},Leaderboard.prototype.renderLeaderboard=function(e,t,a){var r=0;for(var d in e){if(r>=8)break;var o=e[d];if(o){var i=a.clone();i.findByName("Place").element.text="#"+(parseInt(d)+1),i.findByName("Username").element.text=o.username,i.findByName("Fishes").element.text=o.fishes,i.enabled=!0,t.addChild(i),this.allItems.push(i),r++}}},Leaderboard.prototype.clearLeaderboards=function(){for(var e=this.allItems.length;e--;)this.allItems[e].destroy();this.allItems=[]},Leaderboard.prototype.update=function(e){};var ShoesBoxManager=pc.createScript("shoesBoxManager");ShoesBoxManager.attributes.add("popup",{type:"entity"}),ShoesBoxManager.attributes.add("newShoesPopup",{type:"entity"}),ShoesBoxManager.attributes.add("shoeEntityL",{type:"entity"}),ShoesBoxManager.attributes.add("shoeEntityR",{type:"entity"}),ShoesBoxManager.attributes.add("trails",{type:"entity"}),ShoesBoxManager.attributes.add("colorsForRarities",{type:"json",schema:[{name:"rarity",type:"string"},{name:"color",type:"rgb"}],array:!0}),ShoesBoxManager.prototype.initialize=function(){this.currentPrice=0,this.currentBoxType=null,this.currentRarity=null,this.currentShoesList=[],this.currentAsset=null,this.itemEntities=[],this.app.on("ShoeBoxManager:Show",this.onShow,this),this.app.on("ShoeBoxManager:Purchase",this.onPurchase,this),this.app.on("ShoeBoxManager:Eqiup",this.eqiupShoes,this),this.app.on("ShoeBoxManager:Ok",this.onOk,this),this.app.on("PopupManager:Hide",this.onPopupHide,this),this.app.on("ShoeBoxManager:TestPurchaseBox",this.purchaseBox,this),this.on("destroy",this.onDestroy,this)},ShoesBoxManager.prototype.onDestroy=function(){this.app.off("ShoeBoxManager:Show",this.onShow,this),this.app.off("ShoeBoxManager:Purchase",this.onPurchase,this),this.app.off("ShoeBoxManager:Eqiup",this.eqiupShoes,this),this.app.off("ShoeBoxManager:Ok",this.onOk,this),this.app.off("PopupManager:Hide",this.onPopupHide,this),this.app.off("ShoeBoxManager:TestPurchaseBox",this.purchaseBox,this)},ShoesBoxManager.prototype.onShow=function(e){if(e){this.currentShoesList=e.shoesList,this.currentBoxType=e.boxType,this.popup.findByName("BuyButton").enabled=!1,this.popup.findByName("FreeButton").enabled=!1,this.popup.findByName("AdButton").enabled=!1,e.free?this.popup.findByName("FreeButton").enabled=!0:e.coinsForAd&&pc.IdleManager.Coin<this.currentPrice?this.popup.findByName("AdButton").enabled=!0:this.popup.findByName("BuyButton").enabled=!0,this.popup.findByName("Icon").element.textureAsset=e.icon,this.popup.findByName("PriceValue").element.text=e.price,this.currentPrice=e.price;var t=this.popup.findByName("ShoesList"),o=this.popup.findByName("ShoesItem");for(var i in o.enabled=!1,this.clearHolder(this.itemEntities),e.shoesList){var n=e.shoesList[i],a=o.clone();a.name=n.name,a.enabled=!0,a.findByName("Text").element.key=n.chance+"%",a.findByName("Icon").element.textureAsset=this.app.assets.find(n.name+"_thumb.png",pc.ASSET_TEXTURE);var s=this.app.assets.findByTag("Shoes");for(var r in s){var h=s[r];h.name==n.name&&(rarity=h.tags.list()[1])}for(var p=0;p<this.colorsForRarities.length;p++){var u=this.colorsForRarities[p];u.rarity==rarity&&(a.findByName("Shadow").element.color=u.color)}this.itemEntities.push(a),t.addChild(a)}this.app.fire("PopupManager:Show","ShoesBox")}},ShoesBoxManager.prototype.onPopupHide=function(){var e=this.popup.findByName("Icon"),t=this.newShoesPopup.findByName("Icon");e.element.textureAsset=null,e.element.texture=null,t.element.textureAsset=null,t.element.texture=null},ShoesBoxManager.prototype.onPurchase=function(e){var t=this;return"Free"==e?(this.purchaseBox(this.currentShoesList),Utils.setItem("FirstOpen_"+this.currentBoxType,Date.now()),this.popup.findByName("BuyButton").enabled=!0,this.popup.findByName("FreeButton").enabled=!1,this.popup.findByName("AdButton").enabled=!1,!1):"Ad"==e?(PokiPlugin.showReward((function(){t.purchaseBox(t.currentShoesList)})),!1):void(pc.IdleManager.Coin>=this.currentPrice?(this.app.fire("IdleManager:Add","Coin",-1*this.currentPrice),this.purchaseBox(this.currentShoesList)):this.app.fire("PopupManager:Show","NoEnoughMoney"))},ShoesBoxManager.prototype.purchaseBox=function(e){var t=0;for(var o in e){(a=e[o]).name&&a.chance&&(a.chancePositionStart=t,t+=a.chance,a.chancePositionEnd=t)}if(t<=0)return!1;var i=e[0],n=Math.random()*t;for(var o in e){var a;n>=(a=e[o]).chancePositionStart&&n<a.chancePositionEnd&&(i=a)}var s="Common",r=this.app.assets.findByTag("Shoes");for(var h in r){var p=r[h];p.name==i.name&&(s=p.tags.list()[1])}this.currentRarity=s,this.setUpNewShoesPopup(i),this.app.fire("Shoes:Purchase",i.name,0,s),this.app.fire("PopupManager:Show","NewShoes")},ShoesBoxManager.prototype.setUpNewShoesPopup=function(e){var t=e.name.split("_");t=t.join(" ");var o=this.currentRarity,i=this.app.assets.find(e.name+"_thumb.png",pc.ASSET_TEXTURE),n=this.getCurrentLevel(),a=this.newShoesPopup.findByName("Name"),s=this.newShoesPopup.findByName("Rarity"),r=this.newShoesPopup.findByName("Icon"),h=this.newShoesPopup.findByName("Background"),p=this.newShoesPopup.findByName("EqiupButton");a.element.text=t+" -",s.element.key=o,r.element.textureAsset=i,p.script.button.value=`${e.name},${n}`;for(var u=0;u<this.colorsForRarities.length;u++){var c=this.colorsForRarities[u];c.rarity==o&&(h.element.color=c.color)}},ShoesBoxManager.prototype.eqiupShoes=function(e){this.app.fire("ShoesManager:Equipped",e),this.app.fire("PopupManager:Hide"),this.app.fire("Player:Jump")},ShoesBoxManager.prototype.onOk=function(){this.app.fire("PopupManager:Show","ShoesBox")},ShoesBoxManager.prototype.getCurrentLevel=function(){var e=Utils.getItem("CurrentLevel");if(e&&"undefined"!=e){var t=e.split("-");return parseInt(t[1])}return e=1},ShoesBoxManager.prototype.getRandomElement=function(e){if(Array.isArray(e)&&e.length>0){return e[Math.floor(Math.random()*e.length)]}console.error("Array is empty or not valid")},ShoesBoxManager.prototype.clearHolder=function(e){for(var t in e){e[t].destroy()}this.itemEntities=[]};var TutorialManager=pc.createScript("tutorialManager");TutorialManager.attributes.add("container",{type:"entity"}),TutorialManager.attributes.add("rightTutorialEntities",{type:"entity",array:!0}),TutorialManager.attributes.add("leftTutorialEntities",{type:"entity",array:!0}),TutorialManager.attributes.add("arrow",{type:"entity"}),TutorialManager.attributes.add("tutorialGoals",{type:"json",array:!0,schema:[{name:"arrowPosition",type:"entity",array:!0},{name:"listenEvent",type:"string"},{name:"goalParameter",type:"string"},{name:"parameterThresholdFunction",type:"string"},{name:"fingersToActivate",type:"string",array:!0},{name:"fingerEvents",type:"string",array:!0},{name:"fingerParameters",type:"string",array:!0},{name:"fingerThresholdFunctions",type:"string",array:!0},{name:"isDone",type:"boolean",default:!1}]}),TutorialManager.prototype.initialize=function(){Utils.getItem("FirstLogin");this.arrow.enabled=!1,this.fingers=this.app.root.findByTag("TutorialFinger"),this.isInTutorial=!1,this.goalReached=!1;var t=pc.IdleManager.TutorialIndex;if(t<this.tutorialGoals.length&&(this.isInTutorial=!0,this.storedEventListeners=[],this.goal=this.tutorialGoals[t],this.currentTutorial=t,this.startTutorial()),this.app.on("TutorialManager:AddFinger",this.addFinger,this),!Utils.isMobile())return this.container.enabled=!1,this.enableTutorialEntities("Right",!1),this.enableTutorialEntities("Left",!1),!1;this.container.enabled=!0,this.enableTutorialEntities("Right",!0),this.enableTutorialEntities("Left",!1),this.isRotated=!1,this.app.on("TouchManager:MovementMove",this.touchGuideHandlerMove,this),this.app.on("TouchManager:RotationMove",this.touchGuideHandlerRotate,this)},TutorialManager.prototype.addFinger=function(t){this.fingers.push(t)},TutorialManager.prototype.touchGuideHandlerMove=function(){if(!this.isRotated)return!1;this.enableTutorialEntities("Left",!1)},TutorialManager.prototype.touchGuideHandlerRotate=function(){var t=this;if(this.isRotated)return!1;this.isRotated=!0,setTimeout((function(){t.enableTutorialEntities("Right",!1),t.enableTutorialEntities("Left",!0)}),2e3)},TutorialManager.prototype.enableTutorialEntities=function(t,e){var i;for(var r in i="Right"==t?this.rightTutorialEntities:this.leftTutorialEntities){var a=i[r];a&&(a.enabled=e)}},TutorialManager.prototype.startTutorial=function(){if(this.goalReached=!1,this.goal=this.tutorialGoals[this.currentTutorial],!this.goal)return this.removeFingerEventListeners(),this.app.fire("Arrow:Hide"),void(this.isInTutorial=!1);this.goal.arrowPosition.length>0?(this.arrow.enabled=!0,this.app.fire("Arrow:Show"),this.arrow.fire("Arrow:SetPointer",this.goal.arrowPosition)):(this.app.fire("Arrow:Hide"),this.arrow.enabled=!1),this.app.on(this.goal.listenEvent,this.onParameterChange,this),this.activateFingers()},TutorialManager.prototype.onParameterChange=function(t){if(this.goal){var e=this.goal.goalParameter;if(e){var i,r=pc.IdleManager[e];void 0===r&&(r=t);try{i=new Function("parameter",this.goal.parameterThresholdFunction)}catch(t){return void console.error("Invalid threshold function:",t)}i(r)&&this.onGoalReached()}}},TutorialManager.prototype.onGoalReached=function(){this.goalReached=!0,this.removeFingerEventListeners(),this.currentTutorial++,this.startTutorial(),this.app.fire("IdleManager:Set","TutorialIndex",this.currentTutorial)},TutorialManager.prototype.activateFingers=function(){var t=this.goal.fingersToActivate,e=this.goal.fingerEvents,i=this.goal.fingerThresholdFunctions,r=this.goal.fingerParameters;this.storedEventListeners=[];for(var a=0;a<t.length;a++){var n,o=e[a].split(","),s=t[a],h=i[a],l=r[a];try{n=new Function("parameter, parameter2",h)}catch(u){console.error("Error creating threshold function for:",s,u);continue}for(var u=0;u<o.length;u++){var g=o[u].trim();(function(t,e,i,r){var a=function eventListenerFunction(i){var a=r.split(","),n=pc.IdleManager[a[0]],o=a[1]?pc.IdleManager[a[1]]:void 0;e(void 0!==n?n:i,o)&&this.activateFinger(t)}.bind(this);this.app.on(i,a),this.storedEventListeners.push({eventName:i,listener:a})}).bind(this)(s,n,g,l)}}},TutorialManager.prototype.activateFinger=function(t){for(var e=0;e<this.fingers.length;e++)this.fingers[e].enabled=!1;for(e=0;e<this.fingers.length;e++)if(this.fingers[e].name===t&&this.isInTutorial)return void(this.fingers[e].enabled=!0)},TutorialManager.prototype.removeFingerEventListeners=function(){if(this.storedEventListeners){for(var t=0;t<this.storedEventListeners.length;t++){var e=this.storedEventListeners[t];this.app.off(e.eventName,e.listener)}this.storedEventListeners=[]}},TutorialManager.prototype.update=function(t){pc.inPvpMode&&(this.arrow.enabled=!1)};var MergeItem=pc.createScript("mergeItem");MergeItem.attributes.add("action",{type:"string"}),MergeItem.attributes.add("value",{type:"string"}),MergeItem.attributes.add("overlay",{type:"entity"}),MergeItem.attributes.add("scrollView",{type:"entity"}),MergeItem.attributes.add("timeout",{type:"number",default:.25}),MergeItem.attributes.add("sendEntity",{type:"boolean",default:!1}),MergeItem.prototype.initialize=function(){this.timer=0,this.isMouseDown=!1,this.isPickedUp=!1,this.screen=this.entity.element.screen?this.entity.element.screen.screen:null,this.currentCopy=null,this.mergeTo=null,this.holder=this.scrollView.findByName("Holder"),this.entity.element.on("touchstart",this.onDown,this),this.app.touch&&(this.app.touch.on("touchmove",this.onMove,this),this.app.touch.on("touchend",this.onUp,this)),this.entity.element.on("mouseenter",this.onHover,this),this.entity.element.on("mouseleave",this.onLeave,this),this.entity.element.on("mousedown",this.onDown,this),this.app.mouse.on("mousemove",this.onMove,this),this.app.mouse.on("mouseup",this.onUp,this),this.on("state",this.onStageChange,this),this.app.on("MergeItem:SetMergeItems",this.setMergeItems,this),this.on("destroy",this.onDestroy,this)},MergeItem.prototype.onDestroy=function(){this.app.mouse.off("mousemove",this.onMove,this),this.app.mouse.off("mouseup",this.onUp,this),this.app.off("MergeItem:SetMergeItems",this.setMergeItems,this)},MergeItem.prototype.setMergeItems=function(e){this.mergeItems=e},MergeItem.prototype.onStageChange=function(){this.lockAfterAction&&(this.entity.button.active=!0)},MergeItem.prototype.trigger=function(){var e=this;if(this.entity.button&&!this.entity.button.active)return!1;Utils.waitForChanges((function(){e.sendEntity?(e.app.fire(e.action,e.value,e.entity),e.entity.fire("Button:Click",e.action,e.value)):(e.app.fire(e.action,e.value),e.entity.fire("Button:Click",e.action,e.value))})),pc.lastClickTime=Date.now()},MergeItem.prototype.onHover=function(){document.body.style.cursor="pointer"},MergeItem.prototype.onLeave=function(){document.body.style.cursor="default"},MergeItem.prototype.onDown=function(e){if(e.hasOwnProperty("touches")){var t=e.event,i=(e=e.touches[0]).clientX-this.app.graphicsDevice.canvas.width/2,s=this.app.graphicsDevice.canvas.height/2-e.clientY;this.lastXY={x:i,y:s},t.stopPropagation()}else{e.event.stopImmediatePropagation();i=e.x-this.app.graphicsDevice.canvas.width/2,s=this.app.graphicsDevice.canvas.height/2-e.y;this.lastXY={x:i,y:s}}this.timer=0,this.isPickedUp=!1,this.isMouseDown=!0},MergeItem.prototype.onMove=function(e){var t=e.event;if(e.hasOwnProperty("touches")&&(t.stopPropagation(),e=e.touches[0]),this.isPickedUp&&this.currentCopy){var i=this.app.graphicsDevice,s=this.currentCopy.element.anchor.x*i.width,o=this.currentCopy.element.anchor.y*i.height,r=this.screen?1/this.screen.scale:1,n=(e.x-s)*r,h=(-e.y+o)*r;this.currentCopy.setLocalPosition(n,h,0),this.checkForMerge(e.x,e.y),this.mouseY=e.y,t.stopImmediatePropagation()}},MergeItem.prototype.onUp=function(e){e.event.stopImmediatePropagation(),this.timer<this.timeout&&this.isMouseDown&&this.trigger(),this.isMouseDown=!1,this.isPickedUp=!1,this.currentCopy&&(this.mergeTo&&this.entity!=this.mergeTo&&this.mergeTo.shoeData.level==this.currentCopy.shoeData.level&&this.mergeTo.shoeData.name==this.currentCopy.shoeData.name&&this.app.fire("ShoesManager:Merge",this.entity,this.mergeTo),this.currentCopy.destroy(),this.currentCopy=null),this.scrollView.scrollview.vertical=!0},MergeItem.prototype.checkForMerge=function(e,t){if(this.mergeItems=this.holder.findByTag("MergeItem"),this.mergeItems)for(var i=0;i<this.mergeItems.length;i++){var s=this.mergeItems[i],o=s.element.canvasCorners,r=o[3],n=o[1];if(r.x<e&&n.x>e&&r.y<t&&n.y>t&&"Item"!=s.name)return this.mergeTo=s,!1;this.mergeTo=null}},MergeItem.prototype.autoScroll=function(e){if(e&&this.currentCopy){var t=this.scrollView.element.canvasCorners[0],i=this.scrollView.element.canvasCorners[2],s=this.scrollView.scrollview._getMaxScrollValue(pc.ORIENTATION_VERTICAL);t.y-50<e&&this.scrollView.scrollview.scroll.y<s&&(this.scrollView.scrollview.scroll=this.scrollView.scrollview.scroll.add(new pc.Vec2(0,.01))),i.y+50>e&&this.scrollView.scrollview.scroll.y>0&&(this.scrollView.scrollview.scroll=this.scrollView.scrollview.scroll.sub(new pc.Vec2(0,.01)))}},MergeItem.prototype.update=function(e){if(this.desabled)return!1;if(this.isMouseDown&&(this.timer+=e,this.timer>=this.timeout&&!this.isPickedUp)){this.scrollView.scrollview.vertical=!1,this.currentCopy=this.entity.clone(),this.currentCopy.script.mergeItem.desabled=!0,this.currentCopy.element.anchor=new pc.Vec4(.5,.5,.5,.5),this.currentCopy.element.pivot=new pc.Vec2(.5,.5),this.currentCopy.children.forEach((e=>{e.element.opacity=.5})),this.currentCopy.shoeData=this.entity.shoeData,this.currentCopy.findByName("Equipped").enabled=!1;var t=new pc.Vec3(this.lastXY.x,this.lastXY.y,0);this.currentCopy.setLocalPosition(t),this.overlay.addChild(this.currentCopy),this.isPickedUp=!0}this.autoScroll(this.mouseY)};var Glow=pc.createScript("glow");Glow.prototype.initialize=function(){this.entity.parent.on("Glow",this.startGlow,this)},Glow.prototype.startGlow=function(){for(var t=this.entity.children.length-1;t>=0;t--){var i=this.entity.children[t];i.enabled=!0,i.element.opacity=0}this.isStartGlow=!0},Glow.prototype.update=function(t){if(this.isStartGlow)for(var i=this.entity.children.length-1;i>=0;i--){(e=this.entity.children[i]).element.opacity+=.01,e.element.opacity>=1&&(this.isEndGlow=!0,this.isStartGlow=!1)}if(this.isEndGlow){for(i=this.entity.children.length-1;i>=0;i--){var e;(e=this.entity.children[i]).element.opacity-=.01}e.element.opacity<=0&&(this.isEndGlow=!1,e.enabled=!1)}};var RewardManager=pc.createScript("rewardManager");RewardManager.attributes.add("sideDisplayEntity",{type:"entity"}),RewardManager.attributes.add("waitingTime",{type:"number",default:30}),RewardManager.attributes.add("coolDown",{type:"number",default:20}),RewardManager.attributes.add("physicalStation",{type:"entity"}),RewardManager.attributes.add("status",{type:"entity"}),RewardManager.attributes.add("minuteNumber",{type:"entity"}),RewardManager.attributes.add("collectBtn",{type:"entity"}),RewardManager.attributes.add("coinDisplay",{type:"entity"}),RewardManager.attributes.add("player",{type:"entity"}),RewardManager.attributes.add("coinsPerLvl",{type:"number",array:!0}),RewardManager.attributes.add("unlockables",{type:"json",schema:[{name:"title",type:"string"},{name:"icon",type:"asset",assetType:"texture"},{name:"event",type:"string"},{name:"value",type:"string"},{name:"color",type:"rgb"}],array:!0}),RewardManager.prototype.initialize=function(){this.sideDisplayEntity.enabled=!1,this.isWaiting=!0,this.isSideDisplay=!0,this.timerComplete=!1,this.currentSideDisplay=0,this.sideDisplayTime=0,this.coolDownTime=0,this.app.on("RewardManager:Collect",this.collect,this),this.app.on("RewardManager:CollectCoins",this.showPopup,this),this.app.on("RewardManager:UnlockUpgrade",this.onUnlockUpgrade,this),this.app.on("RewardManager:TryGetUpgrade",this.onTryUpgrade,this),this.app.on("NetworkManager:Connect",this.getRewardSpawnPos,this),this.app.on("SceneLoader:Load",this.getRewardSpawnPos,this),this.app.on("SceneLoader:Unload",this.getRewardSpawnPos,this),this.sideDisplayEntity.findByName("Time").script.time.start=parseFloat(this.waitingTime+""),this.app.fire("Timeline:RewardTimer@Time",this.waitingTime),this.startTimer()},RewardManager.prototype.startTimer=function(){this.timerComplete=!1,this.sideDisplayTime=0,this.isWaiting=!0,this.app.fire("Timeline:RewardTimer@Reset"),this.app.fire("Timeline:RewardTimer"),this.setupPhysicalStation(!1)},RewardManager.prototype.setupPhysicalStation=function(t){var e=this.unlockables[this.currentSideDisplay];this.currentPhysicalStation&&this.currentPhysicalStation.destroy(),this.currentPhysicalStation=this.physicalStation.clone(),this.currentPhysicalStation.script.interaction.eventName=e.event,this.currentPhysicalStation.script.interaction.string=e.value,this.currentPhysicalStation.enabled=t,this.entity.addChild(this.currentPhysicalStation),this.getRewardSpawnPos()},RewardManager.prototype.setupSideDisplay=function(){var t=pc.IdleManager.Rods.length||1,e=this.coinsPerLvl[t-1],i=this.unlockables[this.currentSideDisplay],a=this.sideDisplayEntity.findByName("Icon"),s=this.sideDisplayEntity.findByName("Text"),n=this.sideDisplayEntity.findByName("UnlockUpgradeButton"),r=(this.sideDisplayEntity.findByName("Inner"),this.sideDisplayEntity.findByName("Time"));a.element.textureAsset=i.icon,s.element.key=`${e} Coins`,n.script.button.value=e,n.script.button.action=i.event,r.script.time.time=0,this.sideDisplayEntity.fire("Timeline",{isReverse:!1})},RewardManager.prototype.onTryUpgrade=function(){if(this.isWaiting&&!this.timerComplete)return!1;this.onUnlockUpgrade(this.unlockables[this.currentSideDisplay].value)},RewardManager.prototype.showPopup=function(){var t=pc.IdleManager.Rods.length||1,e=this.coinsPerLvl[t-1];this.minuteNumber.element.text=t;var i=this.status.findByName("Amount");i&&this.animateValue(i.element,0,e,500,30),this.app.fire("PopupManager:Show","PassiveEarnings");var a=this.sideDisplayEntity.findByName("Time");this.updateButtons(a.script.time.time<1)},RewardManager.prototype.collect=function(){var t=this;PokiPlugin.showReward((function(){t.makeEarning()}))},RewardManager.prototype.makeEarning=function(){for(var t=pc.IdleManager.Rods.length||1,e=this.coinsPerLvl[t-1],i=0;i<50;i++)setTimeout((function(t){pc.app.fire("World2Screen:Animate","Coin",t.player.getPosition(),t.coinDisplay)}),5*i,this);pc.app.fire("IdleManager:Add","Coin",parseInt(e)),this.app.fire("PopupManager:Hide"),this.hideSideDisplay()},RewardManager.prototype.updateButtons=function(t){var e=this.collectBtn.findByTag("ButtonUI");if(t){this.collectBtn.element.useInput=!0;for(var i=0;i<e.length;i++)e[i].element.color=(new pc.Color).fromString("#228CE6")}else{this.collectBtn.element.useInput=!1;for(i=0;i<e.length;i++)e[i].element.color=pc.Color.GRAY}},RewardManager.prototype.onUnlockUpgrade=function(t){var e=this;PokiPlugin.showReward((function(){e.makeUnlockUpgrade(t)}))},RewardManager.prototype.makeUnlockUpgrade=function(t){this.hideSideDisplay(),this.app.fire("BoostManager:AddRewardPowerUp",t)},RewardManager.prototype.startSideDisplay=function(){this.isSideDisplay=!0,this.startTimer()},RewardManager.prototype.stopSideDisplay=function(){this.sideDisplayEntity.enabled=!1,this.isSideDisplay=!1,this.currentPhysicalStation&&(this.currentPhysicalStation.enabled=!1)},RewardManager.prototype.animateValue=function(t,e,i,a,s){s=s||30;var n=i-e,r=e,o=0,p=setInterval((function(){o++,r=Math.floor(e+n*(o/s)),t.text="+"+r,o>=s&&(clearInterval(p),t.text="+"+i)}),a/s)},RewardManager.prototype.showSideDisplay=function(){this.sideDisplayEntity.enabled=!0,this.setupSideDisplay(),this.currentPhysicalStation&&(this.currentPhysicalStation.enabled=!0),this.timerComplete=!0,this.sideDisplayAutoHideTimer&&clearTimeout(this.sideDisplayAutoHideTimer),this.sideDisplayAutoHideTimer=setTimeout((()=>{this.sideDisplayEntity.enabled&&this.hideSideDisplay()}),6e4)},RewardManager.prototype.getRewardSpawnPos=function(){clearTimeout(this.connectionTimer),this.connectionTimer=setTimeout((t=>{for(var e=t.app.root.findByTag("RewardSpawnPos"),i=0;i<e.length;i++)if(e[i].enabled){t.lastRewardpos=e[i].getPosition();break}t.currentPhysicalStation&&(t.currentPhysicalStation.setPosition(t.lastRewardpos.x,t.lastRewardpos.y,t.lastRewardpos.z),t.currentPhysicalStation.enabled=t.timerComplete)}),500,this)},RewardManager.prototype.hideSideDisplay=function(){this.sideDisplayEntity.fire("Timeline",{isReverse:!0}),this.sideDisplayEntity.enabled=!1,this.currentPhysicalStation&&this.currentPhysicalStation.destroy(),this.isWaiting=!1,this.timerComplete=!1,this.sideDisplayTime=0,this.coolDownTime=0,this.currentSideDisplay=(this.currentSideDisplay+1)%this.unlockables.length},RewardManager.prototype.updateSideDisplay=function(t){this.isSideDisplay&&(this.isWaiting?(this.sideDisplayTime+=t,this.sideDisplayTime>=this.waitingTime&&!this.timerComplete&&this.showSideDisplay()):(this.coolDownTime+=t,this.coolDownTime>=this.coolDown&&(this.startTimer(),this.isWaiting=!0)))},RewardManager.prototype.update=function(t){if(pc.inPvpMode)return this.sideDisplayEntity&&(this.sideDisplayEntity.enabled=!1),this.currentPhysicalStation&&(this.currentPhysicalStation.enabled=!1),!1;this.updateSideDisplay(t)};var Arrow=pc.createScript("arrow");Arrow.prototype.initialize=function(){this.pointers=[],this.arrow=this.entity.findByName("Arrow"),this.entity.on("Arrow:SetPointer",this.setPointerEntities,this),this.app.on("Arrow:Hide",this.hide,this),this.app.on("Arrow:Show",this.show,this),this.isHidden=!1},Arrow.prototype.setPointerEntities=function(t){this.pointers=t},Arrow.prototype.findNearestPointer=function(){for(var t=null,i=Number.MAX_VALUE,e=0;e<this.pointers.length;e++){var n=this.pointers[e];if(n){var o=this.entity.getPosition().distance(n.getPosition());o<i&&(i=o,t=n)}}return t},Arrow.prototype.hide=function(){this.isHidden=!0},Arrow.prototype.show=function(){this.isHidden=!1},Arrow.prototype.onShow=function(){if(this.pointers.length>0){var t=this.findNearestPointer();if(t){var i=t.getPosition().sub(this.entity.getPosition());i.normalize(),this.entity.setEulerAngles(0,180*Math.atan2(i.x,i.z)/Math.PI-90,0),this.entity.enabled=!0;var e=this.entity.getPosition().sub(t.getPosition()).length(),n=this.entity.findByName("Line"),o=this.entity.findByName("Model");e>1.5&&!this.isHidden?(n.enabled=!0,o.enabled=!0,n.setLocalScale(.06,.45,e)):(n.enabled=!1,o.enabled=!1)}}},Arrow.prototype.update=function(){this.onShow()};var PhysicalAdsManager=pc.createScript("physicalAdsManager");PhysicalAdsManager.attributes.add("coolDownTime",{type:"number",default:5,placeholder:"In Seconds"}),PhysicalAdsManager.attributes.add("getRewardPopup",{type:"entity"}),PhysicalAdsManager.attributes.add("ads",{type:"json",schema:[{name:"name",type:"string"},{name:"title",type:"string"},{name:"icon",type:"asset",assetType:"texture"},{name:"color",type:"rgb"},{name:"description",type:"string"},{name:"event",type:"string"},{name:"parameter",type:"string"},{name:"value",type:"number"}],array:!0}),PhysicalAdsManager.prototype.initialize=function(){this.adsStations=this.app.root.findByTag("AdsStation"),this.app.on("PhysicalAdsManager:onInteraction",this.onInteraction,this),this.app.on("PhysicalAdsManager:onReward",this.onReward,this)},PhysicalAdsManager.prototype.onInteraction=function(t){if(this.currentAd=this.findAdByName(t),!this.currentAd)return!1;var e=this.getRewardPopup.findByName("Title"),a=this.getRewardPopup.findByName("Icon"),n=this.getRewardPopup.findByName("Description");e.element.key=this.currentAd.title,a.element.textureAsset=this.currentAd.icon,a.element.color=this.currentAd.color,n.element.key=this.currentAd.description,this.app.fire("PopupManager:Show","GetReward")},PhysicalAdsManager.prototype.onReward=function(t){var e=this;PokiPlugin.showReward((function(){e.makeReward(t)}))},PhysicalAdsManager.prototype.makeReward=function(t){if(!this.currentAd)return!1;var e=this;this.updateAdsStations(!1),this.app.fire(this.currentAd.event,this.currentAd.parameter,this.currentAd.value),this.coolDownTimer=setTimeout((function(){e.updateAdsStations(!0)}),1e3*this.coolDownTime)},PhysicalAdsManager.prototype.updateAdsStations=function(t){this.coolDownTimer&&clearTimeout(this.coolDownTimer);for(var e=0;e<this.adsStations.length;e++){this.adsStations[e].enabled=t}},PhysicalAdsManager.prototype.findAdByName=function(t){for(var e=0;e<this.ads.length;e++){var a=this.ads[e];if(a.name==t)return a}},PhysicalAdsManager.prototype.update=function(t){};var MergeFinger=pc.createScript("mergeFinger");MergeFinger.attributes.add("holder",{type:"entity"}),MergeFinger.prototype.initialize=function(){this.items=this.holder.children,this._items=this.holder.children,this.time=0,this.searchDuplicates(),this.app.on("PopupManager:Show",this.updateItems,this)},MergeFinger.prototype.searchDuplicates=function(){let e=[];for(let t=this.items.length-1;t>=0;t--){let i=this.items[t];if(i.shoeData)for(let s=t-1;s>=0;s--){let t=this.items[s];if(t.shoeData&&t.shoeData.name===i.shoeData.name&&t.shoeData.level===i.shoeData.level&&t.shoeData.rarity===i.shoeData.rarity){e.push(i),e.push(t);break}}}e.length>1&&(this.itemFrom=e[0],this.itemTo=e[1])},MergeFinger.prototype.updateItems=function(){this.items=this.holder.children,setTimeout((function(e){e.items=e.holder.children,e.searchDuplicates()}),1500,this)},MergeFinger.prototype.update=function(e){if(this.itemFrom&&this.itemTo){this.time+=.5*e;var t=this.itemTo.getPosition().clone(),i=this.itemFrom.getPosition().clone(),s=(new pc.Vec3).lerp(i,t,this.time);this.entity.setPosition(s),this.time>1&&(this.time=0)}else this.items=this.holder.children,this.searchDuplicates()};var Time=pc.createScript("time");Time.attributes.add("start",{type:"number",default:0}),Time.attributes.add("direction",{type:"string",default:"Forward",enum:[{Forward:"Forward"},{Backward:"Backward"}]}),Time.attributes.add("startEvent",{type:"string"}),Time.attributes.add("endEvent",{type:"string"}),Time.attributes.add("value",{type:"string"}),Time.prototype.initialize=function(){this.startEventTriggered=!1,this.endEventTriggered=!1,this.time=parseFloat(this.start+""),this.startEvent&&!this.startEventTriggered&&(this.app.fire(this.startEvent,this.value),this.startEventTriggered=!0)},Time.prototype.onStateChange=function(){this.startEventTriggered=!1,this.endEventTriggered=!1,this.time=parseFloat(this.start+"")},Time.prototype.update=function(t){"Forward"==this.direction?this.time+=t:this.time-=t,"Backward"==this.direction&&this.endEvent&&this.time<=0&&!this.endEventTriggered&&(this.app.fire(this.endEvent,this.value),this.endEventTriggered=!0),this.entity.element&&(this.entity.element.text=Utils.mmss(this.time))};var Tabs=pc.createScript("tabs");Tabs.attributes.add("tabEntity",{type:"entity"}),Tabs.attributes.add("tabs",{type:"string",array:!0}),Tabs.attributes.add("scrollView",{type:"entity"}),Tabs.attributes.add("vipColorBackground",{type:"rgba"}),Tabs.attributes.add("vipColorText",{type:"rgba"}),Tabs.prototype.initialize=function(){this.tabEntities=[],this.tabEntity.enabled=!1,this.createTabs(),this.tabEntities.length>0&&this.tabEntities[0].script.button&&this.onButtonPress(this.tabEntities[0].script.button),this.app.on("Tabs:CreateTabs",this.addTabs,this),this.app.on("Tabs:Select",this.selectTab,this),this.app.on("Tabs:SelectMenu",this.selectMenu,this)},Tabs.prototype.selectTab=function(t){for(var i=0;i<this.tabEntities.length;i++)this.tabEntities[i].element.opacity=t===i?1:0},Tabs.prototype.selectMenu=function(t){if((this.menuTabEntities||(this.menuTabEntities=this.app.root.findByTag("Tab"),this.menuTabEntities&&0!==this.menuTabEntities.length))&&this.scrollView&&this.scrollView.scrollview){var i=this;this.menuTabEntities.forEach((function(e){e.name==t?(e.enabled=!0,i.scrollView.scrollview.contentEntity=e):e.enabled=!1})),this.selectTab(t)}},Tabs.prototype.selectTab=function(t){this.tabEntities&&0!==this.tabEntities.length||(this.tabEntities=this.app.root.findByTag("TabBtn")),this.tabEntities.forEach((i=>{i.element.opacity=i.name===t?1:0}))},Tabs.prototype.createTabs=function(){this.tabEntities.forEach((function(t){t.destroy()})),this.tabEntities=[];for(var t=0;t<this.tabs.length;t++){var i=this.tabEntity.clone();i.name=this.tabs[t],i.script.button.value=this.tabs[t],i.on("Button:Click",this.onButtonPress,this),i.findByName("Text").element.text=this.tabs[t],"VIP"==i.name&&(i.element.color=this.vipColorBackground,i.findByName("Text").element.color=this.vipColorText,i.findByName("Text").element.shadowColor=new pc.Color(this.vipColorText.r,this.vipColorText.g,this.vipColorText.b,.5)),i.enabled=!0,this.entity.addChild(i),this.tabEntities.push(i)}this.tabEntities.length>0&&this.tabEntities[0].script.button&&this.onButtonPress(this.tabEntities[0].script.button),this.entity.element.width=150*this.tabEntities.length},Tabs.prototype.addTabs=function(t){this.tabs=[];for(var i=0;i<t.length;i++)t[i]&&this.tabs.push(t[i]);this.createTabs()},Tabs.prototype.onButtonPress=function(t){for(var i=0;i<this.tabEntities.length;i++)this.tabEntities[i].element.opacity=0,"VIP"==this.tabEntities[i].name&&(this.tabEntities[i].element.opacity=.9);t.entity.element.opacity=1};var ShopManager=pc.createScript("shopManager");ShopManager.attributes.add("scrollView",{type:"entity"}),ShopManager.attributes.add("playerEntity",{type:"entity"}),ShopManager.attributes.add("maxVIPAds",{type:"number",default:4}),ShopManager.attributes.add("buttonEntVIP",{type:"entity"}),ShopManager.attributes.add("purchasedTextVIP",{type:"entity"}),ShopManager.prototype.initialize=function(){this.app.on("Shop:Interaction",this.onInteraction,this),this.app.on("Shop:SelectMenu",this.selectMenu,this),this.app.on("Shop:GetVIP",this.getVIP,this),this.app.on("Shop:EquipAura",this.equipAura,this),this.adsWatchedVIP=pc.IdleManager.AdsWatchedVIP||0,this.auraItems=this.app.root.findByTag("AuraItems"),setTimeout((function(e){Array.isArray(pc.IdleManager.CurrentAuraEquippedArray)||(pc.IdleManager.CurrentAuraEquippedArray=[],e.app.fire("IdleManager:Set","CurrentAuraEquippedArray",[])),e.adsWatchedVIP>=e.maxVIPAds&&!pc.IdleManager.CurrentAuraEquippedArray.includes(0)&&(pc.IdleManager.CurrentAuraEquippedArray.push(0),e.app.fire("IdleManager:Set","CurrentAuraEquippedArray",pc.IdleManager.CurrentAuraEquippedArray))}),500,this)},ShopManager.prototype.onInteraction=function(e){this.selectMenu(e),this.app.fire("PopupManager:Show","Shop")},ShopManager.prototype.selectMenu=function(e){this.menuTabEntities||(this.menuTabEntities=this.app.root.findByTag("ShopTab"));var t=this;this.menuTabEntities.forEach((function(a){a.name==e?(a.enabled=!0,t.scrollView.scrollview.contentEntity=a):a.enabled=!1})),this.selectTab(e)},ShopManager.prototype.selectTab=function(e){this.tabEntities&&0!==this.tabEntities.length||(this.tabEntities=this.app.root.findByTag("ShopTabBtn")),this.tabEntities.forEach((t=>{t.element.opacity=t.name===e?1:0})),"Aura"===e?this.updateAuraUI():"VIP"==e&&this.applyVIP()},ShopManager.prototype.getVIP=function(){var e=this;this.isWatchingAds=!0,PokiPlugin.showReward((function(){e.adsWatchedVIP+=1,e.app.fire("IdleManager:Add","AdsWatchedVIP",1),e.applyVIP(),setTimeout((function(){e.isWatchingAds=!1}),500)}))},ShopManager.prototype.applyVIP=function(){pc.IdleManager.AdsWatchedVIP||this.app.fire("IdleManager:Set","AdsWatchedVIP",0);var e=this.buttonEntVIP.findByName("Text");if(e&&e.element&&(e.element.text=this.adsWatchedVIP.toString()+" / "+this.maxVIPAds.toString()),this.adsWatchedVIP>=this.maxVIPAds){this.purchasedTextVIP.enabled=!0,this.buttonEntVIP.enabled=!1;var t=this.auraItems[0];if(t&&0!==pc.IdleManager.CurrentAuraEquipped){var a=t.findByName("EquipButton"),r=t.findByName("Locked");a&&(a.enabled=!0),r&&(r.enabled=!1),this.equipUnlockedAura(t.script.aura.auraIndex,t.script.aura.moneyMultiplier,t.script.aura.workoutMultiplier)}}else this.purchasedTextVIP.enabled=!1,this.buttonEntVIP.enabled=!0},ShopManager.prototype.updateAuraUI=function(){var e=pc.IdleManager.Strength,t=pc.IdleManager.Coin,a=pc.IdleManager.CurrentAuraEquippedArray||[],r=pc.IdleManager.CurrentAuraEquipped;this.auraItems.forEach((n=>{var i=n.script.aura.auraIndex,p=a.includes(i),u=r===i,s=n.script.aura.requiredStrength,d=n.script.aura.price;if(this.setComponentEnabled(n,"Locked",!0),this.setComponentEnabled(n,"BuyButton",!1),this.setComponentEnabled(n,"AdButton",!1),this.setComponentEnabled(n,"EquipButton",!1),this.setComponentEnabled(n,"EquippedText",!1),0===i){var o=this.adsWatchedVIP>=this.maxVIPAds;this.setComponentEnabled(n,"Locked",!o),this.setComponentEnabled(n,"EquipButton",o&&!u),this.setComponentEnabled(n,"EquippedText",o&&u)}else p?(this.setComponentEnabled(n,"Locked",!1),this.setComponentEnabled(n,"EquipButton",!u),this.setComponentEnabled(n,"EquippedText",u)):e>=s&&(this.setComponentEnabled(n,"Locked",!1),t>=d?this.setComponentEnabled(n,"BuyButton",!0):this.setComponentEnabled(n,"AdButton",!0))}))},ShopManager.prototype.equipAura=function(e,t,a,r,n){var i=e.script.aura.auraIndex;if(pc.IdleManager.CurrentAuraEquippedArray.includes(i))this.equipUnlockedAura(i,t,a);else if(0===i&&this.adsWatchedVIP<this.maxVIPAds)this.updateAuraUI();else{var p=pc.IdleManager.Strength,u=pc.IdleManager.Coin;p<e.script.aura.requiredStrength?this.updateAuraUI():u>=r?(pc.IdleManager.CurrentAuraEquippedArray.push(i),this.app.fire("IdleManager:Set","CurrentAuraEquippedArray",pc.IdleManager.CurrentAuraEquippedArray),this.app.fire("IdleManager:Add","Coin",-r),this.equipUnlockedAura(i,t,a)):this.handleAdUnlock(e,t,a,n)}},ShopManager.prototype.handleAdUnlock=function(e,t,a,r){this.isWatchingAds=!0;var n=e.findByName("AdButton").findByName("Text"),i=this;PokiPlugin.showReward((function(){e.adValue=(e.adValue||0)+1,n&&n.element&&(n.element.text=`${e.adValue} / ${r}`),e.adValue>=r&&(pc.IdleManager.CurrentAuraEquippedArray.push(e.script.aura.auraIndex),i.equipUnlockedAura(e.script.aura.auraIndex,t,a)),i.updateAuraUI(),setTimeout((()=>{i.isWatchingAds=!1}),500)}))},ShopManager.prototype.equipUnlockedAura=function(e,t,a){pc.IdleManager.CurrentAuraEquipped=e,this.app.fire("IdleManager:Set","CurrentAuraEquipped",e),this.playerEntity.fire("Player:SetAura",e),this.applyAuraEffects(t,a),this.updateAuraUI()},ShopManager.prototype.applyAuraEffects=function(e,t){this.app.fire("IdleManager:Set","WorkoutMultiplier",t),this.app.fire("IdleManager:Set","EarningMultiplier",e),this.app.fire("Earning:UpdateVIPMultiplier"),this.app.fire("Workout:UpdateVIPMultiplier")},ShopManager.prototype.setComponentEnabled=function(e,t,a){var r=e.findByName(t);r&&(r.enabled=a)};var BoostManager=pc.createScript("boostManager");BoostManager.attributes.add("powerUpsContainer",{type:"entity"}),BoostManager.attributes.add("powerUpItem",{type:"entity"}),BoostManager.attributes.add("powerUpDisplay",{type:"entity"}),BoostManager.attributes.add("boostsDisplay",{type:"entity"}),BoostManager.attributes.add("playerEntity",{type:"entity"}),BoostManager.attributes.add("powerUps",{type:"json",schema:[{name:"name",type:"string"},{name:"icon",type:"asset",assetType:"texture"},{name:"price",type:"number"},{name:"ads",type:"number"},{name:"boost",type:"number"},{name:"description",type:"string"},{name:"activeDuration",type:"number"},{name:"waitingDuration",type:"number"}],array:!0}),BoostManager.prototype.initialize=function(){this.generateBoosts(),this.updateBoosts(),this.currentPowerUps=[],this.updateMultiplier(),this.app.on("BoostManager:BuyPowerUp",this.onBuyPowerUp,this),this.app.on("BoostManager:AddRewardPowerUp",this.onAddRewardPowerUp,this),this.app.on("BoostManager:RewardPowerUp",this.onRewardPowerUp,this),this.app.on("BoostManager:EndPowerUp",this.onEndPowerUp,this),this.app.on("BoostManager:EndCoolDown",this.onEndCoolDown,this),this.app.on("BoostManager:UpdateBoostDisplay",this.updateBoostsDisplay,this),this.app.on("Challenge:Accept",this.hideDisplay,this),this.app.on("IdleManager:Add",this.updateBoosts,this),this.app.on("IdleManager:Set",this.updateBoosts,this)},BoostManager.prototype.updateBoostsDisplay=function(e){e?this.updateMultiplier():this.boostsDisplay.enabled=!1},BoostManager.prototype.generateBoosts=function(){for(var e=0;e<this.powerUps.length;e++){var t=this.powerUps[e],o=this.powerUpItem.clone();e<this.powerUps.length-2&&(o.enabled=!0),o.findByName("Icon").element.textureAsset=t.icon,o.findByName("Name").element.key=t.description;var a=o.findByName("BuyButton");a.script.button.value=t.name,a.findByName("Text").element.key="Buy $"+t.price;var n=o.findByName("AdButton");n.script.button.value=t.name,n.findByName("Text").element.text=`0 / ${t.ads}`,t.entity=o,t.unlockedAds=0,t.isActive=!1,t.coolDownTime=60*(t.activeDuration+t.waitingDuration),t.displayPowerUpEntity=null,this.powerUpsContainer.addChild(o)}this.powerUpItem.enabled=!1},BoostManager.prototype.updateBoosts=function(){for(var e=0;e<this.powerUps.length;e++){var t=this.powerUps[e],o=t.entity,a=o.findByName("BuyButton"),n=o.findByName("AdButton");t.price<=pc.IdleManager.Coin?(a.enabled=!0,n.enabled=!1):(a.enabled=!1,n.enabled=!0),t.isActive&&(a.enabled=!1,n.enabled=!1)}},BoostManager.prototype.onBuyPowerUp=function(e){var t=this.findPowerUpByName(e);t.price<=pc.IdleManager.Coin&&(this.app.fire("IdleManager:Add","Coin",-1*t.price),this.addPowerUp(t))},BoostManager.prototype.onAddRewardPowerUp=function(e){var t=this.findPowerUpByName(e);this.addPowerUp(t)},BoostManager.prototype.onRewardPowerUp=function(e){var t=this;PokiPlugin.showReward((function(){t.makeReward(e)}))},BoostManager.prototype.makeReward=function(e){var t=this.findPowerUpByName(e);t.unlockedAds++,t.unlockedAds==t.ads&&this.addPowerUp(t),t.entity.findByName("AdButton").findByName("Text").element.text=`${t.unlockedAds} / ${t.ads}`},BoostManager.prototype.addPowerUp=function(e){e.isActive=!0,e.unlockedAds=0;var t=e.entity,o=t.findByName("BuyButton"),a=t.findByName("AdButton"),n=t.findByName("CoolDown");o.enabled=!1,a.enabled=!1,n.enabled=!0;var i=this.powerUpDisplay.clone();e.displayPowerUpEntity=i,i.enabled=!0,i.findByName("Icon").element.textureAsset=e.icon;var r=i.findByName("Time");r.script.time.value=e.name,r.script.time.start=parseFloat(60*e.activeDuration+""),r.script.time.fire("state"),this.boostsDisplay.addChild(i),this.currentPowerUps.push(e),"SpeedBoost"==e.name?this.playerEntity.fire("Player:SetSpeedMultiplier",1.5):"Aura"==e.name&&this.playerEntity.fire("Player:SetAura",8,!0),this.updateMultiplier()},BoostManager.prototype.onEndPowerUp=function(e){var t=this.findPowerUpByName(e);t.displayPowerUpEntity&&(t.displayPowerUpEntity.destroy(),t.displayPowerUpEntity=null),"SpeedBoost"==e?this.playerEntity.fire("Player:SetSpeedMultiplier",1):"Aura"==t.name&&this.playerEntity.fire("Player:SetAura",-1,!0),this.updateMultiplier()},BoostManager.prototype.onEndCoolDown=function(e){var t=this.findPowerUpByName(e);t.isActive=!1,t.coolDownTime=60*(t.activeDuration+t.waitingDuration);var o=t.entity,a=o.findByName("BuyButton"),n=o.findByName("AdButton"),i=o.findByName("CoolDown");t.price<=pc.IdleManager.Coin?(a.enabled=!0,n.enabled=!1):(a.enabled=!1,n.enabled=!0),i.enabled=!1;for(let e=this.currentPowerUps.length-1;e>=0;e--)this.currentPowerUps[e].name===t.name&&this.currentPowerUps.splice(e,1)},BoostManager.prototype.findPowerUpByName=function(e){for(var t=0;t<this.powerUps.length;t++){var o=this.powerUps[t];if(o.name==e)return o}},BoostManager.prototype.updateMultiplier=function(){var e=1,t=!1;for(let a=this.currentPowerUps.length-1;a>=0;a--){var o=this.currentPowerUps[a];"Aura"==o.name||"SpeedBoost"==o.name?t=!0:o.coolDownTime>60*o.waitingDuration&&(e*=o.boost)}this.boostsDisplay.enabled=!(1==e&&!t),this.app.fire("Workout:UpdatePowerUpMultiplier",e)},BoostManager.prototype.update=function(e){for(var t=0;t<this.currentPowerUps.length;t++){var o=this.currentPowerUps[t];if(o.isActive)o.coolDownTime-=e,o.coolDownTime<=0&&this.onEndCoolDown(o.name),o.entity.findByName("Time").element.text=Utils.mmss(o.coolDownTime)}};var Aura=pc.createScript("aura");Aura.attributes.add("auraIndex",{type:"number",default:-1}),Aura.attributes.add("moneyMultiplier",{type:"number",default:1}),Aura.attributes.add("workoutMultiplier",{type:"number",default:1}),Aura.attributes.add("requiredStrength",{type:"number",default:100}),Aura.attributes.add("price",{type:"number",default:100}),Aura.attributes.add("ads",{type:"number",default:1}),Aura.prototype.initialize=function(){this.entity.element.on("click",this.equipAura,this)},Aura.prototype.equipAura=function(){this.app.fire("Shop:EquipAura",this.entity,this.moneyMultiplier,this.workoutMultiplier,this.price,this.ads)},Aura.prototype.update=function(t){};var Roads=pc.createScript("roads");Roads.attributes.add("entities",{type:"entity",array:!0}),Roads.prototype.initialize=function(){this.app.on("Road:ChangeLength",this.changeLenght,this),this.on("state",this.onState,this),this.on("destroy",this.onDestroy,this)},Roads.prototype.onState=function(t){t?this.app.on("Road:ChangeLength",this.changeLenght,this):this.app.off("Road:ChangeLength",this.changeLenght,this)},Roads.prototype.onDestroy=function(){this.app.off("Road:ChangeLength",this.changeLenght,this)},Roads.prototype.changeLenght=function(t,e){if(!t)return!1;for(var o in this.entities){var i=this.entities[o];if(i){var a=i.getLocalScale(),n=i.getLocalPosition();i.setLocalScale(a.x,a.y,t+30),i.setLocalPosition(t/2*-1+30,n.y,n.z)}}};var Reparent=pc.createScript("reparent");Reparent.attributes.add("reparentTo",{type:"entity"}),Reparent.attributes.add("reparentToBone",{type:"boolean"}),Reparent.attributes.add("boneName",{type:"entity"}),Reparent.prototype.initialize=function(){var e=!1;if(!(e=this.reparentToBone?this.reparentTo.findByName(reparentToBone):this.reparentTo))return!1;this.entity.reparent(e)};var DrawDistance=pc.createScript("drawDistance");DrawDistance.attributes.add("drawDistance",{type:"number",default:100}),DrawDistance.prototype.initialize=function(){},DrawDistance.prototype.update=function(t){if(Utils.isMobile()){var i=this.entity;if(!i)return;var a=i.getPosition();this.app.root.findByTag("drawable").forEach((function(t){t.getPosition().distance(a)<this.drawDistance?t.enabled=!0:t.enabled=!1}),this)}};pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #ffd800;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;",'    background: url("https://assets.venge.io/FL-Loading-v3.jpg") no-repeat center center;',"    background-size: cover;","    overflow: hidden;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 180px);","    width: 264px;","    left: calc(50% - 132px);","    z-index: 100;","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    height: 30px;","    width: 30vw;","    position: fixed;","    left: 50%;","    bottom: 10%;","    transform: translate(-50%, 0%);","    background-color: rgba(0, 0, 0);","    border-radius: 30px;","    border: solid 5px #000;","    overflow: hidden;","}","","#progress-percentage {","    position: absolute;","    width: 100%;","    height: 100%;","    display: flex;","    align-items: center;","    justify-content: center;","    color: white;","    font-weight: bold;","    z-index: 1;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background: rgb(0, 80, 150);","    background: linear-gradient(0deg, rgba(0, 80, 150, 1) 0%, rgba(0, 200, 255, 1) 100%);","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","}","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;",'    background: url("https://assets.venge.io/FL-Thumbnail-Mobile.jpg") no-repeat center center;',"    background-size: cover;","    overflow: hidden;","}","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("div");a.id="progress-bar-container",t.appendChild(a);var n=document.createElement("div");n.id="progress-percentage",a.appendChild(n);var o=document.createElement("div");o.id="progress-bar",a.appendChild(o),e.appendChild(a)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar"),a=document.getElementById("progress-percentage");t&&a&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%",a.innerText=Math.round(100*e)+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));var ColorTransfusion=pc.createScript("colorTransfusion");ColorTransfusion.attributes.add("colorCurve",{type:"curve",color:"rgb",default:{keys:[[0,.5,.5,1,1,0],[0,0,.5,.5,1,1],[0,1,.5,0,1,.5]]}}),ColorTransfusion.attributes.add("time",{type:"number",default:1}),ColorTransfusion.attributes.add("loop",{type:"boolean",default:!0}),ColorTransfusion.attributes.add("startTime",{type:"number",default:0}),ColorTransfusion.prototype.initialize=function(){this.timer=this.startTime},ColorTransfusion.prototype.update=function(t){this.timer+=t/this.time;var o=this.colorCurve.value(this.timer);this.entity.element.color=new pc.Color(o[0],o[1],o[2],o[3]),this.loop&&this.timer>=1&&(this.timer=0)};var InviteManager=pc.createScript("inviteManager");InviteManager.attributes.add("inviteLinkTextEntity",{type:"entity"}),InviteManager.attributes.add("inviteButtonEntity",{type:"entity"}),InviteManager.attributes.add("createButtonEntity",{type:"entity"}),InviteManager.attributes.add("loadingButton",{type:"entity"}),InviteManager.attributes.add("inviteFriendsPopupEntity",{type:"entity"}),InviteManager.attributes.add("copiedEffectEntity",{type:"entity"}),InviteManager.prototype.initialize=function(){this.url=!1,this.copiedEffectEntity.enabled=!1,this.app.on("InviteManager:SetLink",this.setLink,this),this.app.on("InviteManager:Copy",this.onCopy,this),this.app.on("InviteManager:Create",this.onCreate,this)},InviteManager.prototype.setLink=function(t){var e=this;PokiSDK.shareableURL({invite:t}).then((t=>{e.inviteLinkTextEntity.element.text=t,e.url=t,e.loadingButton.enabled=!1,e.createButtonEntity.enabled=!1,e.inviteButtonEntity.enabled=!0}))},InviteManager.prototype.onCopy=function(){var t=this;Utils.addEvent("CopyLink"),Utils.copyToClipboard(this.url),this.copiedEffectEntity.enabled=!1,this.copiedEffectEntity.enabled=!0,clearTimeout(this.effectTimeout),this.effectTimeout=setTimeout((function(){t.copiedEffectEntity.enabled=!1}),2e3)},InviteManager.prototype.onCreate=function(){};var PvpTracking=pc.createScript("pvpTracking");PvpTracking.prototype.initialize=function(){this.lastInteraction=0,this.waitTimer=0,this.triggered=!1,this.entity.on("Trigger",this.onTrigger,this),this.entity.on("Leave",this.onLeave,this)},PvpTracking.prototype.onTrigger=function(t,i){if(!(this.triggered||Date.now()-this.lastInteraction<1e3))return this.waitTimer>1?(this.triggered=!0,this.lastInteraction=Date.now(),void Utils.addEvent("Pvp Interaction")):void(this.waitTimer+=2*i)},PvpTracking.prototype.onLeave=function(){this.triggered=!1,this.waitTimer=0,this.lastInteraction=0},PvpTracking.prototype.update=function(t){};var DuelOpponent=pc.createScript("duelOpponent");DuelOpponent.attributes.add("offset",{type:"number",default:-31}),DuelOpponent.attributes.add("lerpSpeed",{type:"number",default:.35}),DuelOpponent.attributes.add("characterEntity",{type:"entity"}),DuelOpponent.attributes.add("glassEntity",{type:"entity"}),DuelOpponent.attributes.add("shoeEntity",{type:"entity"}),DuelOpponent.attributes.add("usernameEntity",{type:"entity"}),DuelOpponent.attributes.add("strengthEntity",{type:"entity"}),DuelOpponent.prototype.initialize=function(){this.nextPosition=new pc.Vec3,this.entity.on("Position",this.setPosition,this),this.entity.on("Customization:Set",this.setCustomization,this)},DuelOpponent.prototype.setCustomization=function(t){this.usernameEntity.element.text=t.username,this.strengthEntity.element.text=t.strength;var e=JSON.parse(t.customizations);if(e){var i=e.cosmetics;for(var n in i){var s=i[n];if("Skins"==s.categoryName){var o=this.app.assets.get(s.model);if(s.model&&o){var p=this.app.assets.find(o.name,pc.ASSET_MATERIAL);this.characterEntity.render.asset=o;for(const t of this.characterEntity.render.meshInstances)t.material=p.resource}}}}},DuelOpponent.prototype.setPosition=function(t){this.nextPosition.x=t.x,this.nextPosition.y=t.y,this.nextPosition.z=t.z},DuelOpponent.prototype.lerpPosition=function(t){var e=this.entity.getPosition(),i=new pc.Vec3(0,0,0);i.x=e.x+(this.nextPosition.x-e.x)*this.lerpSpeed,i.y=e.y+(this.nextPosition.y-e.y)*this.lerpSpeed,i.z=e.z+(this.nextPosition.z-e.z)*this.lerpSpeed,e.distance(i)>2&&(i=this.nextPosition),this.entity.setPosition(i.x,0,this.offset)},DuelOpponent.prototype.update=function(t){this.lerpPosition(t)};var Translate=pc.createScript("translate");Translate.prototype.initialize=function(){},Translate.prototype.update=function(t){this.entity.translateLocal(0,0,400*-t)};var Clothes=pc.createScript("clothes");Clothes.attributes.add("tag",{type:"string",default:"Skin"}),Clothes.attributes.add("characterEntity",{type:"entity"}),Clothes.prototype.initialize=function(){this.index=0,this.characters=this.app.assets.findByTag(this.tag),this.lastCharacterChange=Date.now()},Clothes.prototype.update=function(t){if(Date.now()-this.lastCharacterChange<5e3)return!1;var a=this.characters[this.index];if(a){var e=this.app.assets.find(a.name,"render"),s=this.app.assets.find(a.name,pc.ASSET_MATERIAL);e&&s&&(this.app.assets.load(e),this.app.assets.load(s),this.characterEntity.render.asset=e,this.characterEntity.render.materialAssets=[s])}this.index++,this.index-1>this.characters.length&&(this.index=0),this.lastCharacterChange=Date.now()};var Count=pc.createScript("count");Count.attributes.add("targetNumber",{type:"number",default:0}),Count.prototype.initialize=function(){this.currentNumber=0,this.lastNumberChange=-1,this.entity.on("Count:Target",this.setTarget,this)},Count.prototype.setTarget=function(t){this.currentNumber=0,this.targetNumber=t},Count.prototype.update=function(t){this.currentNumber<this.targetNumber&&Date.now()-this.lastNumberChange>150&&(this.currentNumber++,this.lastNumberChange=Date.now()),this.entity.element.text=Math.floor(this.currentNumber)+""};var MeshRaycast=pc.createScript("meshRaycast"),vo=new pc.Vec3;MeshRaycast.prototype.initialize=function(){var e=this.entity.model.meshInstances[0];if(e){var t=e.mesh;t?(this.positionArray=[],t.getPositions(this.positionArray),this.indicesArray=[],t.getIndices(this.indicesArray)):console.error("No mesh found!")}else console.error("No mesh instance found!")},MeshRaycast.prototype.raycast=function(e,t){var n=1/this.entity.getLocalScale().x;return this._raycastGeometry(this.positionArray,e,t,n)},MeshRaycast.prototype._raycastGeometry=function(e,t,n,o){const c=e,s=this.indicesArray;s.length;let r=null,i=null,a=Number.MAX_VALUE;const l=t.clone().scale(o),u=new pc.Ray(l,n.clone());for(let e=0;e<s.length;e+=3){const t=s[e],n=s[e+1],o=s[e+2],y=new pc.Vec3(c[3*t],c[3*t+1],c[3*t+2]),h=new pc.Vec3(c[3*n],c[3*n+1],c[3*n+2]),p=new pc.Vec3(c[3*o],c[3*o+1],c[3*o+2]),d=this._intersectRayTriangle(u,y,h,p);if(null!==d){const e=d.clone().sub(l).length();e<a&&(r=d,a=e,i={v0:y,v1:h,v2:p})}}if(r&&i){return{point:r,normal:this._calculateTriangleNormal(i.v0,i.v1,i.v2)}}return null},MeshRaycast.prototype._intersectRayTriangle=function(e,t,n,o){const c=n.clone().sub(t),s=o.clone().sub(t);vo.cross(e.direction,s);const r=vo.clone(),i=c.dot(r);if(i>-1e-5&&i<1e-5)return null;const a=1/i,l=e.origin.clone().sub(t),u=a*l.dot(r);if(u<0||u>1)return null;vo.cross(l,c);const y=vo.clone(),h=a*e.direction.dot(y);if(h<0||u+h>1)return null;const p=a*s.dot(y);return p>1e-5?e.origin.clone().add(e.direction.clone().scale(p)):null},MeshRaycast.prototype._calculateTriangleNormal=function(e,t,n){const o=t.clone().sub(e),c=n.clone().sub(e),s=new pc.Vec3;return s.cross(o,c).normalize(),s};var Fishing=pc.createScript("fishing");Fishing.attributes.add("targetDepth",{type:"number",default:10}),Fishing.attributes.add("depthEntity",{type:"entity"}),Fishing.attributes.add("fishModel",{type:"entity"}),Fishing.attributes.add("originNPC",{type:"entity"}),Fishing.attributes.add("rarities",{type:"string",default:"Common"}),Fishing.attributes.add("fishes",{type:"entity",array:!0}),Fishing.prototype.initialize=function(){this.popupShown=!1,this.lastIconUpdate=-1,this.labelEntity=this.entity.findByName("Title"),this.depthEntity.element.text="("+this.targetDepth+"mt)",this.originNPC.enabled=!0,this.fm=this.app.root.findByName("FishingManager").script.fishingManager,this.progress=-1,this.threshold=0,this.lastLeave=-1,this._green=new pc.Color(0,1,0,1),this._red=new pc.Color(1,0,0,1),this._updateDepthColor(),this.entity.on("Trigger",this.onTrigger,this),this.entity.on("Leave",this.onLeave,this),this.app.on("Player:Jumped",this.onJump,this),this.app.on("FishingManager:RodChanged",this._updateDepthColor,this)},Fishing.prototype.onJump=function(){if(!this.popupShown)return!1;this.lastLeave=Date.now(),this.popupShown=!1},Fishing.prototype.onTrigger=function(t,i){if(!(Date.now()-this.lastLeave<1e3)){if(this.popupShown)return!1;this.threshold+=5*i,this.app.fire("World2Screen:Show","Progress",this.entity),this.app.fire("Progress:WaitFill",this.threshold),this.threshold>1&&(this.app.fire("World2Screen:Hide","Progress",this.entity),this.labelEntity.enabled=!1,this.originNPC.enabled=!1,this.app.fire("FishingManager:SetFishingPoint",this.entity),this.threshold=0,this.popupShown=!0)}},Fishing.prototype.onLeave=function(t){this.popupShown&&(this.popupShown=!1),this.threshold=0,this.labelEntity.enabled=!0,this.originNPC.enabled=!0,this.app.fire("Progress:WaitFill",this.threshold),this.app.fire("FishingManager:SetFishingPoint",!1),this.app.fire("World2Screen:Hide","Progress",this.entity)},Fishing.prototype._updateDepthColor=function(){var t=this.fm.currentRod;if(t){var i=t.script.rod.depth>=this.targetDepth;this.depthEntity.element.color=i?this._green:this._red}},Fishing.prototype.update=function(t){if(Date.now()-this.lastIconUpdate>2e3&&this.fishes.length>0){var i=Utils.getRandom(this.fishes).script.fish.model;this.fishModel.model.asset=i,this._updateDepthColor(),this.lastIconUpdate=Date.now()}};var FishingManager=pc.createScript("fishingManager");FishingManager.attributes.add("playerEntity",{type:"entity"}),FishingManager.attributes.add("coinDisplay",{type:"entity"}),FishingManager.attributes.add("characterEntity",{type:"entity"}),FishingManager.attributes.add("rodEntity",{type:"entity"}),FishingManager.attributes.add("rodModel",{type:"entity"}),FishingManager.attributes.add("fishingOverlay",{type:"entity"}),FishingManager.attributes.add("overlayEntity",{type:"entity"}),FishingManager.attributes.add("interface",{type:"entity"}),FishingManager.attributes.add("interfaceFish",{type:"entity"}),FishingManager.attributes.add("wheelEntity",{type:"entity"}),FishingManager.attributes.add("cameraEntity",{type:"entity"}),FishingManager.attributes.add("fishingCamera",{type:"entity"}),FishingManager.attributes.add("lookEntity",{type:"entity"}),FishingManager.attributes.add("fishSellIcon",{type:"entity"}),FishingManager.attributes.add("fishSellName",{type:"entity"}),FishingManager.attributes.add("fishSellRarity",{type:"entity"}),FishingManager.attributes.add("fishSellWeight",{type:"entity"}),FishingManager.attributes.add("fishSellPrice",{type:"entity"}),FishingManager.attributes.add("waitingBar",{type:"entity"}),FishingManager.attributes.add("headerEntity",{type:"entity"}),FishingManager.attributes.add("catchedFishEntity",{type:"entity"}),FishingManager.attributes.add("fishIcon",{type:"entity"}),FishingManager.attributes.add("fishName",{type:"entity"}),FishingManager.attributes.add("fishRarity",{type:"entity"}),FishingManager.attributes.add("fishWeight",{type:"entity"}),FishingManager.attributes.add("fishRarityColor",{type:"entity"}),FishingManager.attributes.add("fishAchivement",{type:"entity"}),FishingManager.attributes.add("fishAchivementText",{type:"entity"}),FishingManager.attributes.add("inventoryMessage",{type:"entity"}),FishingManager.attributes.add("sellAllFish",{type:"entity"}),FishingManager.attributes.add("fishingDepth",{type:"entity"}),FishingManager.attributes.add("fishingRarities",{type:"entity"}),FishingManager.attributes.add("itemEntity",{type:"entity"}),FishingManager.attributes.add("inventoryHolder",{type:"entity"}),FishingManager.attributes.add("sellEntity",{type:"entity"}),FishingManager.attributes.add("sellHolder",{type:"entity"}),FishingManager.attributes.add("rodInventoryItem",{type:"entity"}),FishingManager.attributes.add("rodInventoryHolder",{type:"entity"}),FishingManager.attributes.add("rodItem",{type:"entity"}),FishingManager.attributes.add("rodItemHolder",{type:"entity"}),FishingManager.attributes.add("rodItemName",{type:"entity"}),FishingManager.attributes.add("rodItemIcon",{type:"entity"}),FishingManager.attributes.add("rodItemPrice",{type:"entity"}),FishingManager.attributes.add("rodItemPower",{type:"entity"}),FishingManager.attributes.add("rodItemChance",{type:"entity"}),FishingManager.attributes.add("clickItem",{type:"entity"}),FishingManager.attributes.add("clickHolder",{type:"entity"}),FishingManager.attributes.add("clickText",{type:"string",array:!0}),FishingManager.attributes.add("rodItemBuyButton",{type:"entity"}),FishingManager.attributes.add("rodItemAds",{type:"entity"}),FishingManager.attributes.add("rodItemGotName",{type:"entity"}),FishingManager.attributes.add("rodItemGotIcon",{type:"entity"}),FishingManager.attributes.add("hookItemGotName",{type:"entity"}),FishingManager.attributes.add("hookItemGotIcon",{type:"entity"}),FishingManager.attributes.add("fishingItem",{type:"entity"}),FishingManager.attributes.add("fishingHolder",{type:"entity"}),FishingManager.attributes.add("powerLerp",{type:"number",default:10}),FishingManager.attributes.add("slowProgress",{type:"number",default:1}),FishingManager.attributes.add("rarities",{type:"json",schema:[{name:"name",type:"string",default:"Common",enum:[{Common:"Common"},{Uncommon:"Uncommon"},{Epic:"Epic"},{Obsidian:"Obsidian"},{Galactic:"Galactic"}]},{name:"color",type:"rgb"},{name:"priceMultiplier",type:"number",default:1}],array:!0}),FishingManager.attributes.add("meterBar",{type:"entity"}),FishingManager.attributes.add("meterText",{type:"entity"}),FishingManager.attributes.add("targetDepth",{type:"entity"}),FishingManager.attributes.add("bagMoneyUpgradeValue",{type:"entity"}),FishingManager.attributes.add("bagImage",{type:"entity"}),FishingManager.attributes.add("chestImage",{type:"entity"}),FishingManager.attributes.add("bagLevelHolder",{type:"entity"}),FishingManager.attributes.add("bagLevelEntity",{type:"entity"}),FishingManager.attributes.add("bagSlots",{type:"entity"}),FishingManager.attributes.add("bagUpgradeLevels",{type:"number",array:!0}),FishingManager.attributes.add("chestUpgradeLevels",{type:"number",array:!0}),FishingManager.attributes.add("bagUpgradeMoney",{type:"number",array:!0}),FishingManager.attributes.add("bagUpgradeButtons",{type:"entity"}),FishingManager.attributes.add("fishDeckScrollView",{type:"entity"}),FishingManager.attributes.add("fishDeckItem",{type:"entity"}),FishingManager.attributes.add("fishDeckFish",{type:"entity"}),FishingManager.attributes.add("fishDeckBosses",{type:"entity"}),FishingManager.attributes.add("fishDeckFishCount",{type:"entity"}),FishingManager.attributes.add("fishDeckBossCount",{type:"entity"}),FishingManager.attributes.add("chestElement",{type:"entity"}),FishingManager.attributes.add("color",{type:"curve",color:"rgb",default:{keys:[[0,.5,.5,1,1,0],[0,0,.5,.5,1,1],[0,1,.5,0,1,.5]]}}),FishingManager.attributes.add("TempBonusUI",{type:"entity"}),FishingManager.attributes.add("MobileMenu",{type:"entity"}),FishingManager.attributes.add("sellFishUI",{type:"entity"}),FishingManager.attributes.add("rodUI",{type:"entity"}),FishingManager.attributes.add("backPackUI",{type:"entity"}),FishingManager.attributes.add("chestUI",{type:"entity"}),FishingManager.attributes.add("moneyUI",{type:"entity"}),FishingManager.attributes.add("sellText",{type:"entity"}),FishingManager.attributes.add("rodBonusIcon",{type:"entity"}),FishingManager.attributes.add("rodBonusText",{type:"entity"}),FishingManager.attributes.add("offerAmountText",{type:"entity"}),FishingManager.attributes.add("spaceBarUI",{type:"entity"}),FishingManager.attributes.add("spaceBonusTimer",{type:"entity"}),FishingManager.attributes.add("chestBonusTimer",{type:"entity"}),FishingManager.attributes.add("rodBonusTimer",{type:"entity"}),FishingManager.attributes.add("backpackBonusTimer",{type:"entity"}),FishingManager.attributes.add("moneyBonusTimer",{type:"entity"}),FishingManager.attributes.add("spaceBonusDuration",{type:"number",default:120}),FishingManager.attributes.add("rodBonusDuration",{type:"number",default:120}),FishingManager.attributes.add("backpackBonusDuration",{type:"number",default:180}),FishingManager.attributes.add("moneyBonusDuration",{type:"number",default:120}),FishingManager.attributes.add("chestBonusDuration",{type:"number",default:120}),FishingManager.attributes.add("storeLoot",{type:"entity"}),FishingManager.attributes.add("storageHolder",{type:"entity"}),FishingManager.attributes.add("storageMaxSlots",{type:"number",default:8}),FishingManager.attributes.add("storageUpgradePrice",{type:"number",default:1e3}),FishingManager.attributes.add("scrollBar",{type:"entity"}),FishingManager.attributes.add("midRollChance",{type:"number",default:.33}),FishingManager.attributes.add("fishDeckButton",{type:"entity"}),FishingManager.attributes.add("selectRodFishRarity",{type:"entity"}),FishingManager.attributes.add("selectRodFishItem",{type:"entity"}),FishingManager.attributes.add("fishingPoingFishRarity",{type:"entity"}),FishingManager.attributes.add("fishesPointItem",{type:"entity"}),FishingManager.attributes.add("fishesPointHolder",{type:"entity"}),FishingManager.attributes.add("increaseStoreBag",{type:"entity"}),FishingManager.attributes.add("maxBagReachedButton",{type:"entity"}),FishingManager.attributes.add("fishSelectedSellPrice",{type:"entity"}),FishingManager.attributes.add("rodLevelDisplay",{type:"entity"}),FishingManager.attributes.add("sellAllValue",{type:"entity"}),FishingManager.attributes.add("lockSellText",{type:"entity"}),FishingManager.attributes.add("upgradeBagEl",{type:"entity"}),FishingManager.attributes.add("hookItem",{type:"entity"}),FishingManager.attributes.add("hookItemHolder",{type:"entity"}),FishingManager.attributes.add("hookItemBuyButton",{type:"entity"}),FishingManager.attributes.add("scrollbarHook",{type:"entity"}),FishingManager.attributes.add("AuroHolder",{type:"entity"}),FishingManager.attributes.add("auraSystem",{type:"json",array:!0,schema:[{name:"name",type:"string",array:!1,default:""},{name:"levels",type:"number",array:!0,default:[]},{name:"prices",type:"number",array:!0,default:[]}]}),FishingManager.attributes.add("auraItemGotName",{type:"entity"}),FishingManager.attributes.add("auraGlow",{type:"entity"}),FishingManager.attributes.add("auraTimersMobile",{type:"entity"}),FishingManager.attributes.add("auraTimersPC",{type:"entity"}),FishingManager.attributes.add("chestUpgradeMoney",{type:"number",array:!0}),FishingManager.attributes.add("fishInterfaceMode",{type:"entity"}),FishingManager.prototype.initialize=function(){this.inventoryArray=[],this.sellArray=[],this.fishingArray=[],this.fishDeckArray=[],this.rodItemsArray=[],this.hookItemsArray=[],this.rodInventory=[],this.fishesPointArray=[],this.offerAmount=0,this.clickArray=[],this.lvlRod=1,this.lvlHook=1,this.chestLevel=Utils.getItemAsNumber("chestLevel",0),this.chestMaxSlots=this.chestUpgradeLevels[this.chestLevel],this.currentAuraSelected=null,this.currentlyHeldFishIndex=-1,this.isSpacebarDown=!1,pc.IdleManager.FishStorage||(pc.IdleManager.FishStorage=[],Utils.setItemAsArray("FishStorage",pc.IdleManager.FishStorage)),this.storageCurrentMaxSlots=Utils.getItemAsNumber("StorageMaxSlots",this.storageMaxSlots),this.bagLevel=Utils.getItemAsNumber("BagLevel",0),this.maxSlots=this.bagUpgradeLevels[this.bagLevel],this.displayedSlots=this.maxSlots,this.slotsPendingRemoval=!1,this.rodBonusActive=!1,this.backpackBonusActive=!1,this.moneyBonusActive=!1,this.chestBonusActive=!1,this.spaceBonusActive=!1,this.lastMoneyOffer=-1,this.spaceBonusEndTime=0,this.chestBonusEndTime=0,this.rodBonusEndTime=0,this.backpackBonusEndTime=0,this.backpackBonusMultiplier=2,this.normalChestStorage=this.storageCurrentMaxSlots,this.normalMaxSlots=this.maxSlots,this.tempRod=null,this.normalRod=null,this.updateUpgradeSlots(),this.updateUpgradeChestSlots(),this.animationSpeed=1,this.fishingStarted=0,this.rods=this.entity.findByTag("Rod"),this.hooks=this.entity.findByTag("Hook"),this.fishes=this.entity.findByTag("Fish"),this.bosses=this.entity.findByTag("Boss"),this.interface.enabled=!1,this.catchedFishEntity.enabled=!1,this.itemEntity.enabled=!1,this.sellEntity.enabled=!1,this.fishingItem.enabled=!1,this.clickItem.enabled=!1,this.fishingOverlay.enabled=!1,this.rodInventoryItem.enabled=!1,this.currentRod=null,this.currentPoint=null,this.currentBuyRod=null,this.power=0,this.depth=0,this.isPaused=!1,this.pauseStartTime=0,this.lastClickTime=Date.now(),this.inactivityTimeout=3e3,this.inactivityUI=this.fishingOverlay.findByName("InactivityUI"),this.inactivityUI.enabled=!1,Utils.setItemAsArray("CurrentAura",[]),this.activeAuras={CatchSpeed:!1,FishChance:!1,Money:!1},this.auraEndTimes={},this.auraDuration=180,this.app.on("Tabs:SelectMenu",this.selectedMenu,this),this.app.on("FishingManager:SetAura",this.selectAura,this),this.app.on("FishingManager:OpenAuraUpgrade",this.openAuraUpgrade,this),this.app.on("FishingManager:UpgradeAura",this.upgradeAura,this),this.app.on("FishingManager:OpenHookBuy",this.openHookBuy,this),this.app.on("FishingManager:SetFishingPoint",this.setFishingPoint,this),this.app.on("FishingManager:SetFishingPointMode",this.setFishingPointMode,this),this.app.on("FishingManager:SelectRod",this.selectRod,this),this.app.on("FishingManager:ScrollRodView",this.scrollRodView,this),this.app.on("FishingManager:HoldFishByIndex",this.holdFishByIndex,this),this.app.on("FishingManager:IncreaseBagPop",this.increaseBagpop,this),this.app.on("FishingManager:SellFishByName",this.sellFishByName,this),this.app.on("FishingManager:OpenSell",this.openSell,this),this.app.on("FishingManager:SellFish",this.sellFish,this),this.app.on("FishingManager:SelectFish",this.selectFish,this),this.app.on("FishingManager:DoSell",this.doSell,this),this.app.on("FishingManager:DoSellReward",this.doSellReward,this),this.app.on("FishingManager:SpaceBar",this.doSpaceBar,this),this.app.on("FishingManager:SelectFishDeckType",this.selectFishDeckType,this),this.app.on("FishingManager:CatchFish",this.catchFish,this),this.app.on("FishingManager:UpgradeSlots",this.upgradeSlots,this),this.app.on("FishingManager:upgradeChestSlots",this.upgradeChestSlots,this),this.app.on("FishingManager:ActivateTemporaryBonus",this.activateTemporaryBonus,this),this.app.on("FishingManager:SellAllFishReward",this.sellAllFishReward,this),this.app.on("FishingManager:OpenRodBuy",this.openRodBuy,this),this.app.on("FishingManager:ShowRodBuy",this.showRodBuy,this),this.app.on("FishingManager:BuyRod",this.buyRod,this),this.app.on("FishingManager:BuyHook",this.buyHook,this),this.app.on("FishingManager:StoreLoot",this.openChestStorage,this),this.app.on("AuraTimer:EndTime",this.auraTimer,this),this.app.on("FishingManager:OpenFishDeck",this.openFishDeck,this),this.app.on("PointerLock:Change",this.onPointerChanged,this),this.app.on("FishingManager:AcceptMoneyOffer",this.acceptMoneyOffer,this),this.app.on("FishingManager:TransferToStorage",this.transferToStorage,this),this.app.on("FishingManager:TransferFromStorage",this.transferFromStorage,this),this.app.on("FishingManager:PauseBonuses",this.pauseBonuses,this),this.app.on("FishingManager:ResumeBonuses",this.resumeBonuses,this),this.app.on("PopupManager:PopupHidden",this.showMidroll,this),this.app.mouse.on("mouseup",this.onClick,this),this.app.keyboard.on("keydown",this.onKeyDown,this),this.app.keyboard.on("keyup",this.onKeyUp,this),this.app.touch&&this.app.touch.on("touchend",this.onClick,this),this.on("destroy",this.onDestroy,this),this.updateInventory(),this.updateChestStorage(),this.setBiggestFish(),this.updateFishDeck(),this.initializeFishDeck(),Utils.isMobile()&&(this.MobileMenu.addChild(this.TempBonusUI),this.TempBonusUI.setLocalPosition(-520,-37.617,0),this.TempBonusUI.element&&(this.TempBonusUI.element.anchor.set(1,1,1,1),this.TempBonusUI.element.pivot.set(1,1))),this.lvlRod=Utils.getItemAsNumber("RodLevel",0),this.lvlHook=Utils.getItemAsNumber("HookLevel",0),pc.IdleManager.MoneyAuraLevel=Utils.getItemAsNumber("MoneyAuraLevel",0),pc.IdleManager.CatchSpeedAuraLevel=Utils.getItemAsNumber("CatchSpeedAuraLevel",0),pc.IdleManager.FishChanceAuraLevel=Utils.getItemAsNumber("FishChanceAuraLevel",0),this.app.fire("IdleManager:Set","UniqueFishes",pc.IdleManager.FishDeck.length),this.updateInventory();var e=Utils.getItemAsArray("Rods",[]);if(e&&e.length>0){var t=e[e.length-1];this.currentRod=this.getRodByName(t)||this.getRodByName("Wooden Rod"),this.currentRod&&(this.lvlRod=this.getRodLevelByName(this.currentRod.name),Utils.setItem("RodLevel",this.lvlRod),this.app.fire("IdleManager:Set","RodLevel",this.lvlRod))}else this.currentRod=this.getRodByName("Wooden Rod"),this.lvlRod=1,Utils.setItem("RodLevel",this.lvlRod),this.app.fire("IdleManager:Set","RodLevel",this.lvlRod);this.app.fire("IdleManager:Set","RodPower",100*this.currentRod.script.rod.power),this.currentRod&&(this.rodModel.render.asset=this.currentRod.script.rod.model,this.rodModel.render.materialAssets=[this.currentRod.script.rod.material]),this.app.fire("FishingManager:RodChanged"),this.selectAura()},FishingManager.prototype.postInitialize=function(){},FishingManager.prototype.increaseBagpop=function(){this.updateUpgradeSlots(),this.app.fire("PopupManager:Show","IncreaseBag")},FishingManager.prototype.addAuraTimer=function(e){var t=(Utils.isMobile()?this.auraTimersMobile:this.auraTimersPC).findByName(e);if(t){var i=t.findByName("Timer");i.script.time.start=180,i.script.time.fire("state"),t.enabled=!0}else console.warn("No aura timer UI for",e)},FishingManager.prototype.auraTimer=function(e){var t=(Utils.isMobile()?this.auraTimersMobile:this.auraTimersPC).findByName(e);t&&(t.enabled=!1),this.activeAuras[e]=!1,delete this.auraEndTimes[e],this.updateAuraButtons(e),this.syncAuraStorage(),this.selectAura(),this.app.fire("IdleManager:Set","RodPower",100*this.currentRod.script.rod.power),this.app.fire("Overlay:Message",`${"FishChance"==e?"Rare Fish":e} aura expired`)},FishingManager.prototype.getMoneyAuraMultiplier=function(){if("Money"!==this.currentAuraSelected)return 1;const e=this.auraSystem.find((e=>"Money"===e.name)),t=pc.IdleManager.MoneyAuraLevel||0;return 1+(e.levels[t]||0)/100},FishingManager.prototype.getCatchSpeedMultiplier=function(){if("CatchSpeed"!==this.currentAuraSelected)return 1;const e=this.auraSystem.find((e=>"CatchSpeed"===e.name)),t=pc.IdleManager.CatchSpeedAuraLevel||0;return 1+(e.levels[t]||0)/100},FishingManager.prototype.getFishChanceMultiplier=function(){if("FishChance"!==this.currentAuraSelected)return 1;const e=this.auraSystem.find((e=>"FishChance"===e.name)),t=pc.IdleManager.FishChanceAuraLevel||0;return 1+(e.levels[t]||0)/100},FishingManager.prototype.getHookBonusCuts=function(){const e={uncommon:0,epic:0,obsidian:0,galactic:0},t=pc.IdleManager.HookLevel||0,i=this.hooks[t];if(!i)return e;const a=i.name.toLowerCase();return a.includes("rusty")||(a.includes("bone")?e.uncommon=100:a.includes("steel")?e.epic=100:a.includes("titanium")?e.galactic=100:a.includes("gold")&&(e.obsidian=150)),e},FishingManager.prototype.loadAuras=function(){this.auraSystem.forEach((e=>{const t=e.name,i=t+"AuraLevel",a=pc.IdleManager[i]||0,s=e.levels[a]||0;this.updateAuraUI(t,a,s)}))},FishingManager.prototype.selectAura=function(){const e=this.AuroHolder;if(!e)return void console.warn("Aura holder not assigned");e.children.forEach((e=>{const t=e.name,i=!!this.activeAuras[t],a=e.findByName("Borderx"),s=e.findByName("AuraBorder"),n=e.findByName("AuraEffect");a&&(a.enabled=!i),s&&(s.enabled=i),n&&(n.enabled=i)}));const t=Object.keys(this.activeAuras).filter((e=>this.activeAuras[e]));let i;if(1===t.length)switch(t[0]){case"CatchSpeed":i=0;break;case"FishChance":i=1;break;case"Money":i=2}else if(2===t.length)i=3;else{if(3!==t.length)return void(this.auraGlow.enabled=!1);i=4}this.auraGlow.enabled=!0,setTimeout((function(e){e.auraGlow.fire("MaterialShader:Set","activeIndex",i)}),3e3,this),this.auraGlow.fire("MaterialShader:Set","activeIndex",i),this.app.fire("NetworkManager:Send","changeAura",i)},FishingManager.prototype.selectAura2=function(e){e=parseInt(e);var t=this.AuroHolder;if(t){var i="FishChance";2===e&&(i="Money"),0===e&&(i="CatchSpeed"),this.auraGlow.enabled=!0;for(var a=0;a<t.children.length;a++){var s=t.children[a],n=s.name===i,r=s.findByName("Borderx"),o=s.findByName("AuraBorder"),h=s.findByName("AuraEffect");r&&(r.enabled=!n),o&&(o.enabled=n),h&&(h.enabled=n)}this.currentAuraSelected=i,pc.IdleManager.CurrentAura=e,Utils.setItem("CurrentAura",e),this.app.fire("IdleManager:Set","CurrentAura",e),this.auraGlow.fire("MaterialShader:Set","activeIndex",e),setTimeout((function(t){t.auraGlow.fire("MaterialShader:Set","activeIndex",e)}),3e3,this),this.app.fire("NetworkManager:Send","changeAura",e),this.app.fire("Overlay:Announce",`${i} Active!`,1500)}else console.warn("Aura holder not assigned")},FishingManager.prototype.syncAuraStorage=function(){const e=Object.keys(this.activeAuras).filter((e=>this.activeAuras[e]));Utils.setItemAsArray("CurrentAura",e)},FishingManager.prototype.updateAuraUI=function(e,t,i){const a=this.AuroHolder.findByName(e);a.findByName("Level").element.text=t+1,a.findByName("Percentage").element.text=`+${i}%`;const s=this.auraSystem.find((t=>t.name===e)).prices[t+1];a.findByName("MoneyValue").element.text=s?`$${s}`:"MAX";var n=this.AuroHolder.findByName(e).findByName("Upgrade");if(n){var r=n.getLocalScale().clone();n.setLocalScale(1.2*r.x,1.2*r.y,1.2*r.z),setTimeout((function(){n.setLocalScale(r)}),150)}},FishingManager.prototype.upgradeAura=function(e){if(!this.auraSystem.find((t=>t.name===e)))return console.warn("Unknown aura:",e);if(this.activeAuras[e])return void this.app.fire("Overlay:Message",`${e} Aura is already active!`);const t=this;PokiPlugin.showReward((function(){const i=Date.now();t.activeAuras[e]=!0,t.auraEndTimes[e]=i+1e3*t.auraDuration,t.updateAuraButtons(e),t.syncAuraStorage(),t.selectAura(),t.addAuraTimer(e),t.app.fire("Overlay:Message",`${e} Aura activated for ${t.auraDuration/60} min!`)}))},FishingManager.prototype.updateAuraButtons=function(e){const t=this.AuroHolder.findByName(e),i=t.findByName("UpgradeWithAds"),a=t.findByName("Active");i&&(i.enabled=!this.activeAuras[e]),a&&(a.enabled=this.activeAuras[e])},FishingManager.prototype.showMidroll=function(e){"FullInventory"===e&&(!PokiPlugin.canShowAds||PokiPlugin.adblock||PokiPlugin.isGamePaused||PokiPlugin.totalGameplay>=PokiPlugin.midrollInterval&&(PokiPlugin.totalGameplay=0,PokiPlugin.showMidroll((()=>{Utils.isMobile()||PokiPlugin.isPaused||pc.app.mouse.enablePointerLock()}))))},FishingManager.prototype.pauseBonuses=function(){this.isPaused||(this.isPaused=!0,this.pauseStartTime=Date.now())},FishingManager.prototype.resumeBonuses=function(){if(!this.isPaused)return;const e=Date.now()-this.pauseStartTime;this.spaceBonusActive&&(this.spaceBonusEndTime+=e),this.rodBonusActive&&(this.rodBonusEndTime+=e),this.chestBonusActive&&(this.chestBonusEndTime+=e),this.backpackBonusActive&&(this.backpackBonusEndTime+=e),this.moneyBonusActive&&(this.moneyBonusEndTime+=e),this.isPaused=!1},FishingManager.prototype.onUserInteraction=function(){this.lastClickTime=Date.now(),this.inactivityUI.enabled=!1},FishingManager.prototype.checkStorageSlots=function(){for(var e=this.storageHolder.children,t=0;t<e.length;t++)e[t]&&(e[t].enabled=!1);for(t=0;t<this.chestMaxSlots;t++)e[t]&&(e[t].enabled=!0)},FishingManager.prototype.activateTemporaryBonus=function(e,t){switch(e){case"slots":if(this.backpackBonusActive)return void this.app.fire("Overlay:Message","Inventory slots bonus is already active!");break;case"rod":if(this.rodBonusActive)return void this.app.fire("Overlay:Message","Rod bonus is already active!");break;case"money":if(this.moneyBonusActive)return void this.app.fire("Overlay:Message","2 Money bonus is already active!");break;case"chest":if(this.chestBonusActive)return void this.app.fire("Overlay:Message","Chest storage bonus is already active!");break;default:return void console.warn("Unknown temporary bonus type:",e)}var i=this;PokiPlugin.showReward((function(){i.applyTemporaryBonus(e,t)}))},FishingManager.prototype.applyTemporaryBonus=function(e,t){if("slots"===e){if(this.backpackBonusActive)return void this.app.fire("Overlay:Message","Inventory slots bonus is already active!");this.backpackBonusActive=!0,this.backpackBonusEndTime=Date.now()+1e3*this.backpackBonusDuration,this.normalMaxSlots=this.maxSlots,this.maxSlots=this.normalMaxSlots*this.backpackBonusMultiplier,this.displayedSlots=this.maxSlots,this.updateInventory(),this.backPackUI&&(this.backPackUI.enabled=!0),this.app.fire("Overlay:Message","2x inventory slots activated for 3 minutes!")}else if("rod"===e){if(this.rodBonusActive)return void this.app.fire("Overlay:Message","Rod bonus is already active!");this.normalRod=this.currentRod,this.tempRod=this.getRodByName(t),this.tempRod?(this.rodBonusActive=!0,this.rodBonusEndTime=Date.now()+1e3*this.rodBonusDuration,this.currentRod&&(this.currentRod=this.tempRod),this.rodBonusText&&this.rodUI&&(this.rodUI.enabled=!0,this.rodBonusText.element.text=t.toUpperCase(),this.rodBonusIcon.element.textureAsset=this.tempRod.script.rod.icon),this.app.fire("Overlay:Message",t+" activated for 2 minutes!")):console.error("Rod not found: "+t)}else if("money"===e){if(this.moneyBonusActive)return void this.app.fire("Overlay:Message","2x Money bonus is already active!");this.moneyBonusActive=!0,this.moneyBonusEndTime=Date.now()+1e3*this.moneyBonusDuration,this.sellText.enabled=!0,this.moneyUI&&(this.moneyUI.enabled=!0),this.app.fire("Overlay:Message","2x money activated for 2 minutes!")}else if("chest"===e){if(this.chestBonusActive)return void this.app.fire("Overlay:Message","Chest storage bonus is already active!");this.chestBonusActive=!0,this.chestBonusEndTime=Date.now()+1e3*this.chestBonusDuration,this.normalChestStorage=this.storageCurrentMaxSlots,this.storageCurrentMaxSlots+=4,this.checkStorageSlots(),this.updateChestStorage(),this.chestUI&&(this.chestUI.enabled=!0),this.app.fire("Overlay:Message","Chest storage upgraded for 2 minutes! New capacity: "+this.storageCurrentMaxSlots+" slots")}},FishingManager.prototype.endRodBonus=function(){this.rodBonusActive&&(this.currentRod===this.tempRod&&(this.currentRod=this.normalRod),this.tempRod=null,this.normalRod=null,this.app.fire("Overlay:Message","Rod bonus expired"),this.rodBonusActive=!1,this.rodUI&&(this.rodUI.enabled=!1))},FishingManager.prototype.endMoneyBonus=function(){this.moneyBonusActive&&(this.moneyBonusActive=!1,this.moneyBonusEndTime=0,this.sellText.enabled=!1,this.app.fire("Overlay:Message","Money bonus expired"),this.moneyUI&&(this.moneyUI.enabled=!1))},FishingManager.prototype.getRodLevelByName=function(e){for(var t=0;t<this.rods.length;t++)if(this.rods[t].name===e)return t+1;return 1},FishingManager.prototype.getRodNameByLevel=function(e){return e<1||e>this.rods.length?null:this.rods[e-1].name},FishingManager.prototype.endBackpackBonus=function(){if(this.backpackBonusActive){this.maxSlots=this.bagUpgradeLevels[this.bagLevel];var e=pc.IdleManager.Inventory.length;this.displayedSlots=e,this.slotsPendingRemoval=!0,this.updateInventory(),this.app.fire("Overlay:Message","Inventory slots bonus expired"),this.backpackBonusActive=!1,this.backPackUI&&(this.backPackUI.enabled=!1)}},FishingManager.prototype.onPointerChanged=function(e){!1===e&&this.setFishingPoint(!1)},FishingManager.prototype.upgradeSlots=function(e){pc.IdleManager.TutorialIndex;if(2==this.maxSlots&&"Reward"!=e||4==this.maxSlots&&this.backpackBonusActive)return this.doUpgradeSlots(),this.app.fire("IdleManager:Set","TutorialIndex",1),void this.updateUpgradeSlots();if("Reward"==e){var t=this;PokiPlugin.showReward((function(){t.doUpgradeSlots(),pc.app.fire("PopupManager:Hide")}))}else{var i=this.bagUpgradeMoney[this.bagLevel+1];pc.IdleManager.Coin>=i?(this.doUpgradeSlots(),this.app.fire("IdleManager:Add","Coin",-i)):this.showMoneyOffer(i)}},FishingManager.prototype.doUpgradeSlots=function(){this.bagLevel>this.bagUpgradeLevels.length-2?this.app.fire("Overlay:Message","You reached out max bag slots"):(this.bagLevel++,Utils.setItem("BagLevel",this.bagLevel),this.maxSlots=this.bagUpgradeLevels[this.bagLevel],this.normalMaxSlots=this.maxSlots,this.backpackBonusActive&&(this.maxSlots*=this.backpackBonusMultiplier),this.app.assets.find("Bag-"+this.bagLevel+".png")&&(this.app.fire("PopupManager:Show","IncreasedBagSlot"),this.bagImage.element.textureAsset=this.app.assets.find("Bag-"+this.bagLevel+".png")),this.updateInventory(),this.updateUpgradeSlots())},FishingManager.prototype.updateUpgradeSlots=function(){pc.IdleManager.TutorialIndex;var e=this.bagUpgradeLevels.length-1,t=this.bagLevel+1>=e;if(this.upgradeBagEl.enabled=!t,this.bagLevel&&this.bagLevel>this.bagUpgradeLevels.length-2)return this.bagUpgradeButtons.enabled=!1,void(this.bagSlots.element.text="Max level reached!");this.bagLevelHolder.setLocalPosition(-269*this.bagLevel,0,0),this.bagLevelEntity.element.text="Level "+(this.bagLevel+2),this.bagSlots.element.text=this.bagUpgradeLevels[this.bagLevel+1]+" slots";var i=this.bagMoneyUpgradeValue.findByTag("ButtonUI"),a=this.bagMoneyUpgradeValue.findByTag("disabledUI");if(2==this.maxSlots||4==this.maxSlots&&this.backpackBonusActive)this.bagMoneyUpgradeValue.findByName("MoneyValue").element.text="FREE",i.forEach((function(e){e.element&&(e.element.color=new pc.Color(114/255,174/255,71/255))})),this.bagMoneyUpgradeValue.script.button.hoverColor=new pc.Color(54/255,103/255,19/255);else{var s=this.bagUpgradeMoney[this.bagLevel+1];this.bagMoneyUpgradeValue.findByName("MoneyValue").element.text="$"+Utils.numberScaleWithoutFloat(s);var n=pc.IdleManager.Coin>=s;i.forEach((function(e){e.enabled=n})),a.forEach((function(e){e.enabled=!n}))}},FishingManager.prototype.openChestStorage=function(){var e=this.chestUpgradeLevels[this.chestUpgradeLevels.length-2],t=this.chestElement.findByName("UpgradeStorage");this.chestMaxSlots>=e?t.enabled=!1:(t.findByName("Level").element.text=`Level ${this.chestLevel+1}`,t.findByName("Slots").element.text=`${this.chestMaxSlots} Slots`),this.updateInventory(),this.updateChestStorage(),this.app.fire("PopupManager:Show","StoreLoot")},FishingManager.prototype.upgradeChestSlots=function(e){var t=this.chestUpgradeMoney[this.chestLevel];pc.IdleManager.Coin>t?(this.doUpgradeChestStorage(),this.app.fire("IdleManager:Add","Coin",-t)):this.showMoneyOffer(t),this.updateUpgradeSlots()},FishingManager.prototype.doUpgradeChestStorage=function(){this.chestLevel>this.chestUpgradeLevels.length-2?this.app.fire("Overlay:Message","You reached out max bag slots"):(this.chestLevel++,Utils.setItem("chestLevel",this.chestLevel),this.chestMaxSlots=this.chestUpgradeLevels[this.chestLevel],this.app.fire("PopupManager:Show","IncreasedChestSlot"),this.chestImage.element.textureAsset=this.app.assets.find("Chest-"+this.chestLevel+".png"),this.updateUpgradeChestSlots())},FishingManager.prototype.updateUpgradeChestSlots=function(){this.increaseStoreBag.findByName("Holder").setLocalPosition(-269*this.chestLevel,0,0),this.increaseStoreBag.findByName("Slots").element.text=this.chestMaxSlots+" slots",this.increaseStoreBag.findByName("Level").element.text="Level "+(this.chestLevel+1),this.increaseStoreBag.findByName("MoneyValue").element.text="$"+this.chestUpgradeMoney[this.chestLevel],this.chestLevel&&this.chestLevel>=this.chestUpgradeLevels.length-2&&(this.increaseStoreBag.findByName("UpgradeButtons").enabled=!1,this.increaseStoreBag.findByName("Arrow").enabled=!1,this.increaseStoreBag.findByName("Slots").element.text="Max level reached!"),this.checkStorageSlots()},FishingManager.prototype.selectedMenu=function(e){"Rods"===e?this.openRodBuy(!0):"Hooks"===e?this.openHookBuy(!0):(this.hookItemBuyButton.enabled=!1,this.rodItemBuyButton.enabled=!1)},FishingManager.prototype.openAuraUpgrade=function(){this.hookItemBuyButton.enabled=!1,this.rodItemBuyButton.enabled=!1,this.app.fire("TabsFixed:SelectMenu","Aura"),this.app.fire("PopupManager:Show","RodShop")},FishingManager.prototype.openHookBuy=function(e){let t=this.hookItemsArray.length;for(;t--;)this.hookItemsArray[t].destroy();if(this.hookItemsArray=[],this.hookItem.enabled=!1,this.hooks.forEach((e=>{const t=e.script.hook,i=this.hookItem.clone();i.enabled=!0,i.findByName("Icon").element.textureAsset=t.icon,i.findByName("Name").element.text=e.name,i.findByName("Rarity").element.text=0===t.chance?"":`+${t.chance}% ${t.rarities}`,i.findByName("Rarity").element.color=this.getColorByRarity(t.rarities),pc.IdleManager.Hooks.indexOf(e.name)>-1?i.findByName("Equipped").enabled=!0:i.findByName("Locked").enabled=!0;const a=this.hooks.indexOf(e)+1;i.findByName("lvl").element.text=`LVL-${a}`,this.hookItemHolder.addChild(i),this.hookItemsArray.push(i)})),this.hookItemsArray.length){var i=this.hookItemsArray[this.hookItemsArray.length-1].findByName("Arrow");i&&(i.enabled=!1)}const a=this.hooks[this.lvlHook+1];this.hookItemBuyButton.enabled=!0,this.rodItemBuyButton.enabled=!1,a?(this.hookItemBuyButton.findByName("Text").element.text="Upgrade",this.hookItemBuyButton.findByName("MoneyValue").element.text="$"+a.script.hook.price):(this.hookItemBuyButton.findByName("Text").element.text="All Hooks",this.hookItemBuyButton.findByName("MoneyValue").element.text="Unlocked"),setTimeout((()=>{var e=this.scrollbarHook.scrollview,t=this.scrollbarHook.findByName("Hooks")||this.hookItemHolder.parent,i=this.scrollbarHook.findByName("Viewport"),a=Math.min(this.lvlHook,this.hookItemsArray.length-1);if(a>=0&&a<this.hookItemsArray.length&&e){var s=this.hookItemsArray[a];if(s&&t&&i){var n=s.getLocalPosition().x,r=new pc.Vec2;r.copy(e.scroll);var o=n/(t.element.width-i.element.width);r.x=pc.math.clamp(o-.12,0,1),e.scroll=r}}}),100),e||(this.app.fire("TabsFixed:SelectMenu","Hooks"),this.app.fire("PopupManager:Show","RodShop"))},FishingManager.prototype.buyHook=function(){const e=this.lvlHook+1,t=this.hooks[e];if(!t)return void this.app.fire("Overlay:Message","All Hooks unlocked!");const i=t.script.hook,a=i.price;pc.IdleManager.Coin<a?this.showMoneyOffer(a):(this.app.fire("IdleManager:Add","Coin",-a),pc.IdleManager.Hooks=pc.IdleManager.Hooks||[],pc.IdleManager.Hooks.push(t.name),this.lvlHook=e,this.app.fire("IdleManager:Set","HookLevel",this.lvlHook),Utils.setItemAsArray("Hooks",pc.IdleManager.Hooks),this.hookItemGotName.element.text=t.name,this.hookItemGotIcon.element.textureAsset=i.icon,this.app.fire("PopupManager:Show","ShowHookGot"))},FishingManager.prototype.openRodBuy=function(e){pc.IdleManager.TutorialIndex;for(var t=this.rodItemsArray.length;t--;)this.rodItemsArray[t].destroy();for(var i in this.rodItemsArray=[],this.rodItem.enabled=!1,this.rods){var a=this.rods[i],s=this.rodItem.clone();this.getRodLevelByName(a.name);s.enabled=!0,s.script.button.value=a.name,s.findByName("Icon").element.textureAsset=a.script.rod.icon,s.findByName("Name").element.text=a.name,s.findByName("Price").element.text=Utils.numberScaleWithoutFloat(a.script.rod.price),s.findByName("Power").element.text=parseInt(100*a.script.rod.power),s.findByName("Level").element.text='[color="#FFFFFF"]Depth:[/color] '+a.script.rod.depth+"mt";var n=pc.IdleManager.Rods.indexOf(a.name)>-1;n?(this.lvlRod=this.getRodLevelByName(a.name),s.findByName("Equipped").enabled=!0):s.findByName("Locked").enabled=!0;var r=Utils.getItem("CurrentLevel"),o=parseInt(i,10),h=this.rods.length;!n&&"Level-1"===r&&o>=h-3?(s.findByName("LockLevel").enabled=!0,s.script.button.enabled=!1):s.findByName("LockLevel").enabled=!1,this.rodItemHolder.addChild(s),this.rodItemsArray.push(s)}if(this.rodItemsArray.length){var l=this.rodItemsArray[this.rodItemsArray.length-1].findByName("Arrow");l&&(l.enabled=!1)}var d=this.getRodNameByLevel(this.lvlRod+1);a=this.getRodByName(d);if(this.hookItemBuyButton.enabled=!1,this.rodItemBuyButton.enabled=!0,d?this.rodItemBuyButton.findByName("MoneyValue").element.text="$"+Utils.numberScaleWithoutFloat(a.script.rod.price):(this.rodItemBuyButton.findByName("Text").element.text="All Rods",this.rodItemBuyButton.findByName("MoneyValue").element.text="Unlocked!"),setTimeout((()=>{var e=this.scrollBar.scrollview,t=this.scrollBar.findByName("Rods")||this.rodItemHolder.parent,i=this.scrollBar.findByName("Viewport"),a=Math.min(this.lvlRod,this.rodItemsArray.length-1);if(a>=0&&a<this.rodItemsArray.length&&e){var s=this.rodItemsArray[a];if(s&&t&&i){var n=s.getLocalPosition().x,r=new pc.Vec2;r.copy(e.scroll);var o=n/(t.element.width-i.element.width);r.x=pc.math.clamp(o-.12,0,1),e.scroll=r}}}),100),1==this.lvlRod){for(var p=0;p<this.rodItemHolder.length;p++){var c=this.rodItemHolder[p].findByName("Price");c&&(c.element.text="FREE")}this.rodItemBuyButton.findByName("MoneyValue").element.text="FREE"}e||(this.app.fire("TabsFixed:SelectMenu","Rods"),this.app.fire("PopupManager:Show","RodShop"))},FishingManager.prototype.showRodBuy=function(e){var t=this.getRodByName(e);t||console.log("Rod doesnt exist!"),this.currentBuyRod=t,this.rodItemName.element.text=t.name,this.rodItemIcon.element.textureAsset=t.script.rod.icon,this.rodItemPower.element.text=parseInt(10*t.script.rod.power)+"%",this.rodItemChance.element.text=t.script.rod.chance;const i=pc.IdleManager.TutorialIndex||0;this.rodItemPrice.element.text=1===i?"FREE":Utils.numberScaleWithoutFloat(t.script.rod.price),this.app.fire("PopupManager:Show","ShowRodBuy")},FishingManager.prototype.buyRod=function(e){this.doBuy("Default")},FishingManager.prototype.showMoneyOffer=function(e){Date.now()-this.lastMoneyOffer<5e4?this.app.fire("Overlay:Message","Not enough money!"):(e||(e=250),e<=0&&(e=250),e>2e3&&(e=2e3),this.offerAmount=e,this.offerAmountText.element.text="$"+e,this.app.fire("PopupManager:Show","OfferMoney"),this.lastMoneyOffer=Date.now())},FishingManager.prototype.acceptMoneyOffer=function(){var e=this;PokiPlugin.showReward((function(){pc.app.fire("IdleManager:Add","Coin",e.offerAmount),pc.app.fire("PopupManager:Hide")}))},FishingManager.prototype.doBuy=function(e){pc.IdleManager.TutorialIndex;var t=this.lvlRod+1,i=this.getRodNameByLevel(t),a=this.getRodByName(i),s=Utils.getItem("CurrentLevel"),n=this.rods.length;if(!("Level-1"===s&&t>=n-2))return 1==this.lvlRod?(pc.IdleManager.Rods.push(i),this.app.fire("IdleManager:Set","RodLevel",t),Utils.setItemAsArray("Rods",pc.IdleManager.Rods),this.rodItemGotName.element.text=i,this.rodItemGotIcon.element.textureAsset=a.script.rod.icon,this.currentRod=a,this.app.fire("PopupManager:Show","ShowRodGot"),this.app.fire("IdleManager:Set","TutorialIndex",2),void this.app.fire("FishingManager:RodChanged")):void(a?pc.IdleManager.Coin<a.script.rod.price&&"Default"===e?this.showMoneyOffer(a.script.rod.price):pc.IdleManager.Rods.indexOf(i)>-1?this.app.fire("Overlay:Message","You have one "+i+" already!"):(this.rodItemGotName.element.text=i,this.rodItemGotIcon.element.textureAsset=a.script.rod.icon,"Default"===e&&this.app.fire("IdleManager:Add","Coin",-a.script.rod.price),pc.IdleManager.Rods.push(i),this.app.fire("IdleManager:Set","RodLevel",this.lvlRod+1),this.app.fire("IdleManager:Set","RodPower",100*a.script.rod.power),this.app.fire("NetworkManager:Send","changeRodPower",100*a.script.rod.power),Utils.setItemAsArray("Rods",pc.IdleManager.Rods),this.app.fire("PopupManager:Show","ShowRodGot"),this.currentBuyRod=a,this.currentRod=a,this.app.fire("FishingManager:RodChanged")):this.app.fire("Overlay:Message","You are the best Fisherman, we can't offer you more rods!"));this.app.fire("Overlay:Message","You need to reach the world 2 to unlock this rod.")},FishingManager.prototype.openSell=function(){this.updateInventory(),this.setBiggestFish(),this.selectFish(0),this.app.fire("PopupManager:Show","SellFishList")},FishingManager.prototype.selectFish=function(e){this.lockSellText.enabled=!1,this.currentSellIndex=e;var t=pc.IdleManager.Inventory[e];if(!t)return this.fishSelectedSellPrice.element.text=0,this.sellAllValue.element.text=0,this.lockSellText.enabled=!0,void this.app.fire("PopupManager:Hide");var i=t.name||t,a=this.getFishByName(i),s=t.stack||1;if(!a)return this.fishSelectedSellPrice.element.text=0,this.sellAllValue.element.text=0,this.lockSellText.enabled=!0,void this.app.fire("Overlay:Message","An error occured!");var n=this.getSellAllPrice(3);this.sellAllValue.element.text=n;for(var r=0;r<this.sellHolder.children.length;r++){var o=new pc.Color(.0157,.498,.741);this.sellHolder.children[r].element.color=o}var h=new pc.Color(0,.918,.114),l=(this.sellHolder.children[e+1].element.color=h,a.script.fish.price*s);this.fishSelectedSellPrice.element.text=l},FishingManager.prototype.sellFish=function(e){this.sellFishUI.findByName("2xRewardActive").enabled=this.moneyBonusActive,this.sellFishUI.findByName("2xReward").enabled=!this.moneyBonusActive,this.sellFishUI.findByName("x2Element").enabled=this.moneyBonusActive,this.sellFishUI.findByName("SellButton").enabled=!this.moneyBonusActive,this.currentSellIndex=e;var t=pc.IdleManager.Inventory[e],i=t.name||t,a=this.getFishByName(i),s=t.stack||1;if(a){this.fishSellIcon.element.textureAsset=a.script.fish.icon,this.fishSellName.element.text=i,this.fishSellRarity.element.text=a.script.fish.rarity,this.fishSellRarity.element.color=this.getColorByRarity(a.script.fish.rarity);var n=void 0!==t.weight?t.weight:a.script.fish.weight;this.fishSellWeight.element.text=n+"KG";var r=a.script.fish.price*s;this.fishSellPrice.element.text=r,s>1&&(this.fishSellName.element.text=i+" (x"+s+")"),this.app.fire("PopupManager:Show","SellFish")}else this.app.fire("Overlay:Message","An error occured!")},FishingManager.prototype.getSellAllPrice=function(e){for(var t=pc.IdleManager.Inventory,i=0,a=0;a<t.length;a++){var s=t[a],n=s.name||s,r=this.getFishByName(n),o=s.stack||1;r&&(i+=r.script.fish.price*o)}return i=Math.floor(i*e)},FishingManager.prototype.sellAllFishReward=function(){if(0!==this.getSellAllPrice(3)){var e=this;PokiPlugin.showReward((function(){e.doSellAll("ByRewardAds")}))}},FishingManager.prototype.doSellAll=function(e){var t=this.getSellAllPrice("ByRewardAds"===e?3:1);const i=this.getMoneyAuraMultiplier();t=Math.floor(t*i);for(var a=Math.min(t,50),s=0;s<a;s++)setTimeout((function(e){pc.app.fire("World2Screen:Animate","Coin",e.playerEntity.getPosition(),e.coinDisplay)}),10*s,this);this.app.fire("IdleManager:Add","Coin",t),pc.IdleManager.Inventory=[],Utils.setItemAsArray("Inventory",pc.IdleManager.Inventory),this.updateInventory(),this.setBiggestFish(),this.app.fire("Overlay:Message","Sold all fish for "+t+" coins!")},FishingManager.prototype.doSellReward=function(){this.moneyBonusActive||this.activateTemporaryBonus("money"),this.doSell("Reward")},FishingManager.prototype.doSell=function(e){var t=this.currentSellIndex,i=pc.IdleManager.Inventory,a=parseInt(t),s=i[t];if(!s)return;var n=s.name||s,r=this.getFishByName(n),o=s.stack||1,h=r.script.fish.price*o;this.moneyBonusActive&&(d*=2);const l=this.getMoneyAuraMultiplier(),d=Math.floor(h*l);for(var p=Math.min(d,50),c=0;c<p;c++)setTimeout((function(e){pc.app.fire("World2Screen:Animate","Coin",e.playerEntity.getPosition(),e.coinDisplay)}),10*c,this);this.app.fire("IdleManager:Add","Coin",d),pc.IdleManager.Inventory.splice(a,1),Utils.setItemAsArray("Inventory",pc.IdleManager.Inventory),this.updateInventory(),this.setBiggestFish(),this.selectFish(0)},FishingManager.prototype.scrollRodView=function(e){if(this.rodItemsArray&&0!==this.rodItemsArray.length){if("left"===e)this.lvlRod=Math.max(0,this.lvlRod-1);else{if("right"!==e)return void console.warn("scrollRodView: Unknown direction",e);this.lvlRod=Math.min(this.rodItemsArray.length-1,this.lvlRod+1)}var t=this.scrollBar.scrollview,i=this.scrollBar.findByName("Content")||this.rodItemHolder.parent,a=this.scrollBar.findByName("Viewport"),s=this.lvlRod;if(s>=0&&s<this.rodItemsArray.length&&t){var n=this.rodItemsArray[s];if(n&&i&&a){var r=n.getLocalPosition().x,o=new pc.Vec2;o.copy(t.scroll);var h=r/(i.element.width-a.element.width);o.x=pc.math.clamp(h-.12,0,1),t.scroll=o}}}},FishingManager.prototype.doSpaceBar=function(){var e=this;PokiPlugin.showReward((function(){e.spaceBarOnReward=!0,e.spaceBonusActive=!0,e.spaceBonusEndTime=Date.now()+1e3*e.spaceBonusDuration,e.app.fire("PopupManager:Hide"),e.spaceBarUI&&(e.spaceBarUI.enabled=!0),e.selectRod(e.currentRod.name)}))},FishingManager.prototype.onKeyDown=function(e){var t=e.key;if(this.onUserInteraction(),t!=pc.KEY_W&&t!=pc.KEY_S&&t!=pc.KEY_A&&t!=pc.KEY_D&&t!=pc.KEY_UP&&t!=pc.KEY_DOWN&&t!=pc.KEY_LEFT&&t!=pc.KEY_RIGHT||this.setFishingPoint(!1),t===pc.KEY_SPACE&&(!this.isSpacebarDown||this.spaceBarOnReward?(this.isSpacebarDown=!0,this.onClick()):this.fishingOverlay.enabled&&this.app.fire("PopupManager:Show","enableSpam")),t>=pc.KEY_1&&t<=pc.KEY_9){var i=t-pc.KEY_1;this.holdFishByIndex(i)}t==pc.KEY_F&&this.openFishDeck()},FishingManager.prototype.onKeyUp=function(e){e.key===pc.KEY_SPACE&&(this.isSpacebarDown=!1)},FishingManager.prototype.onDestroy=function(){this.app.off("FishingManager:SetFishingPoint",this.setFishingPoint,this),this.app.off("FishingManager:SelectRod",this.selectRod,this),this.app.off("FishingManager:OpenFishDeck",this.openFishDeck,this),this.app.off("FishingManager:SellAllFishReward",this.sellAllFishReward,this),this.app.off("FishingManager:ActivateTemporaryBonus",this.activateTemporaryBonus,this),this.app.off("FishingManager:SpaceBar",this.doSpaceBar,this),this.app.off("FishingManager:ScrollRodView",this.scrollRodView,this),this.app.off("FishingManager:TransferToStorage",this.transferToStorage,this),this.app.off("FishingManager:TransferFromStorage",this.transferFromStorage,this)},FishingManager.prototype.getRodByName=function(e){return this.rods.find((function(t){return t.name==e}))},FishingManager.prototype.getHookLevelByName=function(e){return this.hooks.find((function(t){return t.name==e}))},FishingManager.prototype.adjustSellHolderHeight=function(){var e=this.rodInventory.length;this.rodInventoryHolder.element.height=110*e},FishingManager.prototype.setFishingPoint=function(e){if(this.headerEntity.enabled=!1,!e)return this.stop(),this.reset(),this.interface.enabled=!1,this.catchedFishEntity.enabled=!1,this.playerEntity.script.player.isFocusing=!1,this.setInterfaceState(!1),void clearTimeout(this.catchedFishTimer);for(var t=this.fishingPoingFishRarity.children.slice(),i=1;i<t.length;i++)t[i].tags.has("deleteMe")&&t[i].destroy();this.rodLevelDisplay.element.text=`LVL ${this.lvlRod}`;for(t=this.selectRodFishRarity.children.slice(),i=1;i<t.length;i++)t[i].tags.has("deleteMe")&&t[i].destroy();this.currentPoint=e,this.depth=e.script.fishing.targetDepth,this.targetDepth.element.text=this.depth+" mt";for(i=this.rodInventory.length;i--;)this.rodInventory[i].destroy();this.rodInventory=[];var a=pc.IdleManager.Rods,s=(pc.IdleManager.Hooks,{Common:0,Uncommon:1,Epic:2,Obsidian:3,Galactic:4});for(var n in a=a.slice(-1)){var r=a[n],o=this.rodInventoryItem.clone(),h=o.findByName("ContentRarities");for(t=h.children.slice(),i=1;i<t.length;i++)t[i].tags.has("deleteMe")&&t[i].destroy();var l=this.getRodByName(r);o.enabled=!0,o.tags.add("deleteMe"),o.findByName("Name").element.text=l.name,o.findByName("Icon").element.textureAsset=l.script.rod.icon,o.findByName("Power").element.text=parseInt(10*l.script.rod.power)+"%",o.script.button.value=l.name;var d=l.script.rod.rarities.split(", "),p=this.currentPoint.script.fishing.rarities.split(", "),c=0,g=0;for(var n in p){var y=p[n];g=Math.max(g,s[y])}for(var n in d){y=d[n];c=Math.max(c,s[y])}var u=l.script.rod.depth<this.currentPoint.script.fishing.targetDepth;o.findByName("Lock").enabled=u,o.script.button.enabled=!u;var m=o.findByName("rarityLevels");for(i=1;i<m.children.length;i++)m.children[i].tags.has("deleteMe")&&m.children[i].destroy();for(i=0;i<d.length;i++){var f=m.findByName("RarityDisplay").clone();f.enabled=!0,f.tags.add("deleteMe"),f.element.text=d[i],m.addChild(f)}var M=0;for(i=0;i<this.fishes.length&&M<5;i++){if((I=this.fishes[i]).script.fish.depth<=this.depth&&-1!==d.indexOf(I.script.fish.rarity)){var v=o.findByName("ItemRare").clone();v.tags.add("deleteMe"),v.enabled=!0,v.findByName("Icon").element.textureAsset=I.script.fish.icon,h.addChild(v),M++}}this.rodInventoryHolder.addChild(o),this.rodInventory.push(o),this.currentRod=l}if(this.currentPoint&&this.currentPoint.script.fishing&&this.currentPoint.script.fishing.rarities){var B=this.currentPoint.script.fishing.rarities.split(", "),F=this.currentPoint.script.fishing.fishes;for(i=this.fishesPointArray.length;i--;)this.fishesPointArray[i].destroy();for(var b in this.fishesPointArray=[],F){var I=F[b],S=this.fishesPointItem.clone();S.findByName("Icon").element.textureAsset=I.script.fish.icon,S.findByName("Name").element.text=I.name,S.findByName("Rarity").element.text=I.script.fish.rarity,S.findByName("RarityDisplay").element.color=this.getColorByRarity(I.script.fish.rarity),S.findByName("Transparent").element.color=this.getColorByRarity(I.script.fish.rarity),S.enabled=!0,this.fishesPointHolder.addChild(S),this.fishesPointArray.push(S)}B.forEach(function(e){e=e.trim(),this.currentPoint.script.fishing.fishes.forEach(function(e){var t=this.selectRodFishItem.clone();t.enabled=!0,t.tags.add("deleteMe"),t.element.textureAsset=e.script.fish.icon,this.selectRodFishRarity.addChild(t)}.bind(this))}.bind(this))}this.adjustSellHolderHeight(),this.fishingDepth.element.text='[color="#3A3A3A"]Depth:[/color] '+this.currentPoint.script.fishing.targetDepth+"mt";var A=this.currentPoint.script.fishing.rarities.split(", ").map(function(e){var t=this.getColorByRarity(e);return'[color="'+("#"+Math.floor(255*t.r).toString(16).padStart(2,"0")+Math.floor(255*t.g).toString(16).padStart(2,"0")+Math.floor(255*t.b).toString(16).padStart(2,"0"))+'"]'+e+"[/color]"}.bind(this));this.fishingRarities.element.text='[color="#3A3A3A"]Rarities:[/color] '+A.join(", "),this.app.fire("PopupManager:Show","SelectRod")},FishingManager.prototype.setFishingPointMode=function(e,t){pc.IdleManager.Rods,pc.IdleManager.Hooks,this.lvlRod;var i=this.currentRod;this.currentPoint=e,this.depth=t,this.rodModel.render.asset=i.script.rod.model,this.rodModel.render.materialAssets=[i.script.rod.material],this.characterEntity.anim.setTrigger("StartFishing"),this.rodEntity.anim.setTrigger("StartFishing"),this.cameraEntity.enabled=!1,this.fishingCamera.enabled=!0,this.headerEntity.enabled=!0,this.playerEntity.script.player.focusDirection=90,this.playerEntity.script.player.isFocusing=!0,this.animationSpeed=1,this.fishingStarted=Date.now(),this.fishInterfaceMode.enabled=!0,this.power=0},FishingManager.prototype.selectRod=function(e){if(pc.IdleManager.Inventory.length>=this.maxSlots){var t=this.maxBagReachedButton.findByName("UpInventory");if(!t.enabled&&this.bagLevel>this.bagUpgradeLevels.length-2||this.backpackBonusActive)t.enabled=!1,this.maxBagReachedButton.findByName("OkButton").setLocalPosition(2.168,-340.35,0);return this.setFishingPoint(!1),this.app.fire("PopupManager:Show","FullInventory"),!1}var i=this.currentRod;if(i){this.rodModel.render.asset=i.script.rod.model,this.rodModel.render.materialAssets=[i.script.rod.material],this.characterEntity.anim.setTrigger("StartFishing"),this.rodEntity.anim.setTrigger("StartFishing"),this.cameraEntity.enabled=!1,this.fishingCamera.enabled=!0,this.headerEntity.enabled=!0;var a=this.currentPoint.findByName("Direction");if(a.tags&&a.tags.has("fix")){var s=a.getRotation().getEulerAngles().y;this.playerEntity.script.player.focusDirection=s}else{var n=a.forward.clone().add(this.currentPoint.getPosition().clone()).normalize();s=Math.atan2(n.z,n.x);this.playerEntity.script.player.focusDirection=s*pc.math.RAD_TO_DEG}this.playerEntity.script.player.isFocusing=!0,this.animationSpeed=1,this.fishingStarted=Date.now(),this.interface.enabled=!0,this.power=0,this.app.fire("PopupManager:Hide"),this.setInterfaceState(!0);for(var r=this.rodInventoryHolder.children.slice(),o=1;o<r.length;o++)this.rodInventoryHolder.removeChild(r[o]),r[o].destroy()}},FishingManager.prototype.setInterfaceState=function(e){this.overlayEntity.enabled=!e,this.fishingOverlay.enabled=e},FishingManager.prototype.reset=function(){this.power=0,this.animationSpeed=1,this.fishingStarted=Date.now(),this.characterEntity.anim.setTrigger("ResetFishing"),this.rodEntity.anim.setTrigger("ResetFishing")},FishingManager.prototype.stop=function(){this.characterEntity.anim.speed=1,this.rodEntity.anim.speed=1,this.fishingCamera.enabled&&(this.characterEntity.anim.setTrigger("EndFishing"),this.rodEntity.anim.setTrigger("EndFishing"),this.cameraEntity.enabled=!0,this.fishingCamera.enabled=!1)},FishingManager.prototype.addClickItem=function(e,t){var i=this.clickItem.clone();i.element.text=e,i.enabled=!0,i.createdAt=Date.now(),i.element.color=t;var a=this.clickHolder.element.width;i.setLocalPosition(Math.random()*a-Math.random()*a,Math.random()*a-Math.random()*a,0),this.clickHolder.addChild(i),this.clickArray.push(i)},FishingManager.prototype.updateClickItems=function(){for(var e=this.clickArray.length;e--;){var t=this.clickArray[e];Date.now()-t.createdAt>5e3&&(t.destroy(),this.clickArray.splice(e,1))}},FishingManager.prototype.onClick=function(){if(this.onUserInteraction(),this.catchedFishEntity.enabled)return void(this.waitingTime+=.5);if(!this.currentRod)return;if(!this.interface.enabled&&!this.fishInterfaceMode.enabled)return;const e=5*this.currentRod.script.rod.power,t=this.getCatchSpeedMultiplier();this.power+=e*t,this.animationSpeed+=.5*t,"BossFight"==Utils.getItem("CurrentLevel")?(this.fishInterfaceMode.findByName("WheelMode").rotateLocal(0,0,10*this.animationSpeed),this.fishInterfaceMode.findByName("FishIconMode").fire("Motion","Click",!0)):(this.wheelEntity.rotateLocal(0,0,10*this.animationSpeed),this.interfaceFish.fire("Motion","Click",!0))},FishingManager.prototype.getRandomFish=function(){var e={},t=1e4*Math.random();const i=this.getFishChanceMultiplier(),a=this.getHookBonusCuts();pc.IdleManager.Inventory.length,this.maxSlots;var s=this.currentPoint.script.fishing.fishes;for(var n in s){var r=s[n],o=r.script.fish.rarity;r&&r.script.fish.depth<=this.depth&&(e[o]||(e[o]=[]),e[o].push(r),r.script.fish.weight)}this.currentPoint.script.fishing.rarities.split(", ");const h=1*i+a.galactic,l=10*i+a.obsidian,d=100*i+a.epic,p=5e3*i+a.uncommon;if(t<h&&e.Galactic)return Utils.getRandom(e.Galactic);if(t<l&&e.Obsidian)return Utils.getRandom(e.Obsidian);if(t<d&&e.Epic)return Utils.getRandom(e.Epic);if(t<p&&e.Uncommon)return Utils.getRandom(e.Uncommon);const c=e.Common||[];if(c.length>0)return Utils.getRandom(c);if(e.Uncommon&&e.Uncommon.length>0)return Utils.getRandom(e.Uncommon);if(e.Epic&&e.Epic.length>0)return Utils.getRandom(e.Epic);if(e.Obsidian&&e.Obsidian.length>0)return Utils.getRandom(e.Obsidian);if(e.Galactic&&e.Galactic.length>0)return Utils.getRandom(e.Galactic);for(let t in e)if(e[t]&&e[t].length>0)return Utils.getRandom(e[t])},FishingManager.prototype.getColorByRarity=function(e){var t=new pc.Color;for(var i in this.rarities){var a=this.rarities[i];a.name==e&&(t=a.color)}return t},FishingManager.prototype.initializeFishDeck=function(){this.clearFishDeck(),this.updateFishDeckView()},FishingManager.prototype.clearFishDeck=function(){for(var e=this.fishDeckArray.length;e--;)this.fishDeckArray[e].destroy();this.fishDeckArray=[]},FishingManager.prototype.openFishDeck=function(){this.updateFishDeckView(),this.app.fire("PopupManager:Show","FishDeck")},FishingManager.prototype.selectFishDeckType=function(e){"Bosses"===e?(this.fishDeckScrollView.scrollview.contentEntity=this.fishDeckBosses,this.fishDeckFishCount.enabled=!1,this.fishDeckFish.enabled=!1,this.fishDeckBossCount.enabled=!0,this.fishDeckBosses.enabled=!0):"Fish"===e&&(this.fishDeckScrollView.scrollview.contentEntity=this.fishDeckFish,this.fishDeckBossCount.enabled=!1,this.fishDeckBosses.enabled=!1,this.fishDeckFishCount.enabled=!0,this.fishDeckFish.enabled=!0)},FishingManager.prototype.updateFishDeckView=function(){this.clearFishDeck();var e=pc.IdleManager.FishDeck||[],t=pc.IdleManager.BossDeck||[],i=e.concat(t);for(var a in this.fishes){var s=this.fishes[a],n=this.fishDeckItem.clone();n.enabled=!0;var r=s.tags.has("Boss"),o=i.indexOf(s.name)>-1,h=n.findByName("Image"),l=n.findByName("Name");o?(h.element.textureAsset=s.script.fish.icon,h.element.opacity=1,l.element.text=s.name,n.findByName("Rarity")&&(n.findByName("Rarity").element.text=s.script.fish.rarity,n.findByName("Rarity").element.color=this.getColorByRarity(s.script.fish.rarity)),n.findByName("Weight")&&(n.findByName("Weight").element.text=s.script.fish.weight+" kg"),n.findByName("MeterDisplay")&&(n.findByName("MeterDisplay").element.color=this.getColorByRarity(s.script.fish.rarity)),n.findByName("Transparent")&&(n.findByName("Transparent").findByName("Transparent").element.color=this.getColorByRarity(s.script.fish.rarity)),n.findByName("Depth")&&(n.findByName("Depth").element.text=s.script.fish.depth+" mt"),n.findByName("Price")&&(n.findByName("Price").element.text="$"+s.script.fish.price)):(h.element.textureAsset=s.script.fish.icon,h.element.color=new pc.Color(0,0,0,1),h.element.opacity=.5,l.element.text="???",n.findByName("Rarity")&&(n.findByName("Rarity").element.text="???",n.findByName("Rarity").element.color=new pc.Color(.5,.5,.5,1)),n.findByName("MeterDisplay")&&(n.findByName("MeterDisplay").enabled=!1),n.findByName("Weight")&&(n.findByName("Weight").element.text="? kg",n.findByName("Weight").enabled=!1),n.findByName("Depth")&&(n.findByName("Depth").element.text="? mt"),n.findByName("Price")&&(n.findByName("Price").element.text="$?")),r?this.fishDeckBosses.addChild(n):this.fishDeckFish.addChild(n),this.fishDeckArray.push(n)}},FishingManager.prototype.catchFish=function(e=null,t=null){if(this.catchedFishEntity.enabled)return!1;var i=null;if(i=e?this.getFishByName(e):this.getRandomFish()){this.catchedFishEntity.enabled=!0,this.interface.enabled=!1,this.headerEntity.enabled=!1,this.fishIcon.element.textureAsset=i.script.fish.icon,this.fishName.element.text=i.name,this.fishRarity.element.text=i.script.fish.rarity;var a=null!==t?t:i.script.fish.weight;this.fishWeight.element.text=a+" kg",this.fishRarityColor.element.text=this.getColorByRarity(i.script.fish.rarity),this.app.fire("IdleManager:Add","Score",1),this.app.fire("IdleManager:Add","Fishes",1),e||(this.characterEntity.anim.setTrigger("CatchFish"),this.rodEntity.anim.setTrigger("CatchFish")),i.tags.has("Boss")?-1===pc.IdleManager.BossDeck.indexOf(i.name)&&(pc.IdleManager.BossDeck.push(i.name),Utils.setItemAsArray("BossDeck",pc.IdleManager.BossDeck),this.updateFishDeck(),this.updateFishDeckView()):-1===pc.IdleManager.FishDeck.indexOf(i.name)&&(pc.IdleManager.FishDeck.push(i.name),this.app.fire("IdleManager:Set","UniqueFishes",pc.IdleManager.FishDeck.length),this.fishAchivement.fire("Timeline:Achivement"),Utils.setItemAsArray("FishDeck",pc.IdleManager.FishDeck),this.updateFishDeck(),this.updateFishDeckView());var s=i.script.fish.serialize();null!==t&&(s.weight=t);for(var n=pc.IdleManager.Inventory,r=!1,o=0;o<n.length;o++){var h=void 0!==n[o].weight?n[o].weight:i.script.fish.weight,l=void 0!==s.weight?s.weight:i.script.fish.weight;if(n[o].name===i.name&&n[o].stack<5&&h===l){n[o].stack++,r=!0;break}}r||(n.length<this.maxSlots?(s.stack=1,n.push(s)):this.app.fire("Overlay:Message","Inventory is full!")),Utils.setItemAsArray("Inventory",pc.IdleManager.Inventory),this.updateInventory(),this.setBiggestFish(),this.waitingTime=0}else console.log("Fish doesnt exist!")},FishingManager.prototype.findFishInInventory=function(e){for(var t=pc.IdleManager.Inventory,i=0;i<t.length;i++)if(t[i].name===e)return i;return-1},FishingManager.prototype.updateFishDeck=function(){this.fishAchivementText.element.text=pc.IdleManager.FishDeck.length+" / "+this.fishes.length,this.fishDeckButton.element.text=pc.IdleManager.FishDeck.length+" / "+this.fishes.length,this.fishDeckFishCount.element.text=pc.IdleManager.FishDeck.length+" / "+(this.fishes.length-this.bosses.length),this.fishDeckBossCount.element.text=pc.IdleManager.BossDeck.length+" / "+this.bosses.length},FishingManager.prototype.finalizeCatchedFish=function(){if(this.catchedFishEntity.enabled=!1,this.interface.enabled=!0,this.headerEntity.enabled=!0,pc.IdleManager.Inventory.length>=this.maxSlots){this.setFishingPoint(!1);var e=this.maxBagReachedButton.findByName("UpInventory");!e.enabled&&this.bagLevel>this.bagUpgradeLevels.length-2&&(e.enabled=!1,this.maxBagReachedButton.findByName("OkButton").setLocalPosition(2.168,-340.35,0)),this.app.fire("PopupManager:Show","FullInventory")}else{if(this.currentlyHeldFishIndex>=0&&this.currentlyHeldFishIndex<pc.IdleManager.Inventory.length){var t=pc.IdleManager.Inventory[this.currentlyHeldFishIndex],i=t.name||t,a=this.getFishByName(i);if(a){var s=void 0!==t.weight?t.weight:a.script.fish.weight,n=this.scaleFishModel(s,a.script.fish.weight,a);this.playerEntity.script.player.fishModel.model.asset=a.script.fish.model,this.playerEntity.script.player.fishModel.setLocalScale(n,n,n),this.app.fire("NetworkManager:Send","holdFish",{fishName:i,fishModel:a.script.fish.model.id})}}this.reset()}},FishingManager.prototype.setBiggestFish=function(){if(!(this.currentlyHeldFishIndex>=0)){var e=this.getBiggestFish();e?(this.playerEntity.script.player.fishModel.model.asset=e.model,this.app.fire("NetworkManager:Send","holdFish",{fishName:e.name,fishModel:e.model.id})):(this.playerEntity.script.player.fishModel.model.asset=null,this.app.fire("NetworkManager:Send","holdFish",null))}},FishingManager.prototype.getBiggestFish=function(){var e=pc.IdleManager.Inventory,t=null,i=0;for(var a in e){var s=e[a];if(s&&s.name){var n=this.getFishByName(s.name||s).script.fish;n.weight>=i&&(t=n,i=n.weight)}}return t},FishingManager.prototype.clearStorageLoot=function(){for(var e=this.storageHolder.children.length;e--;){var t=this.storageHolder.children[e];t.findByName("FishName").enabled=!1,t.findByName("MeterDisplay").enabled=!1,t.findByName("Image").enabled=!1}},FishingManager.prototype.clearStoreLoot=function(){for(var e=this.storeLoot.children.length;e--;){var t=this.storeLoot.children[e];t.findByName("FishName").enabled=!1,t.findByName("MeterDisplay").enabled=!1,t.findByName("Image").enabled=!1}},FishingManager.prototype.clearInventory=function(){for(var e=this.inventoryArray.length;e--;)this.inventoryArray[e].destroy(),this.sellArray[e].destroy(),this.fishingArray[e].destroy();this.inventoryArray=[],this.sellArray=[],this.fishingArray=[]},FishingManager.prototype.getFishByName=function(e){return this.fishes.find((function(t){return e==t.name}))},FishingManager.prototype.holdFishByIndex=function(e){var t=pc.IdleManager.Inventory;if(!((e=parseInt(e))<0||e>=t.length)){if(this.currentlyHeldFishIndex===e)this.playerEntity.script.player.fishModel.model.asset=null,this.currentlyHeldFishIndex=-1,this.app.fire("NetworkManager:Send","holdFish",null);else{var i=t[e],a=i.name||i,s=this.getFishByName(a);if(s){var n=void 0!==i.weight?i.weight:s.script.fish.weight,r=this.scaleFishModel(n,s.script.fish.weight,s);this.playerEntity.script.player.fishModel.model.asset=s.script.fish.model,this.playerEntity.script.player.fishModel.setLocalScale(r,r,r),this.currentlyHeldFishIndex=e,this.app.fire("NetworkManager:Send","holdFish",{fishName:a,fishModel:s.script.fish.model.id})}}this.updateInventoryActiveState()}},FishingManager.prototype.scaleFishModel=function(e,t,i){if(!t)return 1;if(i&&i.tags&&i.tags.has("Boss"))return 1.64;var a=1.64*(e/10/t);return Math.max(.3,Math.min(a,17))},FishingManager.prototype.updateInventoryActiveState=function(){for(var e=0;e<this.inventoryArray.length;e++){var t=this.inventoryArray[e];t.findByName("Active")&&(t.findByName("Active").enabled=e===this.currentlyHeldFishIndex)}},FishingManager.prototype.updateChestStorage=function(){var e=pc.IdleManager.FishStorage;for(var t in this.clearStorageLoot(),e){var i=e[t],a=i.name||i,s=this.getFishByName(a),n=i.stack||1;if(s){var r=this.storageHolder.children[t];r.enabled=!0;var o=r.findByName("FishName"),h=r.findByName("Weight"),l=r.findByName("Image"),d=r.findByName("MeterDisplay"),p=void 0!==i.weight?i.weight:s.script.fish.weight;o.element.text=s.name,h.element.text=p+" kg",l.element.textureAsset=s.script.fish.icon,o.enabled=!0,h.enabled=!0,l.enabled=!0,d.enabled=!0,d.element.color=this.getColorByRarity(s.script.fish.rarity),r.findByName("Stack")&&(r.findByName("Stack").element.text=n>1?"x"+n:""),r.findByName("Rarity")&&(r.findByName("Rarity").element.text=s.script.fish.rarity,r.findByName("Rarity").element.color=this.getColorByRarity(s.script.fish.rarity))}}},FishingManager.prototype.transferToStorage=function(e){var t=pc.IdleManager.Inventory,i=pc.IdleManager.FishStorage;if(i.length>=this.storageCurrentMaxSlots)this.app.fire("Overlay:Message","Storage chest is full! Upgrade it or remove some items.");else{var a=parseInt(e);if(!(a<0||a>=t.length)){var s=pc.IdleManager.Inventory[a];s&&(pc.IdleManager.FishStorage.push(s),pc.IdleManager.Inventory.splice(a,1),Utils.setItemAsArray("Inventory",t),Utils.setItemAsArray("FishStorage",i),this.updateInventory(),this.updateChestStorage(),this.setBiggestFish())}}},FishingManager.prototype.transferFromStorage=function(e){var t=pc.IdleManager.Inventory,i=pc.IdleManager.FishStorage;if(t.length>=this.maxSlots)this.app.fire("Overlay:Message","Inventory is full! Sell some fish or upgrade your bag.");else{var a=parseInt(e),s=pc.IdleManager.FishStorage[a];s&&(pc.IdleManager.FishStorage.splice(a,1),pc.IdleManager.Inventory.push(s),Utils.setItemAsArray("Inventory",t),Utils.setItemAsArray("FishStorage",i),this.updateInventory(),this.updateChestStorage(),this.setBiggestFish())}},FishingManager.prototype.endChestBonus=function(){this.chestBonusActive&&(this.storageCurrentMaxSlots=this.normalChestStorage,Utils.setItem("StorageMaxSlots",this.storageCurrentMaxSlots),this.checkStorageSlots(),this.updateChestStorage(),this.chestBonusActive=!1,this.app.fire("Overlay:Message","Chest storage bonus expired"),this.chestUI&&(this.chestUI.enabled=!1))},FishingManager.prototype.updateInventory=function(){var e=pc.IdleManager.Inventory,t=this.slotsPendingRemoval?Math.max(pc.IdleManager.Inventory.length,this.maxSlots):this.maxSlots;this.clearInventory(),this.clearStoreLoot();for(let f=0;f<e.length&&f<t;f++){if(e[f]&&e[f].name){var i=this.getFishByName(e[f].name||e[f]),a=e[f],s=this.itemEntity.clone(),n=this.sellEntity.clone(),r=this.fishingItem.clone(),o=void 0!==a.weight?a.weight:i.script.fish.weight,h=null;if(this.storeLoot){var l=this.storeLoot.children[f];if(l){var d=l.findByName("FishName"),p=l.findByName("Weight"),c=l.findByName("MeterDisplay"),g=l.findByName("Image");d.element.text=i.name,d.enabled=!0,p.element.text=o+" kg",p.enabled=!0,g.element.textureAsset=i.script.fish.icon,g.enabled=!0,c.enabled=!0,c.element.color=this.getColorByRarity(i.script.fish.rarity)}}}var y=a.stack||1;let t=i.script.fish.rarity;var u=this.getColorByRarity(t);s.enabled=!0,s.findByName("Icon").element.textureAsset=i.script.fish.icon,s.findByName("Weight").element.text=o+" kg",s.findByName("Border").element.color=u,s.findByName("Label").element.color=u,s.findByName("KeyBind")&&(s.findByName("KeyBind").element.text=(parseInt(f)+1).toString()),s.findByName("Active")&&(s.findByName("Active").enabled=parseInt(f)===this.currentlyHeldFishIndex),s.script.button.value=f.toString(),s.findByName("Stack")&&(s.findByName("Stack").element.text=y>1?"x"+y:""),r.enabled=!0,r.findByName("Icon").element.textureAsset=i.script.fish.icon,r.findByName("Weight").element.text=o+" kg",r.findByName("Content").script.timeline.enabled=parseInt(f)===e.length-1,r.findByName("KeyBind")&&(r.findByName("KeyBind").element.text=(parseInt(f)+1).toString()),r.findByName("Active")&&(r.findByName("Active").enabled=parseInt(f)===this.currentlyHeldFishIndex),r.findByName("Stack")&&(r.findByName("Stack").element.text=y>1?"x"+y:""),n.findByName("Icon").element.textureAsset=i.script.fish.icon,n.findByName("KG").element.text=o+" kg",n.findByName("FishName").element.text=i.name,n.script.button.value=f,n.findByName("Stack")&&(n.findByName("Stack").element.text=y>1?"x"+y:"1x"),n.enabled=!0;var m=n.findByName("MeterDisplay");if(m&&m.element){u=this.getColorByRarity(t);m.element.color=u}this.inventoryHolder.addChild(s),this.inventoryArray.push(s),this.fishingHolder.addChild(r),this.fishingArray.push(r),this.sellHolder.addChild(n),this.sellArray.push(n),h&&this.storeLoot&&this.storeLoot.addChild(h)}for(var f=e.length;f<t;f++){s=this.itemEntity.clone(),n=this.sellEntity.clone(),r=this.fishingItem.clone();s.enabled=!0,s.findByName("Content").enabled=!1,s.findByName("KeyBind")&&(s.findByName("KeyBind").element.text=""),s.findByName("Active")&&(s.findByName("Active").enabled=!1),r.enabled=!0,r.findByName("Content").enabled=!1,this.inventoryHolder.addChild(s),this.inventoryArray.push(s),this.fishingHolder.addChild(r),this.fishingArray.push(r),this.sellHolder.addChild(n),this.sellArray.push(n)}this.inventoryMessage.enabled=0===e.length,this.sellAllFish.enabled=!(0===e.length),this.currentlyHeldFishIndex>=e.length&&(this.currentlyHeldFishIndex=-1,this.playerEntity.script.player.fishModel.model.asset=null,this.app.fire("NetworkManager:Send","holdFish",null)),this.setBiggestFish(),this.slotsPendingRemoval&&(this.displayedSlots=Math.max(e.length,this.maxSlots),this.displayedSlots===this.maxSlots&&(this.slotsPendingRemoval=!1))},FishingManager.prototype.update=function(e){if(Date.now()-this.lastClickTime>=this.inactivityTimeout&&!this.inactivityUI.enabled&&this.fishingOverlay.enabled&&(Utils.isMobile()&&(this.inactivityUI.findByName("Tap").enabled=!0,this.inactivityUI.findByName("Cursor").enabled=!1,this.inactivityUI.findByName("Text").element.text="Tap to fish!",this.inactivityUI.findByName("Text2").enabled=!1,this.inactivityUI.findByName("Text3").enabled=!1,this.inactivityUI.findByName("Image").enabled=!1),this.inactivityUI.enabled=!0),!this.fishingOverlay.enabled&&this.inactivityUI.enabled&&(this.inactivityUI.enabled=!1),this.rodBonusActive&&Date.now()>this.rodBonusEndTime&&this.endRodBonus(),this.chestBonusActive&&Date.now()>this.chestBonusEndTime&&this.endChestBonus(),this.backpackBonusActive&&Date.now()>this.backpackBonusEndTime&&this.endBackpackBonus(),this.moneyBonusActive&&Date.now()>this.moneyBonusEndTime&&this.endMoneyBonus(),this.spaceBonusActive&&Date.now()>this.spaceBonusEndTime&&(this.spaceBarOnReward=!1,this.spaceBonusActive=!1,this.spaceBonusEndTime=0,this.app.fire("Overlay:Message","Spammable SpaceBar Timer is expired!"),this.spaceBarUI&&(this.spaceBarUI.enabled=!1)),this.spaceBonusActive&&this.spaceBonusTimer){var t=Math.max(0,(this.spaceBonusEndTime-Date.now())/1e3),i=Math.floor(t/60),a=Math.floor(t%60);this.spaceBonusTimer.element.text=i+":"+(a<10?"0":"")+a}if(this.chestBonusActive&&this.chestBonusTimer){t=Math.max(0,(this.chestBonusEndTime-Date.now())/1e3),i=Math.floor(t/60),a=Math.floor(t%60);this.chestBonusTimer.element.text=i+":"+(a<10?"0":"")+a}if(this.rodBonusActive&&this.rodBonusTimer){t=Math.max(0,(this.rodBonusEndTime-Date.now())/1e3),i=Math.floor(t/60),a=Math.floor(t%60);this.rodBonusTimer.element.text=i+":"+(a<10?"0":"")+a}if(this.backpackBonusActive&&this.backpackBonusTimer){t=Math.max(0,(this.backpackBonusEndTime-Date.now())/1e3),i=Math.floor(t/60),a=Math.floor(t%60);this.backpackBonusTimer.element.text=i+":"+(a<10?"0":"")+a}if(this.moneyBonusActive&&this.moneyBonusTimer){t=Math.max(0,(this.moneyBonusEndTime-Date.now())/1e3),i=Math.floor(t/60),a=Math.floor(t%60);this.moneyBonusTimer.element.text=i+":"+(a<10?"0":"")+a}if(this.catchedFishEntity.enabled){return this.waitingTime+=1*e,this.waitingBar.setLocalScale(this.waitingTime/3,1,1),this.waitingBar.parent.enabled=!0,this.waitingTime>3&&this.finalizeCatchedFish(),this.fishingHolder.enabled=!1,!1}if(this.waitingBar.parent.enabled=!1,this.fishingHolder.enabled=!0,this.interface.enabled||this.fishInterfaceMode.enabled){this.updateClickItems();var s=this.power/this.depth;this.power=pc.math.lerp(this.power,0,e*this.powerLerp),this.power+=this.slowProgress*e;var n=this.color.value(s),r=Utils.getItem("CurrentLevel");if("BossFight"===r){var o=this.fishInterfaceMode.findByName("FillMode"),h=this.fishInterfaceMode.findByName("CurrentDepthMode");h=this.fishInterfaceMode.findByName("TargetDepthMode");o.setLocalScale(s,1,1),o.element.color=new pc.Color(n[0],n[1],n[2],n[3]),h.element.text=parseFloat(this.depth-this.power).toFixed(2)+" mt",h.setLocalPosition(0,300*-(1-s),0)}else this.meterBar.setLocalScale(s,1,1),this.meterBar.element.color=new pc.Color(n[0],n[1],n[2],n[3]),this.meterText.element.text=parseFloat(this.depth-this.power).toFixed(2)+" mt",this.targetDepth.setLocalPosition(0,300*-(1-s),0);Date.now()-this.fishingStarted>3e3&&(this.animationSpeed=pc.math.lerp(this.animationSpeed,.05,1*e));var l=Math.min(this.animationSpeed,3);this.characterEntity.anim.speed=l,this.rodEntity.anim.speed=l,"BossFight"===r?(this.fishInterfaceMode.findByName("WheelMode").rotateLocal(0,0,18*s),this.fishInterfaceMode.findByName("WheelMode").rotateLocal(0,0,100*-l*e)):(this.wheelEntity.rotateLocal(0,0,18*s),this.wheelEntity.rotateLocal(0,0,100*-l*e)),this.fishingCamera.lookAt(this.lookEntity.getPosition()),this.fishingCamera.camera.fov=45-l,-1===this.currentlyHeldFishIndex&&(this.playerEntity.script.player.fishModel.model.asset=null,this.app.fire("NetworkManager:Send","holdFish",null)),this.power>this.depth&&"BossFight"!==r&&this.catchFish()}};var Rod=pc.createScript("rod");Rod.attributes.add("icon",{type:"asset"}),Rod.attributes.add("model",{type:"asset"}),Rod.attributes.add("material",{type:"asset"}),Rod.attributes.add("power",{type:"number",default:.1}),Rod.attributes.add("chance",{type:"number",default:.8}),Rod.attributes.add("price",{type:"number",default:100}),Rod.attributes.add("rarities",{type:"string",default:"Common"}),Rod.attributes.add("depth",{type:"number",default:10});var Fish=pc.createScript("fish");Fish.attributes.add("rarity",{type:"string",default:"Common",enum:[{Common:"Common"},{Uncommon:"Uncommon"},{Epic:"Epic"},{Obsidian:"Obsidian"},{Galactic:"Galactic"}]}),Fish.attributes.add("icon",{type:"asset"}),Fish.attributes.add("model",{type:"asset"}),Fish.attributes.add("depth",{type:"number",default:0}),Fish.attributes.add("weight",{type:"number",default:1}),Fish.attributes.add("price",{type:"number",default:100}),Fish.prototype.serialize=function(){return{name:this.entity.name,weight:this.weight,stack:1}};var MobileVisible=pc.createScript("mobileVisible");MobileVisible.attributes.add("visible",{type:"boolean",default:!0,title:"Show on mobile"}),MobileVisible.prototype.initialize=function(){Utils.isMobile()?this.entity.enabled=this.visible:this.entity.enabled=!this.visible};var Sky=pc.createScript("sky");Sky.attributes.add("speed",{type:"number",default:50}),Sky.attributes.add("skyHolder",{type:"entity"}),Sky.attributes.add("skyMaterial",{type:"asset"}),Sky.attributes.add("colorCurve",{type:"curve",color:"rgb"}),Sky.attributes.add("colorRainCurve",{type:"curve",color:"rgba"}),Sky.attributes.add("sunColor",{type:"curve",color:"rgb"}),Sky.attributes.add("sunMoonWrapper",{type:"entity"}),Sky.attributes.add("sunLightEntity",{type:"entity"}),Sky.attributes.add("fogDensity",{type:"curve"}),Sky.attributes.add("exposure",{type:"curve"}),Sky.attributes.add("time",{type:"number",max:2,min:0,default:0}),Sky.prototype.initialize=function(){this.timestamp=0,this.currentTime=0,this.exposureFactor=.5,this.densityFactor=.45,this.cameraEntity=this.app.root.findByName("Lens"),this.sky=this.skyMaterial.resource,this.app.on("Sky:Time",this.setCurrentTime,this),this.app.on("Sky:Exposure",this.setExposure,this),this.app.on("Sky:FogDensity",this.setFogDensity,this),this.onMapLoaded()},Sky.prototype.onMapLoaded=function(){},Sky.prototype.setExposure=function(t){this.exposureFactor=t},Sky.prototype.setFogDensity=function(t){this.densityFactor=t},Sky.prototype.setCurrentTime=function(t){this.currentTime=t},Sky.prototype.mix=function(t,e,i){return t*(1-i)+e*i},Sky.prototype.setSkyTime=function(t){if(!this.sunLightEntity)return!1;this.sky.emissiveMapOffset.x=t-.16,this.sky.update();var e=t/2,i=this.colorCurve.value(e),s=this.colorRainCurve.value(0);this.app.scene.fogColor.r=this.mix(i[0],s[0],s[3]),this.app.scene.fogColor.g=this.mix(i[1],s[1],s[3]),this.app.scene.fogColor.b=this.mix(i[2],s[2],s[3]);var r=this.sunColor.value(e);this.sunLightEntity.light.color=new pc.Color(r[0],r[1],r[2]);var o=this.fogDensity.value(e),a=this.exposure.value(e);this.app.scene.fogDensity=o*this.densityFactor,this.app.scene.exposure=a*this.exposureFactor,this.sunMoonWrapper.setLocalEulerAngles(0,0,180+2*(90*t-90))},Sky.prototype.update=function(t){if(!this.cameraEntity)return!1;var e=this.cameraEntity.getPosition();this.skyHolder.setPosition(e.x,0,e.z),this.currentTime>1?this.currentTime+=t*this.speed*2.5:this.currentTime+=t*this.speed*.5,this.currentTime=this.currentTime%2,this.setSkyTime(this.currentTime)};var LockedPier=pc.createScript("lockedPier");LockedPier.attributes.add("fishesEntity",{type:"entity"}),LockedPier.attributes.add("totalFishes",{type:"number",default:100}),LockedPier.prototype.initialize=function(){this.lastUpdate=-1},LockedPier.prototype.update=function(t){if(Date.now()-this.lastUpdate<1e3)return!1;var e=pc.IdleManager.Fishes;if(this.fishesEntity.element.text=e+" / "+this.totalFishes,e>=this.totalFishes){this.entity.destroy()}this.lastUpdate=Date.now()};var ShowOnceClick=pc.createScript("showOnceClick");ShowOnceClick.prototype.initialize=function(){this.isShown=Utils.getItemAsBoolean("ClickShown"+this.entity.name),this.app.mouse.on("mousedown",this.onClick,this),this.app.mouse.on("touchstart",this.onClick,this),this.isShown&&this.onClick()},ShowOnceClick.prototype.onClick=function(t){Utils.setItem("ClickShown"+this.entity.name,!0),this.app.mouse.off("mousedown",this.onClick,this),this.app.mouse.off("touchstart",this.onClick,this),this.entity.destroy()};var Hook=pc.createScript("hook");Hook.attributes.add("icon",{type:"asset"}),Hook.attributes.add("chance",{type:"number",default:.8}),Hook.attributes.add("price",{type:"number",default:100}),Hook.attributes.add("rarities",{type:"string",default:"Common"});var TabsFixed=pc.createScript("tabsFixed");TabsFixed.attributes.add("tabEntity",{type:"entity"}),TabsFixed.attributes.add("tabs",{type:"string",array:!0}),TabsFixed.attributes.add("rodContentWrapper",{type:"entity"}),TabsFixed.attributes.add("hookContentWrapper",{type:"entity"}),TabsFixed.attributes.add("auraContentWrapper",{type:"entity"}),TabsFixed.prototype.initialize=function(){this.tabEntity.enabled=!1,this._buttons=[],this._createTabs(),this.tabs.length&&this._selectTab(this.tabs[0]),this.app.on("TabsFixed:SelectMenu",this._selectTab,this)},TabsFixed.prototype._createTabs=function(){this._buttons.forEach((function(t){t.destroy()})),this._buttons=[];for(var t=0;t<this.tabs.length;t++){var e=this.tabs[t],a=this.tabEntity.clone();a.name=e,a.enabled=!0;var i=a.findByName("Text");i&&i.element&&(i.element.text=e),a.script&&a.script.button&&(a.script.button.value=e,a.on("Button:Click",this._onButtonClick,this)),this.entity.addChild(a),this._buttons.push(a)}},TabsFixed.prototype._onButtonClick=function(t){this._selectTab(t.entity.name)},TabsFixed.prototype._selectTab=function(t){this.app.fire("Tabs:SelectMenu",t),this._buttons.forEach((function(e){e.element.opacity=e.name===t?1:.15}));var e="Rods"===t,a="Hooks"===t,i="Aura"===t;this.rodContentWrapper&&(this.rodContentWrapper.enabled=e),this.hookContentWrapper&&(this.hookContentWrapper.enabled=a),this.auraContentWrapper&&(this.auraContentWrapper.enabled=i)};var MobileVisibleJP=pc.createScript("mobileVisibleJp");MobileVisibleJP.attributes.add("visible",{type:"boolean",default:!0,title:"Show on mobile"}),MobileVisibleJP.prototype.initialize=function(){Utils.isMobile()&&(this.entity.enabled=this.visible)};var BossFightMode=pc.createScript("bossFightMode");BossFightMode.attributes.add("spawnPosition",{type:"entity"}),BossFightMode.attributes.add("bossEntity",{type:"entity"}),BossFightMode.attributes.add("bossHealthBar",{type:"entity"}),BossFightMode.attributes.add("bossHealthText",{type:"entity"}),BossFightMode.attributes.add("timeRemainingText",{type:"entity"}),BossFightMode.attributes.add("lobbyCountdownText",{type:"entity"}),BossFightMode.attributes.add("victoryScreen",{type:"entity"}),BossFightMode.attributes.add("rewardText",{type:"entity"}),BossFightMode.attributes.add("contributionText",{type:"entity"}),BossFightMode.attributes.add("cooldownText",{type:"entity"}),BossFightMode.attributes.add("specialActionPrompt",{type:"entity"}),BossFightMode.attributes.add("playerCountText",{type:"entity"}),BossFightMode.attributes.add("skipCooldownButton",{type:"entity"}),BossFightMode.attributes.add("attackButton",{type:"entity"}),BossFightMode.attributes.add("damageEffect",{type:"entity"}),BossFightMode.attributes.add("gatewayEntity",{type:"entity"}),BossFightMode.prototype.initialize=function(){if(this.isActive=!1,this.isGameOver=!1,this.inLobby=!0,this.bossHealth=100,this.bossMaxHealth=100,this.timeRemaining=0,this.contribution=0,this.cooldown=0,this.currentSpecialAction=null,this.playerEntity=this.app.root.findByName("Player"),this.networkManager=this.app.root.findByName("NetworkManager").script.networkManager,this.gameOverScreen=this.app.root.findByName("Overlay").script.overlay,this.playerProgress=new Map,this.playerPowers={},this.playerProgressUI={},this.playerEntity){var t=2*Math.random()-2*Math.random(),e=2*Math.random()-2*Math.random();this.playerEntity.setPosition(this.spawnPosition.getPosition().clone().add(new pc.Vec3(t,0,e))),this.playerEntity.script.player&&(this.playerEntity.script.player.inBossFight=!0)}this.attackButton&&this.attackButton.element.on("click",this.onAttackButtonClick,this),this.app.on("BossFight:PlayerPowers",this.onPlayerPowers,this),this.app.on("BossFight:GameStarted",this.onGameStarted,this),this.app.on("BossFight:GameUpdate",this.onGameUpdate,this),this.app.on("BossFight:BossUpdate",this.onBossUpdate,this),this.app.on("BossFight:GameOver",this.onGameOver,this),this.app.on("BossFight:CooldownUpdate",this.onCooldownUpdate,this),this.app.on("BossFight:OnCooldown",this.onCooldown,this),this.app.on("BossFight:CooldownUpdated",this.onCooldownUpdated,this),this.app.on("BossFight:LobbyUpdate",this.onLobbyUpdate,this),this.app.on("Device:Shake",this.onDeviceShake,this),this.app.touch?(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)):this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.on("destroy",this.onDestroy,this)},BossFightMode.prototype.onPlayerPowers=function(t){this.isActive&&(this.playerPowers=t)},BossFightMode.prototype.onDestroy=function(){this.playerEntity&&this.playerEntity.script.player&&(this.playerEntity.script.player.inBossFight=!1),this.app.off("BossFight:GameStarted",this.onGameStarted,this),this.app.off("BossFight:GameUpdate",this.onGameUpdate,this),this.app.off("BossFight:BossUpdate",this.onBossUpdate,this),this.app.off("BossFight:GameOver",this.onGameOver,this),this.app.off("BossFight:SpecialActionPrompt",this.onSpecialActionPrompt,this),this.app.off("BossFight:CooldownUpdate",this.onCooldownUpdate,this),this.app.off("BossFight:OnCooldown",this.onCooldown,this),this.app.off("BossFight:CooldownUpdated",this.onCooldownUpdated,this),this.app.off("BossFight:LobbyUpdate",this.onLobbyUpdate,this),this.app.off("Device:Shake",this.onDeviceShake,this),this.app.touch?(this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)):this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.attackButton&&this.attackButton.element.off("click",this.onAttackButtonClick,this),console.log("BossFight mode destroyed!")},BossFightMode.prototype.onLobbyUpdate=function(t){this.inLobby=!0,this.lobbyCountdownText.element.text=t.timeRemaining,this.playerCountText.element.text="Players: "+t.players+"/"+t.maxPlayers},BossFightMode.prototype.onGameStarted=function(t){this.inLobby=!1,this.isActive=!0,this.isGameOver=!1,this.bossHealth=t.bossHealth,this.bossMaxHealth=t.bossMaxHealth,this.timeRemaining=t.timeLimit,this.updateBossHealthBar(),this.updateTimeRemaining(),this.lobbyCountdownText.enabled=!1,this.app.fire("FishingManager:SetFishingPointMode",this.entity,t.bossMaxHealth),this.playerProgressTemplate=this.app.root.findByName("FishInterfaceMode"),this.barPlayer1=this.playerProgressTemplate.findByName("Objective1"),this.barPlayer2=this.playerProgressTemplate.findByName("Objective2"),this.barPlayer3=this.playerProgressTemplate.findByName("Objective3"),this.barPlayer4=this.playerProgressTemplate.findByName("Objective4"),this.barPlayer5=this.playerProgressTemplate.findByName("Objective5"),this.barPlayer6=this.playerProgressTemplate.findByName("Objective6"),this.barPlayer7=this.playerProgressTemplate.findByName("Objective7")},BossFightMode.prototype.onGameUpdate=function(t){this.isActive&&(this.bossHealth=t.bossHealth,this.bossMaxHealth=t.bossMaxHealth,this.timeRemaining=t.timeRemaining,this.updateBossHealthBar(),this.updateTimeRemaining())},BossFightMode.prototype.onBossUpdate=function(t){this.isActive&&(this.bossHealth=t.health,this.bossMaxHealth=t.maxHealth,this.updateBossHealthBar(),this.updatePlayerProgress(t.playerId,t.damage),t.playerId===this.networkManager.sessionId&&(this.contribution+=t.damage),this.bossTakeDamageAnimation())},BossFightMode.prototype.getProgressColor=function(t){return new pc.Color(1-t,t,0)},BossFightMode.prototype.updateAllPlayerProgress=function(){if(!this.isActive)return;const t=[this.barPlayer1,this.barPlayer2,this.barPlayer3,this.barPlayer4,this.barPlayer5,this.barPlayer6,this.barPlayer7];t.forEach((t=>{t&&t.setLocalScale(0,1,1)}));Object.keys(this.playerPowers).forEach(((e,o)=>{if(o<t.length&&t[o]){const s=this.playerPowers[e]/this.bossMaxHealth;var i=t[o].findByName("FillMode");t[o].enabled=!0,i.setLocalScale(s,1,1)}}))},BossFightMode.prototype.updatePlayerProgress=function(t,e){let o=this.playerProgress.get(t)||0;if(o+=e,this.playerProgress.set(t,o),!this.playerProgressUI[t]){const e=this.playerProgressTemplate.findByName("TargetDepthMode").clone();e.enabled=!0;const o=10*(this.playerProgress.size-1);e.setLocalPosition(0,o,0),this.playerProgressUI[t]=e,this.playerProgressTemplate.findByName("Progress").addChild(e)}const i=this.playerProgressUI[t];i.findByName("FillMode"),i.findByName("CurrentDepthMode")},BossFightMode.prototype.onGameOver=function(t){this.isActive=!1,this.isGameOver=!0,this.attackButton&&(this.attackButton.enabled=!1);var e=this.networkManager.sessionId,o=t.rewards[e]||0;this.rewardText.element.text="Reward: "+o+" coins";var i=t.contributions[e]||0;this.contributionText.element.text="Damage: "+i.toFixed(1),this.cooldown=t.cooldown,this.updateCooldownText(),setTimeout((function(t){t.app.fire("LevelManager:LoadLevel","Level-1")}),5e3,this),console.log("Game over! Victory: "+t.victory)},BossFightMode.prototype.onSpecialActionPrompt=function(t){this.specialActionPrompt.enabled=!0,this.currentSpecialAction=t.type;var e="SHAKE!";"swipe"===t.type?e="SWIPE!":"tap"===t.type&&(e="TAP RAPIDLY!"),this.specialActionPrompt.findByName("ActionText").element.text=e,this.app.fire("Audio:Play","special_action"),setTimeout((function(t){t.specialActionPrompt.enabled&&(t.specialActionPrompt.enabled=!1,t.currentSpecialAction=null)}),3e3,this)},BossFightMode.prototype.onCooldown=function(t){this.cooldown=t.cooldown,this.updateCooldownText(),t.canSkip},BossFightMode.prototype.onCooldownUpdate=function(t){this.cooldown=t.cooldown,this.updateCooldownText(),t.canSkip},BossFightMode.prototype.onCooldownUpdated=function(t){this.cooldown=t.cooldown,this.updateCooldownText(),t.skipped},BossFightMode.prototype.onTouchStart=function(t){this.isActive&&!this.isGameOver&&"tap"===this.currentSpecialAction&&this.completeSpecialAction()},BossFightMode.prototype.onTouchMove=function(t){if(this.isActive&&!this.isGameOver&&"swipe"===this.currentSpecialAction){var e=t.touches[0].x-t.touches[0].startX,o=t.touches[0].y-t.touches[0].startY;Math.sqrt(e*e+o*o)>50&&this.completeSpecialAction()}},BossFightMode.prototype.onMouseDown=function(t){this.isActive&&!this.isGameOver&&"tap"===this.currentSpecialAction&&this.completeSpecialAction()},BossFightMode.prototype.onDeviceShake=function(){this.isActive&&!this.isGameOver&&"shake"===this.currentSpecialAction&&this.completeSpecialAction()},BossFightMode.prototype.onAttackButtonClick=function(){this.isActive&&!this.isGameOver&&(this.networkManager.sendBossAttack(),this.playerEntity&&this.playerEntity.script.player&&this.playerEntity.script.player.playFishingAnimation())},BossFightMode.prototype.onSkipCooldownClick=function(){this.networkManager.sendSkipCooldown()},BossFightMode.prototype.completeSpecialAction=function(){this.networkManager.sendSpecialAction(this.currentSpecialAction),this.currentSpecialAction=null,this.app.fire("Audio:Play","special_action_success")},BossFightMode.prototype.showDamageEffect=function(t){var e=this.damageEffect.findByName("DamageText");e&&(e.element.text="-"+t.toFixed(1)),this.damageEffect.enabled=!0,setTimeout((function(t){t.damageEffect.enabled=!1}),1e3,this)},BossFightMode.prototype.bossTakeDamageAnimation=function(){var t=this.bossEntity.getLocalScale().clone(),e=t.clone().mul(new pc.Vec3(1.1,.9,1.1));this.bossEntity.setLocalScale(e),setTimeout((function(t,e){t.bossEntity.setLocalScale(e)}),100,this,t)},BossFightMode.prototype.updateBossHealthBar=function(){var t=this.bossHealth/this.bossMaxHealth;if(this.bossHealthBar.element)this.bossHealthBar.element.width=300*t;else{var e=this.bossHealthBar.getLocalScale();this.bossHealthBar.setLocalScale(t,e.y,e.z)}this.bossHealthText&&(this.bossHealthText.element.text=Math.ceil(this.bossHealth)+"/"+this.bossMaxHealth),this.bossHealthBar.element&&(this.bossHealthBar.element.color=t<.3?new pc.Color(1,0,0):t<.6?new pc.Color(1,1,0):new pc.Color(0,1,0))},BossFightMode.prototype.updateTimeRemaining=function(){time=this.timeRemaining%60;var t=Math.floor(this.timeRemaining/60),e=Math.floor(time),o=t+":"+(e<10?"0":"")+e;this.timeRemainingText.element.text=o,time<=0&&(this.gatewayEntity.enabled=!1)},BossFightMode.prototype.updateCooldownText=function(){if(this.cooldownText){var t=Math.floor(this.cooldown/60),e=Math.floor(this.cooldown%60),o=t+":"+(e<10?"0":"")+e;this.cooldownText.element.text="Cooldown: "+o}},BossFightMode.prototype.update=function(t){if(this.cooldown>0&&(this.cooldown-=t,this.cooldown<0&&(this.cooldown=0),this.updateCooldownText()),this.bossEntity&&this.isActive){var e=Date.now()/1e3,o=.1*Math.sin(e),i=this.bossEntity.getPosition();this.bossEntity.setPosition(i.x,i.y+o,i.z)}if(this.isActive&&!this.isGameOver){const t=this.app.root.findByName("FishingManager");if(t&&t.script.fishingManager){const e=t.script.fishingManager.power;this.networkManager.sendBossAttack(e)}this.updateAllPlayerProgress()}};var BossFightMode2=pc.createScript("bossFightMode2");BossFightMode2.attributes.add("spawnPosition",{type:"entity"}),BossFightMode2.attributes.add("bossEntity",{type:"entity"}),BossFightMode2.attributes.add("splashs",{type:"entity"}),BossFightMode2.attributes.add("bossHealthEntity",{type:"entity"}),BossFightMode2.attributes.add("countDownWall",{type:"entity"}),BossFightMode2.attributes.add("countDown",{type:"entity"}),BossFightMode2.attributes.add("gameScreen",{type:"entity"}),BossFightMode2.attributes.add("gameTime",{type:"entity"}),BossFightMode2.attributes.add("winScreen",{type:"entity"}),BossFightMode2.attributes.add("winRank",{type:"entity"}),BossFightMode2.attributes.add("loseScreen",{type:"entity"}),BossFightMode2.attributes.add("loseRank",{type:"entity"}),BossFightMode2.attributes.add("headerEntity",{type:"entity"}),BossFightMode2.attributes.add("inactivityUI",{type:"entity"}),BossFightMode2.attributes.add("specialDamages",{type:"entity"}),BossFightMode2.attributes.add("increasePower",{type:"entity"}),BossFightMode2.attributes.add("powerStation",{type:"entity"}),BossFightMode2.attributes.add("startBossPosition",{type:"vec3",default:[6,-25,120]}),BossFightMode2.attributes.add("finalBossPosition",{type:"vec3",default:[6,0,120]}),BossFightMode2.prototype.initialize=function(){this.isGameStarted=!1,this.isGameFinished=!1,this.isPlayerInSpot=!1,this.splashsEnabled=!1,this.canUseMouse=!0,this.increasedPower=0,this.gameScreen.enabled=!1,this.startSplashLocalPos=this.splashs.getLocalPosition().clone(),this.alpha_2=0,this.lastActivity=-1,this.currentSpecialDamage=null,this.lastSpecialDamage=-1,this.bossHealth=100,this.bossMaxHealth=100,this.tempV3_1=new pc.Vec3,this.tempV3_2=new pc.Vec3,this.setupPlayer(),Utils.isMobile()?this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this):this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this);var t=this.app.root.findByName("FishingManager").script.fishingManager,i=!1;t&&(i=Object.values(t.activeAuras).some((t=>t))),this.increasePower.enabled=!i,this.powerStation.enabled=!i,this.bossEntity.script.timeline.duration=5,this.bossEntity.script.timeline.loop=!0,this.bossEntity.script.timeline.position=!0,this.bossEntity.script.timeline.endFrame.position.y=2,this.bossEntity.script.timeline.yoyo=!0,this.bossEntity.script.timeline.enabled=!0,this.bossEntity.script.timeline.onPlay(),this.app.on("BossFight:Timer",this.onUpdateTime,this),this.app.on("BossFight:GameStarted",this.onGameStarted,this),this.app.on("BossFight:BossUpdate",this.onBossUpdate,this),this.app.on("BossFight:PowerBoost",this.showPopup,this),this.app.on("BossFight:Collect",this.collect,this),this.app.on("BossFight:Win",this.onWin,this),this.app.on("BossFight:Lose",this.onLose,this),this.app.on("BossFight:PlayerOnSpot",this.playerOnSpot,this),this.app.on("BossFight:PlayerLeaveSpot",this.playerLeaveSpot,this),this.app.on("BossFight:SpecialDamage",this.onSpecialDamages,this),this.app.on("Player:Jumped",this.onJump,this),this.on("destroy",this.onDestroy,this),this.app.fire("PopupManager:Hide")},BossFightMode2.prototype.onDestroy=function(){this.playerEntity&&this.playerEntity.script.player&&(this.playerEntity.script.player.inBossFight=!1),this.app.off("BossFight:Timer",this.onUpdateTime,this),this.app.off("BossFight:GameStarted",this.onGameStarted,this),this.app.off("BossFight:BossUpdate",this.onBossUpdate,this),this.app.off("BossFight:PowerBoost",this.onPowerBoost,this),this.app.off("BossFight:Win",this.onWin,this),this.app.off("BossFight:Lose",this.onLose,this),this.app.off("BossFight:PlayerOnSpot",this.playerOnSpot,this),this.app.off("BossFight:PlayerLeaveSpot",this.playerLeaveSpot,this),this.app.off("BossFight:SpecialDamage",this.onSpecialDamages,this),this.app.off("Player:Jumped",this.onJump,this),Utils.isMobile()?this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this):this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.attackButton&&this.attackButton.element.off("click",this.onAttackButtonClick,this),this.stats.enabled=!0,Utils.isMobile()?(this.controllerHolder.enabled=!0,this.app.fire("MobileTouch:ActionState",!1),this.gamePlay.forEach((t=>{t.enabled=!0}))):(pc.activePopup3D=!1,pc.hasActiveInterface=!1,this.app.mouse.enablePointerLock()),this.fishModel&&!this.winScreen.enabled&&(this.playerEntity.script.player.fishModel.model.asset=this.fishModel),console.log("BossFight mode destroyed!")},BossFightMode2.prototype.showPopup=function(){var t=100*this.currentRod.script.rod.power;this.app.root.findByName("Overlay").script.overlay.increasedValue.element.text=Math.round(1.1*t),this.app.fire("PopupManager:Show","PowerBoost")},BossFightMode2.prototype.collect=function(){var t=this;PokiPlugin.showReward((function(){t.onPowerBoost()}))},BossFightMode2.prototype.onPowerBoost=function(){var t=this.currentRod.script.rod.power;this.increasedPower=.1*t,this.app.fire("IdleManager:Set","RodPower",Math.floor(110*t)),this.activateAura(),this.app.fire("PopupManager:Hide"),this.increasePower.enabled=!1,this.powerStation.enabled=!1},BossFightMode2.prototype.setupPlayer=function(){if(this.playerEntity=this.app.root.findByName("Player"),this.controllerHolder=this.app.root.findByName("ControllerHolder"),this.stats=this.app.root.findByName("Stats"),this.originEntity=this.playerEntity.findByName("Origin"),this.gamePlay=this.app.root.findByTag("Gameplay"),this.characterEntity=this.playerEntity.findByName("Character"),this.rodEntity=this.playerEntity.findByName("Rod"),this.playerEntity){var t=2*Math.random()-2*Math.random(),i=2*Math.random()-2*Math.random();this.playerEntity.setPosition(this.spawnPosition.getPosition().clone().add(new pc.Vec3(t,0,i))),this.playerEntity.script.player&&(this.playerEntity.script.player.inBossFight=!0)}var e=Utils.getItemAsArray("Rods",[]);if(this.rods=this.app.root.findByName("Rods"),this.currentRod=this.getRodByName("Wooden Rod"),e&&e.length>0){var s=e[e.length-1];this.currentRod=this.getRodByName(s)}this.fishModel=this.playerEntity.script.player.fishModel.model.asset,this.playerEntity.script.player.fishModel.model.asset=null,this.app.fire("NetworkManager:Send","holdFish",null)},BossFightMode2.prototype.activateAura=function(t){var i=this.app.root.findByName("FishingManager").script.fishingManager;i&&(i.activeAuras.CatchSpeed=!0,i.updateAuraButtons("CatchSpeed"),i.syncAuraStorage(),i.selectAura(),i.addAuraTimer("CatchSpeed"),this.app.fire("Overlay:Message","Power Aura activated for 60 seconds!"))},BossFightMode2.prototype.onUpdateTime=function(t){this.isGameStarted?(this.gameTime.element.text="Time : "+t,this.gameTime.script.timeline.onPlay()):(this.countDown.element.text=t+"",this.countDown.script.timeline.onPlay())},BossFightMode2.prototype.onGameStarted=function(t){this.countDownWall.enabled=!1,this.gameScreen.enabled=!0,this.bossHealth=t.bossHealth,this.bossMaxHealth=t.bossMaxHealth,this.bossHealthEntity.setLocalScale(this.bossHealth/this.bossMaxHealth,1,1),this.bossEntity.script.timeline.duration=5,this.bossEntity.script.timeline.yoyo=!1,this.bossEntity.script.timeline.position=!0,this.bossEntity.script.timeline.endFrame.position.y=-25,this.bossEntity.script.timeline.loop=!1,this.bossEntity.script.timeline.reset(),this.bossEntity.script.timeline.onPlay(),this.enableSplashes(!0),setTimeout((()=>{this.enableSplashes(!1),this.bossEntity.script.timeline.enabled=!1}),1e3*this.bossEntity.script.timeline.duration),this.isGameStarted=!0},BossFightMode2.prototype.playerOnSpot=function(){if(!this.isGameStarted)return!1;this.stats.enabled=!1,this.headerEntity.enabled=!0,Utils.isMobile()?(this.controllerHolder.enabled=!1,this.app.fire("MobileTouch:ActionState",!0),this.gamePlay.forEach((t=>{t.enabled=!1}))):(pc.activePopup3D=!0,this.app.mouse.disablePointerLock()),this.characterEntity.anim.getTrigger("StartFishing")||(this.characterEntity.anim.setTrigger("StartFishing",!0),this.rodEntity.anim.setTrigger("StartFishing",!0),this.app.fire("NetworkManager:Send","animSetTrigger","StartFishing")),this.isPlayerInSpot=!0,this.lastSpecialDamage=Date.now()},BossFightMode2.prototype.playerLeaveSpot=function(){if(!this.isGameStarted)return!1;this.stats.enabled=!0,this.headerEntity.enabled=!1,Utils.isMobile()?(this.controllerHolder.enabled=!0,this.app.fire("MobileTouch:ActionState",!1),this.gamePlay.forEach((t=>{t.enabled=!0}))):(pc.activePopup3D=!1,this.app.mouse.enablePointerLock()),this.characterEntity.anim.getTrigger("EndFishing")||(this.characterEntity.anim.setTrigger("EndFishing",!0),this.rodEntity.anim.setTrigger("EndFishing",!0),this.app.fire("NetworkManager:Send","animSetTrigger","EndFishing")),this.isPlayerInSpot=!1},BossFightMode2.prototype.onTouchStart=function(){this.canUseMouse&&this.playerAttack(),this.canUseMouse=!0},BossFightMode2.prototype.onMouseDown=function(){this.canUseMouse&&this.playerAttack(),this.canUseMouse=!0},BossFightMode2.prototype.onJump=function(){},BossFightMode2.prototype.playerAttack=function(t=null){if(this.isPlayerInSpot){var i=this.currentRod.script.rod.power+this.increasedPower,e=t?i*t:i;this.app.fire("NetworkManager:Send","playerAttack",{power:e}),this.app.fire("DealtDamage:Trigger",Math.round(100*e),this.bossEntity.getPosition().clone(),!!t),this.lastActivity=Date.now()}},BossFightMode2.prototype.updateSpecialDamageOptions=function(){var t=5e3*Math.random()+5e3;if(!this.currentSpecialDamage&&Date.now()-this.lastSpecialDamage>t&&this.isGameStarted&&this.isPlayerInSpot){var i=this.specialDamages.children,e=Utils.getRandom(i);e&&(this.currentSpecialDamage=e,this.currentSpecialDamage.enabled=!0,this.currentSpecialDamage.fire("ShrinkingCircle:Show"))}},BossFightMode2.prototype.onSpecialDamages=function(t){t>0&&this.playerAttack(t),this.canUseMouse=!1,this.currentSpecialDamage&&(this.currentSpecialDamage=null,this.lastSpecialDamage=Date.now())},BossFightMode2.prototype.onWin=function(t){if(!this.isGameFinished){this.gameScreen.enabled=!1,this.winScreen.enabled=!0,this.onGameFinish(),this.winRank.element.text=t.rank+"# Rank";var i=Math.random()<.02?"Gold Tralalero Tralala":"Tralalero Tralala";this.characterEntity.anim.setTrigger("CatchFish"),this.rodEntity.anim.setTrigger("CatchFish");var e=this;setTimeout((()=>{this.app.fire("FishingManager:CatchFish",i),setTimeout((()=>{var t=e.app.root.findByName("FishingManager").script.fishingManager.getFishByName(i);t&&(e.playerEntity.script.player.fishModel.model.asset=t.script.fish.model,e.app.fire("NetworkManager:Send","holdFish",{fishName:i,fishModel:t.script.fish.model.id}))}),100)}),5e3)}},BossFightMode2.prototype.onLose=function(t){this.isGameFinished||(this.gameScreen.enabled=!1,this.loseScreen.enabled=!0,this.loseRank.element.text=t.rank+"# Rank",this.onGameFinish())},BossFightMode2.prototype.onGameFinish=function(t){PokiPlugin.onPauseWithPrevent(),setTimeout((()=>{this.characterEntity.anim.setTrigger("EndFishing"),this.rodEntity.anim.setTrigger("EndFishing"),this.app.fire("NetworkManager:Send","animSetTrigger","EndFishing"),Utils.setItem("LastBossFight",Date.now())}),3e3),setTimeout((()=>{this.app.fire("LevelManager:LoadLevelNoAds","Level-1")}),4e3),this.isGameFinished=!0},BossFightMode2.prototype.onBossUpdate=function(t){this.bossHealth=t.bossHealth,this.alpha_2=0},BossFightMode2.prototype.updateBoss=function(t){if(this.alpha_2<1){var i=this.tempV3_1,e=this.bossHealth/this.bossMaxHealth,s=1-e;this.alpha_2+=t,s>.25&&s<=.75&&!this.splashsEnabled&&this.enableSplashes(!0),this.updateSplashes(s);var a=pc.math.lerp(this.bossHealthEntity.getLocalScale().x,e,this.alpha_2);i.lerp(this.startBossPosition,this.finalBossPosition,s),i.lerp(this.bossEntity.getPosition(),i,this.alpha_2),this.bossHealthEntity.setLocalScale(a,1,1),this.bossEntity.script.timeline.enabled||this.bossEntity.setPosition(i)}},BossFightMode2.prototype.enableSplashes=function(t){this.splashsEnabled=t,this.splashs.forEach((i=>{i&&i.particlesystem&&(t?(i.particlesystem.reset(),i.particlesystem.play()):i.particlesystem.stop())}))},BossFightMode2.prototype.updateSplashes=function(t){if(this.splashsEnabled){var i=this.tempV3_2;i.copy(this.startSplashLocalPos),i.y+=-3*t,t>=.95&&this.enableSplashes(!1),this.splashs.setLocalPosition(i)}},BossFightMode2.prototype.getRodByName=function(t){return this.rods.findByName(t)},BossFightMode2.prototype.update=function(t){this.updateBoss(t),this.updateSpecialDamageOptions(t),Date.now()-this.lastActivity>3e3&&this.isGameStarted&&!this.isGameFinished&&this.isPlayerInSpot?(Utils.isMobile()&&(this.inactivityUI.findByName("Tap").enabled=!0,this.inactivityUI.findByName("Cursor").enabled=!1,this.inactivityUI.findByName("Text").element.text="Tap to fish!",this.inactivityUI.findByName("Text2").enabled=!1,this.inactivityUI.findByName("Text3").enabled=!1,this.inactivityUI.findByName("Image").enabled=!1),this.inactivityUI.enabled=!0):this.inactivityUI.enabled=!1};var BattleSpot=pc.createScript("battleSpot");BattleSpot.prototype.initialize=function(){this.popupShown=!1,this.progress=-1,this.threshold=0,this.lastLeave=-1,this.entity.on("Trigger",this.onTrigger,this),this.entity.on("Leave",this.onLeave,this),this.app.on("Player:Jumped",this.onJump,this)},BattleSpot.prototype.onJump=function(){if(!this.popupShown)return!1;this.lastLeave=Date.now(),this.popupShown=!1},BattleSpot.prototype.onTrigger=function(t,e){if(!(Date.now()-this.lastLeave<1e3)){if(this.popupShown)return!1;this.threshold+=5*e,this.app.fire("World2Screen:Show","Progress",this.entity),this.app.fire("Progress:WaitFill",this.threshold),this.threshold>1&&(this.app.fire("World2Screen:Hide","Progress",this.entity),this.app.fire("BossFight:PlayerOnSpot"),this.threshold=0,this.popupShown=!0)}},BattleSpot.prototype.onLeave=function(t){this.popupShown&&(this.popupShown=!1),this.threshold=0,this.app.fire("Progress:WaitFill",this.threshold),this.app.fire("BossFight:PlayerLeaveSpot"),this.app.fire("World2Screen:Hide","Progress",this.entity)},BattleSpot.prototype.update=function(t){};var ShrinkingCircle=pc.createScript("shrinkingCircle");ShrinkingCircle.attributes.add("shrinkingCircle",{type:"entity"}),ShrinkingCircle.attributes.add("outerCircle",{type:"entity"}),ShrinkingCircle.attributes.add("innerCircle",{type:"entity"}),ShrinkingCircle.attributes.add("rewardRange",{type:"vec2",default:[.84,.64]}),ShrinkingCircle.attributes.add("event",{type:"string"}),ShrinkingCircle.attributes.add("value",{type:"number",min:1}),ShrinkingCircle.attributes.add("success",{type:"rgb"}),ShrinkingCircle.attributes.add("lose",{type:"rgb"}),ShrinkingCircle.prototype.initialize=function(){this.isLose=!1,this.isSuccess=!1,this.timeLeft=5,this.originalScale=this.innerCircle.getLocalScale().clone(),Utils.isMobile()?this.innerCircle.element.on(pc.EVENT_TOUCHSTART,this.onTap,this):this.innerCircle.element.on(pc.EVENT_MOUSEDOWN,this.onTap,this),this.entity.on("ShrinkingCircle:Show",this.show,this)},ShrinkingCircle.prototype.show=function(){this.timeLeft=5,this.isLose=!1,this.isSuccess=!1,this.outerCircle.element.color=pc.Color.WHITE,this.entity.forEach((i=>{i&&i.element&&(i.element.opacity=1)}))},ShrinkingCircle.prototype.onTap=function(){this.entity.enabled&&this.timeLeft>0&&(this.app.fire(this.event,this.value),this.outerCircle.element.color=this.success,this.isSuccess=!0,this.innerCircle.tween(this.innerCircle.getLocalScale()).to(this.originalScale.clone().scale(1.5),.2,pc.BackOut).start())},ShrinkingCircle.prototype.updateHide=function(i){this.timeLeft<=1&&this.timeLeft>0?this.entity.forEach((i=>{i&&i.element&&(i.element.opacity=this.timeLeft)})):this.timeLeft<=0&&(this.entity.enabled=!1)},ShrinkingCircle.prototype.update=function(i){(this.timeLeft>0&&(this.timeLeft-=i),this.updateHide(i),this.entity.enabled)&&(this.shrinkingCircle.getLocalScale().x<this.rewardRange.y&&!this.isLose&&!this.isSuccess&&(this.app.fire(this.event,-1),this.outerCircle.element.color=this.lose,this.timeLeft=0,this.isLose=!0))};var TimingBar=pc.createScript("timingBar");TimingBar.attributes.add("barWidth",{type:"number",default:400}),TimingBar.attributes.add("barHeight",{type:"number",default:60}),TimingBar.attributes.add("indicatorWidth",{type:"number",default:8}),TimingBar.attributes.add("indicatorSpeed",{type:"number",default:200}),TimingBar.prototype.initialize=function(){this.isActive=!1,this.indicatorPosition=0,this.direction=1,this.hasClicked=!1,this.segments=[],this.setupBarUI(),this.app.on("CompetitiveMode:BarData",this.onBarData,this),this.app.on("CompetitiveMode:Game2Started",this.onGame2Started,this),this.app.on("CompetitiveMode:GameFinished",this.onGameFinished,this),this.on("destroy",this.onDestroy,this)},TimingBar.prototype.onDestroy=function(){this.app.off("CompetitiveMode:BarData",this.onBarData,this),this.app.off("CompetitiveMode:Game2Started",this.onGame2Started,this),this.app.off("CompetitiveMode:GameFinished",this.onGameFinished,this)},TimingBar.prototype.setupBarUI=function(){this.barBackground=new pc.Entity("BarBackground"),this.barBackground.addComponent("element",{type:pc.ELEMENTTYPE_IMAGE,color:new pc.Color(.3,.3,.3),width:this.barWidth,height:this.barHeight,anchor:[.5,.5,.5,.5],pivot:[.5,.5]}),this.entity.addChild(this.barBackground),this.segmentsContainer=new pc.Entity("SegmentsContainer"),this.barBackground.addChild(this.segmentsContainer),this.indicator=new pc.Entity("Indicator"),this.indicator.addComponent("element",{type:pc.ELEMENTTYPE_IMAGE,color:new pc.Color(1,1,1),width:this.indicatorWidth,height:this.barHeight+10,anchor:[0,.5,0,.5],pivot:[.5,.5]}),this.barBackground.addChild(this.indicator),this.indicator.setLocalPosition(-this.barWidth/2,0,1),this.clickButton=new pc.Entity("ClickButton"),this.clickButton.addComponent("element",{type:pc.ELEMENTTYPE_IMAGE,color:new pc.Color(0,0,0,0),width:this.barWidth,height:this.barHeight}),this.clickButton.addComponent("button"),this.clickButton.button.on("click",this.onBarClick,this),this.barBackground.addChild(this.clickButton),Utils.isMobile()&&this.clickButton.element.on("touchstart",this.onBarClick,this)},TimingBar.prototype.onBarData=function(t){this.segments=t.segments,this.createSegmentVisuals()},TimingBar.prototype.createSegmentVisuals=function(){for(var t=this.segmentsContainer.children.slice(),i=0;i<t.length;i++)t[i].destroy();for(i=0;i<this.segments.length;i++){var e=this.segments[i];this.createSegmentVisual(e,i)}},TimingBar.prototype.createSegmentVisual=function(t,i){var e=new pc.Entity("Segment_"+i),n=this.getSegmentColor(t.type),o=(t.end-t.start)*this.barWidth,r=t.start*this.barWidth-this.barWidth/2+o/2;e.addComponent("element",{type:pc.ELEMENTTYPE_IMAGE,color:n,width:o,height:this.barHeight-4,anchor:[.5,.5,.5,.5],pivot:[.5,.5]}),e.setLocalPosition(r,0,-1),this.segmentsContainer.addChild(e),t.type.startsWith("green")&&this.addSegmentLabel(e,t.type)},TimingBar.prototype.addSegmentLabel=function(t,i){var e=new pc.Entity("Label"),n=this.getMultiplierForType(i);e.addComponent("element",{type:pc.ELEMENTTYPE_TEXT,text:"x"+n,fontSize:14,color:new pc.Color(1,1,1),anchor:[.5,.5,.5,.5],pivot:[.5,.5]}),e.setLocalPosition(0,0,1),t.addChild(e)},TimingBar.prototype.getSegmentColor=function(t){switch(t){case"red":return new pc.Color(.8,.2,.2);case"green_large":return new pc.Color(.2,.8,.2);case"green_medium":return new pc.Color(.1,.7,.1);case"green_small":return new pc.Color(.05,.6,.05);default:return new pc.Color(.5,.5,.5)}},TimingBar.prototype.getMultiplierForType=function(t){switch(t){case"green_large":return 2;case"green_medium":return 4;case"green_small":return 8;default:return 1}},TimingBar.prototype.onGame2Started=function(){this.isActive=!0,this.hasClicked=!1,this.indicatorPosition=0,this.direction=1,this.updateIndicatorPosition()},TimingBar.prototype.onGameFinished=function(){this.isActive=!1},TimingBar.prototype.onBarClick=function(){if(this.isActive&&!this.hasClicked){this.hasClicked=!0,this.isActive=!1;var t=this.getHitSegment(this.indicatorPosition/this.barWidth),i=t?this.getMultiplierForType(t.type):1;this.app.fire("NetworkManager:Send","barHit",{position:this.indicatorPosition/this.barWidth,multiplier:i}),this.showHitEffect(t)}},TimingBar.prototype.getHitSegment=function(t){for(var i=0;i<this.segments.length;i++){var e=this.segments[i];if(t>=e.start&&t<=e.end)return e}return null},TimingBar.prototype.showHitEffect=function(t){var i=new pc.Entity("HitMarker");i.addComponent("element",{type:pc.ELEMENTTYPE_IMAGE,color:t&&t.type.startsWith("green")?new pc.Color(0,1,0):new pc.Color(1,0,0),width:3*this.indicatorWidth,height:this.barHeight+20,anchor:[.5,.5,.5,.5],pivot:[.5,.5]});var e=this.indicatorPosition-this.barWidth/2;i.setLocalPosition(e,0,2),this.barBackground.addChild(i),i.tween(i.element).to({opacity:0},1).on("complete",(function(){i.destroy()})).start(),this.indicator.element.color=t&&t.type.startsWith("green")?new pc.Color(0,1,0):new pc.Color(1,0,0)},TimingBar.prototype.update=function(t){this.isActive&&!this.hasClicked&&(this.indicatorPosition+=this.direction*this.indicatorSpeed*t,this.indicatorPosition>=this.barWidth?(this.indicatorPosition=this.barWidth,this.direction=-1):this.indicatorPosition<=0&&(this.indicatorPosition=0,this.direction=1),this.updateIndicatorPosition())},TimingBar.prototype.updateIndicatorPosition=function(){var t=this.indicatorPosition-this.barWidth/2;this.indicator.setLocalPosition(t,0,1)};var CircleTarget=pc.createScript("circleTarget");CircleTarget.prototype.initialize=function(){this.lifeTime=0,this.maxLifeTime=3,this.isClicked=!1,this.originalScale=this.entity.getLocalScale().clone().scale(1.5),this.targetScale=this.originalScale.clone().scale(.7),this.entity.element&&(this.entity.element.on("click",this.onClick,this),this.entity.element.on("touchstart",this.onTouch,this));var t=this.entity.tween(this.entity.getLocalScale());t.to(this.targetScale,this.maxLifeTime,pc.SineOut),t.start(),this.setupColorAnimation()},CircleTarget.prototype.setupColorAnimation=function(){if(this.entity.element){var t=new pc.Color(1,.5,.5),e=this.entity.tween(this.entity.element);e.to({color:t},.5,pc.SineInOut),e.yoyo(!0),e.repeat(2),e.start()}},CircleTarget.prototype.onClick=function(t){this.isClicked||(this.onHit(),t.stopPropagation())},CircleTarget.prototype.onTouch=function(t){this.isClicked||(this.onHit(),t.stopPropagation())},CircleTarget.prototype.onHit=function(){this.isClicked=!0,this.entity.sound.play("tap"),this.app.fire("CircleTarget:Hit",this.entity),this.flashGreenAndDestroy()},CircleTarget.prototype.flashGreenAndDestroy=function(){var t=this.entity.findByName("Inner"),e=this.entity.findByName("Outer_2"),i=this.entity.findByName("Outer"),n=new pc.Color(0,1,0,1);t&&t.element&&(t.element.color=n),e&&e.element&&(e.element.color=n),i&&i.element&&(i.element.color=n);var o=this.originalScale.clone().scale(1.2),s=this.entity.tween(this.entity.getLocalScale());s.to(o,.1,pc.BackOut),s.start(),setTimeout((()=>{this.entity.destroy()}),150)},CircleTarget.prototype.playHitAnimation=function(){var t=this.originalScale.clone().scale(1.5);this.entity.tween(this.entity.getLocalScale()).to(t,.1,pc.BackOut).on("complete",(()=>{if(this.entity.element){var t=this.entity.tween(this.entity.element);t.to({opacity:0},.1),t.on("complete",(()=>{this.entity.destroy()})),t.start()}else this.entity.destroy()})).start(),this.showHitEffect()},CircleTarget.prototype.showHitEffect=function(){var t=new pc.Entity("HitFlash");t.addComponent("element",{type:pc.ELEMENTTYPE_IMAGE,color:new pc.Color(1,1,1,.8),width:2*this.entity.element.width,height:2*this.entity.element.height}),t.setLocalPosition(this.entity.getLocalPosition()),this.entity.parent.addChild(t);var e=t.tween(t.element);e.to({opacity:0},.2),e.on("complete",(()=>{t.destroy()})),e.start();var i=t.tween(t.getLocalScale());i.to(new pc.Vec3(2,2,2),.2,pc.QuadOut),i.start()},CircleTarget.prototype.update=function(t){this.lifeTime+=t,this.lifeTime>=this.maxLifeTime&&!this.isClicked&&this.onTimeExpired()},CircleTarget.prototype.onTimeExpired=function(){this.app.fire("CircleTarget:Missed",this.entity),this.playMissAnimation()},CircleTarget.prototype.playMissAnimation=function(){var t=this.entity.getLocalScale().clone().scale(.8);if(this.entity.tween(this.entity.getLocalScale()).to(t,.2,pc.SineIn).start(),this.entity.element){var e=this.entity.tween(this.entity.element);e.to({opacity:0},.2),e.on("complete",(()=>{this.entity.destroy()})),e.start()}else setTimeout((()=>{this.entity.destroy()}),200)};var CompetitiveMode=pc.createScript("competitiveMode");CompetitiveMode.attributes.add("spawnPosition",{type:"entity"}),CompetitiveMode.attributes.add("gameScreen",{type:"entity"}),CompetitiveMode.attributes.add("waitingScreen",{type:"entity"}),CompetitiveMode.attributes.add("waitingScreen2",{type:"entity"}),CompetitiveMode.attributes.add("waitingScreen3",{type:"entity"}),CompetitiveMode.attributes.add("waitingScreen4",{type:"entity"}),CompetitiveMode.attributes.add("countDown",{type:"entity"}),CompetitiveMode.attributes.add("countDown2",{type:"entity"}),CompetitiveMode.attributes.add("countDown3",{type:"entity"}),CompetitiveMode.attributes.add("countDown4",{type:"entity"}),CompetitiveMode.attributes.add("gameHealthBar",{type:"entity"}),CompetitiveMode.attributes.add("gameHealthText",{type:"entity"}),CompetitiveMode.attributes.add("playerCount",{type:"entity"}),CompetitiveMode.attributes.add("circleContainer",{type:"entity"}),CompetitiveMode.attributes.add("circleTemplate",{type:"entity"}),CompetitiveMode.attributes.add("barContainer",{type:"entity"}),CompetitiveMode.attributes.add("barBackground",{type:"entity"}),CompetitiveMode.attributes.add("barIndicator",{type:"entity"}),CompetitiveMode.attributes.add("barButton",{type:"entity"}),CompetitiveMode.attributes.add("resultsScreen",{type:"entity"}),CompetitiveMode.attributes.add("resultsList",{type:"entity"}),CompetitiveMode.attributes.add("backButton",{type:"entity"}),CompetitiveMode.attributes.add("headerEntity",{type:"entity"}),CompetitiveMode.attributes.add("bossState",{type:"entity"}),CompetitiveMode.attributes.add("roundCounter",{type:"entity"}),CompetitiveMode.attributes.add("roundCompleted",{type:"entity"}),CompetitiveMode.attributes.add("roundTitle",{type:"entity"}),CompetitiveMode.attributes.add("catchedFishing",{type:"entity"}),CompetitiveMode.attributes.add("playerScore",{type:"entity"}),CompetitiveMode.attributes.add("nextRoundCounter",{type:"entity"}),CompetitiveMode.attributes.add("multiplierResult",{type:"entity"}),CompetitiveMode.attributes.add("fishingPositions",{type:"entity"}),CompetitiveMode.attributes.add("increasePower",{type:"entity"}),CompetitiveMode.attributes.add("powerStation",{type:"entity"}),CompetitiveMode.attributes.add("roundNumber",{type:"entity"}),CompetitiveMode.attributes.add("fishDisplay",{type:"entity"}),CompetitiveMode.attributes.add("submitStation",{type:"entity"}),CompetitiveMode.attributes.add("trashBins",{type:"entity"}),CompetitiveMode.attributes.add("inventoryIcon",{type:"entity"}),CompetitiveMode.attributes.add("inventoryWeight",{type:"entity"}),CompetitiveMode.prototype.initialize=function(){this.gameState="waiting",this.totalHealth=200,this.currentHealth=200,this.currentRound=0,this.gameTimeRemaining=60,this.currentRoundMultiplier=1,this.isGameStarted=!1,this.alpha_2=0,this.myGameState="waiting",this.activeCircles=[],this.circleSpawnTimer=0,this.circleSpawnInterval=.25,this.maxActiveCircles=4,this.barIndicatorPos=0,this.barDirection=1,this.barSpeed=1.25,this.barClicked=!1,this.playerMultiplier=1,this.barSegments=[],this.playersData=new Map,this.setupUI(),this.setupPlayer(),this.connectEventListeners(),this.showWaitingScreen()},CompetitiveMode.prototype.setupUI=function(){this.gameScreen.enabled=!1,this.circleContainer.enabled=!1,this.barContainer.enabled=!1,this.resultsScreen.enabled=!1,this.roundCompleted.enabled=!1,this.circleTemplate.enabled=!1,this.inventoryIcon.enabled=!1,this.inventoryWeight.enabled=!1,this.barButton.element.on("click",this.onBarClick,this)},CompetitiveMode.prototype.setupPlayer=function(){if(this.hideSubmitStationArrow(),this.playerEntity=this.app.root.findByName("Player"),this.arrow=this.playerEntity.findByName("Objective"),this.sessionId=this.playerEntity.sessionId,this.characterEntity=this.playerEntity.findByName("Character"),this.rodEntity=this.playerEntity.findByName("Rod"),this.gamePlay=this.app.root.findByTag("Gameplay"),this.controllerHolder=this.app.root.findByName("ControllerHolder"),this.stats=this.app.root.findByName("Stats"),this.overlay=this.app.root.findByName("Overlay"),this.app.root.findByName("InviteButton").enabled=!1,this.app.fire("PopupManager:Hide"),this.playerEntity){var t=2*Math.random()-2*Math.random(),e=2*Math.random()-2*Math.random();this.playerEntity.setPosition(this.spawnPosition.getPosition().clone().add(new pc.Vec3(t,0,e)))}var i=Utils.getItemAsArray("Rods",[]);this.playerRodLevel=i?i.length:1,this.arrow.fire("Arrow:SetPointer",[this.submitStation]),this.fishModel=this.playerEntity.script.player.fishModel.model.asset,this.playerEntity.script.player.fishModel.model.asset=null,this.app.fire("NetworkManager:Send","holdFish",null)},CompetitiveMode.prototype.updateInventoryDisplay=function(t,e){this.fishToCatch&&this.fishToCatch.script&&this.fishToCatch.script.fish&&(this.inventoryIcon.element.textureAsset=this.fishToCatch.script.fish.icon,this.inventoryWeight.findByName("Weight").element.text=Math.round(e)+"kg",this.inventoryIcon.enabled=!0,this.inventoryWeight.enabled=!0)},CompetitiveMode.prototype.hideInventoryDisplay=function(){this.inventoryIcon.enabled=!1,this.inventoryWeight.enabled=!1},CompetitiveMode.prototype.connectEventListeners=function(){this.app.on("CircleTarget:Hit",this.onCircleHit,this),this.app.on("CircleTarget:Missed",this.onCircleMissed,this),this.app.on("CompetitiveMode:Timer",this.onUpdateTime,this),this.app.on("CompetitiveMode:GameStarted",this.onGameStarted,this),this.app.on("CompetitiveMode:Game1Started",this.onGame1Started,this),this.app.on("CompetitiveMode:Game2Started",this.onGame2Started,this),this.app.on("CompetitiveMode:PlayerProgress",this.onPlayerProgress,this),this.app.on("CompetitiveMode:PlayersUpdate",this.onPlayersUpdate,this),this.app.on("CompetitiveMode:GameFinished",this.onGameFinished,this),this.app.on("CompetitiveMode:RoundComplete",this.onRoundComplete,this),this.app.on("CompetitiveMode:PlayerPositions",this.onPlayerPositions,this),this.app.on("CompetitiveMode:PlayerLeaveSpot",this.playerLeaveSpot,this),this.app.on("CompetitiveMode:PlayerOnSpot",this.playerOnSpot,this),this.app.on("CompetitiveMode:SubmitFish",this.submitFish,this),this.app.on("CompetitiveMode:HideRoundResults",this.hideRoundResults,this),this.app.on("CompetitiveMode:SubmitRequest",this.submitRequest,this),this.app.on("CompetitiveMode:Submited",this.submited,this),this.app.on("CompetitiveMode:RequestThrow",this.reqThrowFish,this),this.app.on("CompetitiveMode:ThrowFish",this.throwFish,this),this.app.on("CompetitiveMode:FishSubmitted",this.fishSubmitted,this),this.on("destroy",this.onDestroy,this)},CompetitiveMode.prototype.onDestroy=function(){this.app.off("CircleTarget:Hit",this.onCircleHit,this),this.app.off("CircleTarget:Missed",this.onCircleMissed,this),this.app.off("CompetitiveMode:Timer",this.onUpdateTime,this),this.app.off("CompetitiveMode:GameStarted",this.onGameStarted,this),this.app.off("CompetitiveMode:Game1Started",this.onGame1Started,this),this.app.off("CompetitiveMode:Game2Started",this.onGame2Started,this),this.app.off("CompetitiveMode:PlayerProgress",this.onPlayerProgress,this),this.app.off("CompetitiveMode:PlayersUpdate",this.onPlayersUpdate,this),this.app.off("CompetitiveMode:GameFinished",this.onGameFinished,this),this.app.off("CompetitiveMode:RoundComplete",this.onRoundComplete,this),this.app.off("CompetitiveMode:PlayerPositions",this.onPlayerPositions,this),this.app.off("CompetitiveMode:PlayerLeaveSpot",this.playerLeaveSpot,this),this.app.off("CompetitiveMode:PlayerOnSpot",this.playerOnSpot,this),this.app.off("CompetitiveMode:SubmitFish",this.submitFish,this),this.app.off("CompetitiveMode:HideRoundResults",this.hideRoundResults,this),this.app.off("CompetitiveMode:SubmitRequest",this.submitRequest,this),this.app.off("CompetitiveMode:Submited",this.submited,this),this.app.off("CompetitiveMode:ThrowFish",this.throwFish,this),this.app.off("CompetitiveMode:RequestThrow",this.reqThrowFish,this),this.app.off("CompetitiveMode:FishSubmitted",this.fishSubmitted,this),this.cleanupCompetitiveMode()},CompetitiveMode.prototype.reqThrowFish=function(){if("submittedFish"!==this.myGameState)return this.app.fire("Overlay:Message","Go to a fishing spot to catch a fish first!"),!1;var t=this.app.root.findByName("ThrowFishReq");t.findByName("FishIcon").element.textureAsset=this.fishToCatch.script.fish.icon,t.findByName("Rarity").element.text=this.fishRarity,t.findByName("Name").element.text=this.fishName,t.findByName("Weight").element.text=this.fishWeight,this.app.fire("PopupManager:Show","ThrowFishReq")},CompetitiveMode.prototype.submited=function(){this.playerEntity.script.player.fishModel.model.asset=null,this.app.fire("NetworkManager:Send","holdFish",null),this.hideInventoryDisplay(),this.app.fire("NetworkManager:Send","submitFish"),this.app.fire("PopupManager:Hide")},CompetitiveMode.prototype.throwFish=function(){if(!this.fishToCatch)return!1;this.myGameState="waiting",this.hideInventoryDisplay(),this.playerEntity.script.player.fishModel.model.asset=null,this.app.fire("NetworkManager:Send","holdFish",null),this.submitStation.findByName("ThrownFish").model.asset=this.fishToCatch.script.fish.model;var t=this;setTimeout((()=>{if(t.submitStation){const e=t.submitStation.findByName("ThrownFish");e&&e.model&&(e.model.asset=null)}}),9e3),this.app.fire("NetworkManager:Send","throwFish"),this.app.fire("PopupManager:Hide")},CompetitiveMode.prototype.fishSubmitted=function(){this.myGameState="waiting",this.submitStation.findByName("FishBowlAsset").model.asset=this.fishToCatch.script.fish.model;var t=this;setTimeout((()=>{if(t.submitStation){t.submitStation.findByName("FishBowlAsset").model.asset=null}}),9e3)},CompetitiveMode.prototype.submitRequest=function(){if("submittedFish"!==this.myGameState)return this.app.fire("Overlay:Message","Go to a fishing spot to catch a fish first!"),!1;var t=this.app.root.findByName("SubmitFish");t.findByName("FishIcon").element.textureAsset=this.fishToCatch.script.fish.icon,t.findByName("Rarity").element.text=this.fishRarity,t.findByName("Name").element.text=this.fishName,t.findByName("Weight").element.text=this.fishWeight,this.app.fire("PopupManager:Show","SubmitFish")},CompetitiveMode.prototype.cleanupCompetitiveMode=function(){this.clearCircles(),this.clearBarSegments(),this.clearBarHighlight(),this.clearTimers(),this.overlay.findByName("Inventory").enabled=!0},CompetitiveMode.prototype.clearTimers=function(){this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownInterval=null),this.roundTimer&&(clearTimeout(this.roundTimer),this.roundTimer=null)},CompetitiveMode.prototype.clearBarSegments=function(){for(var t=this.barBackground.findByTag("barSegment"),e=0;e<t.length;e++)t[e].destroy();this.clearBarHighlight()},CompetitiveMode.prototype.showWaitingScreen=function(){this.waitingScreen.enabled=!0,this.waitingScreen2.enabled=!0,this.waitingScreen3.enabled=!0,this.waitingScreen4.enabled=!0,this.gameScreen.enabled=!1,this.resultsScreen.enabled=!1},CompetitiveMode.prototype.submitFish=function(t){this.playerLeaveSpot(),this.onRoundComplete(t),this.myGameState="submittedFish";var e=this;setTimeout((()=>{var i=e.app.root.findByName("FishingManager").script.fishingManager.getFishByName(e.fishName);if(i){var a=e.scaleFishModel(t.estimatedScore);e.playerEntity.script.player.fishModel.model.asset=i.script.fish.model,e.playerEntity.script.player.fishModel.setLocalScale(a,a,a),e.updateInventoryDisplay(e.fishName,t.estimatedScore),e.app.fire("NetworkManager:Send","holdFish",{fishName:e.fishName,fishModel:i.script.fish.model.id})}}),100)},CompetitiveMode.prototype.onUpdateTime=function(t){this.gameTimeRemaining=t.gameTimeRemaining,this.gameState=t.gameState,"waiting"===this.gameState?(this.countDown.element.text=t.currentTimer+"",this.countDown2.element.text=t.currentTimer+"",this.countDown3.element.text=t.currentTimer+"",this.countDown4.element.text=t.currentTimer+"",this.countDown.script.timeline.onPlay(),this.countDown2.script.timeline.onPlay(),this.countDown3.script.timeline.onPlay(),this.countDown4.script.timeline.onPlay()):this.roundNumber.element.text="Time Left: "+t.gameTimeRemaining},CompetitiveMode.prototype.scaleFishModel=function(t){if(!this.originalFishWeight)return 1;var e=t/20/this.originalFishWeight,i=this.originalFishScale*e;return Math.max(.3,Math.min(i,17))},CompetitiveMode.prototype.onGameStarted=function(t){return t&&t.fishName?(this.fishName=t.fishName,this.fishToCatch=this.app.root.findByName(this.fishName),this.fishToCatch?(this.originalFishScale=1.676,this.fishToCatch.script&&this.fishToCatch.script.fish?this.originalFishWeight=this.fishToCatch.script.fish.weight||1:this.originalFishWeight=1,this.trashBins.enabled=!0,this.submitStation.enabled=!0,this.isGameStarted=!0,this.gameState="countdown",this.increasePower.enabled=!1,this.powerStation.enabled=!1,this.waitingScreen.enabled=!1,this.waitingScreen2.enabled=!1,this.waitingScreen3.enabled=!1,this.waitingScreen4.enabled=!1,this.gameScreen.enabled=!0,void(this.stats.enabled=!1)):(console.error("Fish entity not found:",this.fishName),void this.onGameFinish())):(console.error("Invalid game start data:",t),void this.onGameFinish())},CompetitiveMode.prototype.playerOnSpot=function(){return this.isGameStarted?null!==this.playerEntity.script.player.fishModel.model.asset?(this.app.fire("Overlay:Message","Throw or Submit Fish to Catch try again!"),!1):(this.headerEntity.enabled=!0,Utils.isMobile()?(this.controllerHolder.enabled=!1,this.app.fire("MobileTouch:ActionState",!0),this.gamePlay.forEach((t=>{t.enabled=!1}))):(pc.activePopup3D=!0,this.app.mouse.disablePointerLock()),this.characterEntity.anim.getTrigger("StartFishing")||(this.characterEntity.anim.setTrigger("StartFishing",!0),this.rodEntity.anim.setTrigger("StartFishing",!0),this.app.fire("NetworkManager:Send","animSetTrigger","StartFishing")),void this.app.fire("NetworkManager:Send","playerOnSpot")):(this.app.fire("Overlay:Message","Game did not start yet!"),!1)},CompetitiveMode.prototype.stopPlayerGames=function(){this.circleContainer.enabled=!1,this.barContainer.enabled=!1,this.clearCircles(),this.currentHealth=this.totalHealth,this.playerMultiplier=1,this.barClicked=!1,this.barIndicatorPos=0,this.characterEntity.anim.getTrigger("EndFishing")||(this.characterEntity.anim.setTrigger("EndFishing",!0),this.rodEntity.anim.setTrigger("EndFishing",!0),this.app.fire("NetworkManager:Send","animSetTrigger","EndFishing"))},CompetitiveMode.prototype.playerLeaveSpot=function(){this.headerEntity.enabled=!1,Utils.isMobile()?(this.controllerHolder.enabled=!0,this.app.fire("MobileTouch:ActionState",!1),this.gamePlay.forEach((t=>{t.enabled=!0}))):(pc.activePopup3D=!1,this.app.mouse.enablePointerLock()),this.app.fire("NetworkManager:Send","playerLeaveSpot"),this.stopPlayerGames()},CompetitiveMode.prototype.onGame1Started=function(t){this.currentHealth=this.totalHealth,this.playerDamage=0,this.currentRoundMultiplier=1,this.roundCompleted.enabled=!1,this.myGameState=t.currentState,this.currentRound=t.currentRound,this.gameTimeRemaining=t.duration,this.circleContainer.enabled=!0,this.barContainer.enabled=!1},CompetitiveMode.prototype.onGame2Started=function(t){this.barClicked=!1,this.barIndicatorPos=0,this.barDirection=1,this.myGameState=t.currentState,this.currentRound=t.currentRound,this.gameTimeRemaining=t.duration,this.circleContainer.enabled=!1,this.bossState.enabled=!1,this.onBarData(t.barSegments),this.barInteractionEnabled=!1,this.clearCircles();var e=this;setTimeout((function(){e.barContainer.enabled=!0,e.barInteractionEnabled=!0}),1e3)},CompetitiveMode.prototype.hideRoundResults=function(t){this.nextRoundCounter.script.time.time=3,this.roundCompleted.enabled=!1},CompetitiveMode.prototype.onRoundComplete=function(t){this.barContainer.enabled=!1,this.nextRoundCounter.script.time.time=3,this.fishWeight=t.estimatedScore,this.roundTitle.element.text="Round "+t.round+" Complete!",t.estimatedScore?(this.playerScore.element.text="Your Score: "+t.estimatedScore,this.catchedFishing.enabled=!0,this.catchedFishing.findByName("Icon").element.textureAsset=this.fishToCatch.script.fish.icon,this.catchedFishing.findByName("FishName").element.text=this.fishName,this.catchedFishing.findByName("Weights").element.text=Math.round(t.estimatedScore)+"kg",this.catchedFishing.findByName("Rarity").element.text=t.fishRarity,this.multiplierResult.element.text="Multiplier: x"+t.game2Multiplier):(this.catchedFishing.enabled=!1,this.playerScore.element.text="Your Score: 0",this.multiplierResult.element.text="Multiplier: x1"),this.roundCompleted.enabled=!0;var e=this;this.roundTimer=setTimeout((()=>{e.hideRoundResults(),e.roundTimer=null}),3e3)},CompetitiveMode.prototype.onPlayerProgress=function(t){this.currentHealth=t.score||t.multiplier,this.alpha_2=0},CompetitiveMode.prototype.updateHealthDisplay=function(t){if(this.alpha_2<1){var e=this.currentHealth/this.totalHealth;this.alpha_2+=3*t;var i=pc.math.lerp(this.gameHealthBar.getLocalScale().x,e,this.alpha_2);this.gameHealthBar.setLocalScale(i,1,1)}this.gameHealthText.element.text="Score: "+this.currentHealth},CompetitiveMode.prototype.onPlayerPositions=function(t){var e=t[this.playerEntity.sessionId],i=`Player${e.positionIndex+1}`;if(e){var a=this.fishingPositions.findByName(i);e.position;this.playerEntity.setPosition(a.getPosition().clone())}},CompetitiveMode.prototype.onGameFinish=function(t){PokiPlugin.onPauseWithPrevent();var e=this;this.setPlayerRank(t),setTimeout((()=>{e.playerLeaveSpot()}),1e3),setTimeout((()=>{this.overlay.findByName("Inventory").enabled=!0,this.app.fire("LevelManager:LoadLevelNoAds","Level-1")}),4e3),this.isGameFinished=!0},CompetitiveMode.prototype.onPlayersUpdate=function(t){this.playersData=new Map(Object.entries(t)),this.playerCount.element.text="Players: "+this.playersData.size},CompetitiveMode.prototype.onBarData=function(t){this.barSegments=t,this.setupBarSegments()},CompetitiveMode.prototype.setPlayerRank=function(t){if(t&&t.result&&t.result.rank){pc.lastPvPRank=t.result.rank}else pc.lastPvPRank=-1},CompetitiveMode.prototype.onGameFinished=function(t){this.playerEntity.script.player.fishModel.model.asset=null,this.app.fire("NetworkManager:Send","holdFish",null),this.stats.enabled=!0,this.clearCircles(),this.circleContainer.enabled=!1,this.barContainer.enabled=!1,this.onGameFinish(t),this.characterEntity.anim.getTrigger("StartFishing")&&(this.characterEntity.anim.setTrigger("EndFishing",!0),this.rodEntity.anim.setTrigger("EndFishing",!0),this.app.fire("NetworkManager:Send","animSetTrigger","EndFishing")),this.characterEntity.anim.setTrigger("CatchFish"),this.rodEntity.anim.setTrigger("CatchFish");var e=this;setTimeout((()=>{var i=t.result,a=0;if(i&&i.submittedFishes&&Array.isArray(i.submittedFishes)&&i.submittedFishes.length>0){for(var o=0,s=0;s<i.submittedFishes.length;s++){var n=i.submittedFishes[s],r=n.score||n.fishWeight||n.finalScore||0;r>o&&(o=r)}a=o}var h=Math.round(a);a>0&&(e.characterEntity.anim.setTrigger("CatchFish"),e.rodEntity.anim.setTrigger("CatchFish"),setTimeout((()=>{var t=e.app.root.findByName("FishingManager").script.fishingManager;t.catchedFishEntity.enabled=!1,e.app.fire("FishingManager:CatchFish",e.fishName,h);var i=t.getFishByName(e.fishName);if(i){var a=e.scaleFishModel(h);e.playerEntity.script.player.fishModel.model.asset=i.script.fish.model,e.playerEntity.script.player.fishModel.setLocalScale(a,a,a),e.app.fire("NetworkManager:Send","holdFish",{fishName:e.fishName,fishModel:i.script.fish.model.id})}}),100))}),5e3)},CompetitiveMode.prototype.onCircleHit=function(t){if("game1"===this.myGameState){this.app.fire("NetworkManager:Send","circleHit",{});var e=this.activeCircles.indexOf(t);e>-1&&this.activeCircles.splice(e,1),this.showDamageEffect(t.getPosition(),1)}},CompetitiveMode.prototype.onCircleMissed=function(t){var e=this.activeCircles.indexOf(t);e>-1&&this.activeCircles.splice(e,1)},CompetitiveMode.prototype.onBarClick=function(){if("game2"===this.myGameState&&!this.barClicked&&this.barInteractionEnabled){this.barClicked=!0;var t=this.getHitSegment(this.barIndicatorPos),e=this.getSegmentMultiplier(t);this.playerMultiplier=e,this.highlightHitSegment(t,this.barIndicatorPos),this.app.fire("NetworkManager:Send","barHit",{position:this.barIndicatorPos,multiplier:e}),setTimeout((()=>{this.barContainer.enabled=!1,this.clearBarHighlight()}),2e3)}},CompetitiveMode.prototype.highlightHitSegment=function(t,e){if(t)for(var i=this.barBackground.findByTag("barSegment"),a=0;a<i.length;a++){var o=i[a],s=this.barSegments[a];if(s&&s.start<=e&&e<=s.end){this.createSegmentHighlight(o,s);break}}},CompetitiveMode.prototype.createSegmentHighlight=function(t,e){var i=new pc.Entity("SegmentHighlight");i.tags.add("barHighlight");var a=this.getSegmentColor(e.type),o=new pc.Color(Math.min(a.r+.3,1),Math.min(a.g+.3,1),Math.min(a.b+.3,1),.8);i.addComponent("element",{type:pc.ELEMENTTYPE_IMAGE,color:o,width:t.element.width,height:t.element.height+8,anchor:[.5,.5,.5,.5],pivot:[.5,.5]}),i.setLocalPosition(0,0,-2),t.addChild(i),this.animateHighlight(i)},CompetitiveMode.prototype.animateHighlight=function(t){var e=Date.now(),animate=function(){var i=(Date.now()-e)/1500;if(!(i>=1)&&t&&t.element){var a=1+.1*Math.sin(i*Math.PI*4);t.setLocalScale(a,a,1);var o=Math.max(0,.8-.6*i),s=t.element.color;t.element.color=new pc.Color(s.r,s.g,s.b,o),requestAnimationFrame(animate)}};animate()},CompetitiveMode.prototype.clearBarHighlight=function(){for(var t=this.barBackground.findByTag("barHighlight"),e=0;e<t.length;e++)t[e].destroy();var i=this.barContainer.findByTag("multiplierPopup");for(e=0;e<i.length;e++)i[e].destroy()},CompetitiveMode.prototype.showSubmitStationArrow=function(){this.app.fire("Arrow:Show")},CompetitiveMode.prototype.hideSubmitStationArrow=function(){this.app.fire("Arrow:Hide")},CompetitiveMode.prototype.update=function(t){"game1"===this.myGameState?(this.updateGame1(t),this.updateHealthDisplay(t)):"game2"===this.myGameState&&this.updateGame2(t),"submittedFish"===this.myGameState?this.arrowShown||(this.showSubmitStationArrow(),this.arrowShown=!0):this.arrowShown&&(this.hideSubmitStationArrow(),this.arrowShown=!1),this.isGameFinished||(this.overlay.findByName("Inventory").enabled=!1)},CompetitiveMode.prototype.updateGame1=function(t){"game1"===this.myGameState&&(this.circleSpawnTimer+=t,this.circleSpawnTimer>=this.circleSpawnInterval&&this.activeCircles.length<this.maxActiveCircles&&(this.spawnCircle(),this.circleSpawnTimer=0))},CompetitiveMode.prototype.updateGame2=function(t){!this.barClicked&&this.barInteractionEnabled&&(this.barIndicatorPos+=this.barDirection*this.barSpeed*t,this.barIndicatorPos>=1?(this.barIndicatorPos=1,this.barDirection=-1):this.barIndicatorPos<=0&&(this.barIndicatorPos=0,this.barDirection=1),this.updateBarIndicator())},CompetitiveMode.prototype.spawnCircle=function(){var t,e,i,a,o=this.circleTemplate.clone();o.enabled=!0,o.lifeTime=0,Utils.isMobile()?(t=-182.709,e=223.476,i=125,a=850):(t=-520,e=520,i=20,a=560);var s=t+Math.random()*(e-t),n=i+Math.random()*(a-i);o.setLocalPosition(s,n,0),this.circleContainer.addChild(o),this.activeCircles.push(o)},CompetitiveMode.prototype.clearCircles=function(){for(var t=0;t<this.activeCircles.length;t++)this.activeCircles[t].destroy();this.activeCircles=[]},CompetitiveMode.prototype.setupBarSegments=function(){for(var t=this.barBackground.findByTag("barSegment"),e=0;e<t.length;e++)t[e].destroy();if(this.barSegments&&0!==this.barSegments.length){var i=this.barBackground.element.width,a=this.barBackground.element.height;for(e=0;e<this.barSegments.length;e++){var o=this.barSegments[e];this.createVisualSegment(o,i,a,e)}}},CompetitiveMode.prototype.createVisualSegment=function(t,e,i,a){var o=new pc.Entity("BarSegment_"+a);o.tags.add("barSegment");var s=(t.end-t.start)*e,n=t.start*e-e/2+s/2,r=this.getSegmentColor(t.type);o.addComponent("element",{type:pc.ELEMENTTYPE_IMAGE,color:r,width:s,height:i-4,anchor:[.5,.5,.5,.5],pivot:[.5,.5]}),o.setLocalPosition(n,0,-1),this.barBackground.addChild(o),t.type.startsWith("green")&&this.addSegmentLabel(o,t.type)},CompetitiveMode.prototype.getSegmentColor=function(t){switch(t){case"red":return new pc.Color(.8,.2,.2,1);case"green_large":return new pc.Color(.2,.8,.2,1);case"green_medium":return new pc.Color(.1,.7,.1,1);case"green_small":return new pc.Color(.05,.6,.05,1);default:return new pc.Color(.5,.5,.5,1)}},CompetitiveMode.prototype.addSegmentLabel=function(t,e,i){if(!(i<40)){var a=new pc.Entity("SegmentLabel"),o=this.getSegmentMultiplier({type:e});a.addComponent("element",{type:pc.ELEMENTTYPE_TEXT,text:"x"+o,fontSize:i>60?18:14,color:new pc.Color(1,1,1,.9),anchor:[.5,.5,.5,.5],pivot:[.5,.5],fontAsset:null}),a.element.outlineColor=new pc.Color(0,0,0,1),a.element.outlineThickness=.3,a.setLocalPosition(0,0,1),t.addChild(a)}},CompetitiveMode.prototype.updateBarIndicator=function(){var t=503*(this.barIndicatorPos-.5);this.barIndicator.setLocalPosition(t,0,0)},CompetitiveMode.prototype.getHitSegment=function(t){for(var e=0;e<this.barSegments.length;e++){var i=this.barSegments[e];if(t>=i.start&&t<=i.end)return i}return null},CompetitiveMode.prototype.getSegmentMultiplier=function(t){if(!t)return 1;switch(t.type){case"green_large":return 2;case"green_medium":return 4;case"green_small":return 8;default:return 1}},CompetitiveMode.prototype.updateHealthDisplay=function(){var t=this.currentHealth/this.totalHealth;this.gameHealthBar.setLocalScale(t,1,1),this.gameHealthText.element.text="Score: "+this.currentHealth},CompetitiveMode.prototype.showDamageEffect=function(t,e){this.app.fire("DamageEffect:Show",e,t)};var BattleSpotComp=pc.createScript("battleSpotComp");BattleSpotComp.prototype.initialize=function(){this.popupShown=!1,this.progress=-1,this.threshold=0,this.lastLeave=-1,this.entity.on("Trigger",this.onTrigger,this),this.entity.on("Leave",this.onLeave,this),this.app.on("Player:Jumped",this.onJump,this)},BattleSpotComp.prototype.onJump=function(){if(!this.popupShown)return!1;this.lastLeave=Date.now(),this.popupShown=!1},BattleSpotComp.prototype.onTrigger=function(t,e){if(!(Date.now()-this.lastLeave<1e3)){if(this.popupShown)return!1;this.threshold+=5*e,this.app.fire("World2Screen:Show","Progress",this.entity),this.app.fire("Progress:WaitFill",this.threshold),this.threshold>1&&(this.app.fire("World2Screen:Hide","Progress",this.entity),this.app.fire("CompetitiveMode:PlayerOnSpot"),this.threshold=0,this.popupShown=!0)}},BattleSpotComp.prototype.onLeave=function(t){this.popupShown&&(this.popupShown=!1),this.threshold=0,this.app.fire("Progress:WaitFill",this.threshold),this.app.fire("CompetitiveMode:PlayerLeaveSpot"),this.app.fire("World2Screen:Hide","Progress",this.entity)},BattleSpotComp.prototype.update=function(t){};