const VECTOR_NAME="swag",fragmentShader="\n    precision highp float;\n    uniform sampler2D img;\n    uniform sampler2D depth;\n    uniform vec2 swag;\n    varying vec2 vpos;\n    void main() {\n        vec4 depthDistortion = texture2D(depth, vpos);\n        float parallaxMult = depthDistortion.r;\n        vec2 parallax = swag * parallaxMult;\n        vec4 original = texture2D(img, vpos + parallax);\n        gl_FragColor = original;\n    }\n",vertexShader="\n    attribute vec2 pos;\n    varying vec2 vpos;\n    uniform vec2 u_resolution;\n    uniform vec2 u_image_resolution;\n    uniform vec2 textureScale;\n\tuniform vec2 swag;\n    void main() {\n        // Scale the texture coordinates\n        vec2 scaledPos = pos* textureScale;\n\n        // Center the position\n        vpos = ((pos + 1.0) * 0.5);\n\t\tvpos.y = 1.0-vpos.y;\n\n\t\t// Apply mouse offset for parallax effect to gl_Position\n        vec2 position = scaledPos + swag * 2.5; // Adjust the factor for more or less movement\n        gl_Position = vec4(position, 0.0, 1.0);\n    }\n";class Image3D{constructor(t,e,i){if(!(t instanceof HTMLCanvasElement))throw new Error("The first argument must be a canvas element.");this.canvas=t,this.imageUrl=e,this.depthUrl=i,this.mouseMoveListener=this.onMouseMove.bind(this),this.setup()}async loadImage(t){const e=new Image;return e.crossOrigin="anonymous",e.src=t,await new Promise((t=>e.onload=t)),e}async setup(){const t=await this.loadImage(this.imageUrl),e=await this.loadImage(this.depthUrl);if(this.imageWidth=t.width,this.imageHeight=t.height,this.gl=this.canvas.getContext("webgl"),this.gl||(console.error("WebGL not supported, falling back on experimental-webgl"),this.gl=this.canvas.getContext("experimental-webgl")),!this.gl)throw new Error("Your browser does not support WebGL");const i=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,i),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,1]),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(0,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(0);const s=this.gl.createShader(this.gl.VERTEX_SHADER);if(this.gl.shaderSource(s,vertexShader),this.gl.compileShader(s),!this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS))return console.error("An error occurred compiling the vertex shader: ",this.gl.getShaderInfoLog(s)),void this.gl.deleteShader(s);const r=this.gl.createShader(this.gl.FRAGMENT_SHADER);if(this.gl.shaderSource(r,fragmentShader),this.gl.compileShader(r),!this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS))return console.error("An error occurred compiling the fragment shader: ",this.gl.getShaderInfoLog(r)),void this.gl.deleteShader(r);if(this.program=this.gl.createProgram(),this.gl.attachShader(this.program,s),this.gl.attachShader(this.program,r),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))return void console.error("Unable to initialize the shader program: ",this.gl.getProgramInfoLog(this.program));this.gl.useProgram(this.program),this.setTexture(t,"img",0,this.gl.RGB),this.setTexture(e,"depth",1,this.gl.LUMINANCE),this.uResolution=this.gl.getUniformLocation(this.program,"u_resolution"),this.uImageResolution=this.gl.getUniformLocation(this.program,"u_image_resolution"),this.textureScale=this.gl.getUniformLocation(this.program,"textureScale");this.gl.getUniformLocation(this.program,"swag");window.addEventListener("mousemove",this.mouseMoveListener),this.resize(this.canvas.clientWidth,this.canvas.clientHeight)}onMouseMove(t){const e=getRelativeMousePosition(t);this.gl.uniform2fv(this.gl.getUniformLocation(this.program,"swag"),new Float32Array(e)),requestAnimationFrame((()=>this.paint()))}setTexture(t,e,i,s){const r=this.gl.createTexture();this.gl.activeTexture(this.gl.TEXTURE0+i),this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texImage2D(this.gl.TEXTURE_2D,0,s,s,this.gl.UNSIGNED_BYTE,t),this.gl.uniform1i(this.gl.getUniformLocation(this.program,e),i)}paint(){this.gl&&(this.gl.clearColor(0,.65,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4))}resize(t,e){if(this.canvas.width=t,this.canvas.height=e,!this.gl)return;this.gl.viewport(0,0,this.canvas.width,this.canvas.height);const i=this.imageWidth/this.imageHeight,s=t/e;let r;r=s>i?[1,s/i]:[i/s,1];r=r.map((t=>1.05*t)),this.gl.uniform2f(this.uResolution,t,e),this.gl.uniform2f(this.uImageResolution,this.imageWidth,this.imageHeight),this.gl.uniform2fv(this.textureScale,r),this.paint()}delete(){if(!this.gl)return void console.error("WebGL context is not available.");window.removeEventListener("mousemove",this.mouseMoveListener),this.gl.deleteProgram(this.program);this.gl.getAttachedShaders(this.program).forEach((t=>this.gl.deleteShader(t)));for(let t=0;t<2;t++){this.gl.activeTexture(this.gl.TEXTURE0+t);const e=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D);e&&this.gl.deleteTexture(e)}const t=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING);t&&this.gl.deleteBuffer(t),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.gl=null}}function getRelativeMousePosition(t){const e=window.innerWidth,i=window.innerHeight;return[.035*(t.clientX/e-.5),.035*(.5-t.clientY/i)]}window.Image3D=Image3D;