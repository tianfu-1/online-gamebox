var Movement=pc.createScript("movement");Movement.attributes.add("speed",{type:"number",default:1}),Movement.attributes.add("turnSpeed",{type:"number",default:1}),Movement.attributes.add("startDirection",{type:"number",default:0}),Movement.attributes.add("raycastStart",{type:"entity"}),Movement.attributes.add("jumpSpeed",{type:"number",default:1}),Movement.attributes.add("jumpCurve",{type:"curve"}),Movement.attributes.add("fallLimit",{type:"number",default:-10}),Movement.attributes.add("fallSpeed",{type:"number",default:1}),Movement.attributes.add("originEntity",{type:"entity"}),Movement.attributes.add("cameraEntity",{type:"entity"}),Movement.attributes.add("characterMaleEntity",{type:"entity"}),Movement.attributes.add("characterFemaleEntity",{type:"entity"}),Movement.attributes.add("centerEntity",{type:"entity"}),Movement.attributes.add("mapHolder",{type:"entity"}),Movement.attributes.add("maxDistance",{type:"number",default:.25}),Movement.attributes.add("touchEntity",{type:"entity"}),Movement.attributes.add("touchStartEntity",{type:"entity"}),Movement.attributes.add("touchMoveEntity",{type:"entity"}),Movement.attributes.add("touchDirectionEntity",{type:"entity"}),Movement.attributes.add("groundDetectorEntity",{type:"entity"}),Movement.attributes.add("runningParticles",{type:"entity"}),Movement.attributes.add("splitEntity",{type:"entity"}),Movement.attributes.add("offset",{type:"number",default:.25}),Movement.prototype.initialize=function(){this.characterEntity=this.characterMaleEntity,this.isRunning=!1,this.direction=this.startDirection,this.nextDirection=this.startDirection,this.offsetDelta=0,this.lastEat=-1,this.currentAltitude=0,this.minimumAltitude=0,this.currentJumpValue=0,this.respawnPosition=this.entity.getPosition().clone().add(new pc.Vec3(.2,10,0)),this.triggerJump=!1,this.isJumping=!1,this.isLanded=!0,this.lastIsLanded=!0,this.hasContact=!1,this.lastBroadcast=Date.now(),this.isMobile=Utils.isMobile(),this.currentJumpTime=1,this.cameraDistance=0,this.halfAngle=90*pc.math.DEG_TO_RAD,this.groundVector=new pc.Vec3(0,-100,0),this.footstepType="Grass",this.stepIndex=1,this.force=new pc.Vec3(0,0,0),this.setController(),this.entity.on("SlowDown",this.onSlowDown,this),this.app.on("Player:Checkpoint",this.setCheckpoint,this),this.app.mouse.on("mousedown",this.onMouseDown,this),this.entity.on("Upgrade:State",this.onUpgradeSpeed,this),this.app.on("Movement:TeleportPlayer",this.respawn,this),this.app.on("Movement:Jump",this.onJump,this),this.app.on("Movement:Eat",this.onTouchEat,this),this.characterEntity.anim.on("Sound",this.playSound,this),this.entity.collision.on("collisionstart",this.onCollisionStart,this),this.entity.collision.on("collisionend",this.onCollisionEnd,this),this.app.on("MapManager:Loaded",this.onMapLoaded,this),this.app.on("Customization:Character",this.changeGender,this)},Movement.prototype.changeGender=function(t){this.characterEntity=t},Movement.prototype.onMapLoaded=function(){var t=this.app.root.findByTag("SpawnPoint"),i=Utils.getRandom(t).getPosition();this.entity.rigidbody.teleport(i.x,i.y+1,i.z)},Movement.prototype.onSlowDown=function(){this.lastEat=Date.now()},Movement.prototype.onMouseDown=function(){if(!pc.Mouse.isPointerLocked())return!1;this.app.fire("Eating:Eat")},Movement.prototype.onTouchEat=function(){if(!this.isMobile)return!1;this.app.fire("Eating:Eat")},Movement.prototype.onJump=function(){this.triggerJump=!0},Movement.prototype.setCheckpoint=function(t){this.respawnPosition=t},Movement.prototype.onUpgradeSpeed=function(t){this.speed=this.speed+.5*t},Movement.prototype.playSound=function(t){if("Run"==t.string){var i="Footstep-"+this.footstepType+"-"+this.stepIndex,e=.9;this.isCarrying&&(e=.8),this.entity.sound.slots[i].pitch=e-.3*Math.random(),this.entity.sound.play(i),this.stepIndex++,this.stepIndex>3&&(this.stepIndex=1)}},Movement.prototype.setController=function(){this.isTouching=!1,this.touchStart=new pc.Vec2(0,0),this.currentTouch=new pc.Vec2(0,0),this.app.on("TouchManager:MovementStart",this.onTouchStart,this),this.app.on("TouchManager:MovementMove",this.onTouchMove,this),this.app.on("TouchManager:MovementEnd",this.onTouchEnd,this)},Movement.prototype.onTouchStart=function(t){this.touchStart.x=t.x,this.touchStart.y=t.y,this.isTouchMoved=!1,this.totalMouseDistance=0,this.setTouchEntityPosition(),this.touchEntity.enabled=!0,this.touchMoveEntity.setLocalPosition(0,0,0),this.isTouching=!0},Movement.prototype.onTouchMove=function(t){this.currentTouch.x=t.x,this.currentTouch.y=t.y,this.isTouchMoved=!0;var i=this.currentTouch.x-this.touchStart.x,e=this.currentTouch.y-this.touchStart.y,s=75;if(i>s?i=s:i<-75&&(i=-75),e>s?e=s:e<-75&&(e=-75),this.touchMoveEntity.setLocalPosition(2*i,2*-e,0),this.totalMouseDistance=Utils.distance(this.touchStart.x,this.touchStart.y,this.currentTouch.x,this.currentTouch.y),this.touchMoveEntity.enabled=!0,this.totalMouseDistance>=s){var n=this.currentTouch.x-this.touchStart.x,o=this.currentTouch.y-this.touchStart.y,a=this.normalize(n,o),r=Math.min(Math.max(this.totalMouseDistance,0),s);this.touchStart.x=this.currentTouch.x-a.x*r,this.touchStart.y=this.currentTouch.y-a.y*r,this.setTouchEntityPosition()}},Movement.prototype.normalize=function(t,i){var e=Math.sqrt(t*t+i*i);return 0===e?{x:0,y:0}:{x:t/e,y:i/e}},Movement.prototype.onTouchEnd=function(){this.isTouching=!1,this.touchEntity.enabled=!1},Movement.prototype.setTouchEntityPosition=function(){var t=this.app.graphicsDevice.canvas,i=this.touchStart.x/t.clientWidth*2-1,e=1-this.touchStart.y/t.clientHeight*2;this.touchEntity.setPosition(i,e,0)},Movement.prototype.setKeyboard=function(){var t=-this.cameraEntity.script.camera.lookX;(this.app.keyboard.isPressed(pc.KEY_W)||this.app.keyboard.isPressed(pc.KEY_UP))&&(this.nextDirection=-90+t,this.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_A)||this.app.keyboard.isPressed(pc.KEY_LEFT))&&(this.nextDirection=-180+t,this.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_D)||this.app.keyboard.isPressed(pc.KEY_RIGHT))&&(this.nextDirection=0+t,this.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_S)||this.app.keyboard.isPressed(pc.KEY_DOWN))&&(this.nextDirection=90+t,this.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_W)||this.app.keyboard.isPressed(pc.KEY_UP))&&(this.app.keyboard.isPressed(pc.KEY_A)||this.app.keyboard.isPressed(pc.KEY_LEFT))&&(this.nextDirection=-135+t,this.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_W)||this.app.keyboard.isPressed(pc.KEY_UP))&&(this.app.keyboard.isPressed(pc.KEY_D)||this.app.keyboard.isPressed(pc.KEY_RIGHT))&&(this.nextDirection=-45+t,this.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_S)||this.app.keyboard.isPressed(pc.KEY_DOWN))&&(this.app.keyboard.isPressed(pc.KEY_A)||this.app.keyboard.isPressed(pc.KEY_LEFT))&&(this.nextDirection=135+t,this.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_S)||this.app.keyboard.isPressed(pc.KEY_DOWN))&&(this.app.keyboard.isPressed(pc.KEY_D)||this.app.keyboard.isPressed(pc.KEY_RIGHT))&&(this.nextDirection=45+t,this.isRunning=!0)},Movement.prototype.setTouch=function(){if(this.isTouching&&this.isTouchMoved){var t=Utils.lookAt(this.touchStart.x,this.touchStart.y,this.currentTouch.x,this.currentTouch.y),i=-this.cameraEntity.script.camera.lookX;this.nextDirection=(-t+Math.PI/2)*pc.math.RAD_TO_DEG+i;var e=this.nextDirection-i;this.isRunning=!0,this.touchDirectionEntity.setLocalEulerAngles(0,0,-e),this.touchDirectionEntity.enabled=this.totalMouseDistance>50}},Movement.prototype.setDirection=function(t){var i=this.turnSpeed*t*60;this.direction=Utils.rotate(this.direction,this.nextDirection*pc.math.DEG_TO_RAD,i),this.originEntity.setLocalEulerAngles(0,90-this.direction*pc.math.RAD_TO_DEG,0)},Movement.prototype.applyForce=function(){var t=0;this.isRunning&&(t=this.speed),this.entity.script.player.isWalkingFaster&&(t*=1.75),Date.now()-this.lastEat<380&&(t*=.01),this.force.x=Math.cos(this.direction-this.halfAngle)*t,this.force.z=Math.sin(this.direction-this.halfAngle)*t,this.entity.rigidbody.applyForce(this.force),this.cameraDistance=Utils.lerp(this.cameraDistance,this.isRunning?this.maxDistance:0,.05),this.centerEntity.setLocalPosition(this.cameraDistance,0,0)},Movement.prototype.updateMovement=function(t){this.isRunning=!1,PokiPlugin.isGamePaused||(this.setKeyboard(),this.setTouch()),this.app.fire("Animation:Run",this.isRunning),this.runningParticles.enabled=this.isRunning},Movement.prototype.setGravity=function(t){if(!pc.VoxelAltitude)return!1;var i=this.entity.getPosition().clone();i.y-=1;var e=i.clone().add(this.groundVector),s=this.app.systems.rigidbody.raycastFirst(i,e);if(null!==s){var n=pc.VoxelAltitude.getAltitude(i),o=Math.max(s.point.y+.25,n)+this.offset+this.offsetDelta;this.minimumAltitude=o}this.isJumping||(this.currentAltitude-=this.fallSpeed*t),this.currentAltitude<=this.minimumAltitude&&(this.currentAltitude=this.minimumAltitude),this.entity.rigidbody.body.getWorldTransform().getOrigin().setY(this.currentAltitude)},Movement.prototype.onCollisionStart=function(t){t&&t.contacts&&t.contacts.length,this.hasContact=!0},Movement.prototype.onCollisionEnd=function(t){this.hasContact=!1},Movement.prototype.jump=function(){if(this.isJumping)return!1;this.isLanded&&(this.isJumping=!0,this.isLanded=!1,this.currentJumpTime=0,this.app.fire("Animation:Jump"))},Movement.prototype.land=function(){this.currentJumpTime>=1&&!this.isLanded&&(this.isLanded=!0,this.isJumping=!1)},Movement.prototype.updateJumping=function(t){(this.app.keyboard.wasPressed(pc.KEY_SPACE)||this.triggerJump)&&this.jump(),this.isJumping&&(this.currentAltitude+=this.jumpCurve.value(this.currentJumpTime)*t*50,this.currentJumpTime<=1&&(this.currentJumpTime+=t*this.jumpSpeed)),this.currentJumpTime>=1&&this.land(),this.characterEntity.anim.setBoolean("Land",this.isLanded)},Movement.prototype.respawn=function(){this.entity.rigidbody.teleport(this.respawnPosition.clone())},Movement.prototype.checkFallLimit=function(){this.entity.getPosition().y<this.fallLimit&&this.respawn()},Movement.prototype.broadcastPosition=function(){if(Date.now()-this.lastBroadcast<20)return!1;var t=this.entity.getPosition().clone(),i=this.direction;this.app.fire("NetworkManager:Send","p",{x:t.x,y:t.y,z:t.z,w:i}),this.lastBroadcast=Date.now()},Movement.prototype.update=function(t){if(PokiPlugin.isGamePaused)return!1;(pc.Mouse.isPointerLocked()||this.isMobile)&&(this.updateMovement(),this.updateJumping(t),this.triggerJump=!1),this.entity.script.label.offset.y=.8+this.offsetDelta,this.setDirection(t),this.applyForce(t),this.checkFallLimit(),this.broadcastPosition(),this.setGravity(t)};var Camera=pc.createScript("camera");Camera.attributes.add("pitchEntity",{type:"entity"}),Camera.attributes.add("yawEntity",{type:"entity"}),Camera.attributes.add("cameraEntity",{type:"entity"}),Camera.attributes.add("cameraRaycastEntity",{type:"entity"}),Camera.attributes.add("playerEntity",{type:"entity"}),Camera.attributes.add("centerEntity",{type:"entity"}),Camera.attributes.add("speed",{type:"number",default:1}),Camera.attributes.add("highSpeed",{type:"number",default:1}),Camera.attributes.add("turnSpeed",{type:"number",default:1}),Camera.attributes.add("mobileTurnSpeed",{type:"number",default:1}),Camera.attributes.add("maxAngle",{type:"number",default:90}),Camera.attributes.add("minAngle",{type:"number",default:-35}),Camera.attributes.add("maxCameraDistance",{type:"number",default:2.5}),Camera.attributes.add("cameraFactor",{type:"number",default:1}),Camera.attributes.add("maxCameraFactor",{type:"number",default:1}),Camera.attributes.add("minCameraDistanceEntity",{type:"entity"}),Camera.attributes.add("zoomSpeed",{type:"number",default:.5}),Camera.prototype.initialize=function(){this.nextPosition=new pc.Vec3,this.nextDirection=0,this.minCameraDistance=5,this.isMobile=Utils.isMobile(),this.currentZoom=0,this.OGMaxCameraDistance=this.maxCameraDistance,this.OGMinCameraDistance=this.minCameraDistance,this.app.mouse.on("mousewheel",this.onMouseWheel,this),this.isLocked=!1,this.lookX=0,this.lookY=0,this.setController(),this.app.on("Camara:UpdateMaxCameraDistance",this.updateMaxCameraDistance,this),this.app.on("Camara:UpdateMinCameraDistance",this.updateMinCamaraDistance,this),this.app.on("Camara:ResetMaxCameraDistance",this.resetCameraDistance,this)},Camera.prototype.onMouseWheel=function(t){var a=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));this.currentZoom+=a*this.zoomSpeed,this.currentZoom=Math.max(-3,Math.min(3,this.currentZoom))},Camera.prototype.updateMaxCameraDistance=function(t){this.maxCameraDistance+=t,this.maxCameraDistance>50?this.maxCameraDistance=50:(this.updateMinCamaraDistance(),this.maxCameraDistance<this.minCameraDistance&&(this.maxCameraDistance=this.minCameraDistance))},Camera.prototype.updateMinCamaraDistance=function(){this.entity.getPosition().clone(),this.minCameraDistanceEntity.getPosition().clone()},Camera.prototype.resetCameraDistance=function(){this.maxCameraDistance=this.OGMaxCameraDistance,this.minCameraDistance=this.OGMinCameraDistance},Camera.prototype.setController=function(){this.isTouching=!1,this.lastTouchPosition=new pc.Vec2(0,0),this.touchID=!1,Utils.isMobile()?(this.app.on("TouchManager:RotationStart",this.onTouchStart,this),this.app.on("TouchManager:RotationMove",this.onTouchMove,this),this.app.on("TouchManager:RotationEnd",this.onTouchEnd,this)):(this.app.on("Mouse:Lock",this.onMouseLock,this),this.app.mouse.on("mousedown",this.onMouseDown,this),this.app.mouse.on("mousemove",this.onMouseMove,this),this.app.mouse.on("mouseup",this.onMouseUp,this))},Camera.prototype.onTouchStart=function(t){this.isTouching=!0,this.lastTouchPosition.x=t.x,this.lastTouchPosition.y=t.y},Camera.prototype.onTouchMove=function(t){this.lookX-=(t.x-this.lastTouchPosition.x)*this.mobileTurnSpeed*this.dt*60,this.lookY+=(t.y-this.lastTouchPosition.y)*this.mobileTurnSpeed*this.dt*60,this.lastTouchPosition.x=t.x,this.lastTouchPosition.y=t.y,this.lookY=Math.max(this.lookY,this.minAngle),this.lookY=Math.min(this.lookY,this.maxAngle)},Camera.prototype.normalize=function(t,a){var e=Math.sqrt(t*t+a*a);return 0===e?{x:0,y:0}:{x:t/e,y:a/e}},Camera.prototype.onTouchEnd=function(){this.isTouching=!1,this.touchID=!1},Camera.prototype.onMouseLock=function(){var t=this;this.app.mouse.enablePointerLock((function(){t.isLocked=!0,pc.app.fire("Overlay:MouseLocked",!0)}))},Camera.prototype.onMouseDown=function(){},Camera.prototype.onMouseUp=function(){},Camera.prototype.onMouseMove=function(t){if(!pc.Mouse.isPointerLocked())return!1;this.lookX-=t.dx*this.turnSpeed*60,this.lookY+=t.dy*this.turnSpeed*60,this.lookY=Math.max(this.lookY,this.minAngle),this.lookY=Math.min(this.lookY,this.maxAngle)},Camera.prototype.raycastClip=function(){var t=this.centerEntity.getPosition().clone(),a=this.cameraRaycastEntity.getPosition().clone(),e=this.app.systems.rigidbody.raycastAll(t,a);if(e)if(e.length>0){var i=[];for(let t=0;t<e.length;t++)"Player"===e[t].entity.name||e[t].entity.tags.has("Box")||i.push(e[t].point);if(i.length>0){var s=i.reduce(((a,e)=>t.distance(e)<t.distance(a)?e:a)),o=t.distance(s);o<1?this.cameraEntity.setLocalPosition(0,0,this.minCameraDistance/2):this.cameraEntity.setLocalPosition(0,0,o-.2)}else this.cameraEntity.setLocalPosition(0,0,this.maxCameraDistance)}else this.cameraEntity.setLocalPosition(0,0,this.maxCameraDistance);else this.cameraEntity.setLocalPosition(0,0,this.maxCameraDistance)},Camera.prototype.updatePosition=function(t){this.dt=t;var a=this.speed*t*60;this.nextPosition=this.nextPosition.lerp(this.nextPosition,this.centerEntity.getPosition(),a),this.entity.setPosition(this.centerEntity.getPosition()),this.yawEntity.setLocalEulerAngles(0,this.lookX,0),this.pitchEntity.setLocalEulerAngles(0,0,this.lookY)},Camera.prototype.update=function(t){var a=1;this.isMobile&&(a=2),this.maxCameraDistance=this.playerEntity.script.player.weight*this.cameraFactor,this.maxCameraDistance=Math.min(this.maxCameraDistance,this.maxCameraFactor)*a+this.currentZoom,this.updatePosition(t),this.raycastClip()};var MaterialShader=pc.createScript("materialShader");MaterialShader.attributes.add("inEditor",{type:"boolean",default:!0,title:"In Editor"}),MaterialShader.attributes.add("isDebug",{type:"boolean",default:!1}),MaterialShader.attributes.add("isElement",{type:"boolean",default:!1}),MaterialShader.attributes.add("isStatic",{type:"boolean",default:!1}),MaterialShader.attributes.add("isBatched",{type:"boolean",default:!1}),MaterialShader.attributes.add("color",{type:"boolean",default:!0}),MaterialShader.attributes.add("transform",{type:"boolean",default:!0}),MaterialShader.attributes.add("light",{type:"boolean",default:!0}),MaterialShader.attributes.add("material",{type:"asset",assetType:"material"}),MaterialShader.attributes.add("textures",{type:"json",schema:[{name:"name",type:"string",default:"texture_0"},{name:"texture",type:"asset",assetType:"texture"}],array:!0}),MaterialShader.attributes.add("colors",{type:"json",schema:[{name:"name",type:"string",default:"color_0"},{name:"color",type:"rgba"}],array:!0}),MaterialShader.attributes.add("vectors",{type:"json",schema:[{name:"name",type:"string",default:"vector_0"},{name:"vector",type:"vec2"}],array:!0}),MaterialShader.attributes.add("numbers",{type:"json",schema:[{name:"name",type:"string",default:"number_0"},{name:"number",type:"number",default:0}],array:!0}),MaterialShader.attributes.add("curves",{type:"json",schema:[{name:"name",type:"string",default:"curve_0"},{name:"curve",type:"curve",curves:["x","y","z"]},{name:"speed",type:"number",default:1}],array:!0}),MaterialShader.attributes.add("billboard",{type:"boolean",default:!1}),MaterialShader.attributes.add("vertexSet",{type:"boolean",default:!1}),MaterialShader.attributes.add("cloneMaterial",{type:"boolean",default:!1}),MaterialShader.attributes.add("alphaRef",{type:"number",default:.15}),MaterialShader.attributes.add("shader",{type:"string",default:"dmVjNCBnZXRDb2xvcih2ZWMyIFVWKXsKLy92ZWMzIHRleHR1cmVfY29sb3IgPSB0ZXh0dXJlMkQodGV4dHVyZV8wLCBVVikucmdiOwpjb2xvci5yZ2IgPSB2ZWMzKDAuMCwgMS4wLCAwLjApOwpjb2xvci5hID0gMS4wOwoKcmV0dXJuIGNvbG9yOwp9Cgp2ZWMzIGdldFZlcnRleCh2ZWMzIGxvY2FsUG9zaXRpb24sIHZlYzMgd29ybGRQb3NpdGlvbiwgdmVjMiBVVil7CnZlcnRleC54eXogPSB2ZWMzKDAuMCwgMC4wLCAwLjApOwoKcmV0dXJuIHZlcnRleDsKfQ=="}),MaterialShader.prototype.initialize=function(){this.parameters=[],this.once=!1,this.reset(),this.isDebug?this.addCodeEditor():(this.emissive=atob(this.shader),this.updateMaterial()),this.on("attr:textures",this.onAttributeChange,this),this.on("attr:colors",this.onAttributeChange,this),this.on("attr:vectors",this.onAttributeChange,this),this.on("attr:numbers",this.onAttributeChange,this),this.on("attr:curves",this.onAttributeChange,this),this.on("attr:shader",this.onAttributeChange,this),this.entity.on("MaterialShader:Set",this.setVariable,this),this.on("state",this.onStateChange,this),this.on("destroy",this.onDestroy,this),this.entity.on("Model:Loaded",this.onModelLoaded,this),this.app.on("MaterialShader:Reset",this.onStateChange,this),this.material&&(this.totalAssets=2+this.textures.length,this.loaded=0,this.loadAllAssets()),this.isElement&&this.onAttributeChange()},MaterialShader.prototype.loadAllAssets=function(){if(this.isElement)return this.loaded=this.totalAssets,Timer.setTimeout((function(t){t.isLoaded()}),100,this),!1;var t=this,e=this.entity.model.asset,a=this.app.assets.get(e);for(var i in a?(a.ready((function(){t.loaded++,t.isLoaded()})),this.app.assets.load(a)):(this.loaded++,this.isLoaded()),this.material.ready((function(){t.loaded++,t.isLoaded()})),this.app.assets.load(this.material),this.textures){var r=this.textures[i];r.texture.ready((function(){t.loaded++,t.isLoaded()})),this.app.assets.load(r.texture)}},MaterialShader.prototype.isLoaded=function(){this.loaded>=this.totalAssets&&(this.isBatched?Timer.setTimeout((function(t){t.getMaterialByBatch(),t.updateMaterial()}),100,this):(this.cloneMaterial?(this.currentMaterial=this.material.resource.clone(),this.isElement?this.entity.element.material=this.currentMaterial:this.entity.model.meshInstances[0].material=this.currentMaterial):this.currentMaterial=this.material.resource,this.updateMaterial()))},MaterialShader.prototype.setVariable=function(t,e){for(var a in this.parameters){var i=this.parameters[a];this.currentMaterial.setParameter(i.name,i.resource),i.name==t&&(this.parameters[a].resource=e)}},MaterialShader.prototype.updateDynamicVariables=function(){for(var t in this.curves){var e=this.curves[t];for(var a in this.parameters){var i=this.parameters[a];if(i.name==e.name){var r=e.curve.value(this.timestamp*e.speed%1);i.resource=[r[0],r[1],r[2]]}}}},MaterialShader.prototype.onDestroy=function(){this.cloneMaterial&&this.currentMaterial&&this.currentMaterial.destroy()},MaterialShader.prototype.onModelLoaded=function(t){!0===t&&Timer.setTimeout((function(t){t.onAttributeChange()}),3e3,this)},MaterialShader.prototype.onStateChange=function(t){this.reset()},MaterialShader.prototype.copy=function(t){var e=btoa(t);navigator.clipboard.writeText(e).then((function(){console.log("Async: Copying to clipboard was successful!")}),(function(t){console.error("Async: Could not copy text: ",t)}))},MaterialShader.prototype.addCodeEditor=function(){var t=this,e=document.createElement("button");e.style.position="fixed",e.style.left="10px",e.style.top="340px",e.style.width="100px",e.style.height="40px",e.style.zIndex="5000",e.style.background="rgba(0, 0, 0, 0.5)",e.style.color="#fff",e.textContent="Copy",e.onclick=function(){t.copy(t.emissiveCode.value)},document.body.appendChild(e);var a=document.createElement("textarea");a.style.position="fixed",a.style.left="10px",a.style.top="10px",a.style.width="400px",a.style.height="300px",a.style.padding="10px",a.style.zIndex="5000",a.style.background="rgba(0, 0, 0, 0.5)",a.style.outline="none",a.style.color="white",a.onkeyup=this.onShaderChange.bind(this);var i=document.createElement("style");i.innerText="#application-console{max-height: 80px;}",document.body.appendChild(i),this.emissiveCode=a,this.emissiveCode.value=atob(this.shader),this.emissive=this.emissiveCode.value,this.updateMaterial(),document.body.appendChild(a)},MaterialShader.prototype.onShaderChange=function(){Timer.clearTimeout(this.timer),this.timer=Timer.setTimeout((function(t){t.emissive=t.emissiveCode.value,t.updateMaterial()}),100,this)},MaterialShader.prototype.reset=function(){this.timestamp=0},MaterialShader.prototype.line=function(t){return t+"\n"},MaterialShader.prototype.number=function(t){return parseFloat(t).toFixed(2)},MaterialShader.prototype.colorRGB=function(t){return"vec3("+this.number(t.data[0])+", "+this.number(t.data[1])+", "+this.number(t.data[2])+")"},MaterialShader.prototype.colorRGBA=function(t){return"vec4("+this.number(t.data[0])+", "+this.number(t.data[1])+", "+this.number(t.data[2])+", "+this.number(t.data[3])+")"},MaterialShader.prototype.addParameter=function(t,e){var a="";for(var i in this[t]){var r=this[t][i],s=!1;if(a+=this.line("uniform "+e+" "+r.name+";"),"textures"==t&&(s=r.texture.resource),"colors"==t&&(s=r.color.data),"vectors"==t&&(s=r.vector.data),"curves"==t){var n=r.curve.value(this.timestamp*r.speed);s=[n[0],n[1],n[2]]}"numbers"==t&&(s=r.number),this.parameters.push({name:r.name,resource:s})}return a},MaterialShader.prototype.generateShaderOutput=function(){var t="";return t+=this.addParameter("textures","sampler2D"),t+=this.addParameter("colors","vec4"),t+=this.addParameter("vectors","vec2"),t+=this.addParameter("numbers","float"),t+=this.addParameter("curves","vec3"),t+=this.line("uniform float timestamp;"),t+=this.line("uniform float alpha_ref;"),t+=this.line("vec4 color  = vec4(0.0);"),t+=this.line("vec3 vertex = vec3(0.0);"),t+=this.line(this.emissive),t+=this.line("void getEmission() {"),t+=this.line("}"),t+=this.line("void getAlbedo() {"),t+=this.line("}"),t+=this.line("void getOpacity() {"),t+=this.line("}"),t+=this.line("void alphaTest(float a) {"),t+=this.line("if (a < alpha_ref) discard;"),t+=this.line("}")},MaterialShader.prototype.onAttributeChange=function(){this.reset(),this.updateMaterial()},MaterialShader.prototype.generateTransformOutput=function(){var t="";return t+=this.addParameter("textures","sampler2D"),t+=this.addParameter("colors","vec4"),t+=this.addParameter("vectors","vec2"),t+=this.addParameter("numbers","float"),t+=this.addParameter("curves","vec3"),this.isBatched&&(t+=this.line("#define DYNAMICBATCH")),t+=this.line("uniform float timestamp;"),t+=this.line("uniform mat4 matrix_viewInverse;"),t+=this.line("mat4 getModelMatrix() {"),t+=this.line("#ifdef DYNAMICBATCH"),t+=this.line("return getBoneMatrix(vertex_boneIndices);"),t+=this.line("#elif defined(INSTANCING)"),t+=this.line("return mat4(instance_line1, instance_line2, instance_line3, instance_line4);"),t+=this.line("#else"),t+=this.line("return matrix_model;"),t+=this.line("#endif"),t+=this.line("}"),t+=this.line("vec4 color  = vec4(0.0);"),t+=this.line("vec3 vertex = vec3(0.0);"),t+=this.line(this.emissive),t+=this.line("vec4 getPosition() {"),t+=this.line("dModelMatrix = getModelMatrix();"),t+=this.line("vec3 localPos = vertex_position;"),t+=this.line("vec4 posW   = dModelMatrix * vec4(localPos, 1.0);"),t+=this.line("vec2 UV     = localPos.xy * 0.5 + vec2(0.5, 0.5);"),this.billboard&&(t+=this.line("vec3 CameraUp_worldspace = matrix_viewInverse[1].xyz;"),t+=this.line("vec3 CameraRight_worldspace = matrix_viewInverse[0].xyz;"),t+=this.line("vec3 particleCenter_wordspace = ( dModelMatrix * vec4(0.0, 0.0, 0.0, 1.0) ).xyz;"),t+=this.line("posW.xyz = particleCenter_wordspace.xyz + CameraRight_worldspace * localPos.x + CameraUp_worldspace * localPos.y;")),this.vertexSet?t+=this.line("posW.xyz = getFullVertex(localPos, posW.xyz, UV, dModelMatrix, matrix_viewInverse);"):t+=this.line("posW.xyz+= getVertex(localPos, posW.xyz, UV);"),t+=this.line("dPositionW = posW.xyz;"),t+=this.line("vec4 outputPosition = matrix_viewProjection * posW;"),t+=this.line("return outputPosition;"),t+=this.line("}"),t+=this.line("vec3 getWorldPosition() {"),t+=this.line("return dPositionW;"),t+=this.line("}")},MaterialShader.prototype.getMaterialByBatch=function(){var t=this.entity.model.batchGroupId,e=this.app.batcher.getBatches(t);for(var a in e){var i=e[a].meshInstance.material;this.currentMaterial=i}},MaterialShader.prototype.updateMaterial=function(){if(this.timestamp=0,!this.currentMaterial)return!1;this.transform&&(this.currentMaterial.chunks.transformVS=this.generateTransformOutput()),this.color&&(this.currentMaterial.chunks.diffusePS=this.generateShaderOutput(),this.currentMaterial.chunks.opacityPS=" ",this.currentMaterial.chunks.emissivePS=" ",this.currentMaterial.chunks.alphaTestPS=" ",this.currentMaterial.chunks.endPS="vec4 outputColor = getColor(vUv0);",this.currentMaterial.chunks.endPS+="dAlpha = outputColor.a;",this.currentMaterial.chunks.endPS+="if (dAlpha < "+this.alphaRef+"){ discard; }",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = outputColor.rgb;",this.currentMaterial.chunks.outputAlphaPS=" ",this.light&&(this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = mix(gl_FragColor.rgb * dDiffuseLight, dSpecularLight + dReflection.rgb * dReflection.a, dSpecularity);",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = addFog(gl_FragColor.rgb);",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = toneMap(gl_FragColor.rgb);",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = gammaCorrectOutput(gl_FragColor.rgb);"),this.currentMaterial.chunks.endPS+="gl_FragColor.a = dAlpha;"),this.currentMaterial.update()},MaterialShader.prototype.update=function(t){if(this.currentMaterial){if(this.updateDynamicVariables(),!this.isStatic||!this.once){for(var e in this.parameters){var a=this.parameters[e];this.currentMaterial.setParameter(a.name,a.resource)}this.once=!0}this.currentMaterial.setParameter("timestamp",this.timestamp),this.currentMaterial.update()}this.timestamp+=t};var TouchManager=pc.createScript("touchManager");TouchManager.prototype.initialize=function(){this.setController()},TouchManager.prototype.setController=function(){if(!Utils.isMobile())return!1;this.movementTouchID=-1,this.rotationTouchID=-1,this.app.touch.on("touchstart",this.onTouchStart,this),this.app.touch.on("touchmove",this.onTouchMove,this),this.app.touch.on("touchend",this.onTouchEnd,this)},TouchManager.prototype.onTouchStart=function(t){var o=t.touches;if(o||(o=[t]),o.length>0)for(i=0;i<o.length;i++){var h=o[i];h.x<this.app.graphicsDevice.canvas.width/2?-1==this.movementTouchID&&(this.movementTouchID=h.id,this.app.fire("TouchManager:MovementStart",h)):-1==this.rotationTouchID&&(this.rotationTouchID=h.id,this.app.fire("TouchManager:RotationStart",h))}},TouchManager.prototype.onTouchMove=function(t){var o=t.touches;if(o||(o=[t]),o.length>0)for(i=0;i<o.length;i++){var h=o[i];h.id==this.movementTouchID?this.app.fire("TouchManager:MovementMove",h):h.id==this.rotationTouchID&&this.app.fire("TouchManager:RotationMove",h)}},TouchManager.prototype.onTouchEnd=function(t){var o=t.touches;if(o||(o=[t]),o.length>0)for(i=0;i<o.length;i++){var h=o[i];h.id==this.movementTouchID?(this.rotationTouchID=-1,this.app.fire("TouchManager:RotationEnd")):h.id==this.rotationTouchID&&(this.movementTouchID=-1,this.app.fire("TouchManager:MovementEnd"))}else this.app.fire("TouchManager:MovementEnd"),this.app.fire("TouchManager:RotationEnd"),this.movementTouchID=-1,this.rotationTouchID=-1};var Timeline=pc.createScript("timeline");Timeline.attributes.add("autoplay",{type:"boolean"}),Timeline.attributes.add("loop",{type:"boolean",default:!1}),Timeline.attributes.add("yoyo",{type:"boolean",default:!1}),Timeline.attributes.add("position",{type:"boolean",default:!1}),Timeline.attributes.add("scale",{type:"boolean",default:!1}),Timeline.attributes.add("rotation",{type:"boolean",default:!1}),Timeline.attributes.add("opacity",{type:"boolean",default:!1}),Timeline.attributes.add("custom",{type:"boolean",default:!1}),Timeline.attributes.add("playSound",{type:"boolean",default:!1}),Timeline.attributes.add("duration",{type:"number",default:1}),Timeline.attributes.add("delay",{type:"number",default:0}),Timeline.attributes.add("repeat",{type:"number",default:0}),Timeline.attributes.add("soundDelay",{type:"number",default:0}),Timeline.attributes.add("rollback",{type:"number",default:0}),Timeline.attributes.add("ease",{type:"string",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}],default:"Linear"}),Timeline.attributes.add("startFrame",{type:"json",schema:[{name:"position",type:"vec3"},{name:"rotation",type:"vec3"},{name:"scale",type:"vec3",default:[1,1,1]},{name:"opacity",type:"number",default:1},{name:"custom",type:"string",description:"For example camera.fov = 40"}]}),Timeline.attributes.add("endFrame",{type:"json",schema:[{name:"position",type:"vec3"},{name:"rotation",type:"vec3"},{name:"scale",type:"vec3",default:[1,1,1]},{name:"opacity",type:"number",default:1},{name:"custom",type:"string",description:"For example camera.fov = 40"}]}),Timeline.prototype.initialize=function(){this.animation={custom:0},this.eventListener=!1,this.app.on("Timeline:"+this.entity.name,this.onPlay,this),this.app.on("Timeline:"+this.entity.name+"@Time",this.setTime,this),this.entity.on("Timeline",this.onPlay,this),this.on("destroy",this.onDestroy,this),this.on("state",this.onStateChange,this),this.autoplay&&this.onPlay()},Timeline.prototype.setTime=function(t){this.duration=t},Timeline.prototype.onStateChange=function(t){!0===t?this.autoplay&&this.onPlay():this.reset()},Timeline.prototype.onDestroy=function(){},Timeline.prototype.getEase=function(){return pc[this.ease]},Timeline.prototype.reset=function(){this.positionFrames&&this.positionFrames.stop(),this.rotationFrames&&this.rotationFrames.stop(),this.scaleFrames&&this.scaleFrames.stop(),this.opacityFrames&&this.opacityFrames.stop(),this.customFrames&&this.customFrames.stop()},Timeline.prototype.setFirstFrame=function(options){var frame=this.startFrame;if(options.isReverse&&(frame=this.endFrame),this.position&&this.entity.setLocalPosition(frame.position),this.rotation&&this.entity.setLocalEulerAngles(frame.rotation),this.scale&&this.entity.setLocalScale(frame.scale),this.opacity&&(this.entity.element.opacity=frame.opacity),this.custom){var parts=frame.custom.split(" = "),query=parts[0],value=parseFloat(parts[1]);this.animation.custom=value,eval("this.entity."+this.custom)}},Timeline.prototype.onComplete=function(){},Timeline.prototype.onPlay=function(_options){var self=this,options={isReverse:!1,delay:this.delay,playSound:this.playSound};"object"==typeof _options&&(options.isReverse=!!_options.isReverse),"object"==typeof _options&&(options.playSound=!!_options.playSound),options.playSound&&setTimeout((function(t){t.entity.sound.play("Sound")}),1e3*this.soundDelay,this);var frame=this.endFrame;if(options.isReverse&&(options.delay=0,frame=this.startFrame),this.reset(),this.setFirstFrame(options),this.position&&(this.positionFrames=this.entity.tween(this.entity.getLocalPosition()).to({x:frame.position.x,y:frame.position.y,z:frame.position.z},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.positionFrames.on("complete",this.onComplete,this)),this.loop&&this.positionFrames.loop(!0),this.yoyo&&this.positionFrames.yoyo(!0),this.repeat>0&&this.positionFrames.repeat(this.repeat),this.positionFrames.start()),this.rotation&&(this.rotationFrames=this.entity.tween(this.entity.getLocalEulerAngles()).rotate({x:frame.rotation.x,y:frame.rotation.y,z:frame.rotation.z},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.rotationFrames.on("complete",this.onComplete,this)),this.loop&&this.rotationFrames.loop(!0),this.yoyo&&this.rotationFrames.yoyo(!0),this.repeat>0&&this.rotationFrames.repeat(this.repeat),this.rotationFrames.start()),this.scale&&(this.scaleFrames=this.entity.tween(this.entity.getLocalScale()).to({x:frame.scale.x,y:frame.scale.y,z:frame.scale.z},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.scaleFrames.on("complete",this.onComplete,this)),this.loop&&this.scaleFrames.loop(!0),this.yoyo&&this.scaleFrames.yoyo(!0),this.repeat>0&&this.scaleFrames.repeat(this.repeat),this.scaleFrames.start()),this.opacity&&(this.opacityFrames=this.entity.tween(this.entity.element).to({opacity:frame.opacity},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.opacityFrames.on("complete",this.onComplete,this)),this.loop&&this.opacityFrames.loop(!0),this.yoyo&&this.opacityFrames.yoyo(!0),this.repeat>0&&this.opacityFrames.repeat(this.repeat),this.opacityFrames.start()),this.custom){var parts=frame.custom.split(" = "),query=parts[0],value=parseFloat(parts[1]);this.customFrames=this.entity.tween(this.animation).to({custom:value},this.duration,this.getEase()).delay(options.delay),this.customFrames.on("update",(function(){eval("this.entity."+query+" = "+self.animation.custom)})),this.customFrames.start()}this.rollback>0&&!options.isReverse&&setTimeout((function(t){t.onPlay({isReverse:!0})}),1e3*this.rollback,this)};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var Rotate=pc.createScript("rotate");Rotate.attributes.add("axis",{type:"string",enum:[{x:"x"},{y:"y"},{z:"z"}]}),Rotate.attributes.add("speed",{type:"number"}),Rotate.attributes.add("waveStyle",{type:"boolean"}),Rotate.attributes.add("waveWidth",{type:"number"}),Rotate.attributes.add("children",{type:"boolean"}),Rotate.attributes.add("graphName",{type:"string"}),Rotate.prototype.initialize=function(){this.currentElement=this.entity,this.timestamp=0,this.children&&(this.currentElement=this.entity.findByName(this.graphName))},Rotate.prototype.update=function(t){var e=this.speed*(60*t);this.waveStyle&&(e=Math.cos(this.timestamp*this.speed)*this.waveWidth,this.timestamp+=60*t),this.currentElement?("x"==this.axis&&this.currentElement.rotateLocal(e,0,0),"y"==this.axis&&this.currentElement.rotateLocal(0,e,0),"z"==this.axis&&this.currentElement.rotateLocal(0,0,e)):this.children&&(this.currentElement=this.entity.findByName(this.graphName))};var Collectable=pc.createScript("collectable");Collectable.prototype.initialize=function(){this.modelEntity=this.entity.findByName("Model"),this.shadowEntity=this.entity.findByName("Shadow"),this.entity.collision.on("triggerenter",this.onCollect,this)},Collectable.prototype.onCollect=function(t){var i=this;t.fire("Carry",this.entity,(function(){i.onCarried()}))},Collectable.prototype.onCarried=function(){this.shadowEntity&&(this.shadowEntity.enabled=!1),this.modelEntity&&this.modelEntity.script&&this.modelEntity.script.rotate&&(this.modelEntity.script.rotate.enabled=!1),this.entity.collision.enabled=!1};var Carry=pc.createScript("carry");Carry.attributes.add("holderEntity",{type:"entity"}),Carry.attributes.add("characterEntity",{type:"entity"}),Carry.prototype.initialize=function(){this.holdingItem=!1,this.entity.on("Carry",this.onCarry,this),this.entity.on("Drop",this.onDrop,this)},Carry.prototype.onCarry=function(t,i){if(!t)return!1;if(this.holdingItem)return!1;var e=this;this.app.fire("MoveAnimate:Entity",t,this.holderEntity.getPosition().clone(),(function(t){t.reparent(e.holderEntity),t.setLocalPosition(0,0,0),t.setLocalEulerAngles(0,0,0)})),this.app.fire("EffectManager:LandSmoke",t.getPosition().clone()),this.entity.sound.play("Take-Item"),this.holdingItem=t,i()},Carry.prototype.onDrop=function(t,i){if(!this.holdingItem)return!1;if(-1===this.holdingItem.tags.list().indexOf(i))return!1;var e=this;this.app.fire("MoveAnimate:Entity",this.holdingItem,t.getPosition().clone(),(function(i){i.reparent(t),i.setLocalPosition(0,0,0),i.setLocalEulerAngles(0,0,0),t.fire("Dropped",i),e.holdingItem=!1})),this.entity.sound.play("Drop-Item")},Carry.prototype.update=function(t){this.characterEntity.anim.setBoolean("Holding",!!this.holdingItem)};var Droppable=pc.createScript("droppable");Droppable.attributes.add("acceptedType",{type:"string",default:"Food"}),Droppable.attributes.add("jobEntity",{type:"entity"}),Droppable.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this),this.entity.collision.on("collisionstart",this.onCollisionStart,this),this.entity.on("Dropped",this.onDropped,this)},Droppable.prototype.onTriggerEnter=function(t){t.fire("Drop",this.entity,this.acceptedType)},Droppable.prototype.onCollisionStart=function(t){t&&t.other&&t.other.fire("Drop",this.entity,this.acceptedType)},Droppable.prototype.onDropped=function(t){t.destroy(),this.jobEntity&&this.jobEntity.fire("Job:Complete")};var Timer={nextTimerId:0,timers:[],init:function(){pc.app.on("update",this.onUpdate,this)},setTimeout:function(i,t,e,s,r){var m={id:this.nextTimerId++,callback:i,timeLeft:t/1e3,args:[e,s,r]};return this.timers.push(m),m.id},clearTimeout:function(i){for(var t=0;t<this.timers.length;t++)if(this.timers[t].id===i){this.timers.splice(t,1);break}},onUpdate:function(i){for(var t=this.timers.length-1;t>=0;t--)this.timers[t].timeLeft-=i,this.timers[t].timeLeft<=0&&(this.timers[t].callback.apply(null,this.timers[t].args),this.timers.splice(t,1))}};Timer.init();var Time=pc.createScript("time");Time.attributes.add("start",{type:"number",default:0}),Time.attributes.add("direction",{type:"string",default:"Forward",enum:[{Forward:"Forward"},{Backward:"Backward"}]}),Time.attributes.add("startEvent",{type:"string"}),Time.attributes.add("endEvent",{type:"string"}),Time.prototype.initialize=function(){this.startEventTriggered=!1,this.endEventTriggered=!1,this.time=parseFloat(this.start+""),this.timeOG=parseFloat(this.start+""),this.on("state",this.onStateChange,this),this.startEvent&&!this.startEventTriggered&&(this.app.fire(this.startEvent),this.startEventTriggered=!0),this.app.on("Time:Reset",this.reset,this)},Time.prototype.onStateChange=function(){this.startEventTriggered=!1,this.endEventTriggered=!1,this.time=parseFloat(this.start+"")},Time.prototype.reset=function(){this.startEventTriggered=!1,this.endEventTriggered=!1,this.time=this.timeOG,this.startEvent&&!this.startEventTriggered&&(this.app.fire(this.startEvent),this.startEventTriggered=!0)},Time.prototype.update=function(t){"Forward"==this.direction?this.time+=t:this.time-=t,"Backward"==this.direction&&this.endEvent&&this.time<=0&&!this.endEventTriggered&&(this.app.fire(this.endEvent),this.endEventTriggered=!0),this.entity.element.text=Utils.mmss(this.time)};var Tree=pc.createScript("tree");Tree.attributes.add("trunkEntity",{type:"entity"}),Tree.attributes.add("leavesEntity",{type:"entity"}),Tree.prototype.initialize=function(){this.trunkParentName=this.trunkEntity.parent.name,this.isSeparated=!1},Tree.prototype.onTrunkGetSeparation=function(){this.leavesEntity.removeComponent("rigidbody"),this.leavesEntity.addComponent("rigidbody",{type:pc.BODYTYPE_DYNAMIC,mass:5,friction:.75,linearDamping:.5}),setTimeout((()=>{this.leavesEntity.destroy()}),1500)},Tree.prototype.update=function(){if(!this.trunkEntity.parent)return!1;this.trunkParentName==this.trunkEntity.parent.name||this.isSeparated||(this.onTrunkGetSeparation(),this.isSeparated=!0)};var Motion=pc.createScript("motion");Motion.attributes.add("motions",{type:"json",schema:[{name:"name",type:"string"},{name:"position",type:"curve",curves:["x","y","z"]},{name:"rotation",type:"curve",curves:["x","y","z"]},{name:"scale",type:"curve",curves:["x","y","z"]},{name:"speed",type:"number",default:1},{name:"autoplay",type:"boolean",default:!1},{name:"loop",type:"boolean",default:!1}],array:!0}),Motion.attributes.add("events",{type:"json",schema:[{name:"animationName",type:"string"},{name:"eventName",type:"string"},{name:"time",type:"number",default:1},{name:"type",type:"string",default:"Anytime",enum:[{Anytime:"Anytime"},{Start:"Start"},{End:"End"}]}],array:!0}),Motion.attributes.add("lerp",{type:"number",default:.5}),Motion.prototype.initialize=function(){this.timestamp=0,this.currentSpeed=0,this.currentMotion=!1,this.isReverting=!1,this.startPosition=this.entity.getLocalPosition().clone(),this.startRotation=this.entity.getLocalEulerAngles().clone(),this.startScale=this.entity.getLocalScale().clone(),this.position=new pc.Vec3(0,0,0),this.rotation=new pc.Vec3(0,0,0),this.scale=new pc.Vec3(0,0,0),this.motions.length>0&&this.motions[0].autoplay&&this.onMotionPlay(this.motions[0].name),this.app.on("Motion",this.onMotionPlay,this),this.app.on("Motion:Stop",this.onMotionStop,this),this.entity.on("Motion",this.onMotionPlay,this),this.entity.on("Motion:Stop",this.onMotionStop,this),this.on("destroy",this.onDestroy,this)},Motion.prototype.onDestroy=function(t){this.app.off("Motion",this.onMotionPlay,this),this.app.off("Motion:Stop",this.onMotionStop,this)},Motion.prototype.findMotion=function(t){var i=!1;for(var o in this.motions){var n=this.motions[o];n.name==t&&(i=n)}return i},Motion.prototype.onMotionStop=function(t){this.currentMotion&&this.currentMotion.name==t&&(this.isPlaying=!1,this.currentMotion=!1)},Motion.prototype.onMotionPlay=function(t,i){if(!i&&this.currentMotion&&this.currentMotion.name==t)return!1;var o=this.findMotion(t);if(!o)return!1;this.isPlaying=!0,this.timestamp=0,this.currentMotion=o,this.triggerStartEvent(this.currentMotion)},Motion.prototype.triggerEvents=function(t){for(var i in this.events){var o=this.events[i],n=o.time;o.animationName==this.currentMotion.name&&n>this.timestamp&&n<=this.timestamp+t&&this.app.fire(o.eventName)}},Motion.prototype.findEventByMotion=function(t,i){for(var o in this.events){var n=this.events[o];if(n.animationName==t.name&&n.type==i)return n}},Motion.prototype.triggerStartEvent=function(t){var i=this.findEventByMotion(t,"Start");i&&this.app.fire(i.eventName)},Motion.prototype.triggerEndEvent=function(t){var i=this.findEventByMotion(t,"End");i&&this.app.fire(i.eventName)},Motion.prototype.update=function(t){if(!this.isPlaying)return!1;if(!this.currentMotion)return!1;var i=this.currentMotion.position.value(this.timestamp),o=this.currentMotion.rotation.value(this.timestamp),n=this.currentMotion.scale.value(this.timestamp);this.position=this.position.lerp(this.position,new pc.Vec3(i[0],i[1],i[2]),this.lerp),this.rotation=this.rotation.lerp(this.rotation,new pc.Vec3(o[0],o[1],o[2]),this.lerp),this.scale=this.scale.lerp(this.scale,new pc.Vec3(n[0],n[1],n[2]),this.lerp),this.entity.setLocalPosition(this.position.clone().add(this.startPosition)),this.entity.setLocalEulerAngles(this.rotation.clone().add(this.startRotation)),this.entity.setLocalScale(this.scale.clone().add(this.startScale)),this.triggerEvents(t),this.timestamp>=1&&(this.isPlaying=!1,this.currentMotion.loop?this.onMotionPlay(this.currentMotion.name,!0):(this.triggerEndEvent(this.currentMotion),this.currentMotion=!1)),this.isReverting?(this.timestamp-=t*this.currentMotion.speed,this.timestamp<=0&&(this.triggerEndEvent(this.currentMotion),this.currentMotion=!1,this.isPlaying=!1,this.isReverting=!1)):this.timestamp+=t*this.currentMotion.speed,this.timestamp=Math.max(this.timestamp,0),this.timestamp=Math.min(this.timestamp,1)};var Coin=pc.createScript("coin");Coin.attributes.add("value",{type:"number",default:1}),Coin.attributes.add("coinDisplay",{type:"entity"}),Coin.prototype.initialize=function(){this.isDestroyed=!1,this.entity.collision.on("triggerenter",this.onTrigger,this)},Coin.prototype.onTrigger=function(){if(this.isDestroyed)return!1;this.app.fire("Money:Add",this.value),this.app.fire("World2Screen:Animate","Coin",this.entity.getPosition(),this.coinDisplay),this.entity.destroy(),this.isDestroyed=!0};var World2ScreenAnimate=pc.createScript("world2ScreenAnimate");World2ScreenAnimate.attributes.add("elements",{type:"entity",array:!0}),World2ScreenAnimate.attributes.add("speed",{type:"number",default:1}),World2ScreenAnimate.attributes.add("randomModifier",{type:"number",default:0}),World2ScreenAnimate.attributes.add("scaleCurve",{type:"curve",curves:["x"]}),World2ScreenAnimate.attributes.add("cameraEntity",{type:"entity"}),World2ScreenAnimate.attributes.add("holderEntity",{type:"entity"}),World2ScreenAnimate.prototype.initialize=function(){this.movingElements=[],this.elements.forEach((function(e){e.enabled=!1})),this.app.on("World2Screen:Animate",this.onCollect,this)},World2ScreenAnimate.prototype.onCollect=function(e,t,n){var i=this.getElementByName(e);if(i){var r=this.getScreenPosition(t),a=n.getPosition().clone(),o=i.clone(),s=(Math.random()-Math.random())*this.randomModifier;o.setLocalPosition(r.x+s,r.y+s,0),o.enabled=!0,this.movingElements.push({timestamp:0,element:o,screenPosition:r,destinationPosition:a}),this.holderEntity.addChild(o)}},World2ScreenAnimate.prototype.getScreenPosition=function(e){if(!this.cameraEntity)return console.warn("Camera doesnt exist!"),!1;var t=new pc.Vec3,n=this.cameraEntity.camera,i=this.app.graphicsDevice.maxPixelRatio,r=this.entity.screen.scale,a=this.app.graphicsDevice;return n?(n.worldToScreen(e,t),t.x*=i,t.y*=i,new pc.Vec2(t.x/r,(a.height-t.y)/r)):(console.warn("Camera doesnt exist!"),!1)},World2ScreenAnimate.prototype.getElementByName=function(e){for(var t=0;t<this.elements.length;t++)if(this.elements[t].name===e)return this.elements[t];return null},World2ScreenAnimate.prototype.update=function(e){for(var t=this.movingElements.length;t--;){var n=this.movingElements[t];if(n&&(n.timestamp+=e*this.speed,n.timestamp>0)){var i=n.timestamp,r=this.scaleCurve.value(i),a=n.element.getPosition();i>.25&&a.lerp(a,n.destinationPosition,.1),n.element.setPosition(a),n.element.setLocalScale(r,r,r),i>=1&&(this.movingElements.splice(t,1),n.element.destroy())}}};var World2Screen=pc.createScript("world2Screen");World2Screen.attributes.add("holderEntity",{type:"entity"}),World2Screen.attributes.add("display",{type:"entity",array:!0}),World2Screen.prototype.postInitialize=function(){this.interactions=[],this.cameraEntity=this.app.root.findByName("Lens"),this.frameDrawn=0,this.nextFrameVisible=!1,this.app.on("World2Screen:Clone",this.cloneInteraction,this),this.app.on("World2Screen:Show",this.addInteraction,this),this.app.on("World2Screen:Visible",this.visibleInteraction,this),this.app.on("World2Screen:Hide",this.removeInteraction,this),this.hideAllDisplays(),this.on("destroy",this.onDestroy,this)},World2Screen.prototype.hideAllDisplays=function(){for(var e in this.display){this.display[e].enabled=!1}},World2Screen.prototype.onDestroy=function(){this.app.off("World2Screen:Show",this.setInteraction,this)},World2Screen.prototype.getInteractionDisplay=function(e){var t=!1;for(var i in this.display){var n=this.display[i];n.name==e&&(t=n)}return t},World2Screen.prototype.removeInteraction=function(e,t){var i=this.getInteractionDisplay(e);i&&(i.enabled=!1,i.entity=!1)},World2Screen.prototype.addInteraction=function(e,t,i){var n=this.getInteractionDisplay(e);n&&(n.entity!=t&&(n.enabled=!1),n.offset=i||new pc.Vec3(0,0,0),n.entity=t,n.type=e,n.enabled=!0,n.createdAt=Date.now())},World2Screen.prototype.cloneInteraction=function(e,t,i,n,r){var o=this.getInteractionDisplay(e),a=this;o&&((o=o.clone()).name=t._guid,o.enabled=!0,o.offset=i||new pc.Vec3(0,0,0),o.entity=t,o.type=e,o.enabled=!0,o.createdAt=Date.now(),o.destroyAfter=r,n&&n(o),t.parentDisplay=o,t.on("destroy",(function(){var e=a.display.indexOf(this.parentDisplay);e>-1&&(a.display.splice(e,1),o.destroy())})),t.on("World2Screen:Hide",(function(){var e=a.display.indexOf(this.parentDisplay);e>-1&&(a.display.splice(e,1),o.destroy())})),this.holderEntity.addChild(o),this.display.push(o))},World2Screen.prototype.visibleInteraction=function(e,t,i){this.addInteraction(e,t,i),this.frameDrawn=0,this.nextFrameVisible=e},World2Screen.prototype.updateInteraction=function(e){if(!this.cameraEntity)return!1;var t=new pc.Vec3,i=this.cameraEntity.camera,n=this.app.graphicsDevice.maxPixelRatio,r=this.entity.screen.scale,o=this.app.graphicsDevice;if(!i)return!1;if(!e.entity)return!1;if(e.offset&&e.offset.name?i.worldToScreen(e.offset.getPosition().clone(),t):i.worldToScreen(e.entity.getPosition().clone().add(e.offset),t),t.x*=n,t.y*=n,t.x>0&&t.x<this.app.graphicsDevice.width&&t.y>0&&t.y<this.app.graphicsDevice.height&&t.z>0?(e.setLocalPosition(t.x/r,(o.height-t.y)/r,0),e.enabled=e.entity.enabled):e.enabled=!1,e.destroyAfter>0&&Date.now()-e.createdAt>1e3*e.destroyAfter){this.display.indexOf(e);e.destroy()}},World2Screen.prototype.update=function(e){for(var t=this.display.length;t--;){var i=this.display[t];i&&this.updateInteraction(i)}this.nextFrameVisible&&this.frameDrawn>0&&this.removeInteraction(this.nextFrameVisible),this.frameDrawn++};var MouseManager=pc.createScript("mouseManager");MouseManager.attributes.add("mouseEntity",{type:"entity"}),MouseManager.attributes.add("mouseButtomRightCornerEntity",{type:"entity"}),MouseManager.attributes.add("cameraEntity",{type:"entity"}),MouseManager.attributes.add("hoverStateEntity",{type:"entity"}),MouseManager.attributes.add("clickEffectEntity",{type:"entity"}),MouseManager.prototype.initialize=function(){this.setMouseEvents(),this.isHover=!1,this.isPressed=!1,this.app.on("Cursor:Enabled",this.onCursorEnabled,this)},MouseManager.prototype.onCursorEnabled=function(t){t?(this.mouseEntity.enabled=!0,this.mouseEntity.setPosition(0,0,0)):this.mouseEntity.enabled=!1},MouseManager.prototype.setMouseEvents=function(){this.app.mouse.on("mousedown",this.onMouseDown,this),this.app.mouse.on("mousemove",this.onMouseMove,this),this.app.mouse.on("mousewheel",this.onWheel,this)},MouseManager.prototype.onMouseDown=function(t){if(!this.mouseEntity.enabled)return!1;var e=this.getTargetElement();null!==e&&e.fire("mousedown"),this.isPressed=!0},MouseManager.prototype.getTargetElement=function(){var t=this.mouseEntity.element.screenCorners[0];return this.app.elementInput._getTargetElementByCoords(this.cameraEntity.camera,t.x,this.app.graphicsDevice.height-t.y)},MouseManager.prototype.onMouseMove=function(t){if(!this.mouseEntity.enabled)return!1;this.moveMouseEntity(t);var e=this.getTargetElement();this.isHover=null!==e},MouseManager.prototype.moveMouseEntity=function(t){this.isMoving=!0;var e=this.mouseEntity.getPosition(),i=this.mouseButtomRightCornerEntity.getPosition(),s=!1,o=!1;i.x>=1&&t.dx>0&&(s=!0),e.x<=-1&&t.dx<0&&(s=!0),e.y>=1&&t.dy<0&&(o=!0),i.y<=-1&&t.dy>0&&(o=!0),s||this.mouseEntity.translateLocal(t.dx,0,0),o||this.mouseEntity.translateLocal(0,-t.dy,0)},MouseManager.prototype.setState=function(){if(!this.mouseEntity.enabled)return!1;this.isHover?this.hoverStateEntity.enabled=!0:this.hoverStateEntity.enabled=!1,this.isPressed&&(this.clickEffectEntity.enabled=!1,this.clickEffectEntity.enabled=!0,this.isPressed=!1)},MouseManager.prototype.fixPosition=function(){if(!this.mouseEntity.enabled)return!1;var t=this.mouseEntity.getPosition(),e=this.mouseButtomRightCornerEntity.getPosition();if(e.x>1){var i=e.x-t.x;this.mouseEntity.setPosition(1-i,t.y,t.z)}if(t.x<-1&&this.mouseEntity.setPosition(-1,t.y,t.z),t.y>1&&this.mouseEntity.setPosition(t.x,1,t.z),e.y<-1){var s=e.y-t.y;this.mouseEntity.setPosition(t.x,-1-s,t.z)}},MouseManager.prototype.onWheel=function(t){t.event.wheelDelta},MouseManager.prototype.update=function(t){this.setState(),this.fixPosition()};var EffectManager=pc.createScript("effectManager");EffectManager.prototype.initialize=function(){};var SceneMount=pc.createScript("sceneMount");SceneMount.prototype.postInitialize=function(){this.app.fire("Scene:Ready")};var Gameplay=pc.createScript("gameplay");Gameplay.attributes.add("pauseEntity",{type:"entity"}),Gameplay.attributes.add("playEntity",{type:"entity"}),Gameplay.attributes.add("lightEntity",{type:"entity"}),Gameplay.attributes.add("resetPopupEntity",{type:"entity"}),Gameplay.attributes.add("transitionEntity",{type:"entity"}),Gameplay.prototype.initialize=function(){this.isPaused=!1,this.transitionEntity.enabled=!0,this.app.on("Gameplay:Pause",this.onPause,this),this.app.on("Gameplay:Play",this.onPlay,this),this.app.on("Gameplay:PausePlay",this.onPausePlay,this),this.app.on("Gameplay:Reset",this.onReset,this),this.app.on("Gameplay:ShowResetPopup",this.showResetPopup,this),this.app.on("Gameplay:CloseResetPopup",this.closeResetPopup,this)},Gameplay.prototype.showResetPopup=function(){this.resetPopupEntity.enabled=!0},Gameplay.prototype.closeResetPopup=function(){this.resetPopupEntity.enabled=!1},Gameplay.prototype.onReset=function(){window.localStorage.clear(),window.location.reload()},Gameplay.prototype.onPausePlay=function(){this.isPaused?PokiPlugin.playGame():PokiPlugin.pauseGame()},Gameplay.prototype.onPause=function(){this.isPaused=!0},Gameplay.prototype.onPlay=function(){this.isPaused=!1},Gameplay.prototype.update=function(){this.app.keyboard.wasPressed(pc.KEY_P)&&this.onPausePlay()};var Button=pc.createScript("button");Button.attributes.add("action",{type:"string"}),Button.attributes.add("value",{type:"string"}),Button.attributes.add("cooldown",{type:"number",default:0}),Button.attributes.add("hoverStateEvent",{type:"boolean",default:!1}),Button.attributes.add("lockAfterAction",{type:"boolean",default:!1}),Button.attributes.add("hoverAction",{type:"string"}),Button.attributes.add("leaveAction",{type:"string"}),Button.prototype.initialize=function(){this.cooldown>0&&(this.timerEntity=this.entity.findByName("Timer"),this.timerEntity.enabled=!1),this.isTouchPress=!1,this.entity.element.on("touchstart",this.onTouch,this),this.entity.element.on("touchend",this.onTouchEnd,this),this.entity.element.on("mouseenter",this.onHover,this),this.entity.element.on("mouseleave",this.onLeave,this),this.entity.element.on("mouseup",this.onMouseRelease,this),this.on("state",this.onStageChange,this)},Button.prototype.onStageChange=function(){this.lockAfterAction&&(this.entity.button.active=!0)},Button.prototype.onHover=function(t){document.body.style.cursor="pointer",this.hoverStateEvent&&this.app.fire(this.hoverAction,this.value),this.app.fire("Sound:Play","Button-Hover")},Button.prototype.onTouchEnd=function(t){this.onLeave(t)},Button.prototype.onLeave=function(t){this.hoverStateEvent&&this.app.fire(this.leaveAction,this.value),document.body.style.cursor="default"},Button.prototype.onTouch=function(t){this.isTouchPress=!0,this.onPress(t)},Button.prototype.onMouseRelease=function(t){this.isTouchPress||this.onPress(t)},Button.prototype.onPress=function(t){return 0!==this.app.timeScale&&((!this.timerEntity||!this.timerEntity.enabled)&&(!(this.entity.button&&!this.entity.button.active)&&(this.app.fire(this.action,this.value),this.entity.fire("Button:Click",this.action,this.value),this.timerEntity&&(this.timerEntity.enabled=!0),setTimeout((function(t){t.timerEntity&&(t.timerEntity.enabled=!1)}),1e3*this.cooldown,this),this.lockAfterAction&&(this.entity.button.active=!1,setTimeout((function(t){t.entity.button.active=!0}),1e3,this)),void(pc.lastClickTime=Date.now()))))};var Overlay=pc.createScript("overlay");Overlay.attributes.add("mouseLockElement",{type:"entity"}),Overlay.attributes.add("usernameInputEntity",{type:"entity"}),Overlay.attributes.add("skinRewardBar",{type:"entity"}),Overlay.attributes.add("skinRewardCount",{type:"entity"}),Overlay.attributes.add("skinRewards",{type:"entity",array:!0}),Overlay.attributes.add("spoonRewardBar",{type:"entity"}),Overlay.attributes.add("spoonRewardCount",{type:"entity"}),Overlay.attributes.add("walkRewardBar",{type:"entity"}),Overlay.attributes.add("walkRewardCount",{type:"entity"}),Overlay.attributes.add("customizationEntity",{type:"entity"}),Overlay.attributes.add("playerEntity",{type:"entity"}),Overlay.prototype.initialize=function(){this.gameplayEntities=this.entity.findByTag("Gameplay"),this.currentSkin=this.skinRewards[0],this.rewardWatched=0,this.rewardWatchedSpoon=0,this.rewardWalkFaster=0,this.skinsUnlocked=Utils.getItemAsArray("SkinsUnlocked"),this.app.on("Overlay:Show",this.onShow,this),this.app.on("Overlay:Hide",this.onHide,this),this.app.on("Overlay:MouseLocked",this.onMouseLocked,this),this.app.on("Overlay:OpenLink",this.onOpenLink,this),this.app.on("SpecialSkins:Unlock",this.unlockSpecialSkin,this),this.app.on("GoldenSpoon:Unlock",this.unlockGoldenSpoon,this),this.app.on("WalkFaster:Unlock",this.unlockWalkFaster,this),this.usernameInputEntity.on("uiinput:updatevalue",this.changeUsername,this),this.tutorialStep=0,this.time=0,this.isMobile=Utils.isMobile(),this.showTouchController(),this.onHide(),document.addEventListener("pointerlockchange",this.onPointerLockChange.bind(this)),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this)},Overlay.prototype.unlockWalkFaster=function(){var t=this;PokiPlugin.showReward((function(){t.unlockWalk()}))},Overlay.prototype.unlockWalk=function(){this.rewardWalkFaster++,this.rewardWalkFaster>=3&&(this.playerEntity.script.player.walkFaster(),this.app.fire("PopupManager:Hide"),this.rewardWalkFaster=0,Utils.addEvent("WalkFaster"));var t=Math.max(.333*(this.rewardWalkFaster-1),0),e=Math.min(.333*this.rewardWalkFaster,1);this.walkRewardBar.script.timeline.startFrame.scale.x=t,this.walkRewardBar.script.timeline.endFrame.scale.x=e,this.walkRewardBar.fire("Timeline"),this.walkRewardCount.element.text=this.rewardWalkFaster+" / 3"},Overlay.prototype.unlockGoldenSpoon=function(){var t=this;PokiPlugin.showReward((function(){t.unlockSpoon()}))},Overlay.prototype.unlockSpoon=function(){this.rewardWatchedSpoon++,this.rewardWatchedSpoon>=3&&(this.playerEntity.script.player.eatFaster(),this.app.fire("PopupManager:Hide"),this.rewardWatchedSpoon=0,Utils.addEvent("GoldenSpoon"));var t=Math.max(.333*(this.rewardWatchedSpoon-1),0),e=Math.min(.333*this.rewardWatchedSpoon,1);this.spoonRewardBar.script.timeline.startFrame.scale.x=t,this.spoonRewardBar.script.timeline.endFrame.scale.x=e,this.spoonRewardBar.fire("Timeline"),this.spoonRewardCount.element.text=this.rewardWatchedSpoon+" / 3"},Overlay.prototype.unlockSpecialSkin=function(){var t=this;PokiPlugin.showReward((function(){t.unlockSkin()}))},Overlay.prototype.unlockSkin=function(){if(this.rewardWatched>=2){-1===this.skinsUnlocked.indexOf(this.currentSkin.name)&&(this.skinsUnlocked.push(this.currentSkin.name),Utils.setItemAsArray("SkinsUnlocked",this.skinsUnlocked));this.customizationEntity.script.customization.maleSkins[4].isRedirect=!1,this.customizationEntity.script.customization.unlockedMaleSkinIndices.push(4),Utils.setItemAsArray("unlockedMaleSkinIndices",this.customizationEntity.script.customization.unlockedMaleSkinIndices),this.app.fire("Customization:Character",this.currentSkin),Utils.setItem("maleSkinIndex",4),Utils.setItem("characterGender","Male"),Utils.addEvent("SkinUnlock"),this.app.fire("PopupManager:Hide")}this.rewardWatched++;var t=Math.max(.333*(this.rewardWatched-1),0),e=Math.min(.333*this.rewardWatched,1);this.skinRewardBar.script.timeline.startFrame.scale.x=t,this.skinRewardBar.script.timeline.endFrame.scale.x=e,this.skinRewardBar.fire("Timeline"),this.skinRewardCount.element.text=this.rewardWatched+" / 3"},Overlay.prototype.onPointerLockChange=function(){pc.Mouse.isPointerLocked()?(PokiPlugin.onPlay(),this.onShow()):(PokiPlugin.onPause(),this.onHide())},Overlay.prototype.onOpenLink=function(t){window.open(t,"_blank")},Overlay.prototype.onAlert=function(t){this.alertMessage.element.text=t,this.app.fire("PopupManager:Show","Message")},Overlay.prototype.changeUsername=function(t){pc.app.fire("Player:ChangeUsername",t)},Overlay.prototype.onMouseLocked=function(){},Overlay.prototype.onMouseMove=function(){},Overlay.prototype.onKeyDown=function(t){t.key==pc.KEY_C&&this.app.fire("PopupManager:Show","Customization")},Overlay.prototype.showTouchController=function(){this.isMobile&&(this.entity.findByName("ActionController").enabled=!0)},Overlay.prototype.onShow=function(){if(!this.isMobile)for(var t=0;t<this.gameplayEntities.length;t++)this.gameplayEntities[t].enabled=!0},Overlay.prototype.onHide=function(){if(!this.isMobile)for(var t=0;t<this.gameplayEntities.length;t++)this.gameplayEntities[t].enabled=!1},Overlay.prototype.update=function(t){if(this.isMobile)return!1;this.mouseLockElement.enabled=!pc.Mouse.isPointerLocked()};var Fpsoptimizer=pc.createScript("fpsoptimizer");Fpsoptimizer.attributes.add("lightEntity",{type:"entity"}),Fpsoptimizer.prototype.initialize=function(){this.fps=0,this.createdAt=Date.now(),this.lastFpsTime=Date.now(),this.lightEntity.light.castShadows=!1},Fpsoptimizer.prototype.update=function(t){Date.now()-this.createdAt>1e4||(this.fps=1/t,Date.now()-this.lastFpsTime>1e3&&(this.lightEntity.light.castShadows=this.fps>45,this.lastFpsTime=Date.now()))};var Checkpoint=pc.createScript("checkpoint");Checkpoint.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},Checkpoint.prototype.onTriggerEnter=function(){this.app.fire("Player:Checkpoint",this.entity.getPosition().clone()),this.entity.destroy()};var Collect=pc.createScript("collect");Collect.attributes.add("coin",{type:"entity"}),Collect.prototype.initialize=function(){},Collect.prototype.update=function(t){};var MoneyManager=pc.createScript("moneyManager");MoneyManager.attributes.add("startMoney",{type:"number",default:8}),MoneyManager.attributes.add("moneyColor",{type:"entity"}),MoneyManager.attributes.add("noMoneyAlert",{type:"entity"}),MoneyManager.attributes.add("moneyEntity",{type:"entity"}),MoneyManager.attributes.add("playerEntity",{type:"entity"}),MoneyManager.attributes.add("payPoint",{type:"entity"}),MoneyManager.attributes.add("coinEntity",{type:"entity"}),MoneyManager.attributes.add("alerts",{type:"entity",array:!0}),MoneyManager.prototype.initialize=function(){this.money=this.startMoney,this.totalMoney=this.startMoney,this.savedMaxCoin=0,this.lastCheckedCoin=10,this.lastMoneySave=-1,this.notifications={},Utils.getItem("Money")&&(this.money=parseInt(Utils.getItem("Money"))),Utils.getItem("SavedMaxMoney")&&(this.savedMaxCoin=parseInt(Utils.getItem("SavedMaxMoney")),this.lastCheckedCoin=parseInt(Utils.getItem("SavedMaxMoney"))+10),isNaN(this.money)&&(this.money=0),this.app.on("Money:Remove",this.remove,this),this.app.on("Money:Add",this.add,this),this.app.on("Money:Has",this.has,this),this.app.on("Money:NoMoney",this.showNoMoney,this),this.payMultiplier=1,this.app.on("Money:Pay",this.pay,this),this.app.on("Money:SetPayMultiplier",this.onSetPayMultiplier,this),this.app.on("Money:createCoin",this.createCoin,this),this.updateMoney(),pc.MoneyManager=this},MoneyManager.prototype.onSetPayMultiplier=function(t){this.payMultiplier=parseInt(t)},MoneyManager.prototype.createCoin=function(t,e,n){for(var i=this,o=0;o<t;o++){var a=this.coinEntity.clone();this.app.fire("Money:onCoinCreated",a),a.setLocalPosition(e.clone().add(new pc.Vec3(Math.random()-Math.random(),0,Math.random()-Math.random()))),a.enabled=!0,a.on("Trigger",(function(){i.notifications[n]&&i.notifications[n]--})),a.script.coin.type=n,this.entity.addChild(a),this.notifications[n]?this.notifications[n]++:this.notifications[n]=1}this.entity.sound.play("Pay")},MoneyManager.prototype.pay=function(t,e,n){var i=this.payPoint.getPosition();t*=this.payMultiplier,e&&(i=e.getPosition()),this.createCoin(t,i,n)},MoneyManager.prototype.renderAlerts=function(){for(var t=this.alerts.length;t--;){var e=this.alerts[t];this.notifications[e.name]?(e.enabled=!0,this.notifications[e.name]>e.findByName("Number").element.text&&e.findByName("Notify").fire("Timeline")):e.enabled=!1}},MoneyManager.prototype.showNoMoney=function(){this.noMoneyAlert.enabled||(this.entity.sound.play("NoMoney"),Utils.addEvent("No_Money"),this.noMoneyAlert.enabled=!0,this.noMoneyTimer=Timer.setTimeout((function(t){t.noMoneyAlert.enabled=!1}),1e3,this))},MoneyManager.prototype.has=function(t,e,n){var i=parseInt(t);this.money>=i?e&&e():n&&n()},MoneyManager.prototype.remove=function(t){t<=this.money&&(this.money-=parseInt(t)),this.updateMoney(),this.entity.sound.play("Remove")},MoneyManager.prototype.add=function(t,e){this.money+=parseInt(t),this.totalMoney+=parseInt(t),this.savedMaxCoin+=parseInt(this.money),this.updateMoney(),this.entity.sound.play("Add"),this.app.fire("Money:Added",t,this.money),Utils.setItem("SavedMaxMoney",this.savedMaxCoin),this.savedMaxCoin>this.lastCheckedCoin&&this.savedMaxCoin%10==0&&(this.lastCheckedCoin+=10),this.notifications[e]&&this.notifications[e]--},MoneyManager.prototype.updateMoney=function(){this.app.fire("UpgradeManager:UpdateMoney",this.money),this.moneyEntity.element.text=this.money+"",Date.now()-this.lastMoneySave>1e3&&(Utils.setItem("Money",this.money),this.lastMoneySave=Date.now()),this.money};var MobileUi=pc.createScript("mobileUi");MobileUi.attributes.add("position",{type:"vec3",default:[0,0,0]}),MobileUi.attributes.add("scale",{type:"vec3",default:[1,1,1]}),MobileUi.attributes.add("visible",{type:"boolean",default:!0}),MobileUi.prototype.initialize=function(){Utils.isMobile()&&(this.entity.enabled=this.visible,0==this.position.x&&0==this.position.y&&0==this.position.z||this.entity.setLocalPosition(this.position),1==this.scale.x&&1==this.scale.y&&1==this.scale.z||this.entity.setLocalScale(this.scale))};var PopupManager=pc.createScript("popupManager");PopupManager.attributes.add("popupEntity",{type:"entity"}),PopupManager.prototype.initialize=function(){this.popupEntity.enabled=!1,this.views=this.popupEntity.findByTag("View"),this.popupName="",this.isMobile=Utils.isMobile();for(var i=0;i<this.views.length;i++)this.views[i].enabled=!1;this.app.on("PopupManager:Show",this.onShow,this),this.app.on("PopupManager:Hide",this.onHide,this)},PopupManager.prototype.onShow=function(i){if(i==this.popupName&&this.popupEntity.enabled)return!1;pc.hasActiveInterface=!0,this.popupName=i,this.app.mouse.disablePointerLock(),this.popupEntity.enabled=!0,this.app.fire("Timeline:Popup");for(var e=0;e<this.views.length;e++)this.views[e].name===i?this.views[e].enabled=!0:this.views[e].enabled=!1;PokiPlugin.onPause()},PopupManager.prototype.onHide=function(){var i=this;PokiPlugin.showMidroll((function(){i._onHide()}))},PopupManager.prototype._onHide=function(){pc.hasActiveInterface=!1,this.popupEntity.enabled=!1,this.isMobile||this.app.mouse.enablePointerLock(),Utils.addEvent("PopupMidroll")};var UiInputField=pc.createScript("uiInputField");UiInputField.attributes.add("textEntity",{type:"entity",title:"Text Entity",description:"The Entity that has the text Element to update with the inputted text."}),UiInputField.attributes.add("inputType",{type:"string",title:"Input Type",description:"What type of input will this field accept. On some devices, the virtual keyboard layout may change as well. For example, 'Number' will bring up a numpad instead of the full keyboard.",default:"text",enum:[{Text:"text"},{"Text (no spellcheck)":"text no spellcheck"},{Email:"email"},{Number:"number"},{Decimal:"decimal"},{Password:"password"}]}),UiInputField.attributes.add("enterKeyHint",{type:"string",title:"Enter Key Hint",description:"Change what the enter key shows on the virutal keyboard. Different OSs will have different representations of the hint.",default:"enter",enum:[{Enter:"enter"},{Done:"done"},{Go:"go"},{Search:"search"},{Send:"send"}]}),UiInputField.attributes.add("maxLength",{type:"number",default:32,title:"Max Length",description:"Maximum length of the text can be."}),UiInputField.attributes.add("placeHolder",{type:"string",default:"Placeholder text...",title:"Place Holder String",description:"When the inputted text is empty, what should show as placeholder? Usually this is a prompt such as 'Enter your email here'."}),UiInputField.attributes.add("placeHolderColor",{type:"rgb",title:"Place Holder Text Color",description:"What color the text should be when the placeholder string is used."}),UiInputField.prototype.initialize=function(){this._textElement=this.textEntity.element,this._textColor=this._textElement.color.clone(),this.value="",this.setEvents("on"),this.on("destroy",(()=>{this.setEvents("off")})),this._onValueChange("")},UiInputField.prototype.setEvents=function(t){this.entity[t]("uiinput:updatevalue",this._onValueChange,this),this.entity.element[t]("click",this._onClick,this),this.entity[t]("focus",this.onFocus,this)},UiInputField.prototype.onFocus=function(){this.app.fire("uiinput:focus",this,{})},UiInputField.prototype._onValueChange=function(t){if(this.value=t,t.length>0){if("password"===this.inputType){let e="";for(let i=0;i<t.length;++i)e+="*";this._textElement.text=e}else this._textElement.text=t;this._textElement.color=this._textColor}else this._textElement.text=this.placeHolder,this._textElement.color=this.placeHolderColor;this.entity.fire("updatedvalue",t)},UiInputField.prototype._onClick=function(t){this.app.fire("uiinput:clicked",this,t)};!function(){const e=function getIosVersion(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}return null}();document.documentElement.style.setProperty("--sat","env(safe-area-inset-top)"),document.documentElement.style.setProperty("--sab","env(safe-area-inset-bottom)"),document.documentElement.style.setProperty("--sal","env(safe-area-inset-left)"),document.documentElement.style.setProperty("--sar","env(safe-area-inset-right)");const t=pc.Application.getApplication();let n=null;function createInputDom(){n&&n.remove(),n=document.createElement("input"),n.setAttribute("type","text"),n.style.position="absolute",n.style.fontFamily="Arial, sans-serif",n.style.background="white",n.style.paddingLeft="10px",n.style.paddingRight="10px",n.style.margin="0px",n.style.visibility="hidden",n.style.zIndex=1e3,resetStyle(),n.value="",document.body.appendChild(n)}createInputDom();let o=!1,i=!1,l=null;function onInputFieldClick(e,t){t.stopPropagation(),showDom(e,t)}function showDom(e,t){if(i!==e){switch(i&&i!==e&&onBlur(),i=e,"visible"!==n.style.visibility&&(t.changedTouches?(t.event.preventDefault(),o=!1):o=!0,n.style.visibility="visible",n.onblur=onBlur,n.addEventListener("keydown",onKeyDown),n.addEventListener("keyup",onKeyUp)),n.value=e.value,n.maxLength=e.maxLength,n.placeholder=e.placeHolder,n.pattern=null,n.spellcheck=!1,e.inputType){case"text":default:n.type="text",n.spellcheck=!0;break;case"text no spellcheck":n.type="text";break;case"number":n.type="number",n.pattern="[0-9]*";break;case"decimal":n.type="number";break;case"email":n.type="email";break;case"password":n.type="password"}n.enterKeyHint=e.enterKeyHint,n.focus(),updateStyle(),i.entity.element.on("resize",updateStyle)}}function onBlur(){n.onblur=null,n.removeEventListener("keydown",onKeyDown),n.removeEventListener("keyup",onKeyUp),n.style.visibility="hidden",function onElementSwitch(){i.entity.fire("uiinput:updatevalue",n.value),i.entity.element.off("resize",updateStyle),"password"===i.inputType&&createInputDom(),i=null}()}function onKeyDown(e){e.stopPropagation(),13===e.keyCode&&n.blur()}function onKeyUp(e){e.preventDefault(),e.stopPropagation()}function resetStyle(){const e=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sal")),t=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sar"));n.style.left="20px",n.style.height="40px",n.style.width=window.innerWidth-64-e-t+"px",n.style.fontSize="100%",n.style.top="20px",n.style.marginTop="env(safe-area-inset-top)",n.style.marginLeft="env(safe-area-inset-left)",n.style.bottom=null}function updateStyle(){if(i)if(o&&i.entity.element.screenCorners){const e=i.entity.element.screenCorners,o=Math.min(t.graphicsDevice.maxPixelRatio,window.devicePixelRatio);n.style.left=e[0].x/o-2+"px",n.style.bottom=e[0].y/o-2+"px",n.style.top=null;const l=(e[2].x-e[0].x)/o-20,s=(e[2].y-e[0].y)/o;n.style.width=l+"px",n.style.height=s+"px",n.style.fontSize=Math.round(.5*s)+"px"}else resetStyle()}function onIosResizeTimeout(){t.on("uiinput:clicked",onInputFieldClick),l=null}e?l=setTimeout(onIosResizeTimeout,2100):(t.on("uiinput:clicked",onInputFieldClick),t.on("uiinput:focus",showDom)),t.graphicsDevice.on("resizecanvas",(function onResize(){e&&!l&&(t.off("uiinput:clicked",onInputFieldClick),l=setTimeout(onIosResizeTimeout,2100)),setTimeout((()=>{updateStyle()}))}))}();var Slider=pc.createScript("slider");Slider.attributes.add("valueEntity",{type:"entity"}),Slider.attributes.add("sizeEntity",{type:"entity"}),Slider.prototype.initialize=function(){this.on("state",this.onUpdate,this),this.entity.scrollbar.on("set:value",this.onUpdate,this),this.onUpdate()},Slider.prototype.onUpdate=function(t){this.valueEntity.element.text=Math.round(100*this.entity.scrollbar.value)+"%",this.sizeEntity.setLocalScale(this.entity.scrollbar.value,1,1)};var Label=pc.createScript("label");Label.attributes.add("type",{type:"string",default:"Player"}),Label.attributes.add("offset",{type:"vec3",default:[0,1.25,0]}),Label.prototype.initialize=function(){this.healthRatio=1,this.isLabelCreated=!1,pc.isGameReady?this.onReady():this.app.on("Mount:Ready",this.onReady,this),this.entity.on("Label:Update",this.updateLabel,this),this.entity.on("Damage",this.onDamage,this),this.entity.on("Label:EntityDestroy",this.onEntityDestroy,this)},Label.prototype.onDamage=function(){this.labelEntity&&this.labelEntity.fire("Timeline")},Label.prototype.onReady=function(){if(this.isLabelCreated)return!1;this.app.fire("World2Screen:Clone",this.type,this.entity,this.offset,this.onLabel.bind(this))},Label.prototype.onLabel=function(t){this.labelEntity=t,this.levelEntity=t.findByName("Level"),this.nameEntity=t.findByName("Name"),this.nameEntity&&(this.nameEntity.element.text=this.entity.username),this.isLabelCreated=!0},Label.prototype.updateLabel=function(){this.nameEntity&&(this.nameEntity.element.text=this.entity.username)},Label.prototype.onEntityDestroy=function(){this.labelEntity&&(this.labelEntity.destroy(),this.nameEntity=!1,this.isLabelCreated=!1)},Label.prototype.update=function(t){if(!this.isLabelCreated)return!1;this.levelEntity&&(this.levelEntity.element.text=parseInt(this.entity.level))};var Player=pc.createScript("player");Player.attributes.add("topDetectorEntity",{type:"entity"}),Player.attributes.add("groundDetectorEntity",{type:"entity"}),Player.attributes.add("radiusDetectorEntity",{type:"entity"}),Player.attributes.add("cubeCountEntity",{type:"entity"}),Player.attributes.add("coinDisplay",{type:"entity"}),Player.attributes.add("weightDisplay",{type:"entity"}),Player.attributes.add("eatTimer",{type:"entity"}),Player.attributes.add("walkTimer",{type:"entity"}),Player.prototype.initialize=function(){this.playerScale=1,this.minScale=1,this.time=0,this.currentScaleUp=0,this.isEatingFaster=!1,this.isWalkingFaster=!1,this.weight=Utils.getItemAsFloat("Weight",1),this.setCharacterScale(this.weight),this.updateWeight(),this.gamePlayStart=Date.now(),this.randomOffset=new pc.Vec3,this.currentScale=1,this.currentOffset=0,this.lastCoinAdd=Date.now(),this.app.on("Player:ChangeUsername",this.changeUsername,this),this.app.on("Player:Scale",this.onScale,this),this.app.on("Player:SlowScale",this.onSlowScale,this),this.app.on("Player:ResetScale",this.resetScale,this);var t=Utils.getItem("Username");this.entity.username=t||Utils.generateUsername(),this.entity.health=100,this.entity.maxHealth=100,this.entity.level=1,this.entity.score=0,this.entity.collision.on("contact",this.getCollisions,this)},Player.prototype.walkFaster=function(){if(this.isWalkingFaster)return!1;this.isWalkingFaster=!0,this.walkTimer.enabled=!0,setTimeout((function(t){t.isWalkingFaster=!1,t.walkTimer.enabled=!1}),6e4,this)},Player.prototype.eatFaster=function(){if(this.isEatingFaster)return!1;this.isEatingFaster=!0,this.eatTimer.enabled=!0,setTimeout((function(t){t.isEatingFaster=!1,t.eatTimer.enabled=!1}),6e4,this)},Player.prototype.updateWeight=function(){var t=parseFloat(10*(this.weight-1)).toFixed(1);this.weightDisplay.element.text=t+" kg"},Player.prototype.getCollisions=function(t){},Player.prototype.changeUsername=function(t){if(!t||0==t.length)return!1;this.entity.username=t,this.entity.fire("Label:Update"),Utils.setItem("Username",this.entity.username),pc.app.fire("PopupManager:Hide")},Player.prototype.onSlowScale=function(t){this.currentScaleUp=t},Player.prototype.onScale=function(t){var e=0;Date.now()-this.gamePlayStart<1e4&&(e+=.01),Date.now()-this.gamePlayStart<2e4&&(e+=.025),Date.now()-this.gamePlayStart<3e4&&(e+=.025);var i=t+e;this.scaleCharacter(i),this.app.fire("Camara:UpdateMaxCameraDistance",i),this.app.fire("Camara:UpdateMinCameraDistance")},Player.prototype.setModelScaleByWeight=function(t){var e=t;e>5&&(e=5+.05*e),this.entity.script.movement.offsetDelta=e-1,this.entity.setLocalScale(e,e,e)},Player.prototype.setCharacterScale=function(){this.setModelScaleByWeight(this.weight),this.entity.rigidbody.teleport(this.entity.getPosition().clone().add(new pc.Vec3(0,.03,0))),this.updateWeight(),this.updateCollisions(),this.app.fire("Camara:UpdateMaxCameraDistance",0),this.app.fire("Camara:UpdateMinCameraDistance",0)},Player.prototype.scaleCharacter=function(t){this.entity.level+=.1,this.entity.rigidbody.teleport(this.entity.getPosition().clone().add(new pc.Vec3(0,.03,0))),this.weight+=t,this.setModelScaleByWeight(this.weight),Utils.setItem("Weight",this.weight),this.updateWeight(),this.updateCollisions()},Player.prototype.updateCollisions=function(){this.entity.collision.linearOffset.y;this.entity.collision.radius=this.calculateRadius(),this.entity.collision.height=this.calculateHeight()},Player.prototype.calculateOffsetDelta=function(){return this.entity.getPosition().y+this.calculateHeight()/2+this.entity.collision.linearOffset.y-this.topDetectorEntity.getPosition().y},Player.prototype.calculateHeight=function(){return this.topDetectorEntity.getPosition().y-this.groundDetectorEntity.getPosition().y},Player.prototype.calculateRadius=function(){const t=this.radiusDetectorEntity.getPosition().clone(),e=this.entity.getPosition().clone();return Math.abs(t.distance(e))},Player.prototype.resetScale=function(){this.currentScale=this.entity.getLocalScale().x,this.currentOffset=this.entity.script.movement.offsetDelta,this.updateCollisions()},Player.prototype.updateScaleUp=function(t){if(this.currentScaleUp>0){var e=1*t;this.currentScaleUp-=e,this.scaleCharacter(e),this.app.fire("Camara:UpdateMaxCameraDistance",e),this.app.fire("Camara:UpdateMinCameraDistance")}},Player.prototype.updateScale=function(t){this.currentScale>this.minScale&&(this.currentScale-=5*t,this.currentOffset-=5*t,this.setModelScaleByWeight(this.currentScale),Date.now()-this.lastCoinAdd>30&&(this.randomOffset.x=Math.random()-Math.random(),this.randomOffset.y=Math.random()-Math.random(),this.randomOffset.z=Math.random()-Math.random(),this.app.fire("World2Screen:Animate","Coin",this.entity.getPosition().add(this.randomOffset),this.coinDisplay),this.lastCoinAdd=Date.now()))},Player.prototype.update=function(t){this.updateScaleUp(t)};var Mount=pc.createScript("mount");pc.isGameReady=!1,Mount.prototype.initialize=function(){setTimeout((function(){pc.app.fire("Mount:Ready"),pc.isGameReady=!0}),60)};var SkillLevelManager=pc.createScript("skillLevelManager");SkillLevelManager.attributes.add("player",{type:"entity"}),SkillLevelManager.prototype.initialize=function(){this.app.on("Player:Checkpoint",this.onCheckpointHint,this),this.level=1,Utils.getItem("Level")?this.level=parseInt(Utils.getItem("Level")):Utils.setItem("Level",1),this.setLabelTxt(this.level)},SkillLevelManager.prototype.onCheckpointHint=function(){this.updateLevel()},SkillLevelManager.prototype.setLabelTxt=function(e){this.player.fire("Label:Update",e)},SkillLevelManager.prototype.updateLevel=function(){this.level++,Utils.setItem("Level",this.level),this.setLabelTxt(this.level)};var Eating=pc.createScript("eating");Eating.attributes.add("playerEntity",{type:"entity"}),Eating.attributes.add("splitSphere",{type:"entity"}),Eating.attributes.add("capacity",{type:"number",default:100,title:"Eating Capacity"}),Eating.attributes.add("splitEntity",{type:"entity",title:"Split Sphere"}),Eating.attributes.add("coinDisplay",{type:"entity"}),Eating.attributes.add("blocksEntity",{type:"entity"}),Eating.attributes.add("coinEntity",{type:"entity"}),Eating.attributes.add("weightButtons",{type:"entity"}),Eating.prototype.initialize=function(){this.numOfblockToEat=0,this.totalEaten=0,this.randomOffset=new pc.Vec3,this.lastEat=Date.now(),this.pieces=[],this.isHoldingMouse=!1,this.points=0,this.isSellBtnEnabled=!1,this.app.on("Eating:Eat",this.onEat,this),this.app.on("Eating:Clear",this.clear,this),this.app.on("Eating:Sell",this.sell,this),this.app.on("Eating:Sell2x",this.sell2x,this),this.app.on("PopupManager:Show",this.onPopupShow,this),this.app.mouse&&(this.app.mouse.on("mousedown",this.onMouseDown,this),this.app.mouse.on("mouseup",this.onMouseUp,this)),this.app.on("Eating:GetBlocks",this.getBlocks,this),this.app.on("Eating:UpdateWithPiece",this.updateWithPiece,this),this.app.on("Eating:UpdatePoints",this.updatePoints,this),this.entity.on("Upgrade:State",this.upgradeCapacity,this)},Eating.prototype.onPopupShow=function(t){if("WeightReward"==t){var i=this.totalEaten,e=0,a=this.splitSphere.script.splitSphere.blocks.length;a>0&&(i=a),i>0&&(e=parseInt(2*i)),this.blocksEntity.element.text=parseFloat(.1*i).toFixed(1)+"kg",this.coinEntity.element.text=e+"",this.weightButtons.enabled=e>0}},Eating.prototype.onMouseDown=function(){this.isHoldingMouse=!0},Eating.prototype.onMouseUp=function(){this.isHoldingMouse=!1},Eating.prototype.onEat=function(){if(Date.now()-this.lastEat<1e3)return!1;this.numOfblockToEat>0?this.points<this.capacity?this.app.fire("Animation:Eat"):console.log("Max Capacity Reach!"):(this.playerEntity.fire("SlowDown"),this.app.fire("Animation:Pickup")),this.lastEat=Date.now()},Eating.prototype.onThrow=function(){this.numOfblockToEat>0&&this.app.fire("Animation:Throw")},Eating.prototype.getBlocks=function(t){this.numOfblockToEat=t,this.numOfblockToEat>3?this.pieces=this.breakNumberIntoRandomParts(this.numOfblockToEat,3,parseInt(this.numOfblockToEat*(1/4)),parseInt(this.numOfblockToEat*(3/4))):1==this.numOfblockToEat?this.pieces=[1]:2==this.numOfblockToEat?this.pieces=[1,1]:3==this.numOfblockToEat&&(this.pieces=[1,1,1])},Eating.prototype.updateWithPiece=function(){this.numOfblockToEat>0?this.app.fire("Animation:SetWithPiece",!0):this.app.fire("Animation:SetWithPiece",!1)},Eating.prototype.clear=function(){this.splitEntity.fire("Clear",this.pieces[0]),this.numOfblockToEat-=this.pieces[0],this.numOfblockToEat<=0&&this.app.fire("NetworkManager:Send","destroyHolder"),this.pieces.shift()},Eating.prototype.breakNumberIntoRandomParts=function(t,i,e,a){if(i*e>t||i*a<t)throw new Error("Cannot break the number into the specified parts within the given ranges.");let n=[],o=t;for(let t=0;t<i-1;t++){let s=Math.min(a,o-e*(i-t-1)),p=Math.max(e,o-a*(i-t-1)),h=Math.floor(Math.random()*(s-p+1))+p;n.push(h),o-=h}return n.push(o),n},Eating.prototype.updatePoints=function(t){this.points+=.1,this.totalEaten+=1},Eating.prototype.showSellButton=function(){},Eating.prototype.hideSellButton=function(){},Eating.prototype.sell=function(t=1){var i=this.totalEaten,e=this.splitSphere.script.splitSphere.blocks.length;if(e>0&&(i=e),i>0){var a=parseInt(2*i)*t;this.app.fire("Money:Add",a,"From Selling Blocks"),this.totalEaten=0;for(var n=0;n<a;n++)setTimeout((function(t){t.randomOffset.x=5*(Math.random()-Math.random()),t.randomOffset.y=5*(Math.random()-Math.random()),t.randomOffset.z=5*(Math.random()-Math.random()),t.app.fire("World2Screen:Animate","Coin",t.entity.getPosition().add(t.randomOffset),t.coinDisplay)}),3*n,this);this.numOfblockToEat=0,this.app.fire("Animation:SetWithPiece",!1),this.splitSphere.script.splitSphere.sellAllBlocks(),this.app.fire("Player:ResetScale"),this.app.fire("Animation:SetAnimationSpeed"),this.app.fire("Camara:ResetMaxCameraDistance")}this.app.fire("PopupManager:Hide")},Eating.prototype.sell2x=function(){var t=this;PokiPlugin.showReward((function(){t.sell(2)}))},Eating.prototype.upgradeCapacity=function(t){this.capacity=100*t},Eating.prototype.updateSellBar=function(t){if(!this.isSellBtnEnabled)return!1;this.isHoldingMouse?(this.sellBarScale+=t,this.sellBarScale>=1&&this.sell()):this.sellBarScale=0,this.sellBarEntity.setLocalScale(this.sellBarScale,1,1)},Eating.prototype.update=function(t){this.app.keyboard.wasPressed(pc.KEY_E)&&this.onThrow()};var Blocks=pc.createScript("blocks");Blocks.attributes.add("size",{type:"number",default:10}),Blocks.prototype.postInitialize=function(){this.nx=this.size,this.ny=this.size,this.nz=this.size,this.sx=.5,this.sy=.5,this.sz=.5,this.entities=[],this.app.on("Blocks:Scan",this.updateBlocks,this),this.app.on("Blocks:Fill",this.setBlockFill,this),this.updateBlocks()},Blocks.prototype.setBlockFill=function(t,i,s,o){this.setFilled(t,i,s,!1)},Blocks.prototype.clear=function(){for(var t=this.entities.length;t--;)this.entities[t].destroy();this.entities=[],this.map=[],this.boxified=[],this.boxes=[],this.filled=[];for(var i=0;i<this.nx;i++)for(var s=0;s<this.ny;s++)for(var o=0;o<this.nz;o++)this.map.push(!0),this.boxified.push(!1)},Blocks.prototype.updateBlocks=function(){this.clear(),this.scanBoxes(),this.updateVoxel()},Blocks.prototype.scanBoxes=function(){var t=this.entity.findByTag("Box");for(var i in t){var s=t[i].getPosition().clone(),o=this.getBoxIndex(s.x,s.y,s.z);this.filled.push(o)}},Blocks.prototype.getBoxIndex=function(t,i,s){return t>=0&&t<this.nx&&i>=0&&i<this.ny&&s>=0&&s<this.nz?t+this.nx*i+this.nx*this.ny*s:-1},Blocks.prototype.setFilled=function(t,i,s,o){const e=this.getBoxIndex(t,i,s);-1!==e&&(this.map[e]=Boolean(o))},Blocks.prototype.isFilled=function(t,i,s){var o=this.getBoxIndex(t,i,s);return this.filled.indexOf(o)>-1},Blocks.prototype.isBoxified=function(t,i,s){const o=this.getBoxIndex(t,i,s);return-1!==o&&this.boxified[o]},Blocks.prototype.setBoxified=function(t,i,s,o){this.boxified[this.getBoxIndex(t,i,s)]=Boolean(o)},Blocks.prototype.updateVoxel=function(){for(let t=0;t<this.boxified.length;t++)this.boxified[t]=!1;for(;;){let t=null;for(let i=0;!t&&i<this.nx;i++)for(let s=0;!t&&s<this.ny;s++)for(let o=0;!t&&o<this.nz;o++)this.isFilled(i,s,o)&&!this.isBoxified(i,s,o)&&(t=new pc.Entity,t.xi=i,t.yi=s,t.zi=o,t.nx=0,t.ny=0,t.nz=0,this.boxes.push(t));if(!t)break;{const i=t.xi,s=t.yi,o=t.zi;t.nx=this.nx,t.ny=this.ny,t.nz=this.nz;for(let e=i;e<this.nx+1;e++)if(!this.isFilled(e,s,o)||this.isBoxified(e,s,o)){t.nx=e-i;break}for(let e=i;e<i+t.nx;e++)for(let i=s;i<this.ny+1;i++)this.isFilled(e,i,o)&&!this.isBoxified(e,i,o)||t.ny>i-s&&(t.ny=i-s);for(let e=i;e<i+t.nx;e++)for(let i=s;i<s+t.ny;i++)for(let s=o;s<this.nz+1;s++)this.isFilled(e,i,s)&&!this.isBoxified(e,i,s)||t.nz>s-o&&(t.nz=s-o);0==t.nx&&(t.nx=1),0==t.ny&&(t.ny=1),0==t.nz&&(t.nz=1);for(let e=i;e<i+t.nx;e++)for(let i=s;i<s+t.ny;i++)for(let s=o;s<o+t.nz;s++)this.setBoxified(e,i,s,!0);t=null}}const t=this.sx,i=this.sy,s=this.sz;for(let o=0;o<this.boxes.length;o++){const e=this.boxes[o];e.setLocalPosition(e.xi+.5*e.nx-t,e.yi+.5*e.ny-i,e.zi+.5*e.nz-s),e.addComponent("collision",{type:"box",halfExtents:new pc.Vec3(e.nx*t,e.ny*i,e.nz*s)}),e.addComponent("rigidbody",{type:"static",restitution:.5}),this.entity.addChild(e),this.entities.push(e)}};var Ground=pc.createScript("ground");Ground.attributes.add("boxEntity",{type:"entity"}),Ground.attributes.add("roadBlock",{type:"entity"}),Ground.attributes.add("size",{type:"number",default:50}),Ground.attributes.add("roadStartX",{type:"number",default:0}),Ground.attributes.add("roadStartZ",{type:"number",default:0}),Ground.attributes.add("roadWidth",{type:"number",default:0}),Ground.attributes.add("roadLength",{type:"number",default:0}),Ground.prototype.initialize=function(){if(this.boxEntity){for(var t=0;t<this.size;t++)for(var e=0;e<this.size;e++)t>=this.roadStartX&&t<this.roadStartX+this.roadWidth&&e>=this.roadStartZ&&e<this.roadStartZ+this.roadLength?this.insertBox("Road",t,e):this.insertBox("Grass",t,e);this.app.fire("Blocks:Update")}else console.error("No box entity assigned to the script attribute.")},Ground.prototype.insertBox=function(t,e,i){if("Grass"==t)(r=this.boxEntity.clone()).name=this.entity.name+"-"+e+"-"+i,r.setLocalPosition(e,0,i),r.enabled=!0,this.entity.addChild(r);else if("Road"==t){var r;(r=this.roadBlock.clone()).name=this.entity.name+"-"+e+"-"+i,r.setLocalPosition(e,0,i),r.enabled=!0,this.entity.addChild(r)}};var SplitSphere=pc.createScript("splitSphere");SplitSphere.attributes.add("playerEntity",{type:"entity"}),SplitSphere.attributes.add("enemyManagerEntity",{type:"entity"}),SplitSphere.attributes.add("sphereEntity",{type:"entity"}),SplitSphere.attributes.add("holderMaleEntity",{type:"entity"}),SplitSphere.attributes.add("holderFemaleEntity",{type:"entity"}),SplitSphere.attributes.add("projectileHolderEntity",{type:"entity"}),SplitSphere.attributes.add("nothingToEatUIEntity",{type:"entity"}),SplitSphere.attributes.add("cameraEntity",{type:"entity"}),SplitSphere.attributes.add("throwingEntity",{type:"entity"}),SplitSphere.attributes.add("throwingForce",{type:"number",default:1}),SplitSphere.attributes.add("impulseYFactor",{type:"number",default:1}),SplitSphere.attributes.add("highLightBlockEntity",{type:"entity"}),SplitSphere.attributes.add("emptyHolder",{type:"entity"}),SplitSphere.prototype.initialize=function(){this.holderEntity=this.holderMaleEntity,this.nearbyBoxes=[],this.blocks=[],this.previousPosition=this.entity.getPosition().clone(),this.highLightedBlocks=[],this.highLightedPositions=[],this.gameplayStart=Date.now(),this.time=0,this.isCounting=0,this.isSplited=!1,this.holderClone=this.emptyHolder.clone(),this.sizeMultipler=1,this.entity.on("Split",this.onSplit,this),this.entity.on("Clear",this.clearBlocks,this),this.entity.on("Throw",this.throwBlocks,this),this.entity.on("Upgrade:State",this.upgradeSizeMultipler,this),this.app.on("SplitSphere:GetNearbyBoxes",this.getNearbyBoxes,this),this.app.on("Customization:Character",this.changeGender,this)},SplitSphere.prototype.changeGender=function(t){if(this.holderEntity=t.findByName("HolderPlayer"),this.blocks.length>0)for(var e=this.blocks.length;e--;)this.blocks[e]&&this.blocks[e].reparent&&this.blocks[e].reparent(this.holderEntity),this.setBlockPositionToCenter()},SplitSphere.prototype.onSplit=function(){var t=this.getNearbyEnemy();if(t)t.fire("Enemy:Disable"),this.reparentEnemy(t),this.blocks.length>0&&(this.destroyAllHighLightedBlocks(),this.setEnemyToCenter(t),this.isSplited=!0),this.app.fire("Eating:GetBlocks",this.blocks.length);else{var e=this.entity.getPosition().clone(),i=this.sphereEntity.getScale().x/2;i<1&&(i=1),pc.app.fire("QuadTree:Query",e.x,e.z,i,i,"SplitSphere:GetNearbyBoxes");for(var o=this.nearbyBoxes,s=o.length,h=[];s--;){var n=o[s].entity;n.getPosition().clone().distance(e)<i&&(this.reparentBlock(n),h.push(n.name))}h.length>0&&this.app.fire("NetworkManager:Send","holdBlocks",h),this.blocks.length>0?(this.app.fire("Shake:Start"),this.playerEntity.sound.slots["PickUp-1"].pitch=.9+.2*Math.random(),this.playerEntity.sound.slots["PickUp-2"].pitch=.9+.2*Math.random(),this.playerEntity.sound.play("PickUp-1"),this.playerEntity.sound.play("PickUp-2"),this.setBlockPositionToCenter(),this.destroyAllHighLightedBlocks(),this.isSplited=!0):(this.nothingToEatUIEntity.enabled=!0,setTimeout((()=>{this.nothingToEatUIEntity.enabled=!1}),1500)),this.app.fire("Eating:GetBlocks",this.blocks.length),this.app.fire("Blocks:Scan")}},SplitSphere.prototype.getNearbyEnemy=function(){if(!this.enemyManagerEntity.enabled)return!1;var t=this.entity.getPosition().clone(),e=this.enemyManagerEntity.script.enemyManager.enemies,i=e.length,o=this.sphereEntity.getScale().x/2;o<1&&(o=1);for(var s=!1;i--;){var h=e[i],n=h.getPosition().clone().distance(t),l=h.script.enemy.size,r=this.playerEntity.getLocalScale().clone().x;n<o&&l<r&&(s=h)}return s},SplitSphere.prototype.setEnemyToCenter=function(t){var e=t.findByName("RadiusDetecor").getPosition().clone(),i=this.holderEntity.getPosition().clone().sub(e),o=t.getPosition().clone().add(i);t.setPosition(o)},SplitSphere.prototype.reparentEnemy=function(t){var e=t.getPosition().clone(),i=t.getLocalScale().clone(),o=this.playerEntity.getLocalScale().clone();this.app.fire("VoxelAltitude:Remove",e.x,e.y,e.z),this.blocks.push(t),t&&t.collision&&(t.collision.enabled=!1),t.reparent(this.holderEntity),t.setLocalScale(i.x/o.x,i.y/o.y,i.z/o.z),t.setPosition(e)},SplitSphere.prototype.reparentBlock=function(t){var e=t.getPosition().clone(),i=t.getRotation().clone(),o=t.getLocalScale().clone(),s=this.playerEntity.getLocalScale().clone();this.app.fire("VoxelAltitude:Remove",e.x,e.y,e.z),this.blocks.push(t),t&&t.collision&&(t.collision.enabled=!1,t.tags.clear()),t.reparent(this.holderEntity),t.setLocalScale(o.x/s.x,o.y/s.y,o.z/s.z),t.setPosition(e),t.setRotation(i)},SplitSphere.prototype.setBlockPositionToCenter=function(){var t=this.calculateCenter(this.blocks),e=this.holderEntity.getPosition().clone().sub(t);this.blocks.forEach((t=>{var i=t.getPosition().clone().add(e);t.setPosition(i)}))},SplitSphere.prototype.calculateCenter=function(t){var e=t.map((t=>t.getPosition().clone()));return this.calculateCentroid3D(e)},SplitSphere.prototype.calculateCentroid3D=function(t){if(0===t.length)throw new Error("No coordinates provided");let e=0,i=0,o=0;const s=t.length;t.forEach((t=>{e+=t.x,i+=t.y,o+=t.z}));const h=e/s,n=i/s,l=o/s;return new pc.Vec3(h,n,l)},SplitSphere.prototype.sellAllBlocks=function(){if(this.blocks.length>0)for(var t=this.blocks.length;t--;)this.blocks[t].setLocalPosition(1e3,1e3,1e3),this.blocks[t].reparent(this.emptyHolder);this.blocks=[],this.isSplited=!1},SplitSphere.prototype.throwBlocks=function(){if(this.blocks.length>0){this.throwingEntity.rigidbody.teleport(this.projectileHolderEntity.getPosition(),pc.Vec3.ZERO),this.blocks.forEach((t=>{var e=t.getPosition().clone(),i=t.getRotation().clone();this.playerEntity.getLocalScale().clone();t.reparent(this.throwingEntity),t.setPosition(e),t.setRotation(i),t.setLocalScale(1,1,1)})),this.blocks=[],this.app.fire("Eating:GetBlocks",0);var t=this.playerEntity.findByName("Character").forward.clone(),e=new pc.Vec3(-t.x,this.impulseYFactor,-t.z).normalize().scale(this.throwingForce);this.throwingEntity.rigidbody.applyImpulse(e),this.isSplited=!1}},SplitSphere.prototype.highLightBlocks=function(){if(!this.isSplited){var t=this.entity.getPosition(),e=this.sphereEntity.getScale().x/2;e<1&&(e=1),pc.app.fire("QuadTree:Query",t.x,t.z,e,e,"SplitSphere:GetNearbyBoxes");for(var i=this.nearbyBoxes,o=i.length,s=[];o--;){var h=i[o].entity,n=h.getPosition().clone(),l=h.getRotation().clone(),r=n.distance(t);e-1<r&&r<e&&s.push({pos:n,rot:l})}s.forEach((({pos:t,rot:e})=>{-1===this.highLightedPositions.findIndex((e=>e.pos.equals(t)))&&(this.highLightedPositions.push({pos:t,rot:e}),this.addHighLightBlock(t,e))}));for(var p=this.highLightedPositions.length-1;p>=0;p--){var a=this.highLightedPositions[p].pos;-1===s.findIndex((t=>t.pos.equals(a)))&&(this.highLightedPositions.splice(p,1),this.removeHighLightedBlock(a))}}},SplitSphere.prototype.addHighLightBlock=function(t,e){var i=this.highLightBlockEntity.clone();this.app.root.addChild(i),i.setPosition(t),i.setRotation(e),this.highLightedBlocks.push(i)},SplitSphere.prototype.removeHighLightedBlock=function(t){for(var e=this.highLightedBlocks.length-1;e>=0;e--){this.highLightedBlocks[e].getPosition().equals(t)&&(this.highLightedBlocks[e].destroy(),this.highLightedBlocks.splice(e,1))}},SplitSphere.prototype.destroyAllHighLightedBlocks=function(){for(let t=0;t<this.highLightedBlocks.length;t++)this.highLightedBlocks[t].destroy();this.highLightedBlocks=[],this.highLightedPositions=[]},SplitSphere.prototype.getNearbyBoxes=function(t){t.length>0&&(this.nearbyBoxes=t)},SplitSphere.prototype.clearBlocks=function(t){if(this.blocks.length>0){for(var e=t;e--;)this.blocks[e].reparent(this.emptyHolder),this.playerEntity.score+=1,this.blocks[e].fire("Label:EntityDestroy"),this.blocks.splice(e,1);this.app.fire("Eating:UpdatePoints",t),this.app.fire("Player:Scale",.01*this.sizeMultipler),this.blocks.length>0&&this.setBlockPositionToCenter(),this.blocks.length<1&&(this.app.fire("Animation:SetAnimationSpeed"),this.isSplited=!1,this.app.fire("Eating:GetBlocks",this.blocks.length),this.isCounting=!0)}},SplitSphere.prototype.upgradeSizeMultipler=function(t){this.sizeMultipler=1+.3*(t-1)},SplitSphere.prototype.update=function(t){var e=this.entity.getPosition();e.equals(this.previousPosition)||(this.highLightBlocks(),this.previousPosition=e.clone()),Date.now()-this.gameplayStart<1e4&&this.app.fire("World2Screen:Visible","Eat",this.entity)};var AnimationManager=pc.createScript("animationManager");AnimationManager.attributes.add("characterMaleEntity",{type:"entity"}),AnimationManager.attributes.add("characterFemaleEntity",{type:"entity"}),AnimationManager.attributes.add("splitEntity",{type:"entity"}),AnimationManager.attributes.add("eatingParticalSystemEntity",{type:"entity"}),AnimationManager.prototype.initialize=function(){this.characterEntity=this.characterMaleEntity,this.app.on("Animation:Eat",this.eat,this),this.app.on("Animation:Run",this.run,this),this.app.on("Animation:Jump",this.jump,this),this.app.on("Animation:Pickup",this.pickup,this),this.app.on("Animation:Throw",this.onThrow,this),this.app.on("Animation:SetWithPiece",this.setWithPiece,this),this.app.on("Customization:Character",this.changeGender,this),this.transitionDuration=200,this.isFiredStepEvent=!1,this.isFiredEatStartEvent=!1,this.isFiredEatEvent=!1,this.isFiredEatEndEvent=!1,this.isFiredSplitEvent=!1,this.isFiredThrowEvent=!1,this.isEating=!1,this.isWithPiece=!1,this.lastRunning=!1},AnimationManager.prototype.changeGender=function(t){this.entity.findByTag("Skin").forEach((function(i){i.enabled=t==i})),this.characterEntity=t,this.eatingParticalSystemEntity=t.findByName("EatingParticles"),this.isWithPiece?(this.characterEntity.anim.findAnimationLayer("Base").weight=0,this.characterEntity.anim.findAnimationLayer("With_Piece_Upper").weight=1,this.characterEntity.anim.findAnimationLayer("With_Piece_Lower").weight=1):(this.characterEntity.anim.findAnimationLayer("Base").weight=1,this.characterEntity.anim.findAnimationLayer("With_Piece_Upper").weight=0,this.characterEntity.anim.findAnimationLayer("With_Piece_Lower").weight=0),this.baseWeight=new SmoothValue(this.characterEntity.anim.findAnimationLayer("Base").weight),this.upperWeight=new SmoothValue(this.characterEntity.anim.findAnimationLayer("With_Piece_Upper").weight),this.lowerWeight=new SmoothValue(this.characterEntity.anim.findAnimationLayer("With_Piece_Lower").weight)},AnimationManager.prototype.setAnimationSpeed=function(){var t=this.entity.getLocalScale();this.characterEntity.anim.speed=1/Math.pow(t.x,.25),this.entity.script.player.isEatingFaster&&(this.characterEntity.anim.speed=1.8)},AnimationManager.prototype.eat=function(){var t=this.entity.getPosition();this.isEating||(this.characterEntity.anim.setTrigger("Eat"),this.isEating=!0,this.characterEntity.anim.on("eatStart",(()=>{this.isFiredEatStartEvent||(this.app.fire("DealtDamage:Trigger","+1",t),this.eatingParticalSystemEntity.particlesystem.play()),this.isFiredEatStartEvent=!0}),this.entity),this.isFiredEatStartEvent=!1,this.characterEntity.anim.on("eat",(()=>{this.isFiredEatEvent||(this.entity.sound.slots.Eat.pitch=.9+.2*Math.random(),this.entity.sound.play("Eat"),this.app.fire("Eating:Clear"),this.app.fire("Eating:UpdateWithPiece"),this.isEating=!1),this.isFiredEatEvent=!0}),this.entity),this.isFiredEatEvent=!1,this.characterEntity.anim.on("endEat",(()=>{this.isFiredEatEndEvent||(this.eatingParticalSystemEntity.particlesystem.stop(),this.eatingParticalSystemEntity.particlesystem.reset()),this.isFiredEatEndEvent=!0}),this.entity),this.isFiredEatEndEvent=!1)},AnimationManager.prototype.onThrow=function(){this.characterEntity.anim.setTrigger("Throw"),this.app.fire("NetworkManager:Send","animSetTrigger","Throw"),this.characterEntity.anim.on("throw",(()=>{this.isFiredThrowEvent||(this.splitEntity.fire("Throw"),this.app.fire("Eating:UpdateWithPiece")),this.isFiredThrowEvent=!0}),this.entity),this.isFiredThrowEvent=!1},AnimationManager.prototype.run=function(t){this.characterEntity.anim.setBoolean("Running",t),this.lastRunning!=t&&(this.app.fire("NetworkManager:Send","animSetBoolean",{name:"Running",value:t}),this.lastRunning=t)},AnimationManager.prototype.jump=function(){this.characterEntity.anim.setTrigger("Jump"),this.app.fire("NetworkManager:Send","animSetTrigger","Jump")},AnimationManager.prototype.pickup=function(){this.characterEntity.anim.setTrigger("Pickup"),this.app.fire("NetworkManager:Send","animSetTrigger","Pickup"),this.characterEntity.anim.on("split",(()=>{this.isFiredSplitEvent||(this.splitEntity.fire("Split"),this.app.fire("Eating:UpdateWithPiece"),this.isFiredSplitEvent=!0)}),this.entity),this.isFiredSplitEvent=!1},AnimationManager.prototype.setWithPiece=function(t){t?(this.isWithPiece=!0,this.baseWeight.setTarget(0,this.transitionDuration),this.upperWeight.setTarget(1,this.transitionDuration),this.lowerWeight.setTarget(1,this.transitionDuration)):(this.baseWeight.setTarget(1,this.transitionDuration),this.upperWeight.setTarget(0,this.transitionDuration),this.lowerWeight.setTarget(0,this.transitionDuration),this.isWithPiece=!1)},AnimationManager.prototype.update=function(t){this.characterEntity&&this.characterEntity.anim&&this.baseWeight&&this.upperWeight&&this.lowerWeight&&(this.baseWeight.update(t),this.upperWeight.update(t),this.lowerWeight.update(t),this.characterEntity.anim.findAnimationLayer("Base").weight=this.baseWeight.getValue(),this.characterEntity.anim.findAnimationLayer("With_Piece_Upper").weight=this.upperWeight.getValue(),this.characterEntity.anim.findAnimationLayer("With_Piece_Lower").weight=this.lowerWeight.getValue(),this.setAnimationSpeed())};class SmoothValue{constructor(t){this.currentValue=t,this.targetValue=t,this.startValue=t,this.startTime=null,this.duration=0,this.isAnimating=!1}setTarget(t,i){this.startValue=this.currentValue,this.targetValue=t,this.duration=i,this.startTime=performance.now(),this.isAnimating=!0}update(t){if(!this.isAnimating)return;const i=performance.now()-this.startTime,e=Math.min(i/this.duration,1);this.currentValue=this.lerp(this.startValue,this.targetValue,e),e>=1&&(this.isAnimating=!1)}lerp(t,i,e){return t+(i-t)*e}getValue(){return this.currentValue}}var UpgradeManager=pc.createScript("upgradeManager");UpgradeManager.attributes.add("upgrades",{type:"json",schema:[{name:"title",type:"string",default:"None"},{name:"description",type:"string",default:"None"},{name:"price",type:"number",default:10},{name:"multiplier",type:"number",default:1},{name:"icon",type:"asset",assetType:"texture"},{name:"entity",type:"entity"}],array:!0}),UpgradeManager.attributes.add("rowEntity",{type:"entity"}),UpgradeManager.attributes.add("holderEntity",{type:"entity"}),UpgradeManager.attributes.add("upgradeNotification",{type:"entity"}),UpgradeManager.attributes.add("upgradeNotification2",{type:"entity"}),UpgradeManager.attributes.add("nothingIcon",{type:"entity"}),UpgradeManager.prototype.initialize=function(){this.upgradeItems=[],this.rowEntity.enabled=!1,this.notificationShowed=!1,this.lastRewardUpgrade=-1,this.sinceLastUpgrade=-1,this.bounceBack=this.makeRewardUpgrade.bind(this),this.upgrade=null,this.app.on("UpgradeManager:Upgrade",this.onUpgrade,this),this.app.on("UpgradeManager:RewardUpgrade",this.onRewardUpgrade,this),this.app.on("UpgradeManager:Refresh",this.onRender,this),this.app.on("PopupManager:Show",this.onPopup,this),this.app.on("Mount:Ready",this.onReady,this),this.app.on("Money:Add",this.onMoneyAdd,this),this.app.on("Money:Remove",this.onMoneyAdd,this)},UpgradeManager.prototype.onReady=function(){this.onMoneyAdd()},UpgradeManager.prototype.onPopup=function(e){"Upgrades"==e&&(this.notificationShowed=!0,this.onRender())},UpgradeManager.prototype.onRewardUpgrade=function(e){if(Date.now()-this.sinceLastUpgrade<120)return!1;if(Date.now()-this.lastRewardUpgrade<1e3)return!1;var t=this.getUpgradeByName(e);if(!t)return!1;this.upgrade=t,PokiPlugin.showReward(this.bounceBack),this.lastRewardUpgrade=Date.now(),this.sinceLastUpgrade=Date.now()},UpgradeManager.prototype.makeRewardUpgrade=function(){this.upgrade.entity.fire("Upgrade"),this.renderTimeout=Timer.setTimeout((function(e){e.onRender(name)}),10,this),PokiPlugin.isSatisfied=!0},UpgradeManager.prototype.onUpgrade=function(e){if(Date.now()-this.sinceLastUpgrade<120)return!1;var t=this.getUpgradeByName(e);if(!t)return!1;var a=this.getCurrentPrice(t);if(this.price-1<t.level)return!1;t.entity.fire("Upgrade"),this.app.fire("Money:Remove",a),this.onMoneyAdd(),Timer.clearTimeout(this.renderTimeout),this.renderTimeout=Timer.setTimeout((function(t){t.onRender(e)}),100,this),this.notificationShowed=!1,PokiPlugin.isSatisfied=!0,this.sinceLastUpgrade=Date.now()},UpgradeManager.prototype.loadUpgrades=function(){for(var e=this.upgrades.length;e--;){var t=this.upgrades[e];t&&this.currentUpgrades.indexOf(t.entity.name)>-1&&(t.entity.enabled=!0)}},UpgradeManager.prototype.onRender=function(e){this.clear();for(var t=this.upgrades.length,a=0;t--;){var i=this.upgrades[t];if(i){var n=this.rowEntity.clone();n.enabled=!0,a++,n.findByName("Title").element.text=i.title,n.findByName("Description").element.text=i.description,n.findByName("Icon").element.textureAsset=i.icon,i.entity.enabled?n.findByName("UpgradeLevel").element.text=i.entity.script.upgrade.level+" / "+i.entity.script.upgrade.maxLevel:(n.findByName("Title").element.text="?",n.findByName("Description").element.text="",n.findByName("Icon").element.color=pc.Color.BLACK,n.findByName("Icon").element.opacity=.5),n.findByName("Price").element.text=this.getCurrentPrice(i)+"",n.findByName("Buy").script.button.value=i.entity.name,e===i.entity.name&&(n.findByName("Fireworks").enabled=!0,i.entity.script.upgrade.maxLevel===i.entity.script.upgrade.level&&(this.entity.sound.play("Tada"),this.app.fire("Overlay:Ribbon",i.title+" max!"))),n.findByName("UpgradeFill").setLocalScale(i.entity.script.upgrade.level*(1/i.entity.script.upgrade.maxLevel),1,1),i.entity.enabled&&pc.MoneyManager.money<this.getCurrentPrice(i)&&(n.findByName("Buy").enabled=!0,n.findByName("Buy").button.active=!1),i.entity.script.upgrade.level>=i.entity.script.upgrade.maxLevel&&(n.findByName("Buy").enabled=!1,n.findByName("Active").enabled=!0),this.holderEntity.addChild(n),this.upgradeItems.push(n)}}this.nothingIcon.enabled=0===a},UpgradeManager.prototype.clear=function(){for(var e=this.upgradeItems.length;e--;){this.upgradeItems[e].destroy()}this.upgradeItems=[]},UpgradeManager.prototype.getUpgradeByName=function(e){for(var t=this.upgrades.length;t--;){var a=this.upgrades[t];if(a.entity.name==e)return a}return!1},UpgradeManager.prototype.checkAvailableUpgrades=function(){for(var e=this.upgrades.length,t=!1;e--;){var a=this.upgrades[e],i=this.getCurrentPrice(a);a&&!0===a.entity.enabled&&i>0&&pc.MoneyManager.money>0&&pc.MoneyManager.money>=i&&a.entity.script.upgrade.level<a.entity.script.upgrade.maxLevel&&(t=!0)}return t},UpgradeManager.prototype.onMoneyAdd=function(){this.checkAvailableUpgrades()?this.upgradeNotification2&&(this.upgradeNotification2.enabled=!0):this.upgradeNotification2&&(this.upgradeNotification2.enabled=!1)},UpgradeManager.prototype.getCurrentPrice=function(e){return Math.round(Math.pow(e.price,e.multiplier*e.entity.script.upgrade.level+1))},UpgradeManager.prototype.update=function(e){this.app.keyboard.wasPressed(pc.KEY_B)&&this.app.fire("PopupManager:Show","Upgrades")};"undefined"!=typeof document&&(
/*! FPSMeter 0.3.1 - 9th May 2013 | https://github.com/Darsain/fpsmeter */
function(t,e){function s(t,e){for(var n in e)try{t.style[n]=e[n]}catch(t){}return t}function H(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function R(t,e){if("array"!==H(e))return-1;if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function I(){var t,e=arguments;for(t in e[1])if(e[1].hasOwnProperty(t))switch(H(e[1][t])){case"object":e[0][t]=I({},e[0][t],e[1][t]);break;case"array":e[0][t]=e[1][t].slice(0);break;default:e[0][t]=e[1][t]}return 2<e.length?I.apply(null,[e[0]].concat(Array.prototype.slice.call(e,2))):e[0]}function N(t){return 1===(t=Math.round(255*t).toString(16)).length?"0"+t:t}function S(t,e,n,o){t.addEventListener?t[o?"removeEventListener":"addEventListener"](e,n,!1):t.attachEvent&&t[o?"detachEvent":"attachEvent"]("on"+e,n)}function D(t,e){function g(t,e,n,o){return h[0|t][Math.round(Math.min((e-n)/(o-n)*M,M))]}function r(){F.legend.fps!==q&&(F.legend.fps=q,F.legend[c]=q?"FPS":"ms"),b=q?v.fps:v.duration,F.count[c]=999<b?"999+":b.toFixed(99<b?0:O.decimals)}function m(){for(l=n(),P<l-O.threshold&&(v.fps-=v.fps/Math.max(1,60*O.smoothing/O.interval),v.duration=1e3/v.fps),w=O.history;w--;)T[w]=0===w?v.fps:T[w-1],j[w]=0===w?v.duration:j[w-1];if(r(),O.heat){if(z.length)for(w=z.length;w--;)z[w].el.style[o[z[w].name].heatOn]=q?g(o[z[w].name].heatmap,v.fps,0,O.maxFps):g(o[z[w].name].heatmap,v.duration,O.threshold,0);if(F.graph&&o.column.heatOn)for(w=C.length;w--;)C[w].style[o.column.heatOn]=q?g(o.column.heatmap,T[w],0,O.maxFps):g(o.column.heatmap,j[w],O.threshold,0)}if(F.graph)for(y=0;y<O.history;y++)C[y].style.height=(q?T[y]?Math.round(x/O.maxFps*Math.min(T[y],O.maxFps)):0:j[y]?Math.round(x/O.threshold*Math.min(j[y],O.threshold)):0)+"px"}function k(){20>O.interval?(p=i(k),m()):(p=setTimeout(k,O.interval),f=i(m))}function G(t){(t=t||window.event).preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0),v.toggle()}function U(){O.toggleOn&&S(F.container,O.toggleOn,G,1),t.removeChild(F.container)}function V(){if(F.container&&U(),o=D.theme[O.theme],!(h=o.compiledHeatmaps||[]).length&&o.heatmaps.length){for(y=0;y<o.heatmaps.length;y++)for(h[y]=[],w=0;w<=M;w++){var e,n=h[y],a=w;e=.33/M*w;var i=o.heatmaps[y].saturation,l=o.heatmaps[y].lightness,p=void 0,c=void 0,u=void 0,d=u=void 0,f=p=c=void 0;f=void 0;0===(u=.5>=l?l*(1+i):l+i-l*i)?e="#000":(c=(u-(d=2*l-u))/u,f=(e*=6)-(p=Math.floor(e)),f*=u*c,0===p||6===p?(p=u,c=d+f,u=d):1===p?(p=u-f,c=u,u=d):2===p?(p=d,c=u,u=d+f):3===p?(p=d,c=u-f):4===p?(p=d+f,c=d):(p=u,c=d,u-=f),e="#"+N(p)+N(c)+N(u)),n[a]=e}o.compiledHeatmaps=h}for(var b in F.container=s(document.createElement("div"),o.container),F.count=F.container.appendChild(s(document.createElement("div"),o.count)),F.legend=F.container.appendChild(s(document.createElement("div"),o.legend)),F.graph=O.graph?F.container.appendChild(s(document.createElement("div"),o.graph)):0,z.length=0,F)F[b]&&o[b].heatOn&&z.push({name:b,el:F[b]});if(C.length=0,F.graph)for(F.graph.style.width=O.history*o.column.width+(O.history-1)*o.column.spacing+"px",w=0;w<O.history;w++)C[w]=F.graph.appendChild(s(document.createElement("div"),o.column)),C[w].style.position="absolute",C[w].style.bottom=0,C[w].style.right=w*o.column.width+w*o.column.spacing+"px",C[w].style.width=o.column.width+"px",C[w].style.height="0px";s(F.container,O),r(),t.appendChild(F.container),F.graph&&(x=F.graph.clientHeight),O.toggleOn&&("click"===O.toggleOn&&(F.container.style.cursor="pointer"),S(F.container,O.toggleOn,G))}"object"===H(t)&&undefined===t.nodeType&&(e=t,t=document.body),t||(t=document.body);var o,h,l,p,f,x,b,w,y,v=this,O=I({},D.defaults,e||{}),F={},C=[],M=100,z=[],E=O.threshold,A=0,P=n()-E,T=[],j=[],q="fps"===O.show;v.options=O,v.fps=0,v.duration=0,v.isPaused=0,v.tickStart=function(){A=n()},v.tick=function(){l=n(),E+=(l-P-E)/O.smoothing,v.fps=1e3/E,v.duration=A<P?E:l-A,P=l},v.pause=function(){return p&&(v.isPaused=1,clearTimeout(p),a(p),a(f),p=f=0),v},v.resume=function(){return p||(v.isPaused=0,k()),v},v.set=function(t,e){return O[t]=e,q="fps"===O.show,-1!==R(t,u)&&V(),-1!==R(t,d)&&s(F.container,O),v},v.showDuration=function(){return v.set("show","ms"),v},v.showFps=function(){return v.set("show","fps"),v},v.toggle=function(){return v.set("show",q?"ms":"fps"),v},v.hide=function(){return v.pause(),F.container.style.display="none",v},v.show=function(){return v.resume(),F.container.style.display="block",v},v.destroy=function(){v.pause(),U(),v.tick=v.tickStart=function(){}},V(),k()}var n,o=t.performance;n=o&&(o.now||o.webkitNow)?o[o.now?"now":"webkitNow"].bind(o):function(){return+new Date};for(var a=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,i=t.requestAnimationFrame,h=0,l=0,p=(o=["moz","webkit","o"]).length;l<p&&!a;++l)i=(a=t[o[l]+"CancelAnimationFrame"]||t[o[l]+"CancelRequestAnimationFrame"])&&t[o[l]+"RequestAnimationFrame"];a||(i=function(e){var o=n(),a=Math.max(0,16-(o-h));return h=o+a,t.setTimeout((function(){e(o+a)}),a)},a=function(t){clearTimeout(t)});var c="string"===H(document.createElement("div").textContent)?"textContent":"innerText";D.extend=I,window.FPSMeter=D,D.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var u=["toggleOn","theme","heat","graph","history"],d="position zIndex left top right bottom margin".split(" ")}(window),function(t,e){e.theme={};var n=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter));var Fps=pc.createScript("fps");Fps.prototype.initialize=function(){this.fps=new FPSMeter({heat:!0,graph:!0})},Fps.prototype.update=function(t){this.fps.tick()};var Billboard=pc.createScript("billboard");Billboard.attributes.add("camaraEntity",{type:"entity"}),Billboard.prototype.initialize=function(){this.camera=this.camaraEntity,this.camera||(this.camera=this.app.root.findByName("Lens"))},Billboard.prototype.update=function(t){this.camera&&this.entity.setRotation(this.camera.getRotation())};var Arrow=pc.createScript("arrow");Arrow.prototype.initialize=function(){this.pointer=this.sizeEntity,this.arrow=this.entity.findByName("Arrow"),this.entity.on("Arrow:SetPointer",this.setPointerEntity,this)},Arrow.prototype.setPointerEntity=function(t){this.pointer=t},Arrow.prototype.onShow=function(){if(this.pointer){var t=this.pointer.getPosition().sub(this.entity.getPosition());t.normalize(),this.entity.setEulerAngles(0,180*Math.atan2(t.x,t.z)/Math.PI-90,0),this.entity.enabled=!0;var i=this.entity.getPosition().sub(this.pointer.getPosition()).length();this.entity.findByName("Line").setLocalScale(.06,.45,i)}},Arrow.prototype.update=function(t){this.onShow()};var Interaction=pc.createScript("interaction");Interaction.attributes.add("speed",{type:"number",default:1}),Interaction.attributes.add("eventName",{type:"string"}),Interaction.attributes.add("string",{type:"string"}),Interaction.attributes.add("waitingTime",{type:"number",default:3}),Interaction.attributes.add("radius",{type:"number",default:2}),Interaction.prototype.postInitialize=function(){this.isCounting=!1,this.popupShown=!1,this.progress=-1,this.entity.on("triggerenter",this.onTrigger,this),this.entity.on("triggerleave",this.onLeave,this),this.app.fire("CheckClosest:Add",this.entity),this.on("destroy",this.onDestroy,this)},Interaction.prototype.onDestroy=function(){this.app.fire("CheckClosest:Remove",this.entity)},Interaction.prototype.onTrigger=function(t){if("Player"!=t.name)return!1;this.popupShown||(this.startCounting(),this.app.fire("World2Screen:Clone","Progress",this.entity,!1,this.setDisplay.bind(this))),this.progressionEntity.visible=!0},Interaction.prototype.onLeave=function(t){if("Player"!=t.name)return!1;this.stopCounting(),this.popupShown&&(this.popupShown=!1)},Interaction.prototype.startCounting=function(){this.isCounting=!0,this.progress=0},Interaction.prototype.stopCounting=function(){this.isCounting=!1,this.progress=0,this.progressionEntity&&this.progressionEntity.destroy()},Interaction.prototype.triggerEvent=function(){this.app.fire(this.eventName,this.string),this.popupShown=!0,this.stopCounting(),this.progressionEntity.destroy()},Interaction.prototype.setDisplay=function(t){this.progressionEntity=t},Interaction.prototype.update=function(t){this.progress>this.waitingTime&&this.triggerEvent(),this.isCounting&&(this.progress+=t*this.speed,this.progressionEntity.fire("Progress",this.progress))};var LookAt=pc.createScript("lookAt");LookAt.prototype.initialize=function(){this.cameraEntity=this.app.root.findByName("Lens")},LookAt.prototype.update=function(t){this.entity.lookAt(this.cameraEntity.getPosition())};var Shake=pc.createScript("shake");Shake.attributes.add("speed",{type:"number",default:30}),Shake.attributes.add("amplitude",{type:"number",default:10}),Shake.attributes.add("duration",{type:"number",default:2}),Shake.prototype.initialize=function(){this.time=0,this.shaking=!1,this.app.on("Shake:Start",this.startShaking,this)},Shake.prototype.update=function(t){if(this.shaking){this.time+=t;var i=this.amplitude*Math.sin(this.speed*this.time);this.entity.setLocalEulerAngles(i,0,0),this.time>=this.duration&&this.stopShaking()}},Shake.prototype.startShaking=function(){this.shaking=!0,this.time=0},Shake.prototype.stopShaking=function(){this.shaking=!1,this.entity.setLocalEulerAngles(0,0,0)};var StuckDetector=pc.createScript("stuckDetector");StuckDetector.attributes.add("topDetector",{type:"entity"}),StuckDetector.attributes.add("emptyHolder",{type:"entity"}),StuckDetector.attributes.add("distance",{type:"number",default:1}),StuckDetector.prototype.initialize=function(){this.time=0,this.upVector=new pc.Vec3(0,this.distance,0),this.aboveBoxes=[],this.app.on("StuckDetector:GetAboveBoxes",this.getAboveBoxes,this)},StuckDetector.prototype.update=function(t){if(this.time+=t,this.time>2){var e=this.topDetector.getPosition().clone(),o=e.clone().add(this.upVector),i=this.app.systems.rigidbody.raycastFirst(e,o);if(i)i.point.distance(e)<.1&&(console.log("Player Stuct"),this.destroyAboveBlocks());this.time=0}},StuckDetector.prototype.destroyAboveBlocks=function(){var t=this.topDetector.getPosition().clone(),e=this.entity.getLocalScale().clone().x;e<1&&(e=1),this.app.fire("QuadTree:Query",t.x,t.z,e,e,"StuckDetector:GetAboveBoxes");for(var o=this.aboveBoxes,i=o.length;i--;){var c=o[i].entity;c.getPosition().clone().distance(t)<e&&(c.reparent(this.emptyHolder),this.app.fire("Shake:Start"),this.entity.sound.play("PickUp-1"),this.entity.sound.play("PickUp-2"))}},StuckDetector.prototype.getAboveBoxes=function(t){this.aboveBoxes=t};var Projectile=pc.createScript("projectile");Projectile.attributes.add("emptyHolder",{type:"entity"}),Projectile.attributes.add("dustParticles",{type:"entity"}),Projectile.attributes.add("particleScaleFactor",{type:"number",default:.5}),Projectile.prototype.initialize=function(){this.timeS=0,this.timeT=0,this.isCountingS=!1,this.isCountingT=!1,this.entity.collision.on("collisionstart",this.onTrigger,this)},Projectile.prototype.onTrigger=function(){var t=this.entity.findByTag("Box");t.length>0&&(this.dustParticles.setLocalScale(Math.pow(t.length,this.particleScaleFactor),Math.pow(t.length,this.particleScaleFactor),Math.pow(t.length,this.particleScaleFactor)),this.dustParticles.particlesystem.play(),this.isCountingS=!0,t.forEach((t=>{t.reparent(this.emptyHolder)})))},Projectile.prototype.update=function(t){this.isCountingS&&(this.timeS+=t,this.timeS>=.3&&(this.dustParticles.particlesystem.stop(),this.dustParticles.particlesystem.reset(),this.timeS=0,this.isCountingS=!1));var i=this.entity.findByTag("Box");i.length>0&&(this.timeT+=t,this.timeT>=2&&(i.forEach((t=>{t.reparent(this.emptyHolder)})),this.timeT=0))};var Progress=pc.createScript("progress");Progress.attributes.add("checkEntity",{type:"entity"}),Progress.prototype.initialize=function(){this.checkEntity&&(this.checkEntity.enabled=!1),this.entity.parent.on("Progress",this.onProgress,this)},Progress.prototype.onProgress=function(t){this.entity.fire("MaterialShader:Set","progress",t),this.checkEntity&&(this.checkEntity.enabled=t>=1)};var SpatialHashGrid=pc.createScript("spatialHashGrid");SpatialHashGrid.attributes.add("mapSize",{type:"number"}),SpatialHashGrid.attributes.add("client",{type:"entity"}),SpatialHashGrid.prototype.initialize=function(){this.cellSize=8,this.rows=Math.floor(this.mapSize/this.cellSize),this.cols=Math.floor(this.mapSize/this.cellSize),this.cells=this.create2DArray(this.rows,this.cols),this.clientPreviousPos=this.client.getPosition().clone(),this.clientCell=this.cells[0][0],this.clientNearbyCellsRange=parseInt(1)},SpatialHashGrid.prototype.postInitialize=function(){this.boxes=this.entity.findByTag("Box");for(let e=0;e<this.boxes.length;e++)this.addBoxToCells(this.boxes[e]);console.log(this.boxes.length);var e=this.getNearbyBoxes();this.app.fire("SplitSphere:GetNearbyBoxes",e)},SpatialHashGrid.prototype.updateClient=function(){var e=this.getCellIndexByPosition(this.client);this.clientCell=this.cells[e.x][e.z]},SpatialHashGrid.prototype.getNearbyBoxes=function(){var e=[],t=this.getCellIndexByPosition(this.client);return e=e.concat(this.cells[t.x][t.z]),t.x>=0&&t.x<this.cells.length&&t.z>=0&&t.z<this.cells[0].length&&(t.z+this.clientNearbyCellsRange<this.cells[0].length&&(e=e.concat(this.cells[t.x][t.z+this.clientNearbyCellsRange])),t.z-this.clientNearbyCellsRange>=0&&(e=e.concat(this.cells[t.x][t.z-this.clientNearbyCellsRange])),t.x+this.clientNearbyCellsRange<this.cells.length&&(e=e.concat(this.cells[t.x+this.clientNearbyCellsRange][t.z])),t.x-this.clientNearbyCellsRange>=0&&(e=e.concat(this.cells[t.x-this.clientNearbyCellsRange][t.z])),t.x-this.clientNearbyCellsRange>=0&&t.z+this.clientNearbyCellsRange<this.cells[0].length&&(e=e.concat(this.cells[t.x-this.clientNearbyCellsRange][t.z+this.clientNearbyCellsRange])),t.x-this.clientNearbyCellsRange>=0&&t.z-this.clientNearbyCellsRange>=0&&(e=e.concat(this.cells[t.x-this.clientNearbyCellsRange][t.z-this.clientNearbyCellsRange])),t.x+this.clientNearbyCellsRange<this.cells.length&&t.z-this.clientNearbyCellsRange>=0&&(e=e.concat(this.cells[t.x+this.clientNearbyCellsRange][t.z-this.clientNearbyCellsRange])),t.x+this.clientNearbyCellsRange<this.cells.length&&t.z+this.clientNearbyCellsRange<this.cells[0].length&&(e=e.concat(this.cells[t.x+this.clientNearbyCellsRange][t.z+this.clientNearbyCellsRange]))),e},SpatialHashGrid.prototype.addBoxToCells=function(e){var t=this.getCellIndexByPosition(e);this.cells[t.x][t.z].push(e)},SpatialHashGrid.prototype.getCellIndexByPosition=function(e){var t=e.getPosition().clone(),l=Math.floor(t.x/this.cellSize),i=Math.floor(t.z/this.cellSize);return l>=0&&l<this.cells.length&&i>=0&&i<this.cells.length?{x:l,z:i}:{x:0,z:0}},SpatialHashGrid.prototype.create2DArray=function(e,t,l=[]){let i=new Array(e);for(let s=0;s<e;s++){i[s]=new Array(t);for(let e=0;e<t;e++)i[s][e]=[...l]}return i},SpatialHashGrid.prototype.update=function(e){var t=this.client.getPosition().clone();if(!t.equals(this.clientPreviousPos)){this.updateClient();var l=this.getNearbyBoxes();this.app.fire("SplitSphere:GetNearbyBoxes",l),this.clientPreviousPos=t}};var QuadTreeScript=pc.createScript("quadTree");QuadTreeScript.attributes.add("mapSize",{type:"number",default:80}),QuadTreeScript.attributes.add("capacity",{type:"number",default:4}),QuadTreeScript.prototype.initialize=function(){this.boundary=new Rectangle(this.mapSize/2,this.mapSize/2,this.mapSize/2,this.mapSize/2),this.quadTree=new QuadTree(this.boundary,this.capacity),this.app.on("QuadTree:Query",this.query,this),this.on("destroy",this.onDestroy,this)},QuadTreeScript.prototype.postInitialize=function(){this.boxes=this.entity.findByTag("Box");for(let t=0;t<this.boxes.length;t++)this.insertEntity(this.boxes[t]);console.log("Total Boxes "+this.boxes.length)},QuadTreeScript.prototype.insertEntity=function(t){var e=t.getPosition().clone(),i=new EntityPoint(e.x,e.z,t);this.quadTree.insert(i)},QuadTreeScript.prototype.query=function(t,e,i,r,a){if(t>=0&&t<this.mapSize&&e>=0&&e<this.mapSize){var o=new Rectangle(t,e,i,r);let p=this.quadTree.query(o);pc.app.fire(a,p)}},QuadTreeScript.prototype.onDestroy=function(){this.app.off("QuadTree:Query",this.query,this)},QuadTreeScript.prototype.update=function(t){};var VoxelMap=pc.createScript("voxelMap");VoxelMap.attributes.add("box",{type:"entity"}),VoxelMap.attributes.add("colBox",{type:"entity"}),VoxelMap.attributes.add("holderEntity",{type:"entity"}),VoxelMap.attributes.add("playerEntity",{type:"entity"}),VoxelMap.attributes.add("collisionPoolEntity",{type:"entity"}),VoxelMap.attributes.add("collisionPoolSize",{type:"number",default:50}),VoxelMap.attributes.add("boxPoolEntity",{type:"entity"}),VoxelMap.attributes.add("boxPoolSize",{type:"number",default:50}),VoxelMap.attributes.add("widthSegments",{type:"number",default:50}),VoxelMap.attributes.add("lengthSegments",{type:"number",default:50}),VoxelMap.attributes.add("heightSegments",{type:"number",default:3}),VoxelMap.attributes.add("collisionRadius",{type:"number",default:4}),VoxelMap.prototype.initialize=function(){this.colPositions=[],this.colBoxes=[],this.previousPlayerPosition=this.playerEntity.getPosition().clone(),this.blocks=[],this.holes=[],this.boxClone=this.box.clone(),this.collisionPool=[],this.boxPool=[],this.unitScale=1,this.voxelGrid=new Array(this.widthSegments);for(let t=0;t<this.widthSegments;t++){this.voxelGrid[t]=new Array(this.heightSegments);for(let o=0;o<this.heightSegments;o++)this.voxelGrid[t][o]=new Array(this.lengthSegments).fill(!0)}this.drawVoxelMap(this.widthSegments,this.heightSegments,this.lengthSegments),this.setUpCollisionPool(),this.setUpBoxPool(),this.app.on("Map:Slpit",this.onSplit,this),this.app.on("Map:AddBoxToPool",this.addBoxToPool,this),this.app.on("Map:GetNearbyBoxPositions",this.getNearbyBoxes,this)},VoxelMap.prototype.drawVoxelMap=function(t,o,e){if(this.app.graphicsDevice.supportsInstancing){const i=t*o*e,s=new Float32Array(16*i);let l=0;const n=new pc.Vec3,h=new pc.Quat,r=new pc.Vec3,a=new pc.Mat4;for(let i=0;i<t;i++)for(let t=0;t<o;t++)for(let o=0;o<e;o++)if(this.voxelGrid[i][t][o]){n.set(i,t,o),r.set(1,1,1),h.setFromEulerAngles(0,0,0),a.setTRS(n,h,r);for(let t=0;t<16;t++)s[l++]=a.data[t]}this.vertexBuffer&&this.vertexBuffer.destroy(),this.vbFormat=pc.VertexFormat.getDefaultInstancingFormat(this.app.graphicsDevice),this.vertexBuffer=new pc.VertexBuffer(this.app.graphicsDevice,this.vbFormat,i,{data:s}),this.boxMeshInst=this.box.render.meshInstances[0],this.boxMeshInst.setInstancing(this.vertexBuffer)}},VoxelMap.prototype.onSplit=function(t,o){if(-1<t.x&&t.x<this.widthSegments+1&&-1<t.y&&t.y<this.heightSegments+1&&-1<t.z&&t.z<this.lengthSegments+1){const e=this.getVoxelsGridPositionFromPosition(t,o);this.populateBlocksForEat(e),e.forEach((t=>{t.x>=0&&t.x<this.widthSegments&&t.y>=0&&t.y<this.heightSegments&&t.z>=0&&t.z<this.lengthSegments&&(this.voxelGrid[t.x][t.y][t.z]=!1)})),this.drawVoxelMap(this.widthSegments,this.heightSegments,this.lengthSegments),e.forEach((t=>{this.colBoxes.forEach(((o,e)=>{const i=o.getPosition();i.x===t.x&&i.y===t.y&&i.z===t.z&&(this.addCollisionToPool(o),this.colBoxes.splice(e,1),this.colPositions.splice(e,1))}))}))}},VoxelMap.prototype.getVoxelsGridPositionFromPosition=function(t,o){const e=[],i=Math.floor(t.x-o),s=Math.ceil(t.x+o),l=Math.floor(t.y-o),n=Math.ceil(t.y+o),h=Math.floor(t.z-o),r=Math.ceil(t.z+o);for(let a=i;a<=s;a++)for(let i=l;i<=n;i++)for(let s=h;s<=r;s++){Math.sqrt((a-t.x)**2+(i-t.y)**2+(s-t.z)**2)<=o&&e.push({x:a,y:i,z:s})}return e},VoxelMap.prototype.getNearbyBoxes=function(t,o){var e=this.getVoxelsGridPositionFromPosition(t,o);this.app.fire("SplitSphere:GetNearbyBoxesFromVoxelMap",e)},VoxelMap.prototype.populateBlocksForEat=function(t){var o=[];t.forEach((t=>{if(0<=t.x&&t.x<this.widthSegments&&0<=t.y&&t.y<this.heightSegments&&0<=t.z&&t.z<this.lengthSegments&&this.voxelGrid[t.x][t.y][t.z]){const e=this.getBoxFromPool();e.setPosition(t.x,t.y,t.z),this.app.root.addChild(e),e.enabled=!0,this.reparentToHolder(e),e.setPosition(t.x,t.y,t.z),o.push(e)}})),this.app.fire("SplitSphere:GetVoxelMapBoxes",o)},VoxelMap.prototype.reparentToHolder=function(t){var o=t.getPosition().clone(),e=t.getRotation().clone(),i=this.playerEntity.getLocalScale().clone();t.reparent(this.holderEntity),t.setLocalScale(1/i.x,1/i.y,1/i.z),t.setPosition(o),t.setRotation(e)},VoxelMap.prototype.checkCollision=function(t,o){const e=this.getVoxelsGridPositionFromPosition(t,o),i=[],s=new Set(this.colPositions.map((t=>`${t.x},${t.y},${t.z}`)));e.forEach((t=>{const o=`${t.x},${t.y},${t.z}`;s.has(o)||t.x>=0&&t.x<this.widthSegments&&t.y>=0&&t.y<this.heightSegments&&t.z>=0&&t.z<this.lengthSegments&&this.voxelGrid[t.x][t.y][t.z]&&i.push(t)})),i.forEach((t=>{var o=this.getCollisionFromPool(t);this.colPositions.push(t),this.colBoxes.push(o)})),this.removeObsoleteBoxes(e)},VoxelMap.prototype.addBoxes=function(t){console.log("create",t);var o=new pc.Entity(`Col ${t.x},${t.y},${t.z}`);o.addComponent("collision",{type:"box",halfExtents:new pc.Vec3(.5,.5,.5)}),o.addComponent("rigidbody"),o.setPosition(t.x,t.y,t.z),this.entity.addChild(o),this.colBoxes.push(o)},VoxelMap.prototype.removeObsoleteBoxes=function(t){this.colPositions=this.colPositions.filter((o=>{if(-1===t.findIndex((t=>t.x===o.x&&t.y===o.y&&t.z===o.z))){const t=this.colBoxes.findIndex((t=>{const e=t.getPosition();return e.x===o.x&&e.y===o.y&&e.z===o.z}));return-1!==t&&(this.addCollisionToPool(this.colBoxes[t]),this.colBoxes.splice(t,1)),!1}return!0}))},VoxelMap.prototype.removeObsoleteBoxesOld=function(t){this.colPositions=this.colPositions.filter((o=>{if(-1===t.findIndex((t=>t.x===o.x&&t.y===o.y&&t.z===o.z))){const t=this.colBoxes.findIndex((t=>{const e=t.getPosition();return e.x===o.x&&e.y===o.y&&e.z===o.z}));return-1!==t&&(this.colBoxes[t].destroy(),this.colBoxes.splice(t,1)),!1}return!0}))},VoxelMap.prototype.update=function(t){const o=this.playerEntity.getPosition();o.equals(this.previousPlayerPosition)||(this.checkCollision(o,this.collisionRadius),this.previousPlayerPosition.copy(o))},VoxelMap.prototype.setUpCollisionPool=function(){for(let e=0;e<this.collisionPoolSize;e++){var t=new pc.Entity("Col");t.addComponent("collision",{type:"box",halfExtents:new pc.Vec3(.5,.5,.5)}),t.addComponent("rigidbody",{type:pc.BODYTYPE_STATIC});var o=this.collisionPoolEntity.getPosition().clone();t.rigidbody.teleport(o.x,o.y,o.z),this.entity.addChild(t),this.collisionPool.push(t)}},VoxelMap.prototype.getCollisionFromPool=function(t){var o=this.collisionPool[0];return this.collisionPool=this.collisionPool.slice(1),o.rigidbody.teleport(t.x,t.y,t.z),o},VoxelMap.prototype.addCollisionToPool=function(t){var o=this.collisionPoolEntity.getPosition().clone();t.rigidbody.teleport(o.x,o.y,o.z),this.collisionPool.push(t)},VoxelMap.prototype.setUpBoxPool=function(){for(let e=0;e<this.boxPoolSize;e++){var t=this.boxClone.clone();t.tags.add("VoxelBox");var o=this.collisionPoolEntity.getPosition().clone();this.boxPoolEntity.setPosition(o.x,o.y,o.z),this.boxPoolEntity.addChild(t),this.boxPool.push(t)}},VoxelMap.prototype.getBoxFromPool=function(){var t=this.boxPool[0];return this.boxPool=this.boxPool.slice(1),t.setLocalScale(1,1,1),t},VoxelMap.prototype.addBoxToPool=function(t){var o=this.boxPoolEntity.getPosition().clone();t.reparent(this.boxPoolEntity),t.setPosition(o.x,o.y,o.z),t.setLocalScale(1,1,1);var e=pc.Quat.IDENTITY;t.setRotation(e),this.boxPool.push(t)};var SceneLoader=pc.createScript("sceneLoader");SceneLoader.attributes.add("defaultScenes",{type:"string",array:!0}),SceneLoader.attributes.add("hideEntities",{type:"json",array:!0,schema:[{name:"scene",type:"string"},{name:"entity",type:"string"}]}),SceneLoader.prototype.initialize=function(){this.app.on("SceneLoader:Load",this.loadScene,this),this.app.on("SceneLoader:SetUp",this.setUpScene,this);for(var e=this.defaultScenes.length;e--;)this.loadScene(this.defaultScenes[e])},SceneLoader.prototype.loadScene=function(e){var t=this.app.scenes.find(e),n=this;this.app.loadSceneHierarchy(t.url,(function(e,t){e?console.error(e):n.loadedScene=t}))},SceneLoader.prototype.setUpScene=function(e){for(var t=0;t<this.loadedScene.children.length;t++){this.loadedScene.children[t].enabled=!0}for(var n=0;n<this.hideEntities.length;n++){if(this.hideEntities[n].scene==e){var i=this.loadedScene.findByName(this.hideEntities[n].entity);i&&(i.enabled=!1)}}};var EnemyManager=pc.createScript("enemyManager");EnemyManager.attributes.add("playerHolder",{type:"entity"}),EnemyManager.attributes.add("botEntity",{type:"entity"}),EnemyManager.attributes.add("botCount",{type:"number",default:10}),EnemyManager.prototype.initialize=function(){this.waypoints=[],this.enemies=[],this.isBotsLoaded=!1,this.botEntity.enabled=!1,this.app.on("MapManager:Clear",this.onClear,this),this.app.on("MapManager:Loaded",this.onMapLoaded,this)},EnemyManager.prototype.postInitialize=function(){},EnemyManager.prototype.onClear=function(){for(var t=this.enemies.length;t--;)this.enemies[t].destroy();this.enemies=[],this.isBotsLoaded=!1,console.log("all bots destroyed")},EnemyManager.prototype.onMapLoaded=function(){if(this.isBotsLoaded)return!1;this.waypoints=pc.app.root.findByTag("Waypoint");for(var t=0;t<this.waypoints.length;t++){var e=this.waypoints[t];e.render.enabled=!1,e.eatCount=15}this.createBots()},EnemyManager.prototype.createBots=function(){for(var t=0;t<this.botCount;t++)setTimeout((function(e){var n=e.botEntity.clone(),a=e.waypoints[t].getPosition().clone();n.setPosition(a),n.enabled=!0,e.playerHolder.addChild(n),e.enemies.push(n)}),1e3+1e3*t,this);this.isBotsLoaded=!0};var Enemy=pc.createScript("enemy");Enemy.attributes.add("directionEntity",{type:"entity"}),Enemy.attributes.add("characterEntity",{type:"entity"}),Enemy.attributes.add("splitEntity",{type:"entity"}),Enemy.attributes.add("holderEntity",{type:"entity"}),Enemy.attributes.add("emptyHolder",{type:"entity"}),Enemy.attributes.add("speed",{type:"number",default:.5}),Enemy.attributes.add("turnSpeed",{type:"number",default:.5}),Enemy.attributes.add("maxSize",{type:"number",default:7.5}),Enemy.attributes.add("offset",{type:"number",default:.5}),Enemy.attributes.add("skinBodies",{type:"entity",array:!0}),Enemy.attributes.add("materialOpacity",{type:"number",default:1}),Enemy.attributes.add("bodyMaterial",{type:"asset"}),Enemy.prototype.initialize=function(){this.state="Run",this.force=new pc.Vec3(0,0,0),this.direction=0,this.waypointHolder=this.app.root.findByName("Waypoints"),this.lastBurpSound=Date.now(),this.selectRandomSkin(),this.entity.username=Utils.generateUsername(),this.size=1+3*Math.random(),Math.random()>.5&&(this.size=1+10*Math.random()),this.entity.score=100*this.size,this.entity.level=10+Math.floor(10*Math.random()),this.setSize(),this.nextWaypoint=!1,this.decideWaypoint(),this.isRunning=!1,this.nearbyBlocks=[],this.blocks=[],this.isDisable=!1,this.isLoadingMap=!1,this.app.on("Enemy:GetNearbyBoxes",this.getNearbyBlocks,this),this.app.on("MapManager:Clear",this.onClearBlocks,this),this.app.on("MapManager:Loaded",this.onMapLoaded,this),this.entity.on("Enemy:Disable",this.onDisable,this),this.on("destroy",this.onDestroy,this)},Enemy.prototype.selectRandomSkin=function(){this.skinBodies.forEach((function(t){t.enabled=!1})),this.characterEntity=Utils.getRandom(this.skinBodies),this.characterEntity.enabled=!0,this.holderEntity=this.characterEntity.findByName("Holder"),this.defineAnimationEvents()},Enemy.prototype.defineAnimationEvents=function(){this.characterEntity.anim.on("split",(()=>{if(this.isLoadingMap)return!1;if(!this.isFiredSplitEvent){var t=this.splitEntity.getPosition().clone(),i=this.size*(3/4);i<1&&(i=1),this.app.fire("QuadTree:Query",t.x,t.z,i,i,"Enemy:GetNearbyBoxes");for(var e=this.nearbyBlocks.length;e--;){var n=this.nearbyBlocks[e].entity;n.getPosition().clone().distance(t)<i&&this.reparent(n)}this.blocks.length>0&&this.setBlockPositionToCenter(),this.isFiredSplitEvent=!0}})),this.characterEntity.anim.on("eat",(()=>{this.isFiredEatEvent||this.destroyBlocks(),this.isFiredEatEvent=!0}))},Enemy.prototype.onDestroy=function(){this.app.off("Enemy:GetNearbyBoxes",this.getNearbyBlocks,this),this.app.off("MapManager:Clear",this.onClearBlocks,this),this.app.off("MapManager:Loaded",this.onMapLoaded,this),clearTimeout(this.eatTimer),clearTimeout(this.eatTimer1)},Enemy.prototype.onClearBlocks=function(){this.nearbyBlocks=[],this.blocks=[],this.isLoadingMap=!0},Enemy.prototype.onMapLoaded=function(){this.isLoadingMap=!1,this.waypointHolder=this.app.root.findByName("Waypoints")},Enemy.prototype.getNearbyBlocks=function(t){this.nearbyBlocks=t||[]},Enemy.prototype.onDisable=function(){this.state="Stop",this.isRunning=!1,this.characterEntity.anim.setBoolean("Running",this.isRunning),this.isDisable=!0},Enemy.prototype.run=function(t){this.force.x=0,this.force.z=0;var i=this.direction-Math.PI/2;this.force.x=-Math.cos(i)*this.speed*t,this.force.z=Math.sin(i)*this.speed*t,this.entity.translate(this.force),this.directionEntity.setLocalEulerAngles(0,i*pc.math.RAD_TO_DEG+90,0)},Enemy.prototype.decideWaypoint=function(){if(!this.waypointHolder)return!1;var t=this.waypointHolder.findByTag("Waypoint");if(0===t.length)return this.state="Stop",!1;if(Math.random()>.5)return Utils.getRandom(t);for(var i=null,e=1e3,n=0;n<t.length;n++){var s=this.entity.getPosition().clone().distance(t[n].getPosition());s<e&&(i=t[n],e=s)}return i},Enemy.prototype.decide=function(){if("Run"!=this.state)return!1;if(this.nextWaypoint||(this.nextWaypoint=this.decideWaypoint()),!this.nextWaypoint)return!1;var t=this.nextWaypoint.getPosition(),i=this.entity.getPosition();Utils.distance(t.x,t.z,i.x,i.z)<.5&&(this.nextWaypoint.eatCount--,this.nextWaypoint.eatCount<=0&&this.nextWaypoint.destroy(),this.nextWaypoint=!1,this.takeFromGround())},Enemy.prototype.takeFromGround=function(){if(this.isLoadingMap)return!1;this.characterEntity.anim.setTrigger("TakeFromGround"),this.state="TakeFromGround",this.isFiredSplitEvent=!1,this.pieceCount=3,clearTimeout(this.eatTimer),this.eatTimer=setTimeout((function(t){t.eat()}),1500,this)},Enemy.prototype.reparent=function(t){var i=t.getPosition().clone(),e=t.getRotation().clone(),n=this.directionEntity.getLocalScale().clone();this.app.fire("VoxelAltitude:Remove",i.x,i.y,i.z),this.blocks.push(t),t&&t.collision&&(t.collision.enabled=!1,t.tags.clear()),t.reparent(this.holderEntity),t.setLocalScale(1/n.x,1/n.y,1/n.z),t.setPosition(i),t.setRotation(e)},Enemy.prototype.addSize=function(){this.size+=.05,this.entity.score=100*this.size,this.setSize(),this.size>this.maxSize&&(this.size=1)},Enemy.prototype.setSize=function(){this.directionEntity.setLocalScale(this.size,this.size,this.size)},Enemy.prototype.eat=function(){return!this.isLoadingMap&&(this.pieceCount--,0===this.pieceCount||this.blocks.length<1?(this.state="Run",this.characterEntity.anim.setTrigger("EatDone"),!1):(this.characterEntity.anim.setTrigger("Eat"),this.state="Eat",this.isFiredEatEvent=!1,this.blocks.length>0&&this.setBlockPositionToCenter(),setTimeout((function(t){t.addSize()}),500,this),void(this.pieceCount>0&&(clearTimeout(this.eatTimer1),this.eatTimer1=setTimeout((function(t){t.eat()}),1800,this)))))},Enemy.prototype.setBlockPositionToCenter=function(){var t=this.calculateCenter(this.blocks),i=this.holderEntity.getPosition().clone().sub(t);this.blocks.forEach((t=>{var e=t.getPosition().clone().add(i);t.setPosition(e)}))},Enemy.prototype.calculateCenter=function(t){var i=t.map((t=>t.getPosition().clone()));return this.calculateCentroid3D(i)},Enemy.prototype.calculateCentroid3D=function(t){if(0===t.length)throw new Error("No coordinates provided");let i=0,e=0,n=0;const s=t.length;t.forEach((t=>{i+=t.x,e+=t.y,n+=t.z}));const o=i/s,a=e/s,r=n/s;return new pc.Vec3(o,a,r)},Enemy.prototype.destroyBlocks=function(){if(this.blocks.length>0)for(var t=Math.floor(this.blocks.length*(1/this.pieceCount));t--;)this.blocks[t]&&this.blocks[t].reparent&&this.blocks[t].reparent(this.emptyHolder),this.blocks.splice(t,1)},Enemy.prototype.lookAt=function(t){var i=this.entity.getPosition(),e=this.nextWaypoint.getPosition(),n=Utils.lookAt(e.x,e.z,i.x,i.z);this.direction=Utils.rotate(this.direction,n,this.turnSpeed)},Enemy.prototype.setAnimationStates=function(){this.characterEntity.anim.setBoolean("Running",this.isRunning),this.characterEntity.anim.setBoolean("IsFat",this.size>2)},Enemy.prototype.setGravity=function(){if(!pc.VoxelAltitude)return!1;var t=this.entity.getPosition().clone(),i=pc.VoxelAltitude.getAltitude(t);this.entity.setPosition(t.x,i+this.offset,t.z)},Enemy.prototype.playRandomSounds=function(t){if(Date.now()-this.lastBurpSound<1e4)return!1;Math.random()>.9&&this.entity.sound.play("Burp"),this.lastBurpSound=Date.now()},Enemy.prototype.update=function(t){this.isDisable||(this.isRunning=!1,this.decide(),this.nextWaypoint&&(this.isRunning=!0,this.lookAt(t),this.run(t)),this.playRandomSounds(),this.setAnimationStates(),this.setGravity(t))};var VoxelAltitude=pc.createScript("voxelAltitude");VoxelAltitude.attributes.add("minimumAltitude",{type:"number",default:0}),VoxelAltitude.prototype.initialize=function(){pc.VoxelAltitude=this,this.mask=[],this.app.on("VoxelAltitude:Remove",this.removeBlock,this),this.on("destroy",this.onDestroy,this)},VoxelAltitude.prototype.snap=function(t){return Math.floor(t+.5)},VoxelAltitude.prototype.removeBlock=function(t,e,i){var o=this.snap(t),s=this.snap(e),l=this.snap(i);this.mask[o]||(this.mask[o]=[]),this.mask[o][l]||(this.mask[o][l]=s-.25)},VoxelAltitude.prototype.getAltitude=function(t){var e=this.snap(t.x),i=(this.snap(t.y),this.snap(t.z));return this.mask[e]&&this.mask[e][i]?this.mask[e][i]:this.minimumAltitude},VoxelAltitude.prototype.onDestroy=function(){pc.VoxelAltitude.mask=[],this.app.off("VoxelAltitude:Remove",this.removeBlock,this)};var DealtDamage=pc.createScript("dealtDamage");DealtDamage.attributes.add("numberEntity",{type:"entity"}),DealtDamage.attributes.add("holderEntity",{type:"entity"}),DealtDamage.prototype.initialize=function(){this.numbers=[],this.lastDamage=100,this.defaultOffset=new pc.Vec3(0,0,0),this.isMinus=1,this.cameraEntity=this.app.root.findByName("Lens"),this.numberEntity.enabled=!1,this.app.on("DealtDamage:Trigger",this.onDamageDealt,this)},DealtDamage.prototype.destroyEntity=function(e){this.numbers.splice(this.numbers.indexOf(e),1),e.destroy()},DealtDamage.prototype.onDamageDealt=function(e,t,a){var i=this.numberEntity.clone();e<=.99&&(e=1),i.element.text=e>0?Math.round(e)+"":e,this.offset=this.defaultOffset,i.player=new pc.Vec3(t.x,t.y,t.z),i.element.offsetX=10*Math.random()-10*Math.random(),i.element.offsetY=-1.7,i.element.opacity=1;var n=3,s=.3;a&&(n=4,s=1,i.element.color=pc.Color.RED),this.lastDamage=e;var o=i.tween(i.getLocalScale()).to({x:n,y:n,z:n},.15,pc.BounceOut);o.on("complete",(function(){this.entity.tween(this.entity.getLocalScale()).to({x:1,y:1,z:1},.4,pc.BounceOut).start()})),o.start(),i.tween(i.element).to({offsetY:0},.3,pc.Linear).start().on("complete",(function(){i.tween(i.element).to({opacity:0,offsetY:.8},s,pc.Linear).delay(.5).start()})),setTimeout((function(e,t){e.destroyEntity(t)}),3e3,this,i),this.numbers.push(i),this.holderEntity.addChild(i)},DealtDamage.prototype.updateNumberPosition=function(e){var t=new pc.Vec3,a=this.cameraEntity.camera,i=this.app.graphicsDevice.maxPixelRatio,n=this.entity.screen.scale,s=this.app.graphicsDevice,o=!1;return o=e.player.name?e.player.getPosition().clone().add(this.offset):e.player,!!a&&(!!e&&(a.worldToScreen(o,t),t.x*=i,t.y*=i,void(t.x>0&&t.x<this.app.graphicsDevice.width&&t.y>0&&t.y<this.app.graphicsDevice.height&&t.z>0?(e.setLocalPosition(t.x/n+e.element.offsetX,(s.height-t.y)/n+this.isMinus*Math.cos(e.element.offsetY)*Math.cos(e.element.offsetY)*120+(this.isMinus<0?150:0),0),e.element.outlineThickness=e.element.opacity,e.enabled=!0):e.enabled=!1)))},DealtDamage.prototype.update=function(e){for(var t=this.numbers.length;t--;)this.updateNumberPosition(this.numbers[t])};var Leaderboard=pc.createScript("leaderboard");Leaderboard.attributes.add("playerEntity",{type:"entity"}),Leaderboard.attributes.add("leaderboardEntity",{type:"entity"}),Leaderboard.attributes.add("playerHolder",{type:"entity"}),Leaderboard.attributes.add("myPlayerColor",{type:"rgb"}),Leaderboard.prototype.initialize=function(){this.leaderboardEntity.enabled=!1,this.playerArray=[],this.lastCheck=Date.now(),this.scanLeaderboard()},Leaderboard.prototype.scanLeaderboard=function(e){if(Date.now()-this.lastCheck<1e3)return!1;for(var t=[],r=0,a=this.playerHolder.findByTag("Player"),n=a.length;n--;){(d=a[n])&&t.push({entity:d,username:d.username,score:d.score})}t.sort((function(e,t){return t.score-e.score}));for(n=t.length;n--;)t[n]&&t[n].entity&&(t[n].entity.rank=n+1,t[n].entity.fire("Label:Update"));for(n=t.length;n--;)if(t[n].entity===this.playerEntity){r=n+1;break}for(;this.playerArray.length;){(d=this.playerArray.pop()).destroy()}for(var i in t=t.slice(0,5)){var d,o=t[i];(d=this.leaderboardEntity.clone()).findByName("Username").element.text=parseInt(i)+1+". "+o.username,d.findByName("Score").element.text=parseInt(o.score),d.enabled=!0,o.entity.kingIcon&&(0===parseInt(i)?o.entity.kingIcon.enabled=!0:o.entity.kingIcon.enabled=!1),o.entity==this.playerEntity&&(d.element.color=this.myPlayerColor),this.entity.addChild(d),this.playerArray.push(d)}r>5&&this.playerEntity.enabled&&((d=this.leaderboardEntity.clone()).element.color=this.myPlayerColor,d.findByName("Username").element.text=r+". "+this.playerEntity.username,d.findByName("Score").element.text=parseInt(this.playerEntity.score),d.enabled=!0,this.entity.addChild(d),this.playerArray.push(d));this.lastCheck=Date.now()},Leaderboard.prototype.update=function(e){this.scanLeaderboard()};var Upgrade=pc.createScript("upgrade");Upgrade.attributes.add("maxLevel",{type:"number",default:10}),Upgrade.attributes.add("levelName",{type:"string"}),Upgrade.prototype.initialize=function(){this.level=Utils.getItem(this.levelName)?Utils.getItem(this.levelName):1,this.entity.on("Upgrade",this.onUpgrade,this),this.entity.fire("Upgrade:State",this.level)},Upgrade.prototype.onUpgrade=function(){if(this.level>=this.maxLevel)return!1;this.level++,this.entity.fire("Upgrade:State",this.level),Utils.setItem(this.levelName,this.level)};var AnimatedSprite=pc.createScript("animatedSprite");AnimatedSprite.attributes.add("autoplay",{type:"boolean",default:!0}),AnimatedSprite.attributes.add("speed",{type:"number",default:1}),AnimatedSprite.attributes.add("frameCount",{type:"number",default:1}),AnimatedSprite.attributes.add("loop",{type:"boolean",default:!0}),AnimatedSprite.prototype.initialize=function(){this.currentFrame=0,this.isPlaying=!1,this.entity.on("AnimatedSprite:Play",this.onPlay,this),this.entity.on("AnimatedSprite:Pause",this.onPause,this),this.entity.on("AnimatedSprite:Reset",this.onReset,this),this.autoplay&&this.onPlay(),this.on("state",this.onStateChange,this)},AnimatedSprite.prototype.onStateChange=function(){this.onReset(),this.autoplay&&this.onPlay()},AnimatedSprite.prototype.onPlay=function(){this.isPlaying=!0,this.currentFrame=0},AnimatedSprite.prototype.onPause=function(){this.isPlaying=!1},AnimatedSprite.prototype.onReset=function(){this.isPlaying=!1,this.currentFrame=0},AnimatedSprite.prototype.update=function(t){this.entity.element.spriteFrame=Math.round(this.currentFrame),this.isPlaying&&(this.currentFrame+=this.speed*t,this.currentFrame>=this.frameCount&&this.loop&&(this.currentFrame=0),this.currentFrame=Math.min(this.currentFrame,this.frameCount))};var EmptyHolder=pc.createScript("emptyHolder");EmptyHolder.attributes.add("blocksEntity",{type:"entity"}),EmptyHolder.attributes.add("nothingToEatUIEntity",{type:"entity"}),EmptyHolder.prototype.initialize=function(){this.totalBlocks=this.blocksEntity.findByTag("Box").length},EmptyHolder.prototype.update=function(t){var o=this.entity.findByTag("Box").length;this.totalBlocks==o&&(console.log("There is nothing to eat!"),this.nothingToEatUIEntity.enabled=!0)};var MapManager=pc.createScript("mapManager");MapManager.attributes.add("levels",{type:"json",schema:[{name:"map",type:"string"},{name:"weight",type:"number",default:1}],array:!0}),MapManager.attributes.add("nextMapEntity",{type:"entity"}),MapManager.attributes.add("weightEntity",{type:"entity"}),MapManager.attributes.add("popupNextMap",{type:"entity"}),MapManager.attributes.add("popupWeight",{type:"entity"}),MapManager.attributes.add("nextMapButton",{type:"entity"}),MapManager.attributes.add("playerEntity",{type:"entity"}),MapManager.attributes.add("objectiveFill",{type:"entity"}),MapManager.attributes.add("objectiveText",{type:"entity"}),MapManager.attributes.add("objectiveArrow",{type:"entity"}),MapManager.attributes.add("gateEntity",{type:"entity"}),MapManager.prototype.initialize=function(){this.currentScene=!1,this.sceneIndex=Utils.getItemAsNumber("SceneIndex"),this.alreadyShow=!1,this.objectiveCompleted=-1,this.setScene(this.levels[this.sceneIndex]),this.app.on("MapManager:Set",this.setScene,this),this.app.on("MapManager:SwitchNextScene",this.switchNextScene,this)},MapManager.prototype.clear=function(){console.log("Clearing:",this.currentScene.map+"-Scene"),this.app.fire("MapManager:Clear");var e=this.entity.findByName(this.currentScene.map+"-Scene");e&&e.destroy()},MapManager.prototype.switchNextScene=function(){var e=this;this.sceneIndex++,this.sceneIndex>this.levels.length-1&&(this.sceneIndex=0),PokiPlugin.showMidroll((function(){console.log("map switched"),e.app.fire("PopupManager:Hide"),e.setScene(e.levels[e.sceneIndex]),Utils.setItem("SceneIndex",e.sceneIndex),Utils.addEvent("MapSwitch")}))},MapManager.prototype.updateOverlay=function(){var e=this.levels[this.sceneIndex+1];e||(e=this.levels[0]),this.nextMapEntity.element.text=e.map,this.popupNextMap.element.text=e.map,this.weightEntity.element.text=e.weight+"kg",this.popupWeight.element.text=e.weight+"kg"},MapManager.prototype.update=function(){var e=!1,t=this.sceneIndex+1;this.levels.length-1<t&&(t=0,e=!0);var a=this.levels[t],i=10*(this.playerEntity.script.player.weight-1);if(a&&a.weight>0){this.nextMapButton.enabled=a.weight<=i,a.weight<=i?(!e&&this.objectiveCompleted>-1&&Date.now()-this.objectiveCompleted>12e4&&!this.alreadyShow&&(this.app.fire("PopupManager:Show","NextMap"),this.alreadyShow=!0),this.objectiveArrow.enabled||(this.objectiveCompleted=Date.now()),this.objectiveArrow.enabled=!0,this.objectiveArrow.fire("Arrow:SetPointer",this.gateEntity)):this.objectiveArrow.enabled=!1;var n=a.weight,p=parseFloat(i).toFixed(1),r=1*i/n;r=Math.min(r,1),this.objectiveFill.setLocalScale(r,1,1),this.objectiveText.element.text=p+" / "+n+" kg"}else this.nextMapButton.enabled=!1,this.objectiveArrow.enabled=!1},MapManager.prototype.setScene=function(e){if(!e)return console.log("Scene name is missing!"),!1;this.app.fire("Timeline:SceneTransition"),this.app.fire("Timeline:Spinner");var t=this.app.scenes.find(e.map+"-Scene");if(!t)return console.log("Scene doesnt exist!"),!1;this.clear(),setTimeout((function(a){a.currentScene=e,a.updateOverlay(),console.log("Loading",e),pc.app.scenes.loadSceneHierarchy(t.url+"?v=",(function(t,i){t?console.error(t):(a.app.fire("Time:Reset"),a.app.fire("Timeline:SceneTransition",{isReverse:!0}),a.app.fire("Timeline:Spinner",{isReverse:!0}),a.app.fire("MapManager:Loaded"),i.reparent(a.entity),pc.app.fire("MapManager:Loaded"),pc.app.fire("SceneLoader:SetUp",e))}))}),200,this)};var Reward2xBlock=pc.createScript("reward2xBlock");Reward2xBlock.attributes.add("type",{type:"string"}),Reward2xBlock.prototype.initialize=function(){this.isActive=!0,this.isPlayerSplit=!1,this.lastTrigger=Date.now(),this.entity.collision.on("triggerenter",this.onEnter,this)},Reward2xBlock.prototype.onEnter=function(t){"Player"===t.name&&Date.now()-this.lastTrigger>2e3&&(this.app.fire("RewardManagerMain:Show",this.type,this.entity),this.app.fire("PopupManager:Show","RewardPopup"),this.lastTrigger=Date.now())},Reward2xBlock.prototype.update=function(t){};var RewardManager=pc.createScript("rewardManager");RewardManager.attributes.add("rewardEntity",{type:"entity"}),RewardManager.attributes.add("spawnPointsEntity",{type:"entity"}),RewardManager.prototype.initialize=function(){this.activePoints=[],this.maximumActivePoints=Math.random()>.5?3:4,this.spawnPoints=this.spawnPointsEntity.findByTag("RewardSpawnPoint"),this.activatePoints(),this.generateRewards()},RewardManager.prototype.activatePoints=function(){let t=0;for(;this.activePoints.length<this.maximumActivePoints&&t<100;){var i=Utils.getRandom(this.spawnPoints);this.activePoints.includes(i)||this.activePoints.push(i),t++}},RewardManager.prototype.generateRewards=function(){this.activePoints.forEach((t=>{var i=this.rewardEntity.clone();i.setPosition(t.getPosition().clone()),i.enabled=!0,this.entity.addChild(i)}))},RewardManager.prototype.update=function(t){};var RenderCameraToElement=pc.createScript("renderCameraToElement");RenderCameraToElement.attributes.add("elementTags",{type:"string",array:!0,description:"Render to elements that have these tags"}),RenderCameraToElement.attributes.add("renderResolution",{type:"vec2",description:"Resolution to render at"}),RenderCameraToElement.attributes.add("renderOnce",{type:"boolean",description:"Renders the first frame only"}),RenderCameraToElement.prototype.initialize=function(){this.createNewRenderTexture(),this.renderOnceFrameCount=0,this.on("destroy",this.onDestroy,this),this.app.on("CameraToElement",this.createNewRenderTexture,this)},RenderCameraToElement.prototype.onDestroy=function(e){this.app.off("CameraToElement",this.createNewRenderTexture,this),this.assignTextureToElements(null),this.renderTarget.destroy(),this.texture.destroy()},RenderCameraToElement.prototype.update=function(e){this.renderOnce&&(this.renderOnceFrameCount+=1,this.renderOnceFrameCount>4&&(this.entity.enabled=!1))},RenderCameraToElement.prototype.createNewRenderTexture=function(){var e=this.app.graphicsDevice;if(this.texture&&this.renderTarget){var t=this.renderTarget,r=this.texture;this.renderTarget=null,this.texture=null,t.destroy(),r.destroy()}var n=new pc.Texture(e,{width:this.renderResolution.x,height:this.renderResolution.y,format:pc.PIXELFORMAT_R8_G8_B8,autoMipmap:!0});n.minFilter=pc.FILTER_LINEAR,n.magFilter=pc.FILTER_LINEAR;var a=new pc.RenderTarget(e,n,{depth:!0,flipY:!0,samples:2});this.entity.camera.renderTarget=a,this.texture=n,this.renderTarget=a,this.assignTextureToElements(this.texture)},RenderCameraToElement.prototype.assignTextureToElements=function(e){for(var t,r=0;r<this.elementTags.length;++r){t=this.app.root.findByTag(this.elementTags[r]);for(var n=0;n<t.length;++n)t[n].element.texture=e}};var Customization=pc.createScript("customization");Customization.attributes.add("hairMat",{type:"asset",assetType:"material"}),Customization.attributes.add("tShirtMat",{type:"asset",assetType:"material"}),Customization.attributes.add("pantsMat",{type:"asset",assetType:"material"}),Customization.attributes.add("hairColorNumberUI",{type:"entity"}),Customization.attributes.add("tShirtColorNumberUI",{type:"entity"}),Customization.attributes.add("pantsColorNumberUI",{type:"entity"}),Customization.attributes.add("maleSkins",{type:"json",array:!0,schema:[{name:"skin",type:"entity"},{name:"isRewardedSkin",type:"boolean",default:!1},{name:"isRedirect",type:"boolean",default:!1}]}),Customization.attributes.add("femaleSkins",{type:"json",array:!0,schema:[{name:"skin",type:"entity"},{name:"isRewardedSkin",type:"boolean",default:!1}]}),Customization.attributes.add("rewardSkinBTN",{type:"entity"}),Customization.attributes.add("redirectSkinBTN",{type:"entity"}),Customization.attributes.add("genderUI",{type:"entity"}),Customization.attributes.add("skinUI",{type:"entity"}),Customization.attributes.add("imagesUI",{type:"entity"}),Customization.prototype.initialize=function(){this.gender=Utils.getItem("characterGender")?Utils.getItem("characterGender"):"Male",this.bounceBack=this.onReward.bind(this),this.unlockedMaleSkinIndices=Utils.getItemAsArray("unlockedMaleSkinIndices")?Utils.getItemAsArray("unlockedMaleSkinIndices"):[],this.unlockedFemaleSkinIndices=Utils.getItemAsArray("unlockedFemaleSkinIndices")?Utils.getItemAsArray("unlockedFemaleSkinIndices"):[],this.maleSkinIndex=Utils.getItem("maleSkinIndex")?Utils.getItem("maleSkinIndex"):0,this.femaleSkinIndex=Utils.getItem("femaleSkinIndex")?Utils.getItem("femaleSkinIndex"):0,this.hairColorNumber=Utils.getItem("hairColorNumber")?Utils.getItem("hairColorNumber"):0,this.tShirtColorNumber=Utils.getItem("tShirtColorNumber")?Utils.getItem("tShirtColorNumber"):0,this.pantsColorNumber=Utils.getItem("pantsColorNumber")?Utils.getItem("pantsColorNumber"):0,this.app.on("Customization:Hair",this.customizHair,this),this.app.on("Customization:TShirt",this.customizTShirt,this),this.app.on("Customization:Pants",this.customizPants,this),this.app.on("CustomizationScript:Gender",this.customizGender,this),this.app.on("CustomizationScript:Reward",this.onRewardCustomization,this),this.app.on("CustomizationScript:ChangeSkin",this.changeSkin,this),this.app.on("PopupManager:Hide",this.onPopUpHide,this),this.setUpRewards(),this.customizHair(),this.customizTShirt(),this.customizPants(),this.setGender()},Customization.prototype.setGender=function(){"Male"==this.gender?this.genderUI.element.text="Male":(this.gender="Female")&&(this.genderUI.element.text="Female"),this.makeVisualChange()},Customization.prototype.customizGender=function(){"Female"==this.gender?(this.gender="Male",this.genderUI.element.text="Male"):"Male"==this.gender&&(this.gender="Female",this.genderUI.element.text="Female"),this.makeVisualChange(),Utils.setItem("characterGender",this.gender)},Customization.prototype.changeSkin=function(e){"Male"==this.gender&&("Left"==e?this.maleSkinIndex--:"Right"==e&&this.maleSkinIndex++,this.maleSkinIndex>this.maleSkins.length-1&&(this.maleSkinIndex=0),this.maleSkinIndex<0&&(this.maleSkinIndex=this.maleSkins.length-1)),"Female"==this.gender&&("Left"==e?this.femaleSkinIndex--:"Right"==e&&this.femaleSkinIndex++,this.femaleSkinIndex>this.femaleSkins.length-1&&(this.femaleSkinIndex=0),this.femaleSkinIndex<0&&(this.femaleSkinIndex=this.femaleSkins.length-1)),this.makeVisualChange()},Customization.prototype.makeVisualChange=function(){if("Male"==this.gender){for(var e=0;e<this.maleSkins.length;e++){(i=this.maleSkins[e].skin).enabled=!1,this.imagesUI.findByName(i.name).enabled=!1}for(var t=0;t<this.femaleSkins.length;t++){(i=this.femaleSkins[t].skin).enabled=!1,this.imagesUI.findByName(i.name).enabled=!1}var i=(n=this.maleSkins[this.maleSkinIndex]).skin,s=this.maleSkinIndex;i.enabled=!0,this.skinUI.element.text=`${s}`,this.imagesUI.findByName(i.name).enabled=!0,n.isRedirect?(this.rewardSkinBTN.enabled=!1,this.redirectSkinBTN.enabled=!0):n.isRewardedSkin?(this.rewardSkinBTN.enabled=!0,this.redirectSkinBTN.enabled=!1,this.rewardSkinBTN.script.button.value=this.maleSkinIndex):(this.rewardSkinBTN.enabled=!1,this.redirectSkinBTN.enabled=!1,Utils.setItem("maleSkinIndex",this.maleSkinIndex),this.app.fire("Customization:Character",i))}if("Female"==this.gender){for(e=0;e<this.maleSkins.length;e++){(i=this.maleSkins[e].skin).enabled=!1,this.imagesUI.findByName(i.name).enabled=!1}for(t=0;t<this.femaleSkins.length;t++){(i=this.femaleSkins[t].skin).enabled=!1,this.imagesUI.findByName(i.name).enabled=!1}var n;if((n=this.femaleSkins[this.femaleSkinIndex]).isRewardedSkin){(i=n.skin).enabled=!0,this.imagesUI.findByName(i.name).enabled=!0,this.rewardSkinBTN.enabled=!0,this.rewardSkinBTN.script.button.value=this.femaleSkinIndex}else{(i=n.skin).enabled=!0,this.imagesUI.findByName(i.name).enabled=!0,this.rewardSkinBTN.enabled=!1,this.app.fire("Customization:Character",i);s=this.femaleSkinIndex;this.skinUI.element.text=`${s}`,Utils.setItem("femaleSkinIndex",this.femaleSkinIndex)}}},Customization.prototype.onReward=function(){if("Male"==this.gender){var e=this.maleSkins[this.maleSkinIndex].skin;this.maleSkins[this.maleSkinIndex]={skin:e,isRewardedSkin:!1},this.app.fire("Customization:Character",e);var t=this.maleSkinIndex;this.skinUI.element.text=`${t}`,this.unlockedMaleSkinIndices.push(this.maleSkinIndex),Utils.setItemAsArray("unlockedMaleSkinIndices",this.unlockedMaleSkinIndices),Utils.setItem("maleSkinIndex",this.maleSkinIndex)}else if("Female"==this.gender){e=this.femaleSkins[this.femaleSkinIndex].skin;this.femaleSkins[this.femaleSkinIndex]={skin:e,isRewardedSkin:!1},this.app.fire("Customization:Character",e);t=this.femaleSkinIndex;this.skinUI.element.text=`${t}`,this.unlockedFemaleSkinIndices.push(this.femaleSkinIndex),Utils.setItemAsArray("unlockedFemaleSkinIndices",this.unlockedFemaleSkinIndices),Utils.setItem("femaleSkinIndex",this.femaleSkinIndex)}this.rewardSkinBTN.enabled=!1},Customization.prototype.onRewardCustomization=function(){PokiPlugin.showReward(this.bounceBack)},Customization.prototype.onPopUpHide=function(){if("Male"==this.gender)((e=this.maleSkins[this.maleSkinIndex]).isRewardedSkin||e.isRedirect)&&(this.maleSkinIndex=0,Utils.setItem("maleSkinIndex",this.maleSkinIndex),this.makeVisualChange());else if("Female"==this.gender){var e;(e=this.femaleSkins[this.femaleSkinIndex]).isRewardedSkin&&(this.femaleSkinIndex=0,Utils.setItem("femaleSkinIndex",this.femaleSkinIndex),this.makeVisualChange())}},Customization.prototype.setUpRewards=function(){for(var e=0;e<this.unlockedMaleSkinIndices.length;e++){var t=this.unlockedMaleSkinIndices[e];if(n=this.maleSkins[t]){var i=n.skin;this.maleSkins[t]={skin:i,isRewardedSkin:!1,isRedirect:!1}}}for(var s=0;s<this.unlockedFemaleSkinIndices.length;s++){var n;t=this.unlockedFemaleSkinIndices[s];if(n=this.femaleSkins[t]){i=n.skin;this.femaleSkins[t]={skin:i,isRewardedSkin:!1}}}},Customization.prototype.customizHair=function(e){var t=this.hairMat.resource;"Left"==e?this.hairColorNumber--:"Right"==e&&this.hairColorNumber++,this.hairColorNumber<0&&(this.hairColorNumber=20),this.hairColorNumber>20&&(this.hairColorNumber=0);var i=.06*this.hairColorNumber;t.diffuseMapOffset=new pc.Vec2(i,0),t.update(),this.hairColorNumberUI.element.text=`${this.hairColorNumber}`,Utils.setItem("hairColorNumber",this.hairColorNumber)},Customization.prototype.customizTShirt=function(e){var t=this.tShirtMat.resource;"Left"==e?this.tShirtColorNumber--:"Right"==e&&this.tShirtColorNumber++,this.tShirtColorNumber<0&&(this.tShirtColorNumber=20),this.tShirtColorNumber>20&&(this.tShirtColorNumber=0);var i=.06*this.tShirtColorNumber;t.diffuseMapOffset=new pc.Vec2(i,0),t.update(),this.tShirtColorNumberUI.element.text=`${this.tShirtColorNumber}`,Utils.setItem("tShirtColorNumber",this.tShirtColorNumber)},Customization.prototype.customizPants=function(e){var t=this.pantsMat.resource;"Left"==e?this.pantsColorNumber--:"Right"==e&&this.pantsColorNumber++,this.pantsColorNumber<0&&(this.pantsColorNumber=20),this.pantsColorNumber>20&&(this.pantsColorNumber=0);var i=.06*this.pantsColorNumber;t.diffuseMapOffset=new pc.Vec2(i,0),t.update(),this.pantsColorNumberUI.element.text=`${this.pantsColorNumber}`,Utils.setItem("pantsColorNumber",this.pantsColorNumber)},Customization.prototype.update=function(e){};var RewardManagerMain=pc.createScript("rewardManagerMain");RewardManagerMain.attributes.add("popupNames",{type:"json",schema:[{name:"name",type:"string"},{name:"callBackEvent",type:"string"},{name:"value",type:"number"}],array:!0}),RewardManagerMain.prototype.initialize=function(){this.triggeredEntity=null,this.callbackevent="",this.value=0,this.bounceBack=this.onReward.bind(this),this.app.on("RewardManagerMain:Show",this.onRewardTrigger,this),this.app.on("RewardManagerMain:MakeReward",this.makeReward,this)},RewardManagerMain.prototype.onRewardTrigger=function(a,e){for(var t=0;t<this.popupNames.length;t++){var i;if(a==this.popupNames[t].name)(i=this.app.root.findByName(this.popupNames[t].name))&&(i.enabled=!0,this.callbackevent=this.popupNames[t].callBackEvent,this.value=this.popupNames[t].value),Utils.addEvent(this.popupNames[t].name);else(i=this.app.root.findByName(this.popupNames[t].name))&&(i.enabled=!1)}this.triggeredEntity=e},RewardManagerMain.prototype.makeReward=function(){PokiPlugin.showReward(this.bounceBack)},RewardManagerMain.prototype.onReward=function(){this.app.fire(this.callbackevent,this.value),this.triggeredEntity.destroy(),this.app.fire("PopupManager:Hide")},RewardManagerMain.prototype.update=function(a){};var CustomShader=pc.createScript("customShader");CustomShader.attributes.add("vs",{type:"asset",assetType:"shader",title:"Vertex Shader"}),CustomShader.attributes.add("fs",{type:"asset",assetType:"shader",title:"Fragment Shader"}),CustomShader.prototype.initialize=function(){this.time=0;var e=this.app.graphicsDevice,t=this.vs.resource,a="precision "+e.precision+" float;\n";a+=this.fs.resource;var s={attributes:{aPosition:pc.SEMANTIC_POSITION,aUv0:pc.SEMANTIC_TEXCOORD0},vshader:t,fshader:a};this.shader=new pc.Shader(e,s),this.material=new pc.Material,this.material.shader=this.shader,this.material.setParameter("uTime",0);for(var r=this.entity.findComponents("render"),i=0;i<r.length;++i)for(var h=r[i].meshInstances,d=0;d<h.length;d++)h[d].material=this.material},CustomShader.prototype.update=function(e){this.time+=e,this.material.setParameter("uTime",this.time)};var RandomRender=pc.createScript("randomRender");RandomRender.attributes.add("renders",{type:"asset",array:!0}),RandomRender.prototype.initialize=function(){this.entity.render.asset=Utils.getRandom(this.renders)};var CinematicCamera=pc.createScript("cinematicCamera");CinematicCamera.prototype.initialize=function(){},CinematicCamera.prototype.update=function(a){};pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #283538;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0px;","    left: 0px;","    height: 100%;","    width: 100%;",'    background: url("https://assets.venge.io/ETW-Loading-v3.jpg") no-repeat center center;',"    background-size: contain;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #f60;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("div");a.id="progress-bar-container",t.appendChild(a);var n=document.createElement("div");n.id="progress-bar",a.appendChild(n)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));var CheckClosest=pc.createScript("checkClosest");CheckClosest.prototype.initialize=function(){this.lastClosestUpdate=-1,this.closestEntity=!1,this.entities=[],this.app.on("CheckClosest:Add",this.addRadiusObject,this),this.app.on("CheckClosest:Remove",this.removeRadiusObject,this)},CheckClosest.prototype.addRadiusObject=function(t){this.entities.push(t)},CheckClosest.prototype.removeRadiusObject=function(t){this.entities.splice(this.entity.indexOf(t),1)},CheckClosest.prototype.updateClosest=function(){if(Date.now()-this.lastClosestUpdate<1e3)return!1;this.radiusEntities=this.app.root.findByTag("Radius"),this.lastClosestUpdate=Date.now()},CheckClosest.prototype.findClosest=function(t){for(var s=1e3,e=!1,i=this.entities.length;i--;){var o=this.entities[i],n=this.entity.getPosition(),h=o.getPosition(),c=Utils.distance(n.x,n.z,h.x,h.z);c<o.script.interaction.radius&&c<s&&(s=c,e=this.entities[i])}e!=this.closestEntity&&!1!==this.closestEntity&&this.closestEntity.fire("triggerleave",this.entity),e&&!1!==e&&e!=this.closestEntity&&e.fire("triggerenter",this.entity),this.closestEntity=e},CheckClosest.prototype.update=function(t){this.findClosest()};var MusicManager=pc.createScript("musicManager");MusicManager.prototype.initialize=function(){this.loopIndex=0,this.musicLoops=[this.entity.sound.slots["Loop-1"],this.entity.sound.slots["Loop-2"],this.entity.sound.slots["Loop-2"],this.entity.sound.slots["Loop-2"],this.entity.sound.slots["Loop-3"],this.entity.sound.slots["Loop-3"],this.entity.sound.slots["Loop-3"]],this.playNextLoop()},MusicManager.prototype.playNextLoop=function(){if(0!==this.musicLoops.length){var o=this.musicLoops[this.loopIndex];o.play(),this.loopIndex=(this.loopIndex+1)%this.musicLoops.length,o.once("end",function(){this.playNextLoop()}.bind(this))}},MusicManager.prototype.update=function(o){};var HideClosestPlayer=pc.createScript("hideClosestPlayer");HideClosestPlayer.attributes.add("playerHolder",{type:"entity"}),HideClosestPlayer.prototype.initialize=function(){this.lastEnemyUpdate=-1},HideClosestPlayer.prototype.updateEnemies=function(e){if(Date.now()-this.lastEnemyUpdate<5e3)return!1;this.playerEntities=this.playerHolder.findByTag("Enemy"),this.lastEnemyUpdate=Date.now()},HideClosestPlayer.prototype.hideClosest=function(e){for(var t=this.playerEntities,i=null,s=1e3,a=0;a<t.length;a++){var l=t[a],n=l.getPosition().clone().distance(this.entity.getPosition());n<7&&n<s&&(s=n,i=l)}i&&i.script&&i.script.enemy&&(i.script.enemy.materialOpacity=.1)},HideClosestPlayer.prototype.update=function(e){this.updateEnemies(),this.hideClosest()};var GroudWithPath=pc.createScript("groudWithPath");GroudWithPath.attributes.add("grassBlock",{type:"entity"}),GroudWithPath.attributes.add("pathBlock",{type:"entity"}),GroudWithPath.attributes.add("pathMap",{type:"asset",assetType:"texture"}),GroudWithPath.attributes.add("width",{type:"number",default:80}),GroudWithPath.attributes.add("length",{type:"number",default:80}),GroudWithPath.prototype.initialize=function(){var t=this.pathMap.resource.getSource();this.buffer=this.getImageData(t),this.createGround(t.width,this.buffer);var e=this.entity.findByName("Map");e&&(e.enabled=!1)},GroudWithPath.prototype.getImageData=function(t){var e=document.createElement("canvas"),a=e.getContext("2d"),i=t.width,h=t.height;return e.width=i,e.height=h,a.drawImage(t,0,0),a.getImageData(0,0,i,h).data},GroudWithPath.prototype.createGround=function(t,e){for(var a=0;a<=this.width;a++)for(var i=0;i<=this.length;i++){e[4*(i*t+a)]/255>.5?this.insertBox("Path",a,i):this.insertBox("Grass",a,i)}},GroudWithPath.prototype.insertBox=function(t,e,a){if("Grass"==t)(i=this.grassBlock.clone()).name=this.entity.name+"-"+e+"-"+a,i.setLocalPosition(e,0,a),i.enabled=!0,this.entity.addChild(i);else if("Path"==t){var i;(i=this.pathBlock.clone()).name=this.entity.name+"-"+e+"-"+a,i.setLocalPosition(e,0,a),i.enabled=!0,this.entity.addChild(i)}},GroudWithPath.prototype.update=function(t){};var SeaTree=pc.createScript("seaTree");SeaTree.attributes.add("trunkEntity",{type:"entity"}),SeaTree.attributes.add("leavesEntity",{type:"entity"}),SeaTree.prototype.initialize=function(){this.trunkParentName=this.trunkEntity.parent.name,this.isSeparated=!1,this.startPos=this.leavesEntity.getPosition().clone(),this.targetPos=this.leavesEntity.getPosition().clone().add(new pc.Vec3(0,50,0)),this.isleavesDestroyed=!1,this.time=1e-7},SeaTree.prototype.onTrunkGetSeparation=function(){setTimeout((()=>{this.isleavesDestroyed=!0,this.leavesEntity.destroy()}),2e3)},SeaTree.prototype.updateMovement=function(t){if(!this.isleavesDestroyed&&this.isSeparated){var e=new pc.Vec3;e.lerp(this.startPos,this.targetPos,this.time),this.leavesEntity.rigidbody.teleport(e),this.time+=.1*t}},SeaTree.prototype.update=function(t){if(!this.trunkEntity.parent)return!1;this.trunkParentName==this.trunkEntity.parent.name||this.isSeparated||(this.onTrunkGetSeparation(),this.isSeparated=!0),this.updateMovement(t)};var ConnectedScene=pc.createScript("connectedScene");ConnectedScene.attributes.add("sceneEntity",{type:"entity"}),ConnectedScene.attributes.add("disableEntity",{type:"entity"}),ConnectedScene.prototype.initialize=function(){this.onStateChange(!0),this.on("state",this.onStateChange,this)},ConnectedScene.prototype.onStateChange=function(e){this.sceneEntity.enabled=e,this.disableEntity&&(this.disableEntity.enabled=!e)};var FreeCamera=pc.createScript("freeCamera");FreeCamera.attributes.add("speed",{type:"number",default:.1}),FreeCamera.attributes.add("sensivity",{type:"number",default:.1}),FreeCamera.attributes.add("toolEntity",{type:"entity"}),FreeCamera.prototype.initialize=function(){this.isForward=0,this.isBackward=0,this.isLeft=0,this.isRight=0,this.isUp=0,this.currentSpeed=0,this.isLeftClick=!1,this.isRightClick=!1,this.stopMovement=!1,this.startPosition=this.entity.getPosition().clone(),this.lookX=-123,this.lookY=30,this.app.mouse.on("mousedown",this.onMouseDown,this),this.app.mouse.on("mousemove",this.onMouseMove,this),this.app.mouse.on("mouseup",this.onMouseUp,this),this.isPressing={},this.app.keyboard.on("keydown",this.onKeyDown,this),this.app.keyboard.on("keyup",this.onKeyUp,this),this.app.on("Loader:Load",this.onLoad,this),this.app.on("Touch:Joystick",this.onJoystickMovement,this),this.app.on("Touch:Direction",this.onJoystickDirection,this),window.oncontextmenu=function(){return!1},this.getCameraState(),setInterval((function(t){t.saveCameraState()}),2500,this)},FreeCamera.prototype.onJoystickDirection=function(t,i){this.lookX+=t*this.sensivity,this.lookY+=i*this.sensivity},FreeCamera.prototype.onJoystickMovement=function(t,i){var s=.016*this.speed;"UP"==i&&(this.isForward=pc.math.lerp(this.isForward,-s,.1)),"DOWN"==i&&(this.isForward=pc.math.lerp(this.isForward,s,.1)),"LEFT"==t&&(this.isLeft=pc.math.lerp(this.isLeft,-s,.1)),"RIGHT"==t&&(this.isLeft=pc.math.lerp(this.isLeft,s,.1))},FreeCamera.prototype.onLoad=function(t){this.entity.setPosition(this.startPosition),this.lookX=-123,this.lookY=30},FreeCamera.prototype.reset=function(t){this.isForward=0,this.isBackward=0,this.isLeft=0,this.isRight=0,this.isUp=0,this.isPressing[pc.KEY_W]=!1,this.isPressing[pc.KEY_S]=!1,this.isPressing[pc.KEY_A]=!1,this.isPressing[pc.KEY_D]=!1,this.isPressing[pc.KEY_Q]=!1,this.isPressing[pc.KEY_E]=!1},FreeCamera.prototype.onKeyDown=function(t){if(t.event.metaKey||t.event.ctrlKey)return!1;this.isPressing[t.key]=!0},FreeCamera.prototype.onKeyUp=function(t){t.event.metaKey||t.event.ctrlKey?(this.stopMovement=!0,this.reset()):this.stopMovement=!1,this.isPressing[t.key]=!1},FreeCamera.prototype.getCameraState=function(){var t=window.localStorage.getItem(Utils.prefix+"CameraState");t&&(t=JSON.parse(t),this.entity.setLocalPosition(t.posX,t.posY,t.posZ),this.lookX=t.lookX,this.lookY=t.lookY)},FreeCamera.prototype.saveCameraState=function(){var t=this.entity.getLocalPosition(),i={lookX:this.lookX,lookY:this.lookY,posX:t.x,posY:t.y,posZ:t.z};window.localStorage.setItem(Utils.prefix+"CameraState",JSON.stringify(i))},FreeCamera.prototype.onMouseDown=function(t){2==t.button&&(this.isRightClick=!0,this.app.mouse.enablePointerLock()),0===t.button&&(this.isLeftClick=!0)},FreeCamera.prototype.onMouseMove=function(t){this.isRightClick&&(this.lookX+=t.dx*this.sensivity,this.lookY+=t.dy*this.sensivity)},FreeCamera.prototype.onMouseUp=function(t){2==t.button&&(this.isRightClick=!1,this.app.mouse.disablePointerLock()),0===t.button&&(this.isLeftClick=!1,this.app.fire("Tool:Disable",!0))},FreeCamera.prototype.setKeyboard=function(t){var i=this.speed*t;if(this.app.keyboard.isPressed(pc.KEY_SHIFT)&&(i*=2),this.isForward=pc.math.lerp(this.isForward,0,.08),this.isLeft=pc.math.lerp(this.isLeft,0,.08),this.isUp=pc.math.lerp(this.isUp,0,.08),this.isPressing[pc.KEY_W]&&(this.isForward=pc.math.lerp(this.isForward,-i,.1)),this.isPressing[pc.KEY_S]&&(this.isForward=pc.math.lerp(this.isForward,i,.1)),this.isPressing[pc.KEY_A]&&(this.isLeft=pc.math.lerp(this.isLeft,-i,.1)),this.isPressing[pc.KEY_D]&&(this.isLeft=pc.math.lerp(this.isLeft,i,.1)),this.isPressing[pc.KEY_Q]&&(this.isUp=pc.math.lerp(this.isUp,-i,.1)),this.isPressing[pc.KEY_E]&&(this.isUp=pc.math.lerp(this.isUp,i,.1)),this.stopMovement)return!1;this.entity.translateLocal(this.isLeft,0,this.isForward),this.entity.translate(0,this.isUp,0)},FreeCamera.prototype.setAngle=function(){this.entity.setLocalEulerAngles(-this.lookY,-this.lookX,0)},FreeCamera.prototype.setSize=function(){if(!this.toolEntity)return!1;var t=this.toolEntity.getPosition().sub(this.entity.getPosition()).length();t/=10,this.toolEntity.setLocalScale(t,t,t)},FreeCamera.prototype.update=function(t){return"INPUT"!=document.activeElement.tagName&&(!pc.isPlaying&&(this.setKeyboard(t),this.setSize(),void this.setAngle()))};